# 🔧 直播间数量显示问题已修复

## ❌ 之前的问题

- 即使没有直播，也显示"3个直播间"
- 红色徽章一直显示

## ✅ 修复内容

更新了 `pages/live/entrance.vue` 中的 `fetchLiveCount` 函数：

```typescript
const fetchLiveCount = async () => {
  try {
    const response = await uni.request({
      url: 'http://localhost:3000/api/webrtc/rooms',
      method: 'GET'
    })
    
    if (response.statusCode === 200 && response.data) {
      const data = response.data as any
      if (data.success && data.data) {
        liveCount.value = data.data.length || 0  // ← 确保是数字
        console.log('当前直播间数量:', liveCount.value)
      } else {
        liveCount.value = 0  // ← 失败时设为 0
      }
    } else {
      liveCount.value = 0  // ← 请求失败时设为 0
    }
  } catch (error) {
    console.error('获取直播间数量失败:', error)
    liveCount.value = 0  // ← 异常时设为 0
  }
}
```

## 🧪 测试步骤

### 测试 1: 没有直播时

1. **确保没有医生在直播**
2. **刷新页面** (`Ctrl + F5`)
3. **点击首页的"医生直播"**
4. **预期结果：**
   - ✅ "观看直播"卡片**不显示**红色徽章
   - ✅ 没有"3个直播间"的文字

### 测试 2: 有直播时

1. **医生端开启直播**
   - 访问 `/pages/doctor/live`
   - 输入主题，点击"开始直播"

2. **刷新入口页面**
3. **预期结果：**
   - ✅ "观看直播"卡片**显示**红色徽章
   - ✅ 显示"🔴 1个直播间"

### 测试 3: 多个直播时

1. **多个医生开启直播**（可以用不同浏览器）
2. **刷新入口页面**
3. **预期结果：**
   - ✅ 显示"🔴 2个直播间"或"🔴 3个直播间"

## 📊 显示逻辑

```vue
<!-- 只有当 liveCount > 0 时才显示徽章 -->
<view class="card-badge" v-if="liveCount > 0">
  <view class="badge-dot"></view>
  <text class="badge-text">{{ liveCount }}个直播间</text>
</view>
```

## 🔍 调试方法

### 方法 1: 查看浏览器控制台

打开控制台（F12），应该看到：

```
当前直播间数量: 0  ← 没有直播时
当前直播间数量: 1  ← 有1个直播时
当前直播间数量: 2  ← 有2个直播时
```

### 方法 2: 直接访问 API

在浏览器中访问：
```
http://localhost:3000/api/webrtc/rooms
```

**没有直播时返回：**
```json
{
  "success": true,
  "data": []
}
```

**有直播时返回：**
```json
{
  "success": true,
  "data": [
    {
      "roomId": "room_1234567890",
      "doctorId": "doctor_1234567890",
      "doctorName": "王医生",
      "title": "心血管健康科普",
      "startTime": 1234567890000,
      "viewerCount": 0
    }
  ]
}
```

## 🎯 界面效果

### 没有直播时

```
┌─────────────────────────────┐
│  ┌───────────────────────┐  │
│  │ 📺  观看直播          │  │
│  │  观看医生直播，学习   │  │
│  │  健康知识             │  │
│  │                  →   │  │  ← 没有红色徽章
│  └───────────────────────┘  │
└─────────────────────────────┘
```

### 有直播时

```
┌─────────────────────────────┐
│  ┌───────────────────────┐  │
│  │ 📺  观看直播          │  │
│  │  观看医生直播，学习   │  │
│  │  健康知识             │  │
│  │  🔴 2个直播间    →   │  │  ← 显示红色徽章
│  └───────────────────────┘  │
└─────────────────────────────┘
```

## ✅ 完成！

现在：
- ✅ 没有直播时，不显示徽章
- ✅ 有直播时，显示正确的数量
- ✅ 红色圆点动画只在有直播时显示
- ✅ 用户体验更准确

**刷新页面测试一下吧！** 🚀

