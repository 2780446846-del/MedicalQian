if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(e,t){return"string"==typeof e?t:e}const o=((t,a=0)=>(a,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,o)})("onLoad",2),n=[{font_class:"arrow-down",unicode:"îš¾"},{font_class:"arrow-left",unicode:"îš¼"},{font_class:"arrow-right",unicode:"îš»"},{font_class:"arrow-up",unicode:"îš½"},{font_class:"auth",unicode:"îš«"},{font_class:"auth-filled",unicode:"î›Œ"},{font_class:"back",unicode:"îš¹"},{font_class:"bars",unicode:"î˜§"},{font_class:"calendar",unicode:"îš "},{font_class:"calendar-filled",unicode:"î›€"},{font_class:"camera",unicode:"î™š"},{font_class:"camera-filled",unicode:"î™˜"},{font_class:"cart",unicode:"î˜±"},{font_class:"cart-filled",unicode:"î›"},{font_class:"chat",unicode:"î™"},{font_class:"chat-filled",unicode:"î™™"},{font_class:"chatboxes",unicode:"îš–"},{font_class:"chatboxes-filled",unicode:"îš’"},{font_class:"chatbubble",unicode:"îš—"},{font_class:"chatbubble-filled",unicode:"îš”"},{font_class:"checkbox",unicode:"î˜«"},{font_class:"checkbox-filled",unicode:"î˜¬"},{font_class:"checkmarkempty",unicode:"î™œ"},{font_class:"circle",unicode:"î™›"},{font_class:"circle-filled",unicode:"î™"},{font_class:"clear",unicode:"î™­"},{font_class:"close",unicode:"î™³"},{font_class:"closeempty",unicode:"î™¬"},{font_class:"cloud-download",unicode:"î™‡"},{font_class:"cloud-download-filled",unicode:"î™†"},{font_class:"cloud-upload",unicode:"î™…"},{font_class:"cloud-upload-filled",unicode:"î™ˆ"},{font_class:"color",unicode:"î›"},{font_class:"color-filled",unicode:"î›‰"},{font_class:"compose",unicode:"î™¿"},{font_class:"contact",unicode:"îš“"},{font_class:"contact-filled",unicode:"îš•"},{font_class:"down",unicode:"îš¸"},{font_class:"bottom",unicode:"îš¸"},{font_class:"download",unicode:"îš"},{font_class:"download-filled",unicode:"îš"},{font_class:"email",unicode:"îš"},{font_class:"email-filled",unicode:"îšš"},{font_class:"eye",unicode:"î™‘"},{font_class:"eye-filled",unicode:"î™ª"},{font_class:"eye-slash",unicode:"îš³"},{font_class:"eye-slash-filled",unicode:"îš´"},{font_class:"fire",unicode:"îš¡"},{font_class:"fire-filled",unicode:"î›…"},{font_class:"flag",unicode:"î™Ÿ"},{font_class:"flag-filled",unicode:"î™ "},{font_class:"folder-add",unicode:"îš©"},{font_class:"folder-add-filled",unicode:"î›ˆ"},{font_class:"font",unicode:"îš£"},{font_class:"forward",unicode:"îšº"},{font_class:"gear",unicode:"î™¤"},{font_class:"gear-filled",unicode:"î™¡"},{font_class:"gift",unicode:"îš¤"},{font_class:"gift-filled",unicode:"î›„"},{font_class:"hand-down",unicode:"î˜½"},{font_class:"hand-down-filled",unicode:"î˜¼"},{font_class:"hand-up",unicode:"î˜¿"},{font_class:"hand-up-filled",unicode:"î˜¾"},{font_class:"headphones",unicode:"î˜°"},{font_class:"heart",unicode:"î˜¹"},{font_class:"heart-filled",unicode:"î™"},{font_class:"help",unicode:"î™¹"},{font_class:"help-filled",unicode:"î™´"},{font_class:"home",unicode:"î™¢"},{font_class:"home-filled",unicode:"î™£"},{font_class:"image",unicode:"î™°"},{font_class:"image-filled",unicode:"î™¸"},{font_class:"images",unicode:"î™"},{font_class:"images-filled",unicode:"î™‹"},{font_class:"info",unicode:"î™©"},{font_class:"info-filled",unicode:"î™‰"},{font_class:"left",unicode:"îš·"},{font_class:"link",unicode:"îš¥"},{font_class:"list",unicode:"î™„"},{font_class:"location",unicode:"îš®"},{font_class:"location-filled",unicode:"îš¯"},{font_class:"locked",unicode:"î™«"},{font_class:"locked-filled",unicode:"î™¨"},{font_class:"loop",unicode:"î˜³"},{font_class:"mail-open",unicode:"î™ƒ"},{font_class:"mail-open-filled",unicode:"î˜º"},{font_class:"map",unicode:"î™§"},{font_class:"map-filled",unicode:"î™¦"},{font_class:"map-pin",unicode:"îš­"},{font_class:"map-pin-ellipse",unicode:"îš¬"},{font_class:"medal",unicode:"îš¢"},{font_class:"medal-filled",unicode:"î›ƒ"},{font_class:"mic",unicode:"î™±"},{font_class:"mic-filled",unicode:"î™·"},{font_class:"micoff",unicode:"î™¾"},{font_class:"micoff-filled",unicode:"îš°"},{font_class:"minus",unicode:"î™¯"},{font_class:"minus-filled",unicode:"î™½"},{font_class:"more",unicode:"î™"},{font_class:"more-filled",unicode:"î™"},{font_class:"navigate",unicode:"î™®"},{font_class:"navigate-filled",unicode:"î™º"},{font_class:"notification",unicode:"îš¦"},{font_class:"notification-filled",unicode:"î›"},{font_class:"paperclip",unicode:"î™’"},{font_class:"paperplane",unicode:"î™²"},{font_class:"paperplane-filled",unicode:"î™µ"},{font_class:"person",unicode:"îš™"},{font_class:"person-filled",unicode:"îš"},{font_class:"personadd",unicode:"îšŸ"},{font_class:"personadd-filled",unicode:"îš˜"},{font_class:"personadd-filled-copy",unicode:"î›‘"},{font_class:"phone",unicode:"îšœ"},{font_class:"phone-filled",unicode:"îš›"},{font_class:"plus",unicode:"î™¶"},{font_class:"plus-filled",unicode:"î›‡"},{font_class:"plusempty",unicode:"î™»"},{font_class:"pulldown",unicode:"î˜²"},{font_class:"pyq",unicode:"îš‚"},{font_class:"qq",unicode:"îš€"},{font_class:"redo",unicode:"î™Š"},{font_class:"redo-filled",unicode:"î™•"},{font_class:"refresh",unicode:"î™—"},{font_class:"refresh-filled",unicode:"î™–"},{font_class:"refreshempty",unicode:"îš¿"},{font_class:"reload",unicode:"îš²"},{font_class:"right",unicode:"îšµ"},{font_class:"scan",unicode:"î˜ª"},{font_class:"search",unicode:"î™”"},{font_class:"settings",unicode:"î™“"},{font_class:"settings-filled",unicode:"î›"},{font_class:"shop",unicode:"î˜¯"},{font_class:"shop-filled",unicode:"î›"},{font_class:"smallcircle",unicode:"î™¼"},{font_class:"smallcircle-filled",unicode:"î™¥"},{font_class:"sound",unicode:"îš„"},{font_class:"sound-filled",unicode:"îš†"},{font_class:"spinner-cycle",unicode:"îšŠ"},{font_class:"staff",unicode:"îš§"},{font_class:"staff-filled",unicode:"î›‹"},{font_class:"star",unicode:"îšˆ"},{font_class:"star-filled",unicode:"îš"},{font_class:"starhalf",unicode:"îšƒ"},{font_class:"trash",unicode:"îš‡"},{font_class:"trash-filled",unicode:"îš…"},{font_class:"tune",unicode:"îšª"},{font_class:"tune-filled",unicode:"î›Š"},{font_class:"undo",unicode:"î™"},{font_class:"undo-filled",unicode:"î™Œ"},{font_class:"up",unicode:"îš¶"},{font_class:"top",unicode:"îš¶"},{font_class:"upload",unicode:"îš"},{font_class:"upload-filled",unicode:"îš"},{font_class:"videocam",unicode:"îšŒ"},{font_class:"videocam-filled",unicode:"îš‰"},{font_class:"vip",unicode:"îš¨"},{font_class:"vip-filled",unicode:"î›†"},{font_class:"wallet",unicode:"îš±"},{font_class:"wallet-filled",unicode:"î›‚"},{font_class:"weibo",unicode:"îš‹"},{font_class:"weixin",unicode:"îš‘"}],s=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a};const i=s({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:n}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(i.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:a[0]||(a[0]=(...e)=>i._onClick&&i._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-5610c8db"]]),r={light:{name:"light",bgColor:"#f3f5fb",cardBg:"#ffffff",textColor:"#333333",textColorSecondary:"#666666",textColorTertiary:"#999999",borderColor:"#e5e5e5",primaryColor:"#4a90e2",shadowColor:"rgba(0, 0, 0, 0.06)"},dark:{name:"dark",bgColor:"#1a1a1a",cardBg:"#2d2d2d",textColor:"#ffffff",textColorSecondary:"#cccccc",textColorTertiary:"#999999",borderColor:"#404040",primaryColor:"#5ba0f2",shadowColor:"rgba(0, 0, 0, 0.3)"}};function l(){try{const e=uni.getStorageSync("appTheme")||"light";return r[e]||r.light}catch(Kt){return r.light}}function c(){return function(e){if(r[e])try{uni.setStorageSync("appTheme",e);const t=getApp();if(t&&t.globalData&&(t.globalData.currentTheme=e,t.globalData.theme=r[e]),"undefined"!=typeof document&&document.documentElement){document.documentElement.setAttribute("data-theme",e);const t=r[e],a=document.documentElement;a.style.setProperty("--bg-color",t.bgColor),a.style.setProperty("--card-bg",t.cardBg),a.style.setProperty("--text-color",t.textColor),a.style.setProperty("--text-color-secondary",t.textColorSecondary),a.style.setProperty("--text-color-tertiary",t.textColorTertiary),a.style.setProperty("--border-color",t.borderColor),a.style.setProperty("--primary-color",t.primaryColor),a.style.setProperty("--shadow-color",t.shadowColor)}try{const e=getCurrentPages();if(e&&e.length>0){const t=e[e.length-1];t.$vm&&t.$vm.$forceUpdate&&t.$vm.$forceUpdate()}}catch(Kt){}if("undefined"!=typeof uni&&uni.setTabBarStyle)try{const t=getCurrentPages();if(t&&t.length>0){const a=t[t.length-1],o=["pages/index/index","pages/doctor/doctor","pages/yishuo/yishuo","pages/mine/mine"],n=a.route;if(n&&o.includes(n)){const t=r[e],a=uni.setTabBarStyle({color:"#999999",selectedColor:t.primaryColor,backgroundColor:t.cardBg,borderStyle:"dark"===e?"white":"black"});a&&"function"==typeof a.catch&&a.catch((()=>{}))}}}catch(Kt){}return uni.$emit("themeChange",r[e]),r[e]}catch(Kt){return t("error","at utils/theme.js:133","è®¾ç½®ä¸»é¢˜å¤±è´¥:",Kt),r.light}else t("warn","at utils/theme.js:49","æ— æ•ˆçš„ä¸»é¢˜åç§°:",e)}("light"===l().name?"dark":"light")}const d=s({name:"ThemeToggle",setup(){const t=e.ref(!1),a=()=>{const e=l();t.value="dark"===e.name};return e.onMounted((()=>{a(),uni.$on("themeChange",a)})),e.onUnmounted((()=>{uni.$off("themeChange",a)})),{isDark:t,handleToggle:()=>{const e=c();if(t.value="dark"===e.name,uni.vibrateShort)try{uni.vibrateShort()}catch(Kt){}}}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["theme-toggle",{"theme-toggle-dark":n.isDark}]),onClick:a[0]||(a[0]=(...e)=>n.handleToggle&&n.handleToggle(...e))},[e.createElementVNode("view",{class:e.normalizeClass(["theme-icon",{"theme-icon-dark":n.isDark}])},[n.isDark?(e.openBlock(),e.createElementBlock("text",{key:1,class:"icon-moon"},"ğŸŒ™")):(e.openBlock(),e.createElementBlock("text",{key:0,class:"icon-sun"},"â˜€ï¸"))],2)],2)}],["__scopeId","data-v-07679477"]]),u="yishuo_articles";function m(){try{const e=uni.getStorageSync(u);return e?JSON.parse(e):[]}catch(e){return t("error","at utils/articleStorage.js:15","è·å–æ–‡ç« åˆ—è¡¨å¤±è´¥:",e),[]}}const p=e.defineComponent({__name:"index",setup(o){const n=e.ref("all"),s=e.ref("selected"),r=e.ref("åŒ—äº¬"),l=e.ref([{id:1,name:"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢",distance:"3.8km",appointments:"1950",image:"/static/hospital/hospital.png"},{id:2,name:"åŒ—äº¬å„¿ç«¥åŒ»é™¢",distance:"5.2km",appointments:"3240",image:"/static/hospital/hospital2.png"},{id:3,name:"åŒ—äº¬åå’ŒåŒ»é™¢",distance:"2.5km",appointments:"2580",image:"/static/hospital/hospital3.png"}]),c=e.ref([{id:1,name:"å†…ç§‘",icon:"ğŸ«€"},{id:2,name:"å¤–ç§‘",icon:"ğŸ’‰"},{id:3,name:"å„¿ç§‘",icon:"ğŸ‘¶"},{id:4,name:"å¦‡äº§ç§‘",icon:"ğŸ‘©â€ğŸ¼"},{id:5,name:"çœ¼ç§‘",icon:"ğŸ‘ï¸"},{id:6,name:"å£è…”ç§‘",icon:"ğŸ¦·"},{id:7,name:"çš®è‚¤ç§‘",icon:"ğŸ©¹"},{id:8,name:"éª¨ç§‘",icon:"ğŸ¦´"},{id:9,name:"ç¥ç»å†…ç§‘",icon:"ğŸ§ "},{id:10,name:"å¿ƒè¡€ç®¡å†…ç§‘",icon:"â¤ï¸"}]),u=e.ref([{id:1,name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",department:"å¿ƒè¡€ç®¡å†…ç§‘",specialties:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{id:2,name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",department:"å¿ƒè¡€ç®¡å†…ç§‘",specialties:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/2.jpg"},{id:3,name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",department:"å¿ƒè¡€ç®¡å†…ç§‘",specialties:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/3.jpg"},{id:4,name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",department:"å¿ƒè¡€ç®¡å†…ç§‘",specialties:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/4.jpg"},{id:5,name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",department:"å¿ƒè¡€ç®¡å†…ç§‘",specialties:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/5.jpg"}]),p=e.ref([]),h=e=>{if(!e)return"";const t=String(e).trim();if(t.startsWith("http://")||t.startsWith("https://"))return t;if(t.startsWith("/static/"))return t;let a="http://localhost:3000/api".replace(/\/api$/,"");return a&&"/"!==a&&!a.startsWith("/")||(a="http://localhost:3000"),`${a}${t}`},g=e=>{if(!e)return"";const t=String(e).trim();return t.startsWith("http://")||t.startsWith("https://")?t:h(t)},v=e=>e.image&&"/static/logo.png"!==e.image&&""!==e.image.trim()?e.image.startsWith("http://")||e.image.startsWith("https://")?e.image:h(e.image):null,f=()=>{try{const e=m();p.value=(e||[]).slice(0,4)}catch(e){t("error","at pages/index/index.vue:492","åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:",e),p.value=[]}},w=e=>{n.value=e,t("log","at pages/index/index.vue:501","åˆ‡æ¢åˆ°åˆ†ç±»:",e)},y=()=>{uni.navigateTo({url:"/pages/online-consult/index"})},E=()=>{uni.navigateTo({url:"/pages/live/entrance"})},k=()=>{uni.navigateTo({url:"/pages/doctor/appointment-register"})},N=()=>{uni.navigateTo({url:"/pages/online-consult/index"})},V=()=>{try{uni.navigateTo({url:"/pages/specialty-hospital/index?view=all",fail:e=>{t("error","at pages/index/index.vue:584","é¡µé¢è·³è½¬å¤±è´¥:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none",duration:2e3})}})}catch(e){t("error","at pages/index/index.vue:593","è·³è½¬å¼‚å¸¸:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¼‚å¸¸",icon:"none"})}},C=e=>{s.value=e},x=()=>{uni.navigateTo({url:"/pages/yishuo/article-list",fail:e=>{t("error","at pages/index/index.vue:643","è·³è½¬å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},b=()=>{try{uni.navigateTo({url:`/pages/city/index?city=${encodeURIComponent(r.value)}`,fail:e=>{t("error","at pages/index/index.vue:672","é¡µé¢è·³è½¬å¤±è´¥:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡æ–°è¿è¡Œé¡¹ç›®",icon:"none",duration:2e3})}})}catch(e){t("error","at pages/index/index.vue:681","è·³è½¬å¼‚å¸¸:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¼‚å¸¸",icon:"none"})}};return e.onMounted((()=>{(uni.getStorageSync("token")||(uni.reLaunch({url:"/pages/login/login",fail:e=>{t("error","at pages/index/index.vue:287","è·³è½¬åˆ°ç™»å½•é¡µå¤±è´¥:",e),uni.redirectTo({url:"/pages/login/login"})}}),0))&&((()=>{const e=uni.getStorageSync("currentCity");e&&(r.value=e)})(),f())})),e.onUnmounted((()=>{"undefined"!=typeof uni&&uni.$off&&(uni.$off("cityChanged"),uni.$off("articleReadCountUpdated"),uni.$off("articlesUpdated"))})),"undefined"!=typeof uni&&uni.$on&&(uni.$on("cityChanged",(e=>{r.value=e,uni.setStorageSync("currentCity",e)})),uni.$on("articleReadCountUpdated",(e=>{if(e&&e.articleId){const t=p.value.find((t=>t.id===e.articleId));t&&e.readCount&&(t.readCount=e.readCount)}})),uni.$on("articlesUpdated",(()=>{f()}))),(o,m)=>{const h=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-header"},[e.createElementVNode("view",{class:"status-bar"}),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"location",onClick:b},[e.createVNode(h,{type:"location",size:"18",color:"#333"}),e.createElementVNode("text",{class:"location-text"},e.toDisplayString(r.value),1)]),e.createElementVNode("view",{class:"search-box"},[e.createVNode(h,{type:"search",size:"18",color:"#999"}),e.createElementVNode("input",{class:"search-input",type:"text",placeholder:"æœç´¢åŒ»é™¢ã€ç§‘å®¤ã€ç–¾ç—…ã€åŒ»ç”Ÿ","placeholder-class":"placeholder"})]),e.createElementVNode("view",{class:"chat-icon"},[e.createVNode(h,{type:"chatbubbles",size:"20",color:"#333"})])])]),e.createElementVNode("view",{class:"promo-banner"},[e.createElementVNode("view",{class:"banner-main"},[e.createElementVNode("view",{class:"banner-content"},[e.createElementVNode("view",{class:"banner-text"},[e.createElementVNode("view",{class:"banner-title"},"éšæ—¶éšåœ°é—®åŒ»ç”Ÿ"),e.createElementVNode("view",{class:"banner-subtitle"},"ä¸‰ç”²ä¸“å®¶ 5åˆ†é’Ÿå¿«é€Ÿå›å¤"),e.createElementVNode("view",{class:"banner-desc"},"äº’è”ç½‘åŒ»é™¢ 24å°æ—¶åœ¨çº¿")]),e.createElementVNode("button",{class:"consult-btn",onClick:y},"ç«‹å³å’¨è¯¢")]),e.createElementVNode("view",{class:"banner-image"},[e.createElementVNode("view",{class:"doctor-placeholder"},"ğŸ‘©â€âš•ï¸")])]),e.createElementVNode("view",{class:"live-banner",onClick:E},[e.createElementVNode("view",{class:"live-info"},[e.createElementVNode("view",{class:"live-title"},"åŒ»ç”Ÿç›´æ’­"),e.createElementVNode("view",{class:"live-subtitle"},"ååŒ»å®æ—¶è®²è§£ï¼Œåœ¨çº¿ç­”ç–‘")]),e.createElementVNode("view",{class:"live-status"},[e.createElementVNode("view",{class:"live-dot"}),e.createElementVNode("text",{class:"live-status-text"},"ç›´æ’­ä¸­")])])]),e.createElementVNode("view",{class:"service-cards"},[e.createElementVNode("view",{class:"service-card",onClick:k},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"card-title"},"é¢„çº¦æŒ‚å·"),e.createVNode(h,{type:"arrowright",size:"16",color:"#999"})]),e.createElementVNode("view",{class:"card-subtitle"},"å…¨å›½4000+åŒ»é™¢"),e.createElementVNode("view",{class:"card-tag orange"},"äº’è”ç½‘åŒ»é™¢"),e.createElementVNode("view",{class:"card-bg-icon"},"â•")]),e.createElementVNode("view",{class:"service-card",onClick:N},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"card-title"},"åœ¨çº¿é—®è¯Š"),e.createVNode(h,{type:"arrowright",size:"16",color:"#999"})]),e.createElementVNode("view",{class:"card-subtitle"},"çŸ¥åä¸“å®¶,5åˆ†é’Ÿå›å¤"),e.createElementVNode("view",{class:"card-tag blue"},[e.createElementVNode("text",{class:"lightning"},"âš¡"),e.createElementVNode("text",null,"æ€¥é€Ÿ")]),e.createElementVNode("view",{class:"card-bg-icon"},"ğŸ©º")])]),e.createElementVNode("view",{class:"hospital-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"çƒ­é—¨åŒ»é™¢"),e.createElementVNode("scroll-view",{class:"category-tabs","scroll-x":"","show-scrollbar":"false"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"all"===n.value}]),onClick:m[0]||(m[0]=e=>w("all"))},"å…¨éƒ¨",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"comprehensive"===n.value}]),onClick:m[1]||(m[1]=e=>w("comprehensive"))},"ç»¼åˆåŒ»é™¢",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"children"===n.value}]),onClick:m[2]||(m[2]=e=>w("children"))},"å„¿ç«¥åŒ»é™¢",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"women"===n.value}]),onClick:m[3]||(m[3]=e=>w("women"))},"å¦‡äº§åŒ»é™¢",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"orthopedics"===n.value}]),onClick:m[4]||(m[4]=e=>w("orthopedics"))},"éª¨ç§‘åŒ»é™¢",2)])]),e.createElementVNode("scroll-view",{class:"hospital-scroll","scroll-x":"","show-scrollbar":"false"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"hospital-card",onClick:e=>(e=>{try{uni.navigateTo({url:`/pages/hospital-detail/index?name=${encodeURIComponent(e.name)}&distance=${encodeURIComponent(e.distance)}&id=${e.id}`,fail:e=>{t("error","at pages/index/index.vue:538","é¡µé¢è·³è½¬å¤±è´¥:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none",duration:2e3})}})}catch(a){t("error","at pages/index/index.vue:547","è·³è½¬å¼‚å¸¸:",a),uni.showToast({title:"é¡µé¢è·³è½¬å¼‚å¸¸",icon:"none"})}})(a)},[e.createElementVNode("view",{class:"hospital-image"},[e.createElementVNode("image",{src:a.image,mode:"aspectFill",class:"hospital-img"},null,8,["src"]),e.createElementVNode("view",{class:"hospital-badge"},"ä¸‰ç”²"),e.createElementVNode("view",{class:"hospital-distance"},e.toDisplayString(a.distance),1)]),e.createElementVNode("view",{class:"hospital-info"},[e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"hospital-appointments"},e.toDisplayString(a.appointments)+"äººé¢„çº¦",1)])],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"specialty-section"},[e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("text",{class:"section-title"},"ä¸“ç§‘ä¸“ç—…"),e.createElementVNode("text",{class:"view-more",onClick:V},"æŸ¥çœ‹æ›´å¤š>")]),e.createElementVNode("view",{class:"specialty-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"specialty-item",onClick:e=>(e=>{try{uni.navigateTo({url:`/pages/specialty-hospital/index?specialty=${encodeURIComponent(e.name)}&id=${e.id}`,fail:e=>{t("error","at pages/index/index.vue:561","é¡µé¢è·³è½¬å¤±è´¥:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none",duration:2e3})}})}catch(a){t("error","at pages/index/index.vue:570","è·³è½¬å¼‚å¸¸:",a),uni.showToast({title:"é¡µé¢è·³è½¬å¼‚å¸¸",icon:"none"})}})(a)},[e.createElementVNode("view",{class:"specialty-icon"},e.toDisplayString(a.icon),1),e.createElementVNode("text",{class:"specialty-name"},e.toDisplayString(a.name),1)],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"doctor-section"},[e.createElementVNode("view",{class:"doctor-tabs"},[e.createElementVNode("scroll-view",{class:"tabs-scroll","scroll-x":"","show-scrollbar":"false"},[e.createElementVNode("view",{class:e.normalizeClass(["doctor-tab-item",{active:"selected"===s.value}]),onClick:m[5]||(m[5]=e=>C("selected"))}," ä¸¥é€‰ä¸“å®¶ ",2),e.createElementVNode("view",{class:e.normalizeClass(["doctor-tab-item",{active:"dental"===s.value}]),onClick:m[6]||(m[6]=e=>C("dental"))}," å£è…”ä¸“å®¶ ",2),e.createElementVNode("view",{class:e.normalizeClass(["doctor-tab-item",{active:"orthopedic"===s.value}]),onClick:m[7]||(m[7]=e=>C("orthopedic"))}," éª¨ç§‘ä¸“å®¶ ",2),e.createElementVNode("view",{class:e.normalizeClass(["doctor-tab-item",{active:"gynecology"===s.value}]),onClick:m[8]||(m[8]=e=>C("gynecology"))}," å¦‡ç§‘ä¸“å®¶ ",2),e.createElementVNode("view",{class:e.normalizeClass(["doctor-tab-item",{active:"pediatrics"===s.value}]),onClick:m[9]||(m[9]=e=>C("pediatrics"))}," å„¿ç§‘ ",2)])]),e.createElementVNode("view",{class:"doctor-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"doctor-card",onClick:e=>{t("log","at pages/index/index.vue:608","é€‰æ‹©åŒ»ç”ŸID:",a.id)}},[e.createElementVNode("view",{class:"doctor-avatar"},[e.createElementVNode("image",{src:a.avatar,mode:"aspectFill",class:"avatar-img"},null,8,["src"])]),e.createElementVNode("button",{class:"appointment-btn",onClick:e.withModifiers((e=>{return o=a.id,uni.showToast({title:"é¢„çº¦åŒ»ç”Ÿ",icon:"none"}),void t("log","at pages/index/index.vue:617","é¢„çº¦åŒ»ç”ŸID:",o);var o}),["stop"])},"é¢„çº¦",8,["onClick"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"doctor-title"},e.toDisplayString(a.title),1)]),e.createElementVNode("view",{class:"doctor-hospital"},e.toDisplayString(a.hospital),1),e.createElementVNode("view",{class:"doctor-department"},e.toDisplayString(a.department),1),e.createElementVNode("view",{class:"doctor-specialties"},[e.createElementVNode("text",{class:"specialties-label"},"æ“…é•¿:"),e.createElementVNode("text",{class:"specialties-text"},e.toDisplayString(a.specialties),1)]),e.createElementVNode("view",{class:"doctor-actions"},[e.createElementVNode("view",{class:"action-item",onClick:e.withModifiers((e=>{return o=a.id,uni.showToast({title:"é¢„çº¦æŒ‚å·",icon:"none"}),void t("log","at pages/index/index.vue:626","é¢„çº¦æŒ‚å·åŒ»ç”ŸID:",o);var o}),["stop"])},[e.createVNode(h,{type:"checkmarkempty",size:"14",color:"#4a90e2"}),e.createElementVNode("text",{class:"action-text"},"é¢„çº¦æŒ‚å·(å¤šç‚¹)")],8,["onClick"]),e.createElementVNode("view",{class:"action-item",onClick:e.withModifiers((e=>{return o=a.id,uni.showToast({title:"åœ¨çº¿å’¨è¯¢",icon:"none"}),void t("log","at pages/index/index.vue:635","åœ¨çº¿å’¨è¯¢åŒ»ç”ŸID:",o);var o}),["stop"])},[e.createVNode(h,{type:"checkmarkempty",size:"14",color:"#4a90e2"}),e.createElementVNode("text",{class:"action-text"},"åœ¨çº¿å’¨è¯¢")],8,["onClick"])])])],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"medical-talk-section"},[e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("text",{class:"section-title"},"åŒ»è¯´"),e.createElementVNode("text",{class:"view-more",onClick:x},"æŸ¥çœ‹æ›´å¤š>")]),e.createElementVNode("view",{class:"article-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"article-card",onClick:e=>{return o=a.id,void uni.navigateTo({url:`/pages/yishuo/article-detail?id=${o}`,fail:e=>{t("error","at pages/index/index.vue:657","è·³è½¬å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}});var o}},[e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("view",{class:"article-title"},e.toDisplayString(a.title),1),e.createElementVNode("view",{class:"article-subtitle"},e.toDisplayString(a.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"read-count"},e.toDisplayString(a.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(a.date),1)])]),e.createElementVNode("view",{class:"article-image"},["video"===a.mediaType&&a.video?(e.openBlock(),e.createElementBlock("video",{key:0,src:g(a.video),class:"article-video-thumb",controls:!1,"show-center-play-btn":!0,"show-play-btn":!1,"enable-play-gesture":!1,"object-fit":"cover",poster:v(a)||void 0},null,8,["src","poster"])):(e.openBlock(),e.createElementBlock("image",{key:1,src:a.image,mode:"aspectFill",class:"article-img"},null,8,["src"]))])],8,["onClick"])))),128))])]),e.createVNode(d)])}}});class h{constructor(e,t){this.options=e,this.animation=uni.createAnimation({...e}),this.currentStepAnimates={},this.next=0,this.$=t}_nvuePushAnimates(e,t){let a=this.currentStepAnimates[this.next],o={};if(o=a||{styles:{},config:{}},g.includes(e)){o.styles.transform||(o.styles.transform="");let a="";"rotate"===e&&(a="deg"),o.styles.transform+=`${e}(${t+a}) `}else o.styles[e]=`${t}`;this.currentStepAnimates[this.next]=o}_animateRun(e={},t={}){let a=this.$.$refs.ani.ref;if(a)return new Promise(((o,n)=>{nvueAnimation.transition(a,{styles:e,...t},(e=>{o()}))}))}_nvueNextAnimate(e,t=0,a){let o=e[t];if(o){let{styles:n,config:s}=o;this._animateRun(n,s).then((()=>{t+=1,this._nvueNextAnimate(e,t,a)}))}else this.currentStepAnimates={},"function"==typeof a&&a(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const g=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function v(e,t){if(t)return clearTimeout(t.timer),new h(e,t)}g.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{h.prototype[e]=function(...t){return this.animation[e](...t),this}}));const f=s({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let a in e){t+=this.toLine(a)+":"+e[a]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=v(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,a={}){if(this.animation){for(let a in e)try{"object"==typeof e[a]?this.animation[a](...e[a]):this.animation[a](e[a])}catch(Kt){t("error","at uni_modules/uni-transition/components/uni-transition/uni-transition.vue:148",`æ–¹æ³• ${a} ä¸å­˜åœ¨`)}return this.animation.step(a),this}},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:e,transform:t}=this.styleInit(!1);void 0!==e&&(this.opacity=e),this.transform=t,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=v(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:""},a=(e,a)=>{"fade"===a?t.opacity=this.animationType(e)[a]:t.transform+=this.animationType(e)[a]+" "};return"string"==typeof this.modeClass?a(e,this.modeClass):this.modeClass.forEach((t=>{a(e,t)})),t},tranfromInit(e){let t=(e,t)=>{let a=null;"fade"===t?a=e?0:1:(a=e?"-100%":"0","zoom-in"===t&&(a=e?.8:1),"zoom-out"===t&&(a=e?1.2:1),"slide-right"===t&&(a=e?"100%":"0"),"slide-bottom"===t&&(a=e?"100%":"0")),this.animation[this.animationMode()[t]](a)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((a=>{t(e,a)})),this.animation},animationType:e=>({fade:e?0:1,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,a,o,n,s,i){return e.withDirectives((e.openBlock(),e.createElementBlock("view",{ref:"ani",animation:s.animationData,class:e.normalizeClass(o.customClass),style:e.normalizeStyle(i.transformStyles),onClick:a[0]||(a[0]=(...e)=>i.onClick&&i.onClick(...e))},[e.renderSlot(t.$slots,"default")],14,["animation"])),[[e.vShow,s.isShow]])}]]),w={name:"uniPopup",components:{},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let e={backgroundColor:this.bg};return this.borderRadius,e=Object.assign(e,{borderRadius:this.borderRadius}),e},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:a,safeArea:o,screenHeight:n,safeAreaInsets:s}=uni.getSystemInfoSync();this.popupWidth=e,this.popupHeight=t+(a||0),o&&this.safeArea?this.safeAreaInsets=s.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(e=!0){},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):t("error","at uni_modules/uni-popup/components/uni-popup/uni-popup.vue:298","ç¼ºå°‘ç±»å‹ï¼š",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)}}};const y=s(w,[["render",function(t,o,n,s,i,r){const l=a(e.resolveDynamicComponent("uni-transition"),f);return i.showPopup?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uni-popup",[i.popupstyle,r.isDesktop?"fixforpc-z-index":""]])},[e.createElementVNode("view",{onTouchstart:o[1]||(o[1]=(...e)=>r.touchstart&&r.touchstart(...e))},[i.maskShow?(e.openBlock(),e.createBlock(l,{key:"1",name:"mask","mode-class":"fade",styles:i.maskClass,duration:i.duration,show:i.showTrans,onClick:r.onTap},null,8,["styles","duration","show","onClick"])):e.createCommentVNode("",!0),e.createVNode(l,{key:"2","mode-class":i.ani,name:"content",styles:i.transClass,duration:i.duration,show:i.showTrans,onClick:r.onTap},{default:e.withCtx((()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-popup__wrapper",[i.popupstyle]]),style:e.normalizeStyle(r.getStyles),onClick:o[0]||(o[0]=(...e)=>r.clear&&r.clear(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)])),_:3},8,["mode-class","styles","duration","show","onClick"])],32)],2)):e.createCommentVNode("",!0)}],["__scopeId","data-v-9c09fb6f"]]),E=e=>e.includes("ä¸‰ç”²")||e.includes("ä¸‰çº§ç”²ç­‰")?"ä¸‰ç”²":e.includes("ä¸‰ä¹™")||e.includes("ä¸‰çº§ä¹™ç­‰")?"ä¸‰ä¹™":e.includes("äºŒç”²")||e.includes("äºŒçº§ç”²ç­‰")?"äºŒç”²":e.includes("äºŒä¹™")||e.includes("äºŒçº§ä¹™ç­‰")?"äºŒä¹™":e.includes("ä¸€ç”²")||e.includes("ä¸€çº§ç”²ç­‰")?"ä¸€ç”²":e.includes("ä¸€ä¹™")||e.includes("ä¸€çº§ä¹™ç­‰")?"ä¸€ä¹™":"æœªçŸ¥",k=e=>{const t=e.split(";"),a=[];return t.forEach((e=>{e.includes("ç»¼åˆåŒ»é™¢")?a.push("ç»¼åˆåŒ»é™¢"):e.includes("ä¸“ç§‘åŒ»é™¢")?a.push("ä¸“ç§‘åŒ»é™¢"):e.includes("å†…ç§‘")?a.push("å†…ç§‘"):e.includes("å¤–ç§‘")?a.push("å¤–ç§‘"):e.includes("å„¿ç§‘")?a.push("å„¿ç§‘"):e.includes("å¦‡äº§ç§‘")?a.push("å¦‡äº§ç§‘"):e.includes("çœ¼ç§‘")?a.push("çœ¼ç§‘"):e.includes("å£è…”ç§‘")?a.push("å£è…”ç§‘"):e.includes("è€³é¼»å–‰ç§‘")?a.push("è€³é¼»å–‰ç§‘"):e.includes("çš®è‚¤ç§‘")?a.push("çš®è‚¤ç§‘"):e.includes("ç¥ç»ç§‘")?a.push("ç¥ç»ç§‘"):e.includes("éª¨ç§‘")?a.push("éª¨ç§‘"):e.includes("å¿ƒè¡€ç®¡ç§‘")?a.push("å¿ƒè¡€ç®¡ç§‘"):e.includes("å‘¼å¸ç§‘")&&a.push("å‘¼å¸ç§‘")})),0===a.length&&a.push("å†…ç§‘","å¤–ç§‘"),a},N=e.defineComponent({__name:"index",setup(o){const n=e.ref("åŒ—äº¬"),s=e.ref(""),r=e.ref("ç»¼åˆæ’åº"),l=e.ref([]),c=e.ref(!1),d=e.ref(1),u=e.ref(0),m=e.ref(null),p=e.ref({serviceType:null,hospitalLevel:null,distance:null,hospitalType:null}),h=async()=>{c.value=!0;try{const e=await(async(e="åŒ—äº¬",a="åŒ»é™¢",o=1,n)=>{try{t("log","at services/amap.ts:151","=== å¼€å§‹è°ƒç”¨é«˜å¾·API ==="),t("log","at services/amap.ts:152",`æœç´¢åŸå¸‚: ${e}`),t("log","at services/amap.ts:153",`æœç´¢å…³é”®è¯: ${a}`);const s=e||"åŒ—äº¬";t("log","at services/amap.ts:157",`ä¼ é€’ç»™APIçš„åŸå¸‚: ${s}`),t("log","at services/amap.ts:160","ç­›é€‰æ¡ä»¶:",n);const i={key:"aab8394f9ad4c8088514c3a844880440",keywords:a||"åŒ»é™¢",city:s,page:o,offset:20};if(n&&n.hospitalType&&"å…¶ä»–"!==n.hospitalType){const e={"ç»¼åˆåŒ»é™¢":"090100","å„¿ç«¥åŒ»é™¢":"090101","éª¨ç§‘åŒ»é™¢":"090203","å¦‡äº§åŒ»é™¢":"090201","å£è…”åŒ»é™¢":"090202","è‚¿ç˜¤åŒ»é™¢":"090204"}[n.hospitalType];e&&(i.types=e)}if(n&&n.distance){const e={"5kmå†…":5e3,"10kmå†…":1e4,"20kmå†…":2e4,"50kmå†…":5e4}[n.distance];e&&(i.radius=e)}const r=await uni.request({url:"https://restapi.amap.com/v3/place/text",method:"GET",data:i});if(t("log","at services/amap.ts:211",`APIå“åº”çŠ¶æ€ç : ${r.statusCode}`),t("log","at services/amap.ts:212","APIå“åº”æ•°æ®:",r.data),200===r.statusCode){const e=r.data;if(e&&"1"===e.status){t("log","at services/amap.ts:217",`APIè¿”å›POIæ•°é‡: ${e.pois.length}`),t("log","at services/amap.ts:220","è¿”å›çš„POIè¯¦ç»†æ•°æ®:",r.data.pois);const o=r.data.pois.filter((e=>{const a=e.typecode&&e.typecode.startsWith("09")||e.type&&(e.type.includes("åŒ»é™¢")||e.type.includes("åŒ»ç–—"))||e.name&&e.name.includes("åŒ»é™¢");return t("log","at services/amap.ts:232",`POI: ${e.name}, ç±»å‹: ${e.type}, ç±»å‹ç¼–ç : ${e.typecode}, æ˜¯å¦åŒ»é™¢: ${a}`),a}));t("log","at services/amap.ts:236",`è¿‡æ»¤ååŒ»é™¢æ•°é‡: ${o.length}`);let s=o.map(((e,t)=>{const[a,o]=e.location?e.location.split(","):["",""],n=E(e.name),s=k(e.type),i=e.photos&&e.photos.length>0?e.photos[0].url:"/static/hospital/hospital.png";return{id:t+1,name:e.name||"æœªçŸ¥åŒ»é™¢",level:n,address:e.address||"æš‚æ— åœ°å€",distance:e.distance?`${e.distance}m`:"0m",isInternet:!1,departments:s,image:i,longitude:a,latitude:o,phone:e.tel||"",businessArea:e.business_area||"",rating:e.rating||"",cost:e.cost||""}}));if((n||a)&&((null==n?void 0:n.serviceType)&&"äº’è”ç½‘åŒ»é™¢"===n.serviceType&&(s=s.filter((e=>e.isInternet))),(null==n?void 0:n.hospitalLevel)&&(s=s.filter((e=>(({"ä¸‰ç”²åŒ»é™¢":["ä¸‰ç”²"],"ä¸‰çº§åŒ»é™¢":["ä¸‰ç”²","ä¸‰ä¹™","ä¸‰ä¸™"],"äºŒçº§åŒ»é™¢":["äºŒç”²","äºŒä¹™","äºŒä¸™"],"ä¸€çº§åŒ»é™¢":["ä¸€ç”²","ä¸€ä¹™","ä¸€ä¸™"]}[n.hospitalLevel]||[]).includes(e.level))))),a&&"åŒ»é™¢"!==a)){const e=a.toLowerCase();s=s.filter((t=>{const a=t.name.toLowerCase().includes(e),o=t.address.toLowerCase().includes(e),n=t.departments.some((t=>t.toLowerCase().includes(e)));return a||o||n}))}return t("log","at services/amap.ts:304",`å‰ç«¯ç­›é€‰ååŒ»é™¢æ•°é‡: ${s.length}`),s}return t("error","at services/amap.ts:307",`APIè¿”å›å¤±è´¥: ${r.data.info}, é”™è¯¯ç : ${r.data.infocode}`),[]}return t("error","at services/amap.ts:311",`HTTPè¯·æ±‚å¤±è´¥: ${r.statusCode}`),[]}catch(s){return t("error","at services/amap.ts:315","æœç´¢åŒ»é™¢å¤±è´¥:",s),[]}})(n.value,s.value,d.value,p.value);l.value=e,u.value=e.length}catch(e){t("error","at pages/specialty-hospital/index.vue:350","è·å–åŒ»é™¢æ•°æ®å¤±è´¥:",e),uni.showToast({title:"è·å–åŒ»é™¢æ•°æ®å¤±è´¥",icon:"none"})}finally{c.value=!1}},g=()=>{m.value&&m.value.open()},v=()=>{m.value&&m.value.close()},f=()=>{},w=(e,t)=>{p.value[e]=p.value[e]===t?null:t},N=()=>{p.value={serviceType:null,hospitalLevel:null,distance:null,hospitalType:null}},V=()=>{v(),h()};e.watch(n,(()=>{h()}));const C=()=>{uni.navigateBack({fail:()=>{uni.switchTab({url:"/pages/index/index"})}})},x=e=>{r.value=e},b=e=>{s.value=e.detail.value};let S=null;e.watch(s,(()=>{clearTimeout(S),S=setTimeout((()=>{d.value=1,h()}),500)}));const I=()=>{try{uni.navigateTo({url:`/pages/city/index?city=${encodeURIComponent(n.value)}`,fail:e=>{t("error","at pages/specialty-hospital/index.vue:453","é¡µé¢è·³è½¬å¤±è´¥:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥ï¼Œè¯·é‡æ–°è¿è¡Œé¡¹ç›®",icon:"none",duration:2e3})}})}catch(e){t("error","at pages/specialty-hospital/index.vue:462","è·³è½¬å¼‚å¸¸:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¼‚å¸¸",icon:"none"})}};"undefined"!=typeof uni&&uni.$on&&uni.$on("cityChanged",(e=>{n.value=e,uni.setStorageSync("currentCity",e)})),e.onMounted((()=>{(()=>{const e=uni.getStorageSync("currentCity");e&&(n.value=e)})(),h()}));return(o,d)=>{const u=a(e.resolveDynamicComponent("uni-icons"),i),h=a(e.resolveDynamicComponent("uni-popup"),y);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-header"},[e.createElementVNode("view",{class:"search-bar"},[e.createVNode(u,{type:"left",size:"24",color:"#333",onClick:C}),e.createElementVNode("view",{class:"search-box"},[e.createVNode(u,{type:"search",size:"18",color:"#999"}),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text",placeholder:"æœåŒ»é™¢åç§°","placeholder-class":"placeholder","onUpdate:modelValue":d[0]||(d[0]=e=>s.value=e),onInput:b},null,544),[[e.vModelText,s.value]])]),e.createElementVNode("view",{class:"location",onClick:I},[e.createElementVNode("text",{class:"location-text"},e.toDisplayString(n.value),1),e.createVNode(u,{type:"arrowdown",size:"14",color:"#333"})])])]),e.createElementVNode("view",{class:"filter-options"},[e.createElementVNode("scroll-view",{class:"filter-scroll","scroll-x":"","show-scrollbar":"false"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:"ç»¼åˆæ’åº"===r.value}]),onClick:d[1]||(d[1]=e=>x("ç»¼åˆæ’åº"))}," ç»¼åˆæ’åº ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:"ç§‘å®¤"===r.value}]),onClick:d[2]||(d[2]=e=>x("ç§‘å®¤"))},[e.createTextVNode(" ç§‘å®¤ "),e.createVNode(u,{type:"arrowdown",size:"14",color:"#333"})],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:"ç–¾ç—…"===r.value}]),onClick:d[3]||(d[3]=e=>x("ç–¾ç—…"))},[e.createTextVNode(" ç–¾ç—… "),e.createVNode(u,{type:"arrowdown",size:"14",color:"#333"})],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:"ç­›é€‰"===r.value}]),onClick:g},[e.createTextVNode(" ç­›é€‰ "),e.createVNode(u,{type:"arrowdown",size:"14",color:"#333"})],2)])]),e.createVNode(h,{ref_key:"filterPopup",ref:m,type:"bottom","mask-click":!0,onClose:f},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"filter-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"ç­›é€‰"),e.createVNode(u,{type:"close",size:"24",color:"#333",onClick:v})]),e.createElementVNode("scroll-view",{class:"popup-content","scroll-y":""},[e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"æœåŠ¡ç±»å‹"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"é—¨è¯Šé¢„çº¦"===p.value.serviceType}]),onClick:d[4]||(d[4]=e=>w("serviceType","é—¨è¯Šé¢„çº¦"))}," é—¨è¯Šé¢„çº¦ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"äº’è”ç½‘åŒ»é™¢"===p.value.serviceType}]),onClick:d[5]||(d[5]=e=>w("serviceType","äº’è”ç½‘åŒ»é™¢"))}," äº’è”ç½‘åŒ»é™¢ ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"åŒ»é™¢ç­‰çº§"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸‰ç”²åŒ»é™¢"===p.value.hospitalLevel}]),onClick:d[6]||(d[6]=e=>w("hospitalLevel","ä¸‰ç”²åŒ»é™¢"))}," ä¸‰ç”²åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸‰çº§åŒ»é™¢"===p.value.hospitalLevel}]),onClick:d[7]||(d[7]=e=>w("hospitalLevel","ä¸‰çº§åŒ»é™¢"))}," ä¸‰çº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"äºŒçº§åŒ»é™¢"===p.value.hospitalLevel}]),onClick:d[8]||(d[8]=e=>w("hospitalLevel","äºŒçº§åŒ»é™¢"))}," äºŒçº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸€çº§åŒ»é™¢"===p.value.hospitalLevel}]),onClick:d[9]||(d[9]=e=>w("hospitalLevel","ä¸€çº§åŒ»é™¢"))}," ä¸€çº§åŒ»é™¢ ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"è·ç¦»"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"5kmå†…"===p.value.distance}]),onClick:d[10]||(d[10]=e=>w("distance","5kmå†…"))}," 5kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"10kmå†…"===p.value.distance}]),onClick:d[11]||(d[11]=e=>w("distance","10kmå†…"))}," 10kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"20kmå†…"===p.value.distance}]),onClick:d[12]||(d[12]=e=>w("distance","20kmå†…"))}," 20kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"50kmå†…"===p.value.distance}]),onClick:d[13]||(d[13]=e=>w("distance","50kmå†…"))}," 50kmå†… ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"åŒ»é™¢ç±»å‹"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ç»¼åˆåŒ»é™¢"===p.value.hospitalType}]),onClick:d[14]||(d[14]=e=>w("hospitalType","ç»¼åˆåŒ»é™¢"))}," ç»¼åˆåŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å„¿ç«¥åŒ»é™¢"===p.value.hospitalType}]),onClick:d[15]||(d[15]=e=>w("hospitalType","å„¿ç«¥åŒ»é™¢"))}," å„¿ç«¥åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"éª¨ç§‘åŒ»é™¢"===p.value.hospitalType}]),onClick:d[16]||(d[16]=e=>w("hospitalType","éª¨ç§‘åŒ»é™¢"))}," éª¨ç§‘åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å¦‡äº§åŒ»é™¢"===p.value.hospitalType}]),onClick:d[17]||(d[17]=e=>w("hospitalType","å¦‡äº§åŒ»é™¢"))}," å¦‡äº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å£è…”åŒ»é™¢"===p.value.hospitalType}]),onClick:d[18]||(d[18]=e=>w("hospitalType","å£è…”åŒ»é™¢"))}," å£è…”åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ç²¾ç¥ç—…é™¢"===p.value.hospitalType}]),onClick:d[19]||(d[19]=e=>w("hospitalType","ç²¾ç¥ç—…é™¢"))}," ç²¾ç¥ç—…é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"è‚¿ç˜¤åŒ»é™¢"===p.value.hospitalType}]),onClick:d[20]||(d[20]=e=>w("hospitalType","è‚¿ç˜¤åŒ»é™¢"))}," è‚¿ç˜¤åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å…¶ä»–"===p.value.hospitalType}]),onClick:d[21]||(d[21]=e=>w("hospitalType","å…¶ä»–"))}," å…¶ä»– ",2)])])]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"footer-btn reset-btn",onClick:N},"é‡ç½®"),e.createElementVNode("button",{class:"footer-btn confirm-btn",onClick:V},"ç¡®å®š")])])])),_:1},512),e.createElementVNode("view",{class:"hospital-list"},[c.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createVNode(u,{type:"spinner",size:"36",color:"#4a90e2",animation:"spin"}),e.createElementVNode("text",{class:"loading-text"},"åŠ è½½ä¸­...")])):0===l.value.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-container"},[e.createVNode(u,{type:"empty",size:"64",color:"#ccc"}),e.createElementVNode("text",{class:"empty-text"},"æš‚æ— åŒ»é™¢æ•°æ®")])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"hospital-item",onClick:e=>(e=>{try{const a=e.phone||"",o=`/pages/hospital-detail/index?name=${encodeURIComponent(e.name)}&address=${encodeURIComponent(e.address)}&level=${encodeURIComponent(e.level)}&image=${encodeURIComponent(e.image)}&longitude=${encodeURIComponent(e.longitude||"")}&latitude=${encodeURIComponent(e.latitude||"")}&phone=${encodeURIComponent(a)}`;uni.navigateTo({url:o,success:e=>{t("log","at pages/specialty-hospital/index.vue:516","è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µæˆåŠŸ:",e)},fail:e=>{t("error","at pages/specialty-hospital/index.vue:519","è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¤±è´¥:",e),uni.showToast({title:"è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¤±è´¥",icon:"none"})}})}catch(a){t("error","at pages/specialty-hospital/index.vue:527","è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¼‚å¸¸:",a),uni.showToast({title:"è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¤±è´¥",icon:"none"})}})(a)},[e.createElementVNode("view",{class:"hospital-card"},[e.createElementVNode("view",{class:"hospital-image"},[e.createElementVNode("image",{src:a.image,mode:"aspectFill",class:"hospital-img"},null,8,["src"]),e.createElementVNode("view",{class:"hospital-badge"},e.toDisplayString(a.level),1)]),e.createElementVNode("view",{class:"hospital-info"},[e.createElementVNode("view",{class:"hospital-header"},[e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(a.name),1),a.isInternet?(e.openBlock(),e.createElementBlock("view",{key:0,class:"hospital-tag"},"äº’è”ç½‘åŒ»é™¢")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"hospital-address"},e.toDisplayString(a.address),1),e.createElementVNode("text",{class:"hospital-distance"},e.toDisplayString(a.distance),1),e.createElementVNode("view",{class:"hospital-departments"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.departments,((t,a)=>(e.openBlock(),e.createElementBlock("text",{key:a,class:"department-tag"},e.toDisplayString(t),1)))),128))])])])],8,["onClick"])))),128))])])}}}),V={components:{ThemeToggle:d},data(){const e=[{id:1,name:"å¼ åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…",avatar:"https://randomuser.me/api/portraits/men/1.jpg",price:50,appointmentCount:2312,rating:4.9,consultationCount:542},{id:2,name:"æåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",dept:"ç¥ç»å†…ç§‘",goodAt:"ç¥ç»ç–¾ç—…ã€å¤´ç—›ã€å¤±çœ ",avatar:"https://randomuser.me/api/portraits/men/2.jpg",price:60,appointmentCount:1856,rating:4.8,consultationCount:432},{id:3,name:"ç‹åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤©å›åŒ»é™¢",dept:"éª¨ç§‘",goodAt:"éª¨ç§‘ç–¾ç—…ã€éª¨æŠ˜ã€å…³èŠ‚ç–¼ç—›",avatar:"https://randomuser.me/api/portraits/men/3.jpg",price:45,appointmentCount:1523,rating:4.7,consultationCount:389},{id:4,name:"åˆ˜åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬æœé˜³åŒ»é™¢",dept:"æ¶ˆåŒ–å†…ç§‘",goodAt:"æ¶ˆåŒ–ç³»ç»Ÿç–¾ç—…ã€èƒƒç‚ã€èƒƒæºƒç–¡",avatar:"https://randomuser.me/api/portraits/men/4.jpg",price:55,appointmentCount:2098,rating:4.85,consultationCount:512},{id:5,name:"é™ˆåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å‹è°ŠåŒ»é™¢",dept:"çš®è‚¤ç§‘",goodAt:"çš®è‚¤ç—…ã€æ¹¿ç–¹ã€è¿‡æ•",avatar:"https://randomuser.me/api/portraits/men/5.jpg",price:40,appointmentCount:1245,rating:4.75,consultationCount:321},{id:6,name:"èµµåŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åŒä»åŒ»é™¢",dept:"çœ¼ç§‘",goodAt:"çœ¼ç§‘ç–¾ç—…ã€ç™½å†…éšœã€é’å…‰çœ¼",avatar:"https://randomuser.me/api/portraits/men/6.jpg",price:65,appointmentCount:2689,rating:4.88,consultationCount:623},{id:7,name:"å­™åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å„¿ç«¥åŒ»é™¢",dept:"å„¿ç§‘",goodAt:"å„¿ç§‘ç–¾ç—…ã€å°å„¿æ„Ÿå†’ã€å‘è‚²è¿Ÿç¼“",avatar:"https://randomuser.me/api/portraits/men/7.jpg",price:50,appointmentCount:3124,rating:4.82,consultationCount:756},{id:8,name:"å‘¨åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¦‡äº§åŒ»é™¢",dept:"å¦‡äº§ç§‘",goodAt:"å¦‡ç§‘ç–¾ç—…ã€äº§ç§‘ã€ä¸å­•ä¸è‚²",avatar:"https://randomuser.me/api/portraits/men/8.jpg",price:58,appointmentCount:1987,rating:4.79,consultationCount:498},{id:9,name:"å´åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬è‚¿ç˜¤åŒ»é™¢",dept:"è‚¿ç˜¤å†…ç§‘",goodAt:"è‚¿ç˜¤è¯Šæ–­ã€åŒ–ç–—ã€é¶å‘æ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/9.jpg",price:80,appointmentCount:1456,rating:4.91,consultationCount:389},{id:10,name:"éƒ‘åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å£è…”åŒ»é™¢",dept:"å£è…”ç§‘",goodAt:"å£è…”ç–¾ç—…ã€ç‰™é½¿çŸ«æ­£ã€ç§æ¤ç‰™",avatar:"https://randomuser.me/api/portraits/men/10.jpg",price:48,appointmentCount:1678,rating:4.73,consultationCount:412},{id:11,name:"é’±åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å®£æ­¦åŒ»é™¢",dept:"ç¥ç»å¤–ç§‘",goodAt:"ç¥ç»å¤–ç§‘æ‰‹æœ¯ã€è„‘è‚¿ç˜¤ã€è„‘è¡€ç®¡ç—…",avatar:"https://randomuser.me/api/portraits/men/11.jpg",price:75,appointmentCount:1123,rating:4.86,consultationCount:298},{id:12,name:"é©¬åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å®‰è´åŒ»é™¢",dept:"å¿ƒå¤–ç§‘",goodAt:"å¿ƒè„å¤–ç§‘æ‰‹æœ¯ã€å…ˆå¤©æ€§å¿ƒè„ç—…",avatar:"https://randomuser.me/api/portraits/men/12.jpg",price:85,appointmentCount:987,rating:4.92,consultationCount:245},{id:13,name:"æœ±åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢",dept:"çƒ§ä¼¤ç§‘",goodAt:"çƒ§ä¼¤æ²»ç–—ã€åˆ›é¢ä¿®å¤ã€ç–¤ç—•æ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/13.jpg",price:52,appointmentCount:756,rating:4.68,consultationCount:187},{id:14,name:"èƒ¡åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢",dept:"å‘¼å¸å†…ç§‘",goodAt:"å‘¼å¸ç³»ç»Ÿç–¾ç—…ã€å“®å–˜ã€æ…¢é˜»è‚º",avatar:"https://randomuser.me/api/portraits/men/14.jpg",price:56,appointmentCount:2145,rating:4.81,consultationCount:534},{id:15,name:"æ—åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬301åŒ»é™¢",dept:"å†…åˆ†æ³Œç§‘",goodAt:"ç³–å°¿ç—…ã€ç”²çŠ¶è…ºç–¾ç—…ã€è‚¥èƒ–ç—‡",avatar:"https://randomuser.me/api/portraits/men/15.jpg",price:62,appointmentCount:1789,rating:4.84,consultationCount:467},{id:16,name:"é»„åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬302åŒ»é™¢",dept:"æ„ŸæŸ“ç§‘",goodAt:"æ„ŸæŸ“æ€§ç–¾ç—…ã€è‚ç—…ã€ä¼ æŸ“ç—…",avatar:"https://randomuser.me/api/portraits/men/16.jpg",price:54,appointmentCount:1345,rating:4.76,consultationCount:356},{id:17,name:"æ¨åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬306åŒ»é™¢",dept:"æ³Œå°¿å¤–ç§‘",goodAt:"æ³Œå°¿ç³»ç»Ÿç–¾ç—…ã€è‚¾ç»“çŸ³ã€å‰åˆ—è…º",avatar:"https://randomuser.me/api/portraits/men/17.jpg",price:59,appointmentCount:1567,rating:4.78,consultationCount:423},{id:18,name:"ç½—åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬309åŒ»é™¢",dept:"èƒ¸å¤–ç§‘",goodAt:"èƒ¸éƒ¨ç–¾ç—…ã€è‚ºç™Œã€é£Ÿç®¡ç™Œ",avatar:"https://randomuser.me/api/portraits/men/18.jpg",price:78,appointmentCount:1098,rating:4.87,consultationCount:287},{id:19,name:"é«˜åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬307åŒ»é™¢",dept:"è¡€æ¶²ç§‘",goodAt:"è¡€æ¶²ç–¾ç—…ã€ç™½è¡€ç—…ã€è´«è¡€",avatar:"https://randomuser.me/api/portraits/men/19.jpg",price:63,appointmentCount:892,rating:4.71,consultationCount:234},{id:20,name:"æ¢åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬308åŒ»é™¢",dept:"åº·å¤ç§‘",goodAt:"åº·å¤æ²»ç–—ã€è¿åŠ¨æŸä¼¤ã€åº·å¤è®­ç»ƒ",avatar:"https://randomuser.me/api/portraits/men/20.jpg",price:47,appointmentCount:1234,rating:4.74,consultationCount:312}];return{theme:l(),city:"åŒ—äº¬",keyword:"",unreadMessageCount:3,activeFilterIndex:-1,isRecording:!1,recordingTime:0,recorderManager:null,recordingTimer:null,sortType:"comprehensive",showSortMenu:!1,showMapView:!1,mapInstance:null,mapMarkers:[],mapRippleCircles:[],MAP_KEY:"aab8394f9ad4c8088514c3a844880440",targetHospitalName:"",sortOptions:[{label:"ç»¼åˆæ’åº",value:"comprehensive"},{label:"ä»·æ ¼ä»ä½åˆ°é«˜",value:"price_asc"},{label:"ä»·æ ¼ä»é«˜åˆ°ä½",value:"price_desc"},{label:"é¢„çº¦é‡ä»é«˜åˆ°ä½",value:"appointment_desc"},{label:"è¯„åˆ†ä»é«˜åˆ°ä½",value:"rating_desc"}],filters:{serviceType:null,hospitalLevel:null,distance:null,hospitalType:null},allDoctorList:e,doctorList:e}},computed:{sortTypeText(){const e=this.sortOptions.find((e=>e.value===this.sortType));return e?e.label:"ç»¼åˆæ’åº"},waterfallColumnCount:()=>2,waterfallColumns(){const e=this.filteredDoctorList,t=this.waterfallColumnCount,a=Array.from({length:t},(()=>[]));return e.forEach(((e,o)=>{a[o%t].push(e)})),a},hospitalCount(){const e=new Set;return this.filteredDoctorList.forEach((t=>{t.hospital&&e.add(t.hospital)})),e.size},filteredDoctorList(){let e=this.allDoctorList;if(this.keyword&&""!==this.keyword.trim()){const t=this.keyword.trim().toLowerCase();e=e.filter((e=>{const a=e.name.toLowerCase().includes(t),o=e.dept.toLowerCase().includes(t),n=e.hospital.toLowerCase().includes(t),s=e.goodAt.toLowerCase().includes(t),i=e.level.toLowerCase().includes(t);return a||o||n||s||i}))}e=e.filter((e=>{const t=e.hospital||"";if(this.filters.hospitalLevel){const e={"ä¸‰ç”²åŒ»é™¢":["ä¸‰ç”²"],"ä¸‰çº§åŒ»é™¢":["ä¸‰ç”²","ä¸‰ä¹™","ä¸‰ä¸™","ä¸‰çº§"],"äºŒçº§åŒ»é™¢":["äºŒç”²","äºŒä¹™","äºŒä¸™","äºŒçº§"],"ä¸€çº§åŒ»é™¢":["ä¸€ç”²","ä¸€ä¹™","ä¸€ä¸™","ä¸€çº§"]}[this.filters.hospitalLevel]||[],a=this.getHospitalLevel(t);if(!e.includes(a))return!1}if(this.filters.hospitalType){const e=this.getHospitalType(t);if("å…¶ä»–"===this.filters.hospitalType){if("æœªçŸ¥"!==e)return!1}else if(e!==this.filters.hospitalType)return!1}return!0}));const t=[...e];switch(this.sortType){case"price_asc":t.sort(((e,t)=>e.price-t.price));break;case"price_desc":t.sort(((e,t)=>t.price-e.price));break;case"appointment_desc":t.sort(((e,t)=>t.appointmentCount-e.appointmentCount));break;case"rating_desc":t.sort(((e,t)=>t.rating-e.rating));break;default:t.sort(((e,t)=>{const a=.6*e.rating+e.appointmentCount/3e3*.4;return.6*t.rating+t.appointmentCount/3e3*.4-a}))}return t}},watch:{filteredDoctorList:{handler(){this.showMapView&&this.mapInstance&&this.addHospitalMarkers()},deep:!0}},onLoad(e){const t=uni.getStorageSync("targetHospitalName"),a=uni.getStorageSync("showMapView");t&&(this.targetHospitalName=t,uni.removeStorageSync("targetHospitalName")),a&&(this.showMapView=!0,uni.removeStorageSync("showMapView"),this.$nextTick((()=>{setTimeout((()=>{this.initMap()}),300)})))},onShow(){uni.$on("themeChange",this.updateTheme),this.updateTheme(),uni.$on("cityChanged",this.onCityChanged),this.loadCity()},onHide(){uni.$off("themeChange",this.updateTheme),uni.$off("cityChanged",this.onCityChanged),this.destroyMap()},beforeDestroy(){this.destroyMap(),this.isRecording&&this.stopRecording(),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null)},methods:{updateTheme(e){try{this.theme=e||l(),this.$nextTick((()=>{this.$forceUpdate&&"function"==typeof this.$forceUpdate&&this.$forceUpdate()}))}catch(Kt){t("warn","at pages/doctor/doctor.vue:897","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},chooseCity(){uni.navigateTo({url:"/pages/city/index"})},onSearch(){if(t("log","at pages/doctor/doctor.vue:909","æœç´¢å…³é”®è¯:",this.keyword),this.keyword&&""!==this.keyword.trim()){0===this.filteredDoctorList.length&&uni.showToast({title:"æœªæ‰¾åˆ°ç›¸å…³åŒ»ç”Ÿ",icon:"none"})}},onSearchInput(e){this.keyword=e.detail.value},toggleVoiceSearch(){this.isRecording?this.stopRecording():this.startRecording()},startRecording(){try{this.recorderManager=uni.createRecorderManager(),this.recorderManager.onStart((()=>{this.isRecording=!0,this.recordingTime=0,this.recordingTimer=setInterval((()=>{this.recordingTime++,this.recordingTime>=60&&this.stopRecording()}),1e3),uni.showToast({title:"å¼€å§‹å½•éŸ³",icon:"none",duration:1e3})})),this.recorderManager.onStop((e=>{this.isRecording=!1,this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),this.handleVoiceRecognition(e)})),this.recorderManager.onError((e=>{t("error","at pages/doctor/doctor.vue:982","å½•éŸ³é”™è¯¯:",e),this.isRecording=!1,this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),uni.showToast({title:"å½•éŸ³å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})})),this.recorderManager.start({duration:6e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3"})}catch(Kt){t("error","at pages/doctor/doctor.vue:1003","å½•éŸ³åˆå§‹åŒ–å¤±è´¥:",Kt),uni.showToast({title:"å½•éŸ³åŠŸèƒ½ä¸å¯ç”¨",icon:"none"})}},stopRecording(){this.recorderManager&&this.recorderManager.stop()},handleVoiceRecognition(e){uni.showLoading({title:"è¯†åˆ«ä¸­..."}),setTimeout((()=>{uni.hideLoading();const e=["å†…ç§‘","å¤–ç§‘","å„¿ç§‘","å¦‡ç§‘","çœ¼ç§‘","å£è…”ç§‘","å¤´ç—›","æ„Ÿå†’","å‘çƒ§","èƒƒç—›"],t=e[Math.floor(Math.random()*e.length)];this.keyword=t,uni.showToast({title:`è¯†åˆ«ç»“æœ: ${t}`,icon:"none",duration:2e3}),this.onSearch()}),1e3)},goChat(){uni.showToast({title:"å®¢æœåŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},goSmartRecommend(){uni.navigateTo({url:"/pages/doctor/smart-recommend",fail:e=>{t("error","at pages/doctor/doctor.vue:1057","è·³è½¬åˆ°æ™ºèƒ½æ¨èé¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},goMessages(){uni.navigateTo({url:"/pages/mine/messages"})},toggleSortMenu(){0!==this.activeFilterIndex&&(this.activeFilterIndex=0),this.showSortMenu=!this.showSortMenu},closeSortMenu(){this.showSortMenu=!1},selectSortType(e){this.sortType=e,this.showSortMenu=!1},onFilterChange(e){switch(this.showSortMenu=!1,this.activeFilterIndex===e?this.activeFilterIndex=-1:this.activeFilterIndex=e,e){case 0:break;case 1:uni.navigateTo({url:"/pages/doctor/department"});break;case 2:uni.navigateTo({url:"/pages/doctor/disease"});break;case 3:this.toggleFilterPopup()}},goDoctorDetail(e){const t=encodeURIComponent(JSON.stringify(e));uni.navigateTo({url:`/pages/doctor/detail?doctor=${t}`})},onReserve(e){uni.navigateTo({url:`/pages/doctor/appointment?doctorId=${e.id}`})},onConsult(e){uni.showToast({title:"åœ¨çº¿å’¨è¯¢åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},loadCity(){try{const e=uni.getStorageSync("currentCity");e&&(this.city=e)}catch(Kt){t("warn","at pages/doctor/doctor.vue:1145","åŠ è½½åŸå¸‚ä¿¡æ¯å¤±è´¥:",Kt)}},onCityChanged(e){this.city=e},toggleMapView(){this.showMapView=!this.showMapView,this.showMapView?this.$nextTick((()=>{setTimeout((()=>{this.initMap()}),300)})):this.destroyMap()},initMap(){if("undefined"!=typeof window&&window.AMap)this.initGaodeMap();else{t("log","at pages/doctor/doctor.vue:1168","é«˜å¾·åœ°å›¾APIæœªåŠ è½½ï¼Œå°è¯•åŠ è½½..."),window._AMapSecurityConfig||(window._AMapSecurityConfig={securityJsCode:this.MAP_KEY});const e=document.createElement("script");e.src=`https://webapi.amap.com/maps?v=2.0&key=${this.MAP_KEY}&plugin=AMap.ControlBar,AMap.ToolBar,AMap.Marker,AMap.InfoWindow`,e.type="text/javascript",e.onload=()=>{this.initGaodeMap()},e.onerror=()=>{t("error","at pages/doctor/doctor.vue:1183","é«˜å¾·åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥Keyæƒé™é…ç½®æˆ–ç½‘ç»œï¼")},document.body.appendChild(e)}},initGaodeMap(){window.AMap&&this.$nextTick((()=>{setTimeout((()=>{if(!document.getElementById("doctor-map"))return void t("error","at pages/doctor/doctor.vue:1198","åœ°å›¾å®¹å™¨ä¸å­˜åœ¨");this.mapInstance&&(this.mapInstance.destroy(),this.mapInstance=null),this.mapInstance=new window.AMap.Map("doctor-map",{viewMode:"2D",zoom:10,center:[116.397428,39.90923],resizeEnable:!0,dragEnable:!0,zoomEnable:!0,mapStyle:"amap://styles/normal"});new window.AMap.ToolBar({position:{left:"10px",top:"10px"}}).addTo(this.mapInstance),this.addHospitalMarkers(),this.targetHospitalName&&setTimeout((()=>{this.focusOnHospital(this.targetHospitalName)}),200),this.mapInstance.on("complete",(()=>{t("log","at pages/doctor/doctor.vue:1240","âœ… é«˜å¾·åœ°å›¾åŠ è½½æˆåŠŸï¼")}))}),100)}))},addHospitalMarkers(){if(!this.mapInstance||!window.AMap)return;this.mapMarkers.forEach((e=>{this.mapInstance.remove(e)})),this.mapMarkers=[];const e={};this.filteredDoctorList.forEach((t=>{e[t.hospital]||(e[t.hospital]={name:t.hospital,doctors:[],location:this.getHospitalLocation(t.hospital)}),e[t.hospital].doctors.push(t)})),Object.values(e).forEach(((e,t)=>{if(!e.location)return;const[a,o]=e.location,n=e.doctors.length,s=new window.AMap.Icon({size:new window.AMap.Size(32,32),image:this.createMarkerIcon(n),imageSize:new window.AMap.Size(32,32)}),i=new window.AMap.Marker({position:[a,o],icon:s,title:e.name,zIndex:100+t}),r=document.createElement("div");r.style.cssText="padding:10px;background:#fff;border-radius:4px;min-width:200px;cursor:pointer;",r.innerHTML=`\n\t\t\t\t\t<div style="font-size:16px;color:#333;margin-bottom:8px;font-weight:600;">${e.name}</div>\n\t\t\t\t\t<div style="font-size:14px;color:#666;margin-bottom:4px;">åŒ»ç”Ÿæ•°é‡: <span style="color:#4A90E2;font-weight:600;">${n}</span></div>\n\t\t\t\t\t<div style="font-size:12px;color:#4A90E2;margin-top:8px;cursor:pointer;text-decoration:underline;">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div>\n\t\t\t\t`,r.addEventListener("click",(()=>{this.navigateToHospitalDetail(e.name)}));const l=new window.AMap.InfoWindow({content:r,offset:new window.AMap.Pixel(0,-30),isCustom:!0});i.on("click",(()=>{l.open(this.mapInstance,i.getPosition())})),this.addRippleEffect(i,[a,o]),i.setMap(this.mapInstance),this.mapMarkers.push(i)})),this.mapMarkers.length>0&&!this.targetHospitalName&&this.mapInstance.setFitView(this.mapMarkers)},createMarkerIcon(e){let t="#4A90E2";t=e>10?"#52c41a":e>5?"#4A90E2":e>2?"#faad14":"#ff4d4f";const a=Math.max(24,Math.min(40,3*Math.sqrt(e)));return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(`\n\t\t\t\t<svg width="${a}" height="${a}" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<circle cx="${a/2}" cy="${a/2}" r="${a/2-2}" fill="${t}" opacity="0.8" stroke="#fff" stroke-width="2"/>\n\t\t\t\t\t<circle cx="${a/2}" cy="${a/2}" r="${a/4}" fill="#fff"/>\n\t\t\t\t\t<circle cx="${a/2}" cy="${a/2}" r="2" fill="${t}"/>\n\t\t\t\t</svg>\n\t\t\t`)))},addRippleEffect(e,t){if(!this.mapInstance||!window.AMap)return;const a=new window.AMap.Circle({center:t,radius:20,strokeColor:"#4A90E2",strokeWeight:2,strokeOpacity:.6,fillColor:"#4A90E2",fillOpacity:.1,zIndex:50});a.setMap(this.mapInstance),this.mapRippleCircles.push(a);let o=20;const n=()=>{o+=2,o>80&&(o=20),a.setRadius(o),a.setOptions({strokeOpacity:Math.max(0,.6-(o-20)/60),fillOpacity:Math.max(0,.1-(o-20)/60)}),this.showMapView&&this.mapInstance&&requestAnimationFrame(n)};n()},getHospitalLocation:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":[116.3732,39.9885],"åŒ—äº¬åå’ŒåŒ»é™¢":[116.4179,39.9042],"åŒ—äº¬å¤©å›åŒ»é™¢":[116.4074,39.8806],"åŒ—äº¬æœé˜³åŒ»é™¢":[116.4681,39.9289],"åŒ—äº¬å‹è°ŠåŒ»é™¢":[116.3607,39.8765],"åŒ—äº¬åŒä»åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬å„¿ç«¥åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å¦‡äº§åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å£è…”åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬301åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬å®‰è´åŒ»é™¢":[116.4074,39.9885],"åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":[116.4179,39.9885],"åŒ—äº¬302åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬306åŒ»é™¢":[116.3509,39.9885],"åŒ—äº¬309åŒ»é™¢":[116.2732,39.9885],"åŒ—äº¬307åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬308åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬å®£æ­¦åŒ»é™¢":[116.3607,39.9042]}[e]||[116.397428,39.90923]),getHospitalAddress:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œå•åŒ—å¤§è¡—53å·","åŒ—äº¬åå’ŒåŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºç‹åºœäº•å¤§è¡—1å·","åŒ—äº¬å¤©å›åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ6å·","åŒ—äº¬æœé˜³åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå·¥äººä½“è‚²åœºå—è·¯8å·","åŒ—äº¬å‹è°ŠåŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ°¸å®‰è·¯95å·","åŒ—äº¬åŒä»åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œäº¤æ°‘å··1å·","åŒ—äº¬å„¿ç«¥åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºå—ç¤¼å£«è·¯56å·","åŒ—äº¬å¦‡äº§åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå§šå®¶å›­è·¯251å·","åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé˜œæˆè·¯52å·","åŒ—äº¬å£è…”åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ4å·","åŒ—äº¬301åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤å…´è·¯28å·","åŒ—äº¬å®‰è´åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰è´è·¯2å·","åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºæ¨±èŠ±å›­ä¸œè¡—2å·","åŒ—äº¬302åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºè¥¿å››ç¯ä¸­è·¯100å·","åŒ—äº¬306åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰ç¿”åŒ—é‡Œ9å·","åŒ—äº¬309åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé»‘å±±æ‰ˆè·¯17å·","åŒ—äº¬307åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºä¸œå¤§è¡—8å·","åŒ—äº¬308åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤ªå¹³è·¯27å·","åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ–°è¡—å£ä¸œè¡—31å·","åŒ—äº¬å®£æ­¦åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºé•¿æ¤¿è¡—45å·"}[e]||"åŒ—äº¬å¸‚"),navigateToHospitalDetail(e){const t=this.getHospitalAddress(e),a=this.getHospitalLocation(e);uni.navigateTo({url:`/pages/hospital-detail/index?name=${encodeURIComponent(e)}&address=${encodeURIComponent(t)}&level=ä¸‰ç”²&longitude=${a[0]}&latitude=${a[1]}`})},focusOnHospital(e){if(!this.mapInstance||!window.AMap)return;const t=this.getHospitalLocation(e);if(!t)return;this.mapInstance.setCenter(t),this.mapInstance.setZoom(16);const a=this.mapMarkers.find((e=>{const a=e.getPosition(),o="number"==typeof a.lng?a.lng:a.getLng(),n="number"==typeof a.lat?a.lat:a.getLat();return Math.abs(o-t[0])<.001&&Math.abs(n-t[1])<.001}));a&&setTimeout((()=>{const t=document.createElement("div");t.style.cssText="padding:10px;background:#fff;border-radius:4px;min-width:200px;cursor:pointer;",t.innerHTML=`\n\t\t\t\t\t\t<div style="font-size:16px;color:#333;margin-bottom:8px;font-weight:600;">${e}</div>\n\t\t\t\t\t\t<div style="font-size:12px;color:#4A90E2;margin-top:8px;cursor:pointer;text-decoration:underline;">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div>\n\t\t\t\t\t`,t.addEventListener("click",(()=>{this.navigateToHospitalDetail(e)}));const o=new window.AMap.InfoWindow({content:t,offset:new window.AMap.Pixel(0,-30),isCustom:!0}),n=a.getPosition();o.open(this.mapInstance,n)}),300)},destroyMap(){this.mapRippleCircles.forEach((e=>{this.mapInstance&&this.mapInstance.remove(e)})),this.mapRippleCircles=[],this.mapMarkers.forEach((e=>{this.mapInstance&&this.mapInstance.remove(e)})),this.mapMarkers=[],this.mapInstance&&(this.mapInstance.destroy(),this.mapInstance=null)},toggleFilterPopup(){this.showSortMenu=!1,this.$refs.filterPopup&&this.$refs.filterPopup.open()},closeFilterPopup(){this.$refs.filterPopup&&this.$refs.filterPopup.close()},onFilterPopupClose(){},selectFilterOption(e,t){this.filters[e]===t?this.filters[e]=null:this.filters[e]=t},resetFilters(){this.filters={serviceType:null,hospitalLevel:null,distance:null,hospitalType:null}},applyFilters(){this.closeFilterPopup()},getHospitalLevel(e){if(!e)return"";return["åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢","åŒ—äº¬åå’ŒåŒ»é™¢","åŒ—äº¬å¤©å›åŒ»é™¢","åŒ—äº¬æœé˜³åŒ»é™¢","åŒ—äº¬å‹è°ŠåŒ»é™¢","åŒ—äº¬åŒä»åŒ»é™¢","åŒ—äº¬301åŒ»é™¢","åŒ—äº¬å®‰è´åŒ»é™¢","åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢"].some((t=>e.includes(t)))||e.includes("ä¸‰ç”²")||e.includes("ä¸‰çº§ç”²ç­‰")?"ä¸‰ç”²":e.includes("ä¸‰ä¹™")||e.includes("ä¸‰çº§ä¹™ç­‰")?"ä¸‰ä¹™":e.includes("ä¸‰ä¸™")||e.includes("ä¸‰çº§ä¸™ç­‰")?"ä¸‰ä¸™":e.includes("ä¸‰çº§")?"ä¸‰çº§":e.includes("äºŒç”²")||e.includes("äºŒçº§ç”²ç­‰")?"äºŒç”²":e.includes("äºŒä¹™")||e.includes("äºŒçº§ä¹™ç­‰")?"äºŒä¹™":e.includes("äºŒä¸™")||e.includes("äºŒçº§ä¸™ç­‰")?"äºŒä¸™":e.includes("äºŒçº§")?"äºŒçº§":e.includes("ä¸€ç”²")||e.includes("ä¸€çº§ç”²ç­‰")?"ä¸€ç”²":e.includes("ä¸€ä¹™")||e.includes("ä¸€çº§ä¹™ç­‰")?"ä¸€ä¹™":e.includes("ä¸€ä¸™")||e.includes("ä¸€çº§ä¸™ç­‰")?"ä¸€ä¸™":e.includes("ä¸€çº§")?"ä¸€çº§":""},getHospitalType:e=>e?e.includes("å„¿ç«¥åŒ»é™¢")?"å„¿ç«¥åŒ»é™¢":e.includes("éª¨ç§‘åŒ»é™¢")?"éª¨ç§‘åŒ»é™¢":e.includes("å¦‡äº§åŒ»é™¢")?"å¦‡äº§åŒ»é™¢":e.includes("å£è…”åŒ»é™¢")?"å£è…”åŒ»é™¢":e.includes("ç²¾ç¥")||e.includes("å¿ƒç†")?"ç²¾ç¥ç§‘åŒ»é™¢":e.includes("è‚¿ç˜¤")?"è‚¿ç˜¤åŒ»é™¢":e.includes("åŒ»é™¢")?"ç»¼åˆåŒ»é™¢":"æœªçŸ¥":"æœªçŸ¥"}};const C=s(V,[["render",function(t,o,n,s,i,r){const l=a(e.resolveDynamicComponent("uni-popup"),y),c=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"city",onClick:o[0]||(o[0]=(...e)=>r.chooseCity&&r.chooseCity(...e))},[e.createElementVNode("text",{class:"city-name"},e.toDisplayString(i.city),1),e.createElementVNode("text",{class:"city-arrow"},"â–¼")]),e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("text",{class:"icon-search"},"ğŸ”"),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text","onUpdate:modelValue":o[1]||(o[1]=e=>i.keyword=e),placeholder:"æœç´¢åŒ»é™¢ã€ç§‘å®¤ã€ç–¾ç—…ã€åŒ»ç”Ÿ","placeholder-class":"search-placeholder","confirm-type":"search",onConfirm:o[2]||(o[2]=(...e)=>r.onSearch&&r.onSearch(...e)),onInput:o[3]||(o[3]=(...e)=>r.onSearchInput&&r.onSearchInput(...e))},null,544),[[e.vModelText,i.keyword]]),e.createElementVNode("view",{class:e.normalizeClass(["voice-icon",{recording:i.isRecording}]),onClick:o[4]||(o[4]=(...e)=>r.toggleVoiceSearch&&r.toggleVoiceSearch(...e))},[e.createElementVNode("text",{class:"voice-icon-text"},e.toDisplayString(i.isRecording?"ğŸ”´":"ğŸ¤"),1)],2)]),i.isRecording?(e.openBlock(),e.createElementBlock("view",{key:0,class:"voice-recording-tip"},[e.createElementVNode("text",{class:"tip-text"},"æ­£åœ¨å½•éŸ³ï¼Œç‚¹å‡»åœæ­¢"),e.createElementVNode("text",{class:"tip-time"},e.toDisplayString(i.recordingTime)+"ç§’",1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"chat-icon",onClick:o[5]||(o[5]=(...e)=>r.goMessages&&r.goMessages(...e))},[e.createElementVNode("text",null,"ğŸ’¬"),i.unreadMessageCount>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"message-badge"},e.toDisplayString(i.unreadMessageCount>99?"99+":i.unreadMessageCount),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"smart-recommend-banner",onClick:o[6]||(o[6]=(...e)=>r.goSmartRecommend&&r.goSmartRecommend(...e))},[e.createElementVNode("view",{class:"banner-content"},[e.createElementVNode("view",{class:"banner-icon"},"ğŸ¤–"),e.createElementVNode("view",{class:"banner-text"},[e.createElementVNode("text",{class:"banner-title"},"æ™ºèƒ½æ¨è"),e.createElementVNode("text",{class:"banner-desc"},"æ ¹æ®ç—‡çŠ¶å’Œå†å²è®°å½•ä¸ºæ‚¨æ¨èæœ€åˆé€‚çš„åŒ»ç”Ÿ")]),e.createElementVNode("view",{class:"banner-arrow"},"â€º")])]),e.createElementVNode("view",{class:"filter-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-item sort-filter",{active:0===i.activeFilterIndex}]),onClick:o[7]||(o[7]=(...e)=>r.toggleSortMenu&&r.toggleSortMenu(...e))},[e.createElementVNode("text",{class:"filter-text"},e.toDisplayString(r.sortTypeText),1),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),i.showSortMenu?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sort-menu",onClick:o[8]||(o[8]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.sortOptions,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["sort-menu-item",{active:i.sortType===t.value}]),onClick:e=>r.selectSortType(t.value)},[e.createElementVNode("text",{class:"sort-menu-text"},e.toDisplayString(t.label),1),i.sortType===t.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"sort-menu-check"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"])))),128))])):e.createCommentVNode("",!0),i.showSortMenu?(e.openBlock(),e.createElementBlock("view",{key:1,class:"sort-mask",onClick:o[9]||(o[9]=(...e)=>r.closeSortMenu&&r.closeSortMenu(...e))})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:1===i.activeFilterIndex}]),onClick:o[10]||(o[10]=e=>r.onFilterChange(1))},[e.createElementVNode("text",{class:"filter-text"},"ç§‘å®¤"),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:2===i.activeFilterIndex}]),onClick:o[11]||(o[11]=e=>r.onFilterChange(2))},[e.createElementVNode("text",{class:"filter-text"},"ç–¾ç—…"),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:3===i.activeFilterIndex}]),onClick:o[12]||(o[12]=e=>r.onFilterChange(3))},[e.createElementVNode("text",{class:"filter-text"},"ç­›é€‰"),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:i.showMapView}]),onClick:o[13]||(o[13]=(...e)=>r.toggleMapView&&r.toggleMapView(...e))},[e.createElementVNode("text",{class:"filter-text"},e.toDisplayString(i.showMapView?"åˆ—è¡¨":"åœ°å›¾"),1)],2)]),i.showMapView?(e.openBlock(),e.createElementBlock("view",{key:0,class:"map-view-container"},[e.createElementVNode("view",{class:"map-header"},[e.createElementVNode("view",{class:"map-stats"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"åŒ»é™¢æ€»æ•°"),e.createElementVNode("view",{class:"stat-value"},e.toDisplayString(r.hospitalCount),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"åŒ»ç”Ÿæ€»æ•°"),e.createElementVNode("view",{class:"stat-value"},e.toDisplayString(r.filteredDoctorList.length),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-label"},"è¦†ç›–åŸå¸‚"),e.createElementVNode("view",{class:"stat-value"},"1")])])]),e.createElementVNode("view",{class:"map-container"},[e.createElementVNode("view",{id:"doctor-map",class:"doctor-map"})])])):(e.openBlock(),e.createElementBlock("scroll-view",{key:1,class:"doctor-list","scroll-y":""},[e.createElementVNode("view",{class:"waterfall-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.waterfallColumns,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"waterfall-column"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||a,class:"doctor-card",onClick:e=>r.goDoctorDetail(t)},[e.createElementVNode("view",{class:"doctor-left"},[e.createElementVNode("image",{class:"doctor-avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"])]),e.createElementVNode("view",{class:"doctor-right"},[e.createElementVNode("view",{class:"doctor-header-row"},[e.createElementVNode("view",{class:"doctor-title-box"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(t.level),1)]),e.createElementVNode("button",{class:"btn-reserve",size:"mini",onClick:e.withModifiers((e=>r.onReserve(t)),["stop"])}," é¢„çº¦ ",8,["onClick"])]),e.createElementVNode("view",{class:"doctor-hospital-row"},[e.createElementVNode("text",{class:"hospital"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"dept"},e.toDisplayString(t.dept),1)]),e.createElementVNode("view",{class:"doctor-goodat-row"},[e.createElementVNode("text",{class:"goodat-label"},"æ“…é•¿ï¼š"),e.createElementVNode("text",{class:"goodat-text"},e.toDisplayString(t.goodAt),1)]),e.createElementVNode("view",{class:"doctor-tags-row"},[e.createElementVNode("view",{class:"tag tag-reserve",onClick:e.withModifiers((e=>r.onReserve(t)),["stop"])},[e.createElementVNode("text",{class:"tag-dot"},"â—"),e.createElementVNode("text",null,"é¢„çº¦æŒ‚å·(å¤šç‚¹)")],8,["onClick"]),e.createElementVNode("view",{class:"tag tag-online",onClick:e.withModifiers((e=>r.onConsult(t)),["stop"])},[e.createElementVNode("text",{class:"tag-dot"},"â—"),e.createElementVNode("text",null,"åœ¨çº¿å’¨è¯¢")],8,["onClick"])])])],8,["onClick"])))),128))])))),128))]),0===r.filteredDoctorList.length&&i.keyword?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-result"},[e.createElementVNode("text",{class:"empty-text"},"æœªæ‰¾åˆ°ç›¸å…³åŒ»ç”Ÿ"),e.createElementVNode("text",{class:"empty-hint"},"è¯·å°è¯•å…¶ä»–å…³é”®è¯")])):e.createCommentVNode("",!0)])),e.createVNode(l,{ref:"filterPopup",type:"right","mask-click":!0,onClose:r.onFilterPopupClose},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"filter-popup"},[e.createElementVNode("scroll-view",{class:"popup-content","scroll-y":""},[e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"æœåŠ¡ç±»å‹"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"é—¨è¯Šé¢„çº¦"===i.filters.serviceType}]),onClick:o[14]||(o[14]=e=>r.selectFilterOption("serviceType","é—¨è¯Šé¢„çº¦"))}," é—¨è¯Šé¢„çº¦ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"äº’è”ç½‘åŒ»é™¢"===i.filters.serviceType}]),onClick:o[15]||(o[15]=e=>r.selectFilterOption("serviceType","äº’è”ç½‘åŒ»é™¢"))}," äº’è”ç½‘åŒ»é™¢ ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"åŒ»é™¢ç­‰çº§"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸‰ç”²åŒ»é™¢"===i.filters.hospitalLevel}]),onClick:o[16]||(o[16]=e=>r.selectFilterOption("hospitalLevel","ä¸‰ç”²åŒ»é™¢"))}," ä¸‰ç”²åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸‰çº§åŒ»é™¢"===i.filters.hospitalLevel}]),onClick:o[17]||(o[17]=e=>r.selectFilterOption("hospitalLevel","ä¸‰çº§åŒ»é™¢"))}," ä¸‰çº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"äºŒçº§åŒ»é™¢"===i.filters.hospitalLevel}]),onClick:o[18]||(o[18]=e=>r.selectFilterOption("hospitalLevel","äºŒçº§åŒ»é™¢"))}," äºŒçº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ä¸€çº§åŒ»é™¢"===i.filters.hospitalLevel}]),onClick:o[19]||(o[19]=e=>r.selectFilterOption("hospitalLevel","ä¸€çº§åŒ»é™¢"))}," ä¸€çº§åŒ»é™¢ ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"è·ç¦»"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"5kmå†…"===i.filters.distance}]),onClick:o[20]||(o[20]=e=>r.selectFilterOption("distance","5kmå†…"))}," 5kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"10kmå†…"===i.filters.distance}]),onClick:o[21]||(o[21]=e=>r.selectFilterOption("distance","10kmå†…"))}," 10kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"20kmå†…"===i.filters.distance}]),onClick:o[22]||(o[22]=e=>r.selectFilterOption("distance","20kmå†…"))}," 20kmå†… ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"50kmå†…"===i.filters.distance}]),onClick:o[23]||(o[23]=e=>r.selectFilterOption("distance","50kmå†…"))}," 50kmå†… ",2)])]),e.createElementVNode("view",{class:"filter-section"},[e.createElementVNode("text",{class:"section-title"},"åŒ»é™¢ç±»å‹"),e.createElementVNode("view",{class:"filter-options-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ç»¼åˆåŒ»é™¢"===i.filters.hospitalType}]),onClick:o[24]||(o[24]=e=>r.selectFilterOption("hospitalType","ç»¼åˆåŒ»é™¢"))}," ç»¼åˆåŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å„¿ç«¥åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[25]||(o[25]=e=>r.selectFilterOption("hospitalType","å„¿ç«¥åŒ»é™¢"))}," å„¿ç«¥åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"éª¨ç§‘åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[26]||(o[26]=e=>r.selectFilterOption("hospitalType","éª¨ç§‘åŒ»é™¢"))}," éª¨ç§‘åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å¦‡äº§åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[27]||(o[27]=e=>r.selectFilterOption("hospitalType","å¦‡äº§åŒ»é™¢"))}," å¦‡äº§åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å£è…”åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[28]||(o[28]=e=>r.selectFilterOption("hospitalType","å£è…”åŒ»é™¢"))}," å£è…”åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"ç²¾ç¥ç§‘åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[29]||(o[29]=e=>r.selectFilterOption("hospitalType","ç²¾ç¥ç§‘åŒ»é™¢"))}," ç²¾ç¥ç§‘åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"è‚¿ç˜¤åŒ»é™¢"===i.filters.hospitalType}]),onClick:o[30]||(o[30]=e=>r.selectFilterOption("hospitalType","è‚¿ç˜¤åŒ»é™¢"))}," è‚¿ç˜¤åŒ»é™¢ ",2),e.createElementVNode("view",{class:e.normalizeClass(["filter-option",{active:"å…¶ä»–"===i.filters.hospitalType}]),onClick:o[31]||(o[31]=e=>r.selectFilterOption("hospitalType","å…¶ä»–"))}," å…¶ä»– ",2)])]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"footer-btn reset-btn",onClick:o[32]||(o[32]=(...e)=>r.resetFilters&&r.resetFilters(...e))},"é‡ç½®"),e.createElementVNode("button",{class:"footer-btn confirm-btn",onClick:o[33]||(o[33]=(...e)=>r.applyFilters&&r.applyFilters(...e))},"ç¡®å®š")])])])])),_:1},8,["onClose"]),e.createVNode(c)])}]]),x=["{","}"];const b=/^(?:\d)+/,S=/^(?:\w)+/;const I="zh-Hans",T="zh-Hant",D="en",B=Object.prototype.hasOwnProperty,_=(e,t)=>B.call(e,t),P=new class{constructor(){this._caches=Object.create(null)}interpolate(e,t,a=x){if(!t)return[e];let o=this._caches[e];return o||(o=function(e,[t,a]){const o=[];let n=0,s="";for(;n<e.length;){let i=e[n++];if(i===t){s&&o.push({type:"text",value:s}),s="";let t="";for(i=e[n++];void 0!==i&&i!==a;)t+=i,i=e[n++];const r=i===a,l=b.test(t)?"list":r&&S.test(t)?"named":"unknown";o.push({value:t,type:l})}else s+=i}return s&&o.push({type:"text",value:s}),o}(e,a),this._caches[e]=o),function(e,t){const a=[];let o=0;const n=Array.isArray(t)?"list":(s=t,null!==s&&"object"==typeof s?"named":"unknown");var s;if("unknown"===n)return a;for(;o<e.length;){const s=e[o];switch(s.type){case"text":a.push(s.value);break;case"list":a.push(t[parseInt(s.value,10)]);break;case"named":"named"===n&&a.push(t[s.value])}o++}return a}(o,t)}};function A(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return I;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?I:e.indexOf("-hant")>-1?T:(a=e,["-tw","-hk","-mo","-cht"].find((e=>-1!==a.indexOf(e)))?T:I);var a;let o=[D,"fr","es"];t&&Object.keys(t).length>0&&(o=Object.keys(t));const n=function(e,t){return t.find((t=>0===e.indexOf(t)))}(e,o);return n||void 0}class U{constructor({locale:e,fallbackLocale:t,messages:a,watcher:o,formater:n}){this.locale=D,this.fallbackLocale=D,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=n||P,this.messages=a||{},this.setLocale(e||D),o&&this.watchLocale(o)}setLocale(e){const t=this.locale;this.locale=A(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach((e=>{e(this.locale,t)}))}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,a=!0){const o=this.messages[e];o?a?Object.assign(o,t):Object.keys(t).forEach((e=>{_(o,e)||(o[e]=t[e])})):this.messages[e]=t}f(e,t,a){return this.formater.interpolate(e,t,a).join("")}t(e,t,a){let o=this.message;return"string"==typeof t?(t=A(t,this.messages))&&(o=this.messages[t]):a=t,_(o,e)?this.formater.interpolate(o[e],a).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}const M={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"å–æ¶ˆ","uni-search-bar.placeholder":"è¯·è¾“å…¥æœç´¢å†…å®¹"},"zh-Hant":{"uni-search-bar.cancel":"å–æ¶ˆ","uni-search-bar.placeholder":"è«‹è¼¸å…¥æœç´¢å…§å®¹"}},{t:$}=function(e,t={},a,o){if("string"!=typeof e){const a=[t,e];e=a[0],t=a[1]}"string"!=typeof e&&(e="undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():D),"string"!=typeof a&&(a="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||D);const n=new U({locale:e,fallbackLocale:a,messages:t,watcher:o});let s=(e,t)=>{if("function"!=typeof getApp)s=function(e,t){return n.t(e,t)};else{let e=!1;s=function(t,a){const o=getApp().$vm;return o&&(o.$locale,e||(e=!0,function(e,t){e.$watchLocale?e.$watchLocale((e=>{t.setLocale(e)})):e.$watch((()=>e.$locale),(e=>{t.setLocale(e)}))}(o,n))),n.t(t,a)}}return s(e,t)};return{i18n:n,f:(e,t,a)=>n.f(e,t,a),t:(e,t)=>s(e,t),add:(e,t,a=!0)=>n.add(e,t,a),watch:e=>n.watchLocale(e),getLocale:()=>n.getLocale(),setLocale:e=>n.setLocale(e)}}(M),L={name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:""},bgColor:{type:String,default:"#F8F8F8"},textColor:{type:String,default:"#000000"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||$("uni-search-bar.cancel")},placeholderText(){return this.placeholder||$("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,t){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.searchVal="",this.$nextTick((()=>{this.$emit("clear",{value:""})}))},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,plus.key.hideSoftKeybord())},confirm(){plus.key.hideSoftKeybord(),this.$emit("confirm",{value:this.searchVal})},blur(){plus.key.hideSoftKeybord(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}};const F=s(L,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"uni-searchbar"},[e.createElementVNode("view",{style:e.normalizeStyle({borderRadius:n.radius+"px",backgroundColor:n.bgColor}),class:"uni-searchbar__box",onClick:o[5]||(o[5]=(...e)=>l.searchClick&&l.searchClick(...e))},[e.createElementVNode("view",{class:"uni-searchbar__box-icon-search"},[e.renderSlot(t.$slots,"searchIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"18",type:"search"})]),!0)]),r.show||r.searchVal?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,focus:r.showSync,disabled:n.readonly,placeholder:l.placeholderText,maxlength:n.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>r.searchVal=e),style:e.normalizeStyle({color:n.textColor}),onConfirm:o[1]||(o[1]=(...e)=>l.confirm&&l.confirm(...e)),onBlur:o[2]||(o[2]=(...e)=>l.blur&&l.blur(...e)),onFocus:o[3]||(o[3]=(...e)=>l.emitFocus&&l.emitFocus(...e))},null,44,["focus","disabled","placeholder","maxlength"])),[[e.vModelText,r.searchVal]]):(e.openBlock(),e.createElementBlock("text",{key:1,class:"uni-searchbar__text-placeholder"},e.toDisplayString(n.placeholder),1)),r.show&&("always"===n.clearButton||"auto"===n.clearButton&&""!==r.searchVal)&&!n.readonly?(e.openBlock(),e.createElementBlock("view",{key:2,class:"uni-searchbar__box-icon-clear",onClick:o[4]||(o[4]=(...e)=>l.clear&&l.clear(...e))},[e.renderSlot(t.$slots,"clearIcon",{},(()=>[e.createVNode(c,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])):e.createCommentVNode("",!0)],4),"always"===n.cancelButton||r.show&&"auto"===n.cancelButton?(e.openBlock(),e.createElementBlock("text",{key:0,onClick:o[6]||(o[6]=(...e)=>l.cancel&&l.cancel(...e)),class:"uni-searchbar__cancel"},e.toDisplayString(l.cancelTextI18n),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-2ba324d9"]]),R="/static/maiyao/buluofen.png";const O=s({name:"BuyMedicine",data:()=>({hours:"3",minutes:"18",seconds:"36",categories:[{name:"å¯¹ç—‡æ‰¾è¯",icon:"/static/maiyao/buluofen.png",bgColor:"#ffebee"},{name:"å¸¸ç”¨è¯ç‰©",icon:"/static/maiyao/buluofen.png",bgColor:"#e8f5e9"},{name:"ç”¨è¯å›æ”¶",icon:"/static/maiyao/buluofen.png",bgColor:"#e3f2fd"},{name:"æ¢å­£å¿…å¤‡",icon:"/static/maiyao/buluofen.png",bgColor:"#fff3e0"},{name:"å¤„æ–¹è´­è¯",icon:"/static/maiyao/buluofen.png",bgColor:"#f3e5f5"}],limitedMedicines:[{name:"é˜¿ç“¦æ–¯ä¸ å…‹éš†æŠ—ä½“",price:"168",originalPrice:"198",sold:"68%",image:"/static/maiyao/buluofen.png"},{name:"é˜¿æ–¯åŒ¹æ— å…‹éš†æŠ—ä½“",price:"168",originalPrice:"198",sold:"34%",image:"/static/maiyao/buluofen.png"},{name:"Achatinin",price:"168",originalPrice:"198",sold:"51%",image:"/static/maiyao/buluofen.png"}],promotions:[{name:"æ…¢ç—…ç”¨è¯",image:"/static/maiyao/buluofen.png"},{name:"å„¿ç«¥ç”¨è¯",image:"/static/maiyao/buluofen.png"}]}),onLoad(){this.startCountdown()},onUnload(){this.timer&&clearInterval(this.timer)},methods:{onSearch(e){t("log","at pages/buy-medicine/index.vue:175","æœç´¢:",e)},startCountdown(){let e=260316;this.timer=setInterval((()=>{e--,e<=0?clearInterval(this.timer):(this.hours=Math.floor(e/3600).toString().padStart(2,"0"),this.minutes=Math.floor(e%3600/60).toString().padStart(2,"0"),this.seconds=Math.floor(e%60).toString().padStart(2,"0"))}),1e3)}}},[["render",function(t,o,n,s,i,r){const l=a(e.resolveDynamicComponent("uni-search-bar"),F);return e.openBlock(),e.createElementBlock("view",{class:"buy-medicine-container"},[e.createElementVNode("view",{class:"search-bar"},[e.createVNode(l,{placeholder:"è¯·è¾“å…¥æ‚¨è¦æŸ¥æ‰¾çš„å†…å®¹",bgColor:"#f5f5f5",borderRadius:"80rpx",onConfirm:r.onSearch},null,8,["onConfirm"])]),e.createElementVNode("view",{class:"banner"},[e.createElementVNode("swiper",{"indicator-dots":!0,autoplay:!0,interval:3e3,duration:500,"indicator-color":"#ddd","indicator-active-color":"#4a90e2"},[e.createElementVNode("swiper-item",null,[e.createElementVNode("view",{class:"banner-item"},[e.createElementVNode("view",{class:"banner-content"},[e.createElementVNode("text",{class:"banner-title"},"24å°æ—¶çº¿ä¸Šå¤§è¯æˆ¿"),e.createElementVNode("text",{class:"banner-subtitle"},"ä¸€åŸåä¹æˆ¿"),e.createElementVNode("text",{class:"banner-desc"},"è®©æ‚¨ä¹°çš„æ”¾å¿ƒä¸å®‰å¿ƒ"),e.createElementVNode("button",{class:"banner-btn"},"ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…")]),e.createElementVNode("view",{class:"banner-image"},[e.createElementVNode("image",{src:R,mode:"aspectFit"})])])]),e.createElementVNode("swiper-item",null,[e.createElementVNode("view",{class:"banner-item"},[e.createElementVNode("view",{class:"banner-content"},[e.createElementVNode("text",{class:"banner-title"},"ä¸“ä¸šè¯å¸ˆåœ¨çº¿æœåŠ¡"),e.createElementVNode("text",{class:"banner-subtitle"},"7x24å°æ—¶ä¸ºæ‚¨ç­”ç–‘"),e.createElementVNode("text",{class:"banner-desc"},"ç”¨è¯æŒ‡å¯¼ï¼Œå¥åº·å’¨è¯¢"),e.createElementVNode("button",{class:"banner-btn"},"ç«‹å³å’¨è¯¢")]),e.createElementVNode("view",{class:"banner-image"},[e.createElementVNode("image",{src:R,mode:"aspectFit"})])])])])]),e.createElementVNode("view",{class:"category"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.categories,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"category-item",key:a},[e.createElementVNode("view",{class:"category-icon",style:e.normalizeStyle({backgroundColor:t.bgColor})},[e.createElementVNode("image",{src:t.icon,mode:"aspectFit"},null,8,["src"])],4),e.createElementVNode("text",{class:"category-name"},e.toDisplayString(t.name),1)])))),128))]),e.createElementVNode("view",{class:"limited-offer"},[e.createElementVNode("view",{class:"offer-header"},[e.createElementVNode("text",{class:"offer-title"},"é™æ—¶ä¼˜æƒ "),e.createElementVNode("view",{class:"countdown"},[e.createElementVNode("text",{class:"countdown-item"},e.toDisplayString(i.hours),1),e.createElementVNode("text",{class:"countdown-separator"},":"),e.createElementVNode("text",{class:"countdown-item"},e.toDisplayString(i.minutes),1),e.createElementVNode("text",{class:"countdown-separator"},":"),e.createElementVNode("text",{class:"countdown-item"},e.toDisplayString(i.seconds),1)]),e.createElementVNode("text",{class:"offer-more"},"å…¨éƒ¨ >>")]),e.createElementVNode("view",{class:"offer-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.limitedMedicines,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"medicine-card",key:a},[e.createElementVNode("view",{class:"medicine-image"},[e.createElementVNode("image",{src:t.image,mode:"aspectFit"},null,8,["src"])]),e.createElementVNode("view",{class:"medicine-info"},[e.createElementVNode("text",{class:"medicine-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"medicine-price"},[e.createElementVNode("text",{class:"price-current"},"Â¥"+e.toDisplayString(t.price),1),e.createElementVNode("text",{class:"price-original"},"Â¥"+e.toDisplayString(t.originalPrice),1)]),e.createElementVNode("view",{class:"medicine-progress"},[e.createElementVNode("text",{class:"progress-text"},"å·²å”®"+e.toDisplayString(t.sold),1),e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:t.sold})},null,4)])]),e.createElementVNode("button",{class:"buy-btn"},"å»æŠ¢è´­")])])))),128))])]),e.createElementVNode("view",{class:"promotion"},[e.createElementVNode("view",{class:"promotion-header"},[e.createElementVNode("text",{class:"promotion-title"},"ä¿ƒé”€ä¸“åŒº")]),e.createElementVNode("view",{class:"promotion-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.promotions,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"promotion-card",key:a},[e.createElementVNode("image",{src:t.image,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"promotion-name"},e.toDisplayString(t.name),1)])))),128))])])])}],["__scopeId","data-v-ba2565ed"]]),j="http://192.168.8.8:3000/api",z="http://192.168.8.8:3000",q={API_BASE_URL:j,SOCKET_URL:z},H=Object.freeze(Object.defineProperty({__proto__:null,API_BASE_URL:j,SOCKET_URL:z,default:q},Symbol.toStringTag,{value:"Module"})),W={components:{ThemeToggle:d},data:()=>({theme:l(),articles:[]}),onLoad(){this.loadArticles()},onShow(){uni.$on("themeChange",this.updateTheme),uni.$on("articlesUpdated",this.loadArticles),uni.$on("articleReadCountUpdated",this.updateArticleReadCount),this.loadArticles()},onHide(){uni.$off("themeChange",this.updateTheme),uni.$off("articlesUpdated",this.loadArticles),uni.$off("articleReadCountUpdated",this.updateArticleReadCount)},methods:{loadArticles(){try{const e=m();this.articles=(e||[]).slice(0,4)}catch(e){t("error","at pages/yishuo/yishuo.vue:100","åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:",e),this.articles=[]}},updateArticleReadCount(e){try{if(e&&e.articleId){const t=this.articles.find((t=>t.id===e.articleId));t&&e.readCount&&(t.readCount=e.readCount)}}catch(a){t("error","at pages/yishuo/yishuo.vue:115","æ›´æ–°é˜…è¯»æ•°å¤±è´¥:",a)}},updateTheme(e){try{this.theme=e||l(),this.$nextTick((()=>{this.$forceUpdate&&"function"==typeof this.$forceUpdate&&this.$forceUpdate()}))}catch(Kt){t("warn","at pages/yishuo/yishuo.vue:127","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},viewMoreMedicalTalk(){uni.navigateTo({url:"/pages/yishuo/article-list",fail:e=>{t("error","at pages/yishuo/yishuo.vue:136","è·³è½¬å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},selectArticle(e){uni.navigateTo({url:`/pages/yishuo/article-detail?id=${e}`,fail:e=>{t("error","at pages/yishuo/yishuo.vue:149","è·³è½¬å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},getFullFileUrl(e){if(!e)return"";const t=String(e).trim();if(t.startsWith("http://")||t.startsWith("https://"))return t;if(t.startsWith("/static/"))return t;let a=j.replace(/\/api$/,"");return a&&"/"!==a&&!a.startsWith("/")||(a="http://localhost:3000"),`${a}${t}`},getVideoUrl(e){if(!e)return"";const t=String(e).trim();return t.startsWith("http://")||t.startsWith("https://")?t:this.getFullFileUrl(t)},getVideoPoster(e){return e.image&&"/static/logo.png"!==e.image&&""!==e.image.trim()?e.image.startsWith("http://")||e.image.startsWith("https://")?e.image:this.getFullFileUrl(e.image):null},onVideoMetadataLoaded(e){t("log","at pages/yishuo/yishuo.vue:216","è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ")}}};const J=s(W,[["render",function(t,a,o,n,s,i){const r=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"medical-talk-section"},[e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("text",{class:"section-title"},"åŒ»è¯´"),e.createElementVNode("text",{class:"view-more",onClick:a[0]||(a[0]=(...e)=>i.viewMoreMedicalTalk&&i.viewMoreMedicalTalk(...e))},"æŸ¥çœ‹æ›´å¤š>")]),e.createElementVNode("view",{class:"article-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.articles,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"article-card",onClick:e=>i.selectArticle(t.id)},[e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("view",{class:"article-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"article-subtitle"},e.toDisplayString(t.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"read-count"},e.toDisplayString(t.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(t.date),1)])]),e.createElementVNode("view",{class:"article-image"},["video"===t.mediaType&&t.video?(e.openBlock(),e.createElementBlock("video",{key:0,src:i.getVideoUrl(t.video),class:"article-video-thumb",controls:!1,"show-center-play-btn":!0,"show-play-btn":!1,"enable-play-gesture":!1,autoplay:!1,muted:!0,"object-fit":"cover",poster:i.getVideoPoster(t)||void 0,onLoadedmetadata:a[1]||(a[1]=(...e)=>i.onVideoMetadataLoaded&&i.onVideoMetadataLoaded(...e))},null,40,["src","poster"])):(e.openBlock(),e.createElementBlock("image",{key:1,src:t.image,mode:"aspectFill",class:"article-img"},null,8,["src"]))])],8,["onClick"])))),128))])]),e.createVNode(r)])}]]);var K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];const G={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");var t;return function(e,t){for(var a,o=e.length,n="="===e[o-2]?2:"="===e[o-1]?1:0,s=0,i=o-n&4294967292,r=0;r<i;r+=4)a=K[e.charCodeAt(r)]<<18|K[e.charCodeAt(r+1)]<<12|K[e.charCodeAt(r+2)]<<6|K[e.charCodeAt(r+3)],t[s++]=a>>16&255,t[s++]=a>>8&255,t[s++]=255&a;1===n&&(a=K[e.charCodeAt(r)]<<10|K[e.charCodeAt(r+1)]<<4|K[e.charCodeAt(r+2)]>>2,t[s++]=a>>8&255,t[s++]=255&a),2===n&&(a=K[e.charCodeAt(r)]<<2|K[e.charCodeAt(r+1)]>>4,t[s++]=255&a)}((t="DCloud-Crypto",weex.requireModule(t)).getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}},Y="sso_token",Q="token",X="sso_refresh_token",Z="sso_user_info";function ee(){let e=uni.getStorageSync(Y);if(e)return uni.setStorageSync(Q,e),e;const a=uni.getStorageSync(Q);return a?(uni.setStorageSync(Y,a),t("log","at utils/auth.js:71","âœ… ä»æ—§KEYè¯»å–tokenå¹¶åŒæ­¥åˆ°æ–°KEY"),a):null}function te(e){e?(uni.setStorageSync(Y,e),uni.setStorageSync(Q,e),t("log","at utils/auth.js:152","Tokenå·²ä¿å­˜ï¼Œé•¿åº¦:",e.length,"ï¼ˆsso_token ä¸ token åŒKEYåŒæ­¥ï¼‰")):t("warn","at utils/auth.js:83","setToken: tokenä¸ºç©º")}function ae(){let e=uni.getStorageSync(Z);if(e)try{const t="string"==typeof e?JSON.parse(e):e;return uni.setStorageSync("userInfo",t),t}catch(Kt){t("error","at utils/auth.js:220","Failed to parse user info:",Kt)}const a=uni.getStorageSync("userInfo");if(a)try{const e="string"==typeof a?JSON.parse(a):a;return uni.setStorageSync(Z,JSON.stringify(e)),t("log","at utils/auth.js:237","âœ… ä»æ—§KEYè¯»å–ç”¨æˆ·ä¿¡æ¯å¹¶åŒæ­¥åˆ°æ–°KEY"),e}catch(Kt){t("error","at utils/auth.js:240","Failed to parse legacy user info:",Kt)}return null}function oe(e){uni.setStorageSync(Z,JSON.stringify(e))}function ne(){uni.removeStorageSync(Y),uni.removeStorageSync(X),uni.removeStorageSync(Z),uni.removeStorageSync(Q),uni.removeStorageSync("userInfo"),uni.removeStorageSync("userProfile"),uni.removeStorageSync("userProfilesById"),uni.removeStorageSync("currentUserId"),t("log","at utils/auth.js:334","âœ… å·²æ¸…é™¤æ‰€æœ‰è®¤è¯ä¿¡æ¯å’Œç”¨æˆ·æ•°æ®")}function se(){const e=uni.getStorageSync(X)||null;return e?new Promise(((a,o)=>{uni.request({url:`${j}/auth/refresh`,method:"POST",header:{"Content-Type":"application/json"},data:{refreshToken:e},success:e=>{var t;200===e.statusCode&&(null==(t=e.data)?void 0:t.token)?(te(e.data.token),a(e.data.token)):(ne(),a(null))},fail:e=>{t("error","at utils/auth.js:494","Token refresh failed:",e),ne(),a(null)}})})):Promise.resolve(null)}function ie(e,t){var a;if(t){let t="è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";if(e.statusCode)switch(e.statusCode){case 400:t="è¯·æ±‚å‚æ•°é”™è¯¯";break;case 401:t="æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•";break;case 403:t="æ²¡æœ‰æƒé™è®¿é—®";break;case 404:t="è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨";break;case 500:t="æœåŠ¡å™¨é”™è¯¯";break;default:t=(null==(a=e.data)?void 0:a.message)||`è¯·æ±‚å¤±è´¥: ${e.statusCode}`}else e.errMsg&&(e.errMsg.includes("timeout")?t="è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ":e.errMsg.includes("fail")&&(t="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"));uni.showToast({title:t,icon:"none",duration:2e3})}}function re(e,a={},o={}){return function(e){return new Promise(((a,o)=>{const{url:n,method:s="GET",data:i={},header:r={},showLoading:l=!1,showError:c=!0}=e;l&&uni.showLoading({title:"åŠ è½½ä¸­...",mask:!0});const d=ee();d&&(r.Authorization=`Bearer ${d}`),r["Content-Type"]||(r["Content-Type"]="application/json"),uni.request({url:n.startsWith("http")?n:`${j}${n}`,method:s,data:i,header:r,success:async e=>{var d,u,m,p;if(l&&uni.hideLoading(),401===e.statusCode){if(null==(d=e.data)?void 0:d.sessionExpired)return t("log","at utils/api.js:61","âš ï¸ ä¼šè¯å·²å¤±æ•ˆï¼Œæ¸…é™¤æœ¬åœ°tokenï¼ˆå¯èƒ½åœ¨å…¶ä»–åœ°æ–¹å·²ç™»å‡ºï¼‰"),ne(),uni.showToast({title:"ç™»å½•å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•",icon:"none",duration:2e3}),setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),2e3),void o(new Error("Session expired"));const u=await se();return u?(r.Authorization=`Bearer ${u}`,void uni.request({url:n.startsWith("http")?n:`${j}${n}`,method:s,data:i,header:r,success:e=>{var t;200===e.statusCode?a(e.data):(ie(e,c),o(new Error((null==(t=e.data)?void 0:t.message)||"è¯·æ±‚å¤±è´¥")))},fail:e=>{l&&uni.hideLoading(),ie(e,c),o(e)}})):(ne(),uni.showToast({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none",duration:2e3}),setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),2e3),void o(new Error("Token expired")))}if(200===e.statusCode)e.data&&"object"==typeof e.data&&!1===e.data.success?(ie(e,c),o(new Error((null==(u=e.data)?void 0:u.message)||"è¯·æ±‚å¤±è´¥"))):a(e.data);else{ie(e,c);const t=(null==(m=e.data)?void 0:m.message)||(null==(p=e.data)?void 0:p.error)||`è¯·æ±‚å¤±è´¥: ${e.statusCode}`;o(new Error(t))}},fail:e=>{l&&uni.hideLoading(),ie(e,c),o(e)}})}))}({url:e,method:"POST",data:a,...o})}function le(e,a,o="file",n={},s={}){return new Promise(((i,r)=>{const l=ee(),c=e.startsWith("http")?e:`${j}${e}`,d={};l&&(d.Authorization=`Bearer ${l}`),uni.uploadFile({url:c,filePath:a,name:o,formData:n,header:d,onProgressUpdate:s.onProgressUpdate||(()=>{}),success:e=>{if(200===e.statusCode)try{const t="string"==typeof e.data?JSON.parse(e.data):e.data;i(t)}catch(Kt){t("error","at utils/api.js:451","å“åº”æ•°æ®è§£æå¤±è´¥:",e.data),r(new Error("å“åº”æ•°æ®è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿”å›æ ¼å¼"))}else{let t=`ä¸Šä¼ å¤±è´¥: ${e.statusCode}`;try{t=JSON.parse(e.data).message||t}catch(Kt){404===e.statusCode?t="æ¥å£ä¸å­˜åœ¨ (404)":500===e.statusCode&&(t="æœåŠ¡å™¨é”™è¯¯ (500)")}r(new Error(t))}},fail:e=>{r(e)},...s})}))}const ce={components:{ThemeToggle:d},data:()=>({theme:l(),screenInfo:{windowWidth:375,windowHeight:667},mediaType:"image",articleForm:{title:"",content:"",image:"",video:""},imageUploadProgress:0,imageUploadStatus:"idle",videoUploadProgress:0,videoUploadStatus:"idle",videoUploadPaused:!1,videoUploadFileHash:"",videoUploadBlob:null,videoUploadFileName:"",videoUploadExt:"",videoUploadTotalChunks:0,videoUploadChunkSize:0,articles:[]}),onLoad(){this.getScreenInfo(),this.loadArticles()},onShow(){uni.$on("themeChange",this.updateTheme),uni.$on("articlesUpdated",this.loadArticles),uni.$on("articleReadCountUpdated",this.updateArticleReadCount),this.getScreenInfo(),this.loadArticles()},onHide(){uni.$off("themeChange",this.updateTheme),uni.$off("articlesUpdated",this.loadArticles),uni.$off("articleReadCountUpdated",this.updateArticleReadCount)},methods:{getScreenInfo(){try{const e=uni.getSystemInfoSync();this.screenInfo={windowWidth:e.windowWidth||375,windowHeight:e.windowHeight||667}}catch(Kt){t("warn","at pages/yishuo/article-list.vue:292","è·å–å±å¹•ä¿¡æ¯å¤±è´¥:",Kt),this.screenInfo={windowWidth:375,windowHeight:667}}},updateTheme(e){try{this.theme=e||l(),this.$nextTick((()=>{this.$forceUpdate&&"function"==typeof this.$forceUpdate&&this.$forceUpdate()}))}catch(Kt){t("warn","at pages/yishuo/article-list.vue:308","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},addArticle(){this.resetForm(),this.$refs.addArticlePopup.open()},closeAddArticleModal(){this.$refs.addArticlePopup.close(),setTimeout((()=>{this.resetForm()}),300)},resetForm(){this.articleForm={title:"",content:"",image:"",video:""},this.mediaType="image",this.imageUploadProgress=0,this.imageUploadStatus="idle",this.videoUploadProgress=0,this.videoUploadStatus="idle",this.videoUploadPaused=!1,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0},switchMediaType(e){this.mediaType=e,"image"===e?this.articleForm.video="":this.articleForm.image=""},async chooseImage(){try{const e=(await new Promise(((e,t)=>{uni.chooseImage({count:1,sizeType:["compressed","original"],sourceType:["album","camera"],success:e,fail:t})}))).tempFilePaths[0];t("log","at pages/yishuo/article-list.vue:372","é€‰æ‹©çš„å›¾ç‰‡:",e),this.imageUploadStatus="uploading",this.imageUploadProgress=0;const a=await le("/image/upload",e,"image",{},{onProgressUpdate:e=>{void 0!==e.progress?this.imageUploadProgress=Math.round(e.progress):e.totalBytesSent&&e.totalBytesExpectedToSend&&(this.imageUploadProgress=Math.round(e.totalBytesSent/e.totalBytesExpectedToSend*100))}});if(this.imageUploadStatus="success",this.imageUploadProgress=100,!(a&&a.success&&a.data&&a.data.url))throw new Error((null==a?void 0:a.message)||"ä¸Šä¼ å¤±è´¥");{let e=a.data.url;if(e.startsWith("http://")||e.startsWith("https://")||(e=this.getFullFileUrl(e)),!e||""===e.trim())throw new Error("å›¾ç‰‡URLæ— æ•ˆ");e=e.trim(),this.articleForm.image=e,this.mediaType="image",t("log","at pages/yishuo/article-list.vue:410","âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"),t("log","at pages/yishuo/article-list.vue:411","   å®Œæ•´URL:",e),t("log","at pages/yishuo/article-list.vue:412","   URLé•¿åº¦:",e.length),t("log","at pages/yishuo/article-list.vue:413","   URLæ˜¯å¦ä»¥httpså¼€å¤´:",e.startsWith("https://")),uni.showToast({title:"å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",icon:"success",duration:1500})}}catch(e){if(t("error","at pages/yishuo/article-list.vue:424","é€‰æ‹©æˆ–ä¸Šä¼ å›¾ç‰‡å¤±è´¥:",e),this.imageUploadStatus="error",this.imageUploadProgress=0,e.errMsg&&e.errMsg.includes("cancel"))return void(this.imageUploadStatus="idle");uni.showToast({title:e.message||"å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}},deleteImage(){this.articleForm.image="",this.imageUploadStatus="idle",this.imageUploadProgress=0},onImagePreviewLoad(e){t("log","at pages/yishuo/article-list.vue:449","âœ… å›¾ç‰‡é¢„è§ˆåŠ è½½æˆåŠŸ:",this.articleForm.image)},onImagePreviewError(e){t("error","at pages/yishuo/article-list.vue:453","âŒ å›¾ç‰‡é¢„è§ˆåŠ è½½å¤±è´¥:",e),t("error","at pages/yishuo/article-list.vue:454","å›¾ç‰‡URL:",this.articleForm.image),uni.showToast({title:"å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URL",icon:"none",duration:2e3})},onVideoPreviewPlay(e){t("log","at pages/yishuo/article-list.vue:463","âœ… è§†é¢‘å¼€å§‹æ’­æ”¾:",this.articleForm.video)},async onVideoPreviewError(e){const a=this.articleForm.video,o=this.getVideoUrl(a);if(t("error","at pages/yishuo/article-list.vue:469","âŒ è§†é¢‘é¢„è§ˆåŠ è½½å¤±è´¥:",e),t("error","at pages/yishuo/article-list.vue:470","åŸå§‹URL:",a),t("error","at pages/yishuo/article-list.vue:471","è½¬æ¢åURL:",o),t("error","at pages/yishuo/article-list.vue:472","URLç±»å‹:",typeof a),t("error","at pages/yishuo/article-list.vue:473","æ˜¯å¦ä¸ºå®Œæ•´URL:",a&&(a.startsWith("http://")||a.startsWith("https://"))),o&&(o.startsWith("http://")||o.startsWith("https://"))){try{t("log","at pages/yishuo/article-list.vue:483","HEADè¯·æ±‚ç»“æœ:",await fetch(o,{method:"HEAD",mode:"no-cors"}))}catch(n){t("warn","at pages/yishuo/article-list.vue:485","HEADè¯·æ±‚å¤±è´¥ï¼ˆå¯èƒ½æ˜¯CORSé™åˆ¶ï¼‰:",n)}o.includes("cos.")||o.includes("myqcloud.com")?(t("warn","at pages/yishuo/article-list.vue:490","âš ï¸ è¿™æ˜¯è…¾è®¯äº‘COS URLï¼Œå¯èƒ½çš„åŸå› ï¼š"),t("warn","at pages/yishuo/article-list.vue:491","1. æ–‡ä»¶å¯èƒ½æœªæˆåŠŸä¸Šä¼ åˆ°COSï¼ˆåˆå¹¶å¤±è´¥ï¼‰"),t("warn","at pages/yishuo/article-list.vue:492","2. COSçš„CORSé…ç½®å¯èƒ½ä¸å…è®¸å½“å‰åŸŸåè®¿é—®"),t("warn","at pages/yishuo/article-list.vue:493","3. æ–‡ä»¶å¯èƒ½å·²è¿‡æœŸæˆ–è¢«åˆ é™¤"),t("warn","at pages/yishuo/article-list.vue:494","4. è§†é¢‘æ–‡ä»¶æ ¼å¼å¯èƒ½ä¸è¢«æµè§ˆå™¨æ”¯æŒ"),uni.showToast({title:"è§†é¢‘åŠ è½½å¤±è´¥ï¼šå¯èƒ½æ˜¯COSæ–‡ä»¶ä¸å­˜åœ¨æˆ–CORSé™åˆ¶",icon:"none",duration:3e3})):uni.showToast({title:"è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæˆ–æ ¼å¼",icon:"none",duration:2e3})}else uni.showToast({title:"è§†é¢‘URLæ— æ•ˆ",icon:"none",duration:2e3})},chooseVideo(){uni.chooseVideo({sourceType:["album","camera"],maxDuration:300,camera:"back",success:async e=>{const a=e.tempFilePath;t("log","at pages/yishuo/article-list.vue:524","é€‰æ‹©çš„è§†é¢‘ä¸´æ—¶è·¯å¾„:",a),t("log","at pages/yishuo/article-list.vue:525","è§†é¢‘æ—¶é•¿:",e.duration,"ç§’"),await this.uploadVideoNormal(a)},fail:e=>{t("error","at pages/yishuo/article-list.vue:542","é€‰æ‹©è§†é¢‘å¤±è´¥:",e),uni.showToast({title:"é€‰æ‹©è§†é¢‘å¤±è´¥",icon:"none"})}})},async uploadVideoNormal(e){try{this.videoUploadStatus="uploading",this.videoUploadProgress=0;const a=await le("/video/upload",e,"video",{},{onProgressUpdate:e=>{void 0!==e.progress?this.videoUploadProgress=Math.round(e.progress):e.totalBytesSent&&e.totalBytesExpectedToSend&&(this.videoUploadProgress=Math.round(e.totalBytesSent/e.totalBytesExpectedToSend*100))}});if(!(a&&a.success&&a.data&&a.data.url))throw this.videoUploadStatus="error",new Error((null==a?void 0:a.message)||"ä¸Šä¼ å¤±è´¥");{const e=a.data.url.startsWith("http://")||a.data.url.startsWith("https://")?a.data.url:this.getFullFileUrl(a.data.url);this.articleForm.video=e,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,t("log","at pages/yishuo/article-list.vue:578","âœ… è§†é¢‘ä¸Šä¼ æˆåŠŸï¼ŒURL:",e),uni.showToast({title:"è§†é¢‘ä¸Šä¼ æˆåŠŸ",icon:"success",duration:1500})}}catch(a){t("error","at pages/yishuo/article-list.vue:589","æ™®é€šè§†é¢‘ä¸Šä¼ å¤±è´¥:",a),this.videoUploadStatus="error",this.videoUploadProgress=0,uni.showToast({title:"è§†é¢‘ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}},async handleBigVideoUploadH5(e){const a=e.tempFilePath;this.videoUploadStatus="uploading",this.videoUploadProgress=0;const o=await fetch(a),n=await o.blob(),s=e.name||`video_${Date.now()}.mp4`,i=s.lastIndexOf("."),r=-1!==i?s.substring(i):".mp4",l=await n.arrayBuffer(),c=await G.subtle.digest("SHA-256",l),d=Array.from(new Uint8Array(c)).map((e=>e.toString(16).padStart(2,"0"))).join(""),u=await fetch(`${j}/video/check`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:d,filename:s,size:n.size,ext:r})}),m=await u.json();if(!m.success)throw new Error(m.message||"æ£€æŸ¥ä¸Šä¼ çŠ¶æ€å¤±è´¥");const p=m.data||{};if(p.alreadyUploaded&&p.url){uni.hideLoading();let e=p.url;if(e.startsWith("http://")||e.startsWith("https://")||(e=this.getFullFileUrl(e)),!e||""===e.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");return e=e.trim(),this.articleForm.video=e,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,t("log","at pages/yishuo/article-list.vue:664","âœ… è§†é¢‘ç§’ä¼ æˆåŠŸ"),t("log","at pages/yishuo/article-list.vue:665","   å®Œæ•´URL:",e),t("log","at pages/yishuo/article-list.vue:666","   URLé•¿åº¦:",e.length),void uni.showToast({title:"å·²ç§’ä¼ ï¼Œæ— éœ€é‡æ–°ä¸Šä¼ ",icon:"success",duration:1500})}const h=p.uploadedChunks||[],g=5242880,v=Math.ceil(n.size/g);if(this.videoUploadFileHash=d,this.videoUploadBlob=n,this.videoUploadFileName=s,this.videoUploadExt=r,this.videoUploadTotalChunks=v,this.videoUploadChunkSize=g,await this.uploadChunks(h,g,v,n,d,s,r),"uploading"!==this.videoUploadStatus&&"paused"!==this.videoUploadStatus)return;const f=await fetch(`${j}/video/merge`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:d,filename:s,ext:r,totalChunks:v})}),w=await f.json();if(uni.hideLoading(),!w.success||!w.data||!w.data.url)throw new Error(w.message||"è§†é¢‘åˆå¹¶å¤±è´¥");let y=w.data.url;if(y.startsWith("http://")||y.startsWith("https://")||(y=this.getFullFileUrl(y)),!y||""===y.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");y=y.trim(),this.articleForm.video=y,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,t("log","at pages/yishuo/article-list.vue:737","âœ… è§†é¢‘åˆå¹¶å®Œæˆ"),t("log","at pages/yishuo/article-list.vue:738","   å®Œæ•´URL:",y),t("log","at pages/yishuo/article-list.vue:739","   URLé•¿åº¦:",y.length),t("log","at pages/yishuo/article-list.vue:740","   URLæ˜¯å¦ä»¥httpså¼€å¤´:",y.startsWith("https://")),uni.showToast({title:"è§†é¢‘ä¸Šä¼ å®Œæˆ",icon:"success",duration:1500}),this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0},async uploadChunks(e,a,o,n,s,i,r){for(let c=0;c<o;c++){for(;this.videoUploadPaused;){if("paused"!==this.videoUploadStatus&&"uploading"!==this.videoUploadStatus)return void t("log","at pages/yishuo/article-list.vue:763",`ä¸Šä¼ ä¸­æ–­ï¼šçŠ¶æ€ä¸º ${this.videoUploadStatus}`);await new Promise((e=>setTimeout(e,100)))}if("uploading"!==this.videoUploadStatus&&"paused"!==this.videoUploadStatus)return void t("log","at pages/yishuo/article-list.vue:771",`ä¸Šä¼ ä¸­æ–­ï¼šçŠ¶æ€ä¸º ${this.videoUploadStatus}`);if(e.includes(c)){this.videoUploadProgress=Math.round((c+1)/o*100);continue}"paused"===this.videoUploadStatus&&(this.videoUploadStatus="uploading",this.videoUploadPaused=!1);const d=c*a,u=Math.min(n.size,d+a),m=n.slice(d,u),p=new FormData;p.append("fileHash",s),p.append("chunkIndex",c),p.append("totalChunks",o),p.append("filename",i),p.append("ext",r),p.append("chunk",m,`${s}-${c}${r}`);try{const e=await fetch(`${j}/video/upload-chunk`,{method:"POST",body:p,credentials:"include"}),t=await e.json();if(!t.success)throw new Error(t.message||`åˆ†ç‰‡ ${c} ä¸Šä¼ å¤±è´¥`);this.videoUploadProgress=Math.round((c+1)/o*100)}catch(l){throw t("error","at pages/yishuo/article-list.vue:813",`åˆ†ç‰‡ ${c} ä¸Šä¼ å¤±è´¥:`,l),l}}t("log","at pages/yishuo/article-list.vue:820","æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆ")},pauseVideoUpload(e){e&&e.stopPropagation(),t("log","at pages/yishuo/article-list.vue:827","æš‚åœä¸Šä¼ è¢«ç‚¹å‡»"),this.videoUploadPaused=!0,this.videoUploadStatus="paused",uni.showToast({title:"ä¸Šä¼ å·²æš‚åœ",icon:"none",duration:1500})},cancelVideoUpload(e){e&&e.stopPropagation(),t("log","at pages/yishuo/article-list.vue:841","å–æ¶ˆä¸Šä¼ è¢«ç‚¹å‡»"),this.videoUploadStatus="idle",this.videoUploadPaused=!1,this.videoUploadProgress=0,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0,this.articleForm.video="",uni.hideLoading(),uni.showToast({title:"ä¸Šä¼ å·²å–æ¶ˆ",icon:"none",duration:1500})},async resumeVideoUpload(e){var a,o,n,s,i;if(e&&e.stopPropagation(),t("log","at pages/yishuo/article-list.vue:871","ç»§ç»­ä¸Šä¼ è¢«ç‚¹å‡»"),this.videoUploadFileHash&&this.videoUploadBlob){this.videoUploadPaused=!1,this.videoUploadStatus="uploading";try{const e=await fetch(`${j}/video/check`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:this.videoUploadFileHash,filename:this.videoUploadFileName,size:this.videoUploadBlob.size,ext:this.videoUploadExt})}),r=await e.json();if(!r.success)throw new Error(r.message||"æ£€æŸ¥ä¸Šä¼ çŠ¶æ€å¤±è´¥");const l=r.data||{};if(l.alreadyUploaded&&l.url){t("log","at pages/yishuo/article-list.vue:911","âœ… æ–‡ä»¶å·²å®Œæ•´ä¸Šä¼ ï¼ˆç§’ä¼ ï¼‰");let e=l.url;if(e.startsWith("http://")||e.startsWith("https://")||(e=this.getFullFileUrl(e)),!e||""===e.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");return e=e.trim(),this.articleForm.video=e,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0,uni.hideLoading(),void uni.showToast({title:"è§†é¢‘å·²å­˜åœ¨ï¼Œæ— éœ€é‡æ–°ä¸Šä¼ ",icon:"success",duration:1500})}const c=l.uploadedChunks||[];if(c.length===this.videoUploadTotalChunks)t("log","at pages/yishuo/article-list.vue:949","æ‰€æœ‰åˆ†ç‰‡å·²ä¸Šä¼ ï¼Œç›´æ¥åˆå¹¶");else if(0===c.length){t("log","at pages/yishuo/article-list.vue:955","âš ï¸ åˆ†ç‰‡åˆ—è¡¨ä¸ºç©ºï¼Œç­‰å¾…åˆå¹¶å®Œæˆ...");let e=0;const n=10;for(;e<n;){await new Promise((e=>setTimeout(e,500)));const n=await fetch(`${j}/video/check`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:this.videoUploadFileHash,filename:this.videoUploadFileName,size:this.videoUploadBlob.size,ext:this.videoUploadExt})}),s=await n.json();if(s.success&&(null==(a=s.data)?void 0:a.alreadyUploaded)&&(null==(o=s.data)?void 0:o.url)){t("log","at pages/yishuo/article-list.vue:981","âœ… ç­‰å¾…åæ£€æŸ¥ï¼šæ–‡ä»¶å·²ä¸Šä¼ å®Œæˆ");let e=s.data.url;if(e.startsWith("http://")||e.startsWith("https://")||(e=this.getFullFileUrl(e)),!e||""===e.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");return e=e.trim(),this.articleForm.video=e,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0,uni.hideLoading(),void uni.showToast({title:"è§†é¢‘ä¸Šä¼ å®Œæˆ",icon:"success",duration:1500})}e++}t("log","at pages/yishuo/article-list.vue:1018","âš ï¸ ç­‰å¾…è¶…æ—¶ï¼Œå°è¯•åˆå¹¶ï¼ˆå¯èƒ½åˆå¹¶æ­£åœ¨è¿›è¡Œä¸­ï¼‰...")}else{t("log","at pages/yishuo/article-list.vue:1021",`ç»§ç»­ä¸Šä¼ ï¼šå·²ä¸Šä¼  ${c.length}/${this.videoUploadTotalChunks} ä¸ªåˆ†ç‰‡`),await this.uploadChunks(c,this.videoUploadChunkSize,this.videoUploadTotalChunks,this.videoUploadBlob,this.videoUploadFileHash,this.videoUploadFileName,this.videoUploadExt);const e=await fetch(`${j}/video/check`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:this.videoUploadFileHash,filename:this.videoUploadFileName,size:this.videoUploadBlob.size,ext:this.videoUploadExt})}),a=await e.json();if(!a.success)throw new Error("éªŒè¯ä¸Šä¼ çŠ¶æ€å¤±è´¥");if((null==(n=a.data)?void 0:n.alreadyUploaded)&&(null==(s=a.data)?void 0:s.url)){t("log","at pages/yishuo/article-list.vue:1054","âœ… éªŒè¯æœŸé—´æ–‡ä»¶å·²ä¸Šä¼ å®Œæˆ");let e=a.data.url;if(e.startsWith("http://")||e.startsWith("https://")||(e=this.getFullFileUrl(e)),!e||""===e.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");return e=e.trim(),this.articleForm.video=e,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0,uni.hideLoading(),void uni.showToast({title:"è§†é¢‘ä¸Šä¼ å®Œæˆ",icon:"success",duration:1500})}const o=(null==(i=a.data)?void 0:i.uploadedChunks)||[];o.length!==this.videoUploadTotalChunks?t("log","at pages/yishuo/article-list.vue:1090",`âš ï¸ åˆ†ç‰‡ä¸å®Œæ•´ï¼šå·²ä¸Šä¼  ${o.length}/${this.videoUploadTotalChunks}ï¼Œå°è¯•åˆå¹¶...`):t("log","at pages/yishuo/article-list.vue:1092",`âœ… æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆï¼š${o.length}/${this.videoUploadTotalChunks}`)}t("log","at pages/yishuo/article-list.vue:1097","å¼€å§‹åˆå¹¶åˆ†ç‰‡...");const d=await fetch(`${j}/video/merge`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileHash:this.videoUploadFileHash,filename:this.videoUploadFileName,ext:this.videoUploadExt,totalChunks:this.videoUploadTotalChunks})}),u=await d.json();if(uni.hideLoading(),!u.success||!u.data||!u.data.url)throw new Error(u.message||"è§†é¢‘åˆå¹¶å¤±è´¥");let m=u.data.url;if(m.startsWith("http://")||m.startsWith("https://")||(m=this.getFullFileUrl(m)),!m||""===m.trim())throw new Error("è§†é¢‘URLæ— æ•ˆ");m=m.trim(),this.articleForm.video=m,this.mediaType="video",this.videoUploadStatus="success",this.videoUploadProgress=100,this.videoUploadFileHash="",this.videoUploadBlob=null,this.videoUploadFileName="",this.videoUploadExt="",this.videoUploadTotalChunks=0,this.videoUploadChunkSize=0,uni.showToast({title:"è§†é¢‘ä¸Šä¼ å®Œæˆ",icon:"success",duration:1500})}catch(r){this.videoUploadStatus="error",uni.hideLoading(),uni.showToast({title:r.message||"ç»§ç»­ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}}else uni.showToast({title:"æ— æ³•ç»§ç»­ä¸Šä¼ ï¼Œè¯·é‡æ–°é€‰æ‹©è§†é¢‘",icon:"none"})},getFullFileUrl(e){if(!e)return t("warn","at pages/yishuo/article-list.vue:1162","âš ï¸ getFullFileUrl: pathä¸ºç©º"),"";const a=String(e).trim();if(a.startsWith("http://")||a.startsWith("https://")){if(a.includes("localhost:5173")||a.includes("127.0.0.1:5173")){t("warn","at pages/yishuo/article-list.vue:1173","âš ï¸ æ£€æµ‹åˆ°localhost URLï¼Œå°è¯•è½¬æ¢ä¸ºåç«¯æœåŠ¡å™¨åœ°å€");let e=j.replace(/\/api$/,"");e&&"/"!==e&&!e.startsWith("/")||(e="http://v96e6967.natappfree.cc");const o=`${e}${a.replace(/^https?:\/\/[^\/]+/,"")}`;return t("log","at pages/yishuo/article-list.vue:1182",`ğŸ”§ ä¿®æ­£localhost URL: ${a} -> ${o}`),o}return a}let o="";o=j.replace(/\/api$/,""),o&&"/"!==o&&!o.startsWith("/")||(o="http://v96e6967.natappfree.cc");const n=`${o}${a}`;return t("log","at pages/yishuo/article-list.vue:1210","ğŸ”— URLè½¬æ¢:"),t("log","at pages/yishuo/article-list.vue:1211",`   åŸå§‹è·¯å¾„: ${a}`),t("log","at pages/yishuo/article-list.vue:1212",`   API_BASE_URL: ${j}`),t("log","at pages/yishuo/article-list.vue:1213",`   åç«¯æœåŠ¡å™¨åœ°å€: ${o}`),t("log","at pages/yishuo/article-list.vue:1214",`   å®Œæ•´URL: ${n}`),n},getVideoUrl(e){if(!e)return t("warn","at pages/yishuo/article-list.vue:1220","âš ï¸ getVideoUrl: URLä¸ºç©º"),"";const a=String(e).trim();if(a.startsWith("http://")||a.startsWith("https://"))return t("log","at pages/yishuo/article-list.vue:1229","âœ… getVideoUrl: å·²ç»æ˜¯å®Œæ•´URL:",a),a;const o=this.getFullFileUrl(a);return t("log","at pages/yishuo/article-list.vue:1235","ğŸ”— getVideoUrl: è½¬æ¢ç›¸å¯¹è·¯å¾„"),t("log","at pages/yishuo/article-list.vue:1236","   åŸå§‹:",a),t("log","at pages/yishuo/article-list.vue:1237","   è½¬æ¢å:",o),o},getVideoPoster(e){return e.image&&"/static/logo.png"!==e.image&&""!==e.image.trim()?e.image.startsWith("http://")||e.image.startsWith("https://")?e.image:this.getFullFileUrl(e.image):null},onVideoMetadataLoaded(e){t("log","at pages/yishuo/article-list.vue:1257","è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ")},deleteVideo(){this.articleForm.video=""},loadArticles(){try{const e=m();this.articles=e||[]}catch(e){t("error","at pages/yishuo/article-list.vue:1270","åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:",e),this.articles=[]}},updateArticleReadCount(e){try{if(e&&e.articleId){const t=this.articles.find((t=>t.id===e.articleId));t&&e.readCount&&(t.readCount=e.readCount)}}catch(a){t("error","at pages/yishuo/article-list.vue:1285","æ›´æ–°é˜…è¯»æ•°å¤±è´¥:",a)}},saveArticle(){if(this.articleForm.title&&""!==this.articleForm.title.trim())if(this.articleForm.content&&""!==this.articleForm.content.trim())if(this.articleForm.image||this.articleForm.video){uni.showLoading({title:"ä¿å­˜ä¸­..."});try{!function(e){try{const t=m(),a=Date.now()+Math.floor(1e3*Math.random()),o=new Date,n=o.getFullYear(),s=`${n}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,i={id:a,title:e.title||"",subtitle:e.content?e.content.substring(0,50):"",content:e.content||"",readCount:"0",date:s,image:e.image||"/static/logo.png",video:e.video||"",mediaType:e.video?"video":"image",createTime:Date.now()};t.unshift(i),uni.setStorageSync(u,JSON.stringify(t)),uni.$emit("articlesUpdated",i)}catch(a){throw t("error","at utils/articleStorage.js:63","ä¿å­˜æ–‡ç« å¤±è´¥:",a),a}}({title:this.articleForm.title.trim(),content:this.articleForm.content.trim(),image:this.articleForm.image,video:this.articleForm.video}),uni.hideLoading(),uni.showToast({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:1500}),this.closeAddArticleModal()}catch(e){t("error","at pages/yishuo/article-list.vue:1341","ä¿å­˜æ–‡ç« å¤±è´¥:",e),uni.hideLoading(),uni.showToast({title:"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}else uni.showToast({title:"è¯·é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘",icon:"none"});else uni.showToast({title:"è¯·è¾“å…¥æ–‡ç« å†…å®¹",icon:"none"});else uni.showToast({title:"è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜",icon:"none"})},selectArticle(e){uni.navigateTo({url:`/pages/yishuo/article-detail?id=${e}`,fail:e=>{t("error","at pages/yishuo/article-list.vue:1354","è·³è½¬å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},goBack(){const e=getCurrentPages();e&&e.length>1?uni.navigateBack({delta:1,fail:e=>{t("warn","at pages/yishuo/article-list.vue:1369","è¿”å›å¤±è´¥:",e),uni.switchTab({url:"/pages/yishuo/yishuo",fail:()=>{uni.showToast({title:"è¿”å›å¤±è´¥",icon:"none"})}})}}):uni.switchTab({url:"/pages/yishuo/yishuo",fail:()=>{uni.showToast({title:"æ— æ³•è¿”å›",icon:"none"})}})}}};const de=s(ce,[["render",function(t,o,n,s,i,r){const l=e.resolveComponent("ThemeToggle"),c=a(e.resolveDynamicComponent("uni-popup"),y);return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("view",{class:"navbar-content"},[e.createElementVNode("view",{class:"nav-back-btn",onClick:o[0]||(o[0]=(...e)=>r.goBack&&r.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"navbar-title"},"åŒ»è¯´"),e.createElementVNode("view",{class:"add-article-btn",onClick:o[1]||(o[1]=(...e)=>r.addArticle&&r.addArticle(...e))},[e.createElementVNode("text",{class:"add-btn-text"},"+ æ·»åŠ æ–‡ç« ")])])]),e.createElementVNode("view",{class:"article-list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.articles,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"article-card",onClick:e=>r.selectArticle(t.id)},[e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("view",{class:"article-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"article-subtitle"},e.toDisplayString(t.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"read-count"},e.toDisplayString(t.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(t.date),1)])]),e.createElementVNode("view",{class:"article-image"},["video"===t.mediaType&&t.video?(e.openBlock(),e.createElementBlock("video",{key:0,src:r.getVideoUrl(t.video),class:"article-video-thumb",controls:!1,"show-center-play-btn":!0,"show-play-btn":!1,"enable-play-gesture":!1,autoplay:!1,muted:!0,"object-fit":"cover",poster:r.getVideoPoster(t)||void 0,onLoadedmetadata:o[2]||(o[2]=(...e)=>r.onVideoMetadataLoaded&&r.onVideoMetadataLoaded(...e))},null,40,["src","poster"])):(e.openBlock(),e.createElementBlock("image",{key:1,src:t.image,mode:"aspectFill",class:"article-img"},null,8,["src"]))])],8,["onClick"])))),128))]),e.createVNode(l),e.createVNode(c,{ref:"addArticlePopup",type:"center","is-mask-click":!1},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"add-article-modal"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"æ·»åŠ æ–‡ç« "),e.createElementVNode("text",{class:"modal-close",onClick:o[3]||(o[3]=(...e)=>r.closeAddArticleModal&&r.closeAddArticleModal(...e))},"Ã—")]),e.createElementVNode("scroll-view",{class:"modal-body","scroll-y":""},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"æ–‡ç« æ ‡é¢˜"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":o[4]||(o[4]=e=>i.articleForm.title=e),placeholder:"è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜",maxlength:"100"},null,512),[[e.vModelText,i.articleForm.title]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"æ·»åŠ å›¾ç‰‡æˆ–è§†é¢‘"),e.createElementVNode("view",{class:"media-upload"},[e.createElementVNode("view",{class:"media-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["media-tab",{active:"image"===i.mediaType}]),onClick:o[5]||(o[5]=e=>r.switchMediaType("image"))}," å›¾ç‰‡ ",2),e.createElementVNode("view",{class:e.normalizeClass(["media-tab",{active:"video"===i.mediaType}]),onClick:o[6]||(o[6]=e=>r.switchMediaType("video"))}," è§†é¢‘ ",2)]),"image"===i.mediaType?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-area"},[i.articleForm.image?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-preview"},[e.createElementVNode("image",{src:i.articleForm.image,mode:"aspectFill",class:"preview-img",onError:o[7]||(o[7]=(...e)=>r.onImagePreviewError&&r.onImagePreviewError(...e)),onLoad:o[8]||(o[8]=(...e)=>r.onImagePreviewLoad&&r.onImagePreviewLoad(...e))},null,40,["src"]),e.createElementVNode("view",{class:"delete-btn",onClick:o[9]||(o[9]=(...e)=>r.deleteImage&&r.deleteImage(...e))},[e.createElementVNode("text",null,"Ã—")])])):"uploading"===i.imageUploadStatus?(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-progress-container"},[e.createElementVNode("view",{class:"upload-progress-content"},[e.createElementVNode("text",{class:"upload-progress-icon"},"ğŸ“¤"),e.createElementVNode("text",{class:"upload-progress-text"},"ä¸Šä¼ ä¸­ "+e.toDisplayString(i.imageUploadProgress)+"%",1),e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:i.imageUploadProgress+"%"})},null,4)])])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"upload-placeholder",onClick:o[10]||(o[10]=(...e)=>r.chooseImage&&r.chooseImage(...e))},[e.createElementVNode("text",{class:"upload-icon"},"ğŸ“·"),e.createElementVNode("text",{class:"upload-text"},"ç‚¹å‡»é€‰æ‹©å›¾ç‰‡")]))])):e.createCommentVNode("",!0),"video"===i.mediaType?(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-area"},["uploading"===i.videoUploadStatus||"paused"===i.videoUploadStatus?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-progress-container"},[e.createElementVNode("view",{class:"upload-progress-content"},[e.createElementVNode("text",{class:"upload-progress-icon"},"ğŸ“¤"),e.createElementVNode("text",{class:"upload-progress-text"},e.toDisplayString("paused"===i.videoUploadStatus?"å·²æš‚åœ":"ä¸Šä¼ ä¸­")+" "+e.toDisplayString(i.videoUploadProgress)+"% ",1),e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:i.videoUploadProgress+"%"})},null,4)]),e.createElementVNode("view",{class:"upload-controls"},["uploading"===i.videoUploadStatus?(e.openBlock(),e.createElementBlock("view",{key:0,class:"pause-btn",onClick:o[11]||(o[11]=e.withModifiers(((...e)=>r.pauseVideoUpload&&r.pauseVideoUpload(...e)),["stop"]))}," â¸ æš‚åœ ")):"paused"===i.videoUploadStatus?(e.openBlock(),e.createElementBlock("view",{key:1,class:"resume-btn",onClick:o[12]||(o[12]=e.withModifiers(((...e)=>r.resumeVideoUpload&&r.resumeVideoUpload(...e)),["stop"]))}," â–¶ ç»§ç»­ ")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"cancel-btn",onClick:o[13]||(o[13]=e.withModifiers(((...e)=>r.cancelVideoUpload&&r.cancelVideoUpload(...e)),["stop"]))}," âœ• å–æ¶ˆ ")])])])):i.articleForm.video||"success"===i.videoUploadStatus?(e.openBlock(),e.createElementBlock("view",{key:1,class:"video-preview"},[e.createElementVNode("video",{src:r.getVideoUrl(i.articleForm.video),class:"preview-video",controls:!0,"show-center-play-btn":!0,"show-play-btn":!0,"enable-play-gesture":!0,poster:"",onError:o[14]||(o[14]=(...e)=>r.onVideoPreviewError&&r.onVideoPreviewError(...e)),onPlay:o[15]||(o[15]=(...e)=>r.onVideoPreviewPlay&&r.onVideoPreviewPlay(...e))},null,40,["src"]),e.createElementVNode("view",{class:"delete-btn",onClick:o[16]||(o[16]=(...e)=>r.deleteVideo&&r.deleteVideo(...e))},[e.createElementVNode("text",null,"Ã—")])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"upload-placeholder",onClick:o[17]||(o[17]=(...e)=>r.chooseVideo&&r.chooseVideo(...e))},[e.createElementVNode("text",{class:"upload-icon"},"ğŸ¥"),e.createElementVNode("text",{class:"upload-text"},"ç‚¹å‡»é€‰æ‹©è§†é¢‘")]))])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"form-label"},"æ–‡ç« å†…å®¹"),e.createElementVNode("view",{class:"form-textarea-wrapper"},[e.withDirectives(e.createElementVNode("textarea",{class:"form-textarea","onUpdate:modelValue":o[18]||(o[18]=e=>i.articleForm.content=e),placeholder:"è¯·è¾“å…¥æ–‡ç« å†…å®¹",maxlength:"5000","auto-height":!0},null,512),[[e.vModelText,i.articleForm.content]]),e.createElementVNode("view",{class:"char-count"},e.toDisplayString(i.articleForm.content.length)+"/5000",1)])])]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("view",{class:"footer-btn cancel-btn",onClick:o[19]||(o[19]=(...e)=>r.closeAddArticleModal&&r.closeAddArticleModal(...e))},"å–æ¶ˆ"),e.createElementVNode("view",{class:"footer-btn confirm-btn",onClick:o[20]||(o[20]=(...e)=>r.saveArticle&&r.saveArticle(...e))},"ä¿å­˜")])])])),_:1},512)])}]]),ue={components:{ThemeToggle:d},data:()=>({theme:l(),articleId:null,article:{title:"",content:"",date:"",readCount:"0",image:"",video:"",mediaType:"image"}}),computed:{canDelete(){return this.articleId&&this.articleId>4}},onLoad(e){e&&e.id?(this.articleId=parseInt(e.id),this.loadArticle()):(uni.showToast({title:"æ–‡ç« IDæ— æ•ˆ",icon:"none"}),setTimeout((()=>{this.goBack()}),1500))},onShow(){uni.$on("themeChange",this.updateTheme)},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{loadArticle(){try{let e=this.getDefaultArticles().find((e=>e.id===this.articleId));if(!e&&(e=function(e){try{return m().find((t=>t.id===e))||null}catch(a){return t("error","at utils/articleStorage.js:77","è·å–æ–‡ç« å¤±è´¥:",a),null}}(this.articleId),!e)){e=m().find((e=>e.id===this.articleId))}if(e){let a=e.mediaType;a||(a=e.video?"video":"image");let o=e.video||"";if(o&&!o.startsWith("http://")&&!o.startsWith("https://")){o=`${j.replace(/\/api$/,"")}${o}`}let n=e.image||"";if(n&&!n.startsWith("http://")&&!n.startsWith("https://")&&!n.startsWith("/static/")){n=`${j.replace(/\/api$/,"")}${n}`}this.article={title:e.title||"",content:e.content||e.subtitle||"",date:e.date||"",readCount:e.readCount||"0",image:n,video:o,mediaType:a},t("log","at pages/yishuo/article-detail.vue:179","ğŸ“¹ åŠ è½½æ–‡ç« è§†é¢‘URL:",o),e.id>4&&this.updateReadCount()}else uni.showToast({title:"æ–‡ç« ä¸å­˜åœ¨",icon:"none"}),setTimeout((()=>{this.goBack()}),1500)}catch(e){t("error","at pages/yishuo/article-detail.vue:195","åŠ è½½æ–‡ç« å¤±è´¥:",e),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}},getDefaultArticles:()=>[{id:1,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",content:'å…ƒå®µèŠ‚åƒæ±¤åœ†æ˜¯ä¼ ç»Ÿä¹ ä¿—ï¼Œä½†æ˜¯ç©ºè…¹åƒæ±¤åœ†éœ€è¦æ³¨æ„ã€‚æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³ç²˜æ€§å¤§ï¼Œä¸æ˜“æ¶ˆåŒ–ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¼•èµ·èƒƒéƒ¨ä¸é€‚ã€‚æ— ç³–æ±¤åœ†è™½ç„¶ä¸æ·»åŠ ç³–åˆ†ï¼Œä½†ä»ç„¶å«æœ‰æ·€ç²‰å’Œç¢³æ°´åŒ–åˆç‰©ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´çƒ­é‡æ‘„å…¥å¢åŠ ï¼Œå› æ­¤ä¸èƒ½è¯´å®Œå…¨ä¸"èƒ–äºº"ã€‚',readCount:"8908",date:"2020-03-03",image:"/static/logo.png",mediaType:"image"},{id:2,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",content:'å…ƒå®µèŠ‚åƒæ±¤åœ†æ˜¯ä¼ ç»Ÿä¹ ä¿—ï¼Œä½†æ˜¯ç©ºè…¹åƒæ±¤åœ†éœ€è¦æ³¨æ„ã€‚æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³ç²˜æ€§å¤§ï¼Œä¸æ˜“æ¶ˆåŒ–ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¼•èµ·èƒƒéƒ¨ä¸é€‚ã€‚æ— ç³–æ±¤åœ†è™½ç„¶ä¸æ·»åŠ ç³–åˆ†ï¼Œä½†ä»ç„¶å«æœ‰æ·€ç²‰å’Œç¢³æ°´åŒ–åˆç‰©ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´çƒ­é‡æ‘„å…¥å¢åŠ ï¼Œå› æ­¤ä¸èƒ½è¯´å®Œå…¨ä¸"èƒ–äºº"ã€‚',readCount:"8908",date:"2020-03-03",image:"/static/logo.png",mediaType:"image"},{id:3,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",content:'å…ƒå®µèŠ‚åƒæ±¤åœ†æ˜¯ä¼ ç»Ÿä¹ ä¿—ï¼Œä½†æ˜¯ç©ºè…¹åƒæ±¤åœ†éœ€è¦æ³¨æ„ã€‚æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³ç²˜æ€§å¤§ï¼Œä¸æ˜“æ¶ˆåŒ–ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¼•èµ·èƒƒéƒ¨ä¸é€‚ã€‚æ— ç³–æ±¤åœ†è™½ç„¶ä¸æ·»åŠ ç³–åˆ†ï¼Œä½†ä»ç„¶å«æœ‰æ·€ç²‰å’Œç¢³æ°´åŒ–åˆç‰©ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´çƒ­é‡æ‘„å…¥å¢åŠ ï¼Œå› æ­¤ä¸èƒ½è¯´å®Œå…¨ä¸"èƒ–äºº"ã€‚',readCount:"8908",date:"2020-03-03",image:"/static/logo.png",mediaType:"image"},{id:4,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",content:'å…ƒå®µèŠ‚åƒæ±¤åœ†æ˜¯ä¼ ç»Ÿä¹ ä¿—ï¼Œä½†æ˜¯ç©ºè…¹åƒæ±¤åœ†éœ€è¦æ³¨æ„ã€‚æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³ç²˜æ€§å¤§ï¼Œä¸æ˜“æ¶ˆåŒ–ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¼•èµ·èƒƒéƒ¨ä¸é€‚ã€‚æ— ç³–æ±¤åœ†è™½ç„¶ä¸æ·»åŠ ç³–åˆ†ï¼Œä½†ä»ç„¶å«æœ‰æ·€ç²‰å’Œç¢³æ°´åŒ–åˆç‰©ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´çƒ­é‡æ‘„å…¥å¢åŠ ï¼Œå› æ­¤ä¸èƒ½è¯´å®Œå…¨ä¸"èƒ–äºº"ã€‚',readCount:"8908",date:"2020-03-03",image:"/static/logo.png",mediaType:"image"}],updateReadCount(){try{const e=function(e){try{const t=m(),a=t.find((t=>t.id===e));if(a){const o=parseInt(a.readCount)||0;return a.readCount=String(o+1),uni.setStorageSync(u,JSON.stringify(t)),uni.$emit("articleReadCountUpdated",{articleId:e,readCount:a.readCount}),a.readCount}return null}catch(a){return t("error","at utils/articleStorage.js:125","æ›´æ–°é˜…è¯»æ•°å¤±è´¥:",a),null}}(this.articleId);if(e)this.article.readCount=e;else{const e=parseInt(this.article.readCount)||0;this.article.readCount=String(e+1),uni.$emit("articleReadCountUpdated",{articleId:this.articleId,readCount:this.article.readCount})}}catch(e){t("error","at pages/yishuo/article-detail.vue:266","æ›´æ–°é˜…è¯»æ•°å¤±è´¥:",e)}},onImageError(e){t("error","at pages/yishuo/article-detail.vue:271","å›¾ç‰‡åŠ è½½å¤±è´¥:",e),this.article.image="/static/logo.png"},onVideoError(e){t("error","at pages/yishuo/article-detail.vue:276","è§†é¢‘åŠ è½½å¤±è´¥:",e),uni.showToast({title:"è§†é¢‘åŠ è½½å¤±è´¥",icon:"none",duration:2e3})},updateTheme(e){try{this.theme=e||l(),this.$nextTick((()=>{this.$forceUpdate&&"function"==typeof this.$forceUpdate&&this.$forceUpdate()}))}catch(Kt){t("warn","at pages/yishuo/article-detail.vue:292","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},showDeleteConfirm(){uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚",confirmText:"åˆ é™¤",confirmColor:"#ff3b30",cancelText:"å–æ¶ˆ",success:e=>{e.confirm&&this.deleteArticle()}})},deleteArticle(){if(!this.articleId||this.articleId<=4)uni.showToast({title:"é»˜è®¤æ–‡ç« ä¸èƒ½åˆ é™¤",icon:"none"});else{uni.showLoading({title:"åˆ é™¤ä¸­..."});try{(function(e){try{const t=m().filter((t=>t.id!==e));return uni.setStorageSync(u,JSON.stringify(t)),uni.$emit("articlesUpdated"),!0}catch(a){return t("error","at utils/articleStorage.js:97","åˆ é™¤æ–‡ç« å¤±è´¥:",a),!1}})(this.articleId)?(uni.hideLoading(),uni.showToast({title:"åˆ é™¤æˆåŠŸ",icon:"success",duration:1500}),setTimeout((()=>{this.goBack()}),1500)):(uni.hideLoading(),uni.showToast({title:"åˆ é™¤å¤±è´¥",icon:"none"}))}catch(e){t("error","at pages/yishuo/article-detail.vue:347","åˆ é™¤æ–‡ç« å¤±è´¥:",e),uni.hideLoading(),uni.showToast({title:"åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}},goBack(){const e=getCurrentPages();e&&e.length>1?uni.navigateBack({delta:1,fail:e=>{t("warn","at pages/yishuo/article-detail.vue:362","è¿”å›å¤±è´¥:",e),uni.switchTab({url:"/pages/yishuo/yishuo",fail:()=>{uni.showToast({title:"è¿”å›å¤±è´¥",icon:"none"})}})}}):uni.switchTab({url:"/pages/yishuo/yishuo"})}}};const me=s(ue,[["render",function(t,a,o,n,s,i){const r=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("view",{class:"navbar-content"},[e.createElementVNode("view",{class:"nav-back-btn",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"navbar-title"},"æ–‡ç« è¯¦æƒ…"),i.canDelete?(e.openBlock(),e.createElementBlock("view",{key:0,class:"nav-delete-btn",onClick:a[1]||(a[1]=(...e)=>i.showDeleteConfirm&&i.showDeleteConfirm(...e))},[e.createElementVNode("text",{class:"delete-icon"},"åˆ é™¤")])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"nav-placeholder"}))])]),e.createElementVNode("scroll-view",{class:"article-container","scroll-y":""},[e.createElementVNode("view",{class:"article-header"},[e.createElementVNode("text",{class:"article-title"},e.toDisplayString(s.article.title||"åŠ è½½ä¸­..."),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"article-date"},e.toDisplayString(s.article.date||""),1),e.createElementVNode("text",{class:"read-count"},e.toDisplayString(s.article.readCount||"0")+"é˜…è¯»",1)])]),e.createElementVNode("view",{class:"article-media"},[s.article.video&&("video"===s.article.mediaType||!s.article.mediaType&&s.article.video)?(e.openBlock(),e.createElementBlock("video",{key:0,src:s.article.video,class:"article-video",controls:!0,"show-center-play-btn":!0,"show-fullscreen-btn":!0,"enable-play-gesture":!0,"object-fit":"contain",onError:a[2]||(a[2]=(...e)=>i.onVideoError&&i.onVideoError(...e))},null,40,["src"])):s.article.image&&"video"!==s.article.mediaType?(e.openBlock(),e.createElementBlock("image",{key:1,src:s.article.image,mode:"widthFix",class:"article-image",onError:a[3]||(a[3]=(...e)=>i.onImageError&&i.onImageError(...e))},null,40,["src"])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"media-placeholder"},[e.createElementVNode("text",{class:"placeholder-icon"},"ğŸ“„"),e.createElementVNode("text",{class:"placeholder-text"},"æš‚æ— å›¾ç‰‡æˆ–è§†é¢‘")]))]),e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("text",{class:"content-text"},e.toDisplayString(s.article.content||"æš‚æ— å†…å®¹"),1)])]),e.createVNode(r)])}]]),pe="appointment_records";function he(){try{const e=uni.getStorageSync(pe);return e?JSON.parse(e):[]}catch(e){return t("error","at utils/appointmentStorage.js:15","è·å–é¢„çº¦è®°å½•å¤±è´¥:",e),[]}}const ge={components:{ThemeToggle:d},data:()=>({defaultAvatar:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",avatarUrl:"",nickname:"",username:"",phone:"158****1234",theme:l(),pendingVisitCount:0}),computed:{displayPhone(){return this.phone?this.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"æœªç»‘å®š"},displayName(){return this.username?this.username:this.phone?this.displayPhone:"æœªç™»å½•"}},onShow(){let e={},t={};const a=getApp&&getApp();try{t=a&&a.globalData&&a.globalData.userInfo||uni.getStorageSync("userInfo")||{};const o=t&&(t.id||t._id||t.userId||t.username)||uni.getStorageSync("currentUserId")||null,n=uni.getStorageSync("userProfilesById")||{};if(o&&n[o])e=n[o];else{const t=uni.getStorageSync("userProfile");t&&Object.keys(t).length>0?e=t:a&&a.globalData&&a.globalData.userProfile&&(e=a.globalData.userProfile)}}catch(Kt){e={},t={}}this.avatarUrl=e.avatarUrl||this.defaultAvatar,this.username=t.username||this.username,this.nickname=e.nickname||t.username||this.nickname,this.phone=e.phone||this.phone,this.updatePendingVisitCount(),uni.$on("themeChange",this.updateTheme),this.updateTheme()},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{goVip(){uni.showToast({title:"å³å°†å¼€é€šVIP",icon:"none"})},goAppointments(e){uni.navigateTo({url:`/pages/mine/appointments?type=${e}`})},goPatients(){uni.navigateTo({url:"/pages/mine/patients"})},goConsultations(){uni.navigateTo({url:"/pages/mine/consultations"})},goFavorites(){uni.navigateTo({url:"/pages/mine/favorites"})},goMessages(){uni.navigateTo({url:"/pages/mine/messages"})},goHelp(){uni.navigateTo({url:"/pages/mine/help"})},goSettings(){uni.navigateTo({url:"/pages/settings/settings"})},openService(){uni.showToast({title:"è”ç³»å®¢æœ",icon:"none"})},updateTheme(e){try{this.theme=e||l(),this.$nextTick((()=>{this.$forceUpdate&&"function"==typeof this.$forceUpdate&&this.$forceUpdate()}))}catch(Kt){t("warn","at pages/mine/mine.vue:220","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},updatePendingVisitCount(){try{this.pendingVisitCount=function(){try{return he().filter((e=>"pendingVisit"===e.status)).length}catch(e){return t("error","at utils/appointmentStorage.js:140","è·å–å¾…å°±è¯Šæ•°é‡å¤±è´¥:",e),0}}()}catch(e){t("error","at pages/mine/mine.vue:229","è·å–å¾…å°±è¯Šæ•°é‡å¤±è´¥:",e),this.pendingVisitCount=0}}}};const ve=s(ge,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i),d=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"mine-page min-h-screen pb-[60rpx]"},[e.createElementVNode("view",{class:"header bg-gradient-to-b from-[#4a90e2] to-[#287adf] px-[28rpx] pt-[32rpx] pb-[32rpx]"},[e.createElementVNode("view",{class:"user-row flex items-center justify-between",onClick:o[1]||(o[1]=(...e)=>l.goSettings&&l.goSettings(...e))},[e.createElementVNode("view",{class:"avatar w-[84rpx] h-[84rpx] rounded-full bg-white flex items-center justify-center overflow-hidden"},[e.createElementVNode("image",{src:r.avatarUrl||r.defaultAvatar,mode:"aspectFill",class:"avatar-img w-full h-full"},null,8,["src"])]),e.createElementVNode("view",{class:"user-info flex-1 ml-[20rpx] text-white"},[e.createElementVNode("view",{class:"phone text-[32rpx] font-bold"},e.toDisplayString(l.displayName),1),e.createElementVNode("view",{class:"role-tag inline-flex items-center justify-center mt-[6rpx] px-[14rpx] py-[6rpx] rounded-full bg-white/20 text-[22rpx]"},"æ™®é€šç”¨æˆ·")]),e.createElementVNode("view",{class:"actions flex gap-[18rpx]"},[e.createElementVNode("view",{class:"action-icon flex items-center justify-center",onClick:o[0]||(o[0]=(...e)=>l.goSettings&&l.goSettings(...e))},[e.createVNode(c,{type:"gear",size:"26",color:"#ffffff"})])])]),e.createElementVNode("view",{class:"vip-card mt-[20rpx] bg-gradient-to-r from-[#f8d06b] to-[#dcb14a] rounded-[12rpx] px-[20rpx] py-[18rpx] flex items-center justify-between shadow-md"},[e.createElementVNode("view",{class:"vip-left text-[#5a3b05]"},[e.createElementVNode("view",{class:"vip-title font-bold text-[26rpx]"},"å¥åº·VIPä¼šå‘˜"),e.createElementVNode("view",{class:"vip-sub mt-[6rpx] text-[20rpx]"},"ç‹é™é™å¤§ä¸€å·å®¶åº­ç®¡ç† æä¾› å…è´¹ä¸“å®¶é—®è¯Š")]),e.createElementVNode("view",{class:"vip-btn px-[24rpx] py-[12rpx] bg-[#0070c0] text-white rounded-[16rpx] text-[22rpx] shadow",onClick:o[2]||(o[2]=(...e)=>l.goVip&&l.goVip(...e))},"ç«‹å³é¢†å–")])]),e.createElementVNode("view",{class:"section rounded-[8rpx] mx-[16rpx] my-[12rpx] px-[14rpx] pt-[18rpx] pb-[10rpx] shadow"},[e.createElementVNode("view",{class:"section-header flex items-center justify-between mb-[10rpx] px-[4rpx]"},[e.createElementVNode("view",{class:"section-title text-[28rpx] font-bold"},"æˆ‘çš„é¢„çº¦"),e.createElementVNode("view",{class:"section-link text-[22rpx]",onClick:o[3]||(o[3]=e=>l.goAppointments("all"))},"æŸ¥çœ‹å…¨éƒ¨")]),e.createElementVNode("view",{class:"status-grid grid grid-cols-4 gap-[6rpx]"},[e.createElementVNode("view",{class:"status-item flex flex-col items-center relative py-[16rpx]",onClick:o[4]||(o[4]=e=>l.goAppointments("pendingVisit"))},[r.pendingVisitCount>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"badge absolute top-[4rpx] left-[38rpx] min-w-[26rpx] h-[26rpx] px-[8rpx] rounded-full bg-[#e74c3c] text-white text-[18rpx] leading-[26rpx] text-center"},e.toDisplayString(r.pendingVisitCount>99?"99+":r.pendingVisitCount),1)):e.createCommentVNode("",!0),e.createVNode(c,{type:"plusempty",size:"30",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("view",{class:"status-text text-[22rpx] mt-[6rpx]"},"å¾…å°±è¯Š")]),e.createElementVNode("view",{class:"status-item flex flex-col items-center relative py-[16rpx]",onClick:o[5]||(o[5]=e=>l.goAppointments("pendingRate"))},[e.createVNode(c,{type:"checkbox",size:"30",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("view",{class:"status-text text-[22rpx] mt-[6rpx]"},"å¾…è¯„ä»·")]),e.createElementVNode("view",{class:"status-item flex flex-col items-center relative py-[16rpx]",onClick:o[6]||(o[6]=e=>l.goAppointments("rated"))},[e.createVNode(c,{type:"compose",size:"30",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("view",{class:"status-text text-[22rpx] mt-[6rpx]"},"å·²è¯„ä»·")]),e.createElementVNode("view",{class:"status-item flex flex-col items-center relative py-[16rpx]",onClick:o[7]||(o[7]=e=>l.goAppointments("history"))},[e.createVNode(c,{type:"calendar",size:"30",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("view",{class:"status-text text-[22rpx] mt-[6rpx]"},"å†å²")])])]),e.createElementVNode("view",{class:"list-card rounded-[10rpx] mx-[16rpx] mb-[10rpx] shadow"},[e.createElementVNode("view",{class:"list-item flex items-center justify-between px-[16rpx] py-[18rpx]",onClick:o[8]||(o[8]=(...e)=>l.goPatients&&l.goPatients(...e))},[e.createElementVNode("view",{class:"left flex items-center gap-[14rpx] text-[26rpx]"},[e.createVNode(c,{type:"person",size:"22",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("text",null,"æˆ‘çš„å°±è¯Šäºº")]),e.createVNode(c,{type:"arrowright",size:"18",color:r.theme.textColorTertiary},null,8,["color"])]),e.createElementVNode("view",{class:"list-item flex items-center justify-between px-[16rpx] py-[18rpx]",onClick:o[9]||(o[9]=(...e)=>l.goConsultations&&l.goConsultations(...e))},[e.createElementVNode("view",{class:"left flex items-center gap-[14rpx] text-[26rpx]"},[e.createVNode(c,{type:"chatboxes",size:"22",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("text",null,"æˆ‘çš„å’¨è¯¢")]),e.createVNode(c,{type:"arrowright",size:"18",color:r.theme.textColorTertiary},null,8,["color"])]),e.createElementVNode("view",{class:"list-item flex items-center justify-between px-[16rpx] py-[18rpx]",onClick:o[10]||(o[10]=(...e)=>l.goFavorites&&l.goFavorites(...e))},[e.createElementVNode("view",{class:"left flex items-center gap-[14rpx] text-[26rpx]"},[e.createVNode(c,{type:"heart",size:"22",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("text",null,"æˆ‘çš„æ”¶è—")]),e.createVNode(c,{type:"arrowright",size:"18",color:r.theme.textColorTertiary},null,8,["color"])]),e.createElementVNode("view",{class:"list-item flex items-center justify-between px-[16rpx] py-[18rpx]",onClick:o[11]||(o[11]=(...e)=>l.goMessages&&l.goMessages(...e))},[e.createElementVNode("view",{class:"left flex items-center gap-[14rpx] text-[26rpx]"},[e.createVNode(c,{type:"chatbubble",size:"22",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("text",null,"æˆ‘çš„æ¶ˆæ¯")]),e.createVNode(c,{type:"arrowright",size:"18",color:r.theme.textColorTertiary},null,8,["color"])]),e.createElementVNode("view",{class:"list-item flex items-center justify-between px-[16rpx] py-[18rpx]",onClick:o[12]||(o[12]=(...e)=>l.goHelp&&l.goHelp(...e))},[e.createElementVNode("view",{class:"left flex items-center gap-[14rpx] text-[26rpx]"},[e.createVNode(c,{type:"help",size:"22",color:r.theme.primaryColor},null,8,["color"]),e.createElementVNode("text",null,"å¸®åŠ©ä¸­å¿ƒ")]),e.createVNode(c,{type:"arrowright",size:"18",color:r.theme.textColorTertiary},null,8,["color"])])]),e.createVNode(d)])}]]),fe={__name:"index",setup(t){const n=e.ref("hot"),s=e.ref(""),r=e.ref("åŒ—äº¬"),l=e.ref([{id:1,name:"åŒ—äº¬å¸‚"},{id:2,name:"ä¸Šæµ·å¸‚"},{id:3,name:"å¹¿ä¸œçœ"},{id:4,name:"æ¹–åŒ—çœ"},{id:5,name:"æ¹–å—çœ"},{id:6,name:"æ±Ÿè¥¿çœ"},{id:7,name:"é‡åº†å¸‚"},{id:8,name:"å±±è¥¿çœ"},{id:9,name:"æ±Ÿè‹çœ"},{id:10,name:"æµ™æ±Ÿçœ"},{id:11,name:"å››å·çœ"},{id:12,name:"å±±ä¸œçœ"}]),c=e.ref([{id:1,name:"åŒ—äº¬å¸‚",isAutoLocation:!0},{id:2,name:"æ­¦æ±‰å¸‚"},{id:3,name:"å¹¿å·å¸‚"},{id:4,name:"ä¸Šæµ·å¸‚"},{id:5,name:"å—æ˜Œå¸‚"},{id:6,name:"é•¿æ²™å¸‚"},{id:7,name:"è¥¿å®‰å¸‚"},{id:8,name:"é’å²›å¸‚"},{id:9,name:"æ·±åœ³å¸‚"},{id:10,name:"æ­å·å¸‚"},{id:11,name:"æˆéƒ½å¸‚"},{id:12,name:"å—äº¬å¸‚"},{id:13,name:"å¤©æ´¥å¸‚"},{id:14,name:"é‡åº†å¸‚"},{id:15,name:"è‹å·å¸‚"},{id:16,name:"éƒ‘å·å¸‚"}]),d=e.computed((()=>s.value?l.value.filter((e=>e.name.includes(s.value))):l.value)),u=e.computed((()=>s.value?c.value.filter((e=>e.name.includes(s.value))):c.value)),m=e=>{n.value=e,s.value=""},p=e=>{s.value=e.detail.value},h=e=>{uni.setStorageSync("currentCity",e.name),"undefined"!=typeof uni&&uni.$emit&&uni.$emit("cityChanged",e.name),uni.navigateBack({delta:1,success:()=>{setTimeout((()=>{uni.showToast({title:`å·²åˆ‡æ¢åˆ°${e.name}`,icon:"success",duration:1500})}),300)}})},g=()=>{uni.navigateBack({delta:1})};return o((e=>{e&&e.city&&(r.value=e.city)})),(t,o)=>{const r=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:g},[e.createVNode(r,{type:"left",size:"20",color:"#333"})]),e.createElementVNode("text",{class:"nav-title"},"åˆ‡æ¢åŸå¸‚")]),e.createElementVNode("view",{class:"search-box"},[e.createVNode(r,{type:"search",size:"18",color:"#999"}),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text",placeholder:"æœç´¢åŸå¸‚åç§°","placeholder-class":"placeholder","onUpdate:modelValue":o[0]||(o[0]=e=>s.value=e),onInput:p},null,544),[[e.vModelText,s.value]])]),e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"hot"===n.value}]),onClick:o[1]||(o[1]=e=>m("hot"))}," çƒ­é—¨åŸå¸‚ ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"all"===n.value}]),onClick:o[2]||(o[2]=e=>m("all"))}," å…¨å›½ ",2)]),e.createElementVNode("view",{class:"city-content"},["hot"===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"city-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"city-item",onClick:e=>h(t)},[e.createElementVNode("text",{class:"city-name"},e.toDisplayString(t.name),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),"all"===n.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"city-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"city-item",onClick:e=>h(t)},[e.createElementVNode("text",{class:"city-name"},e.toDisplayString(t.name),1),t.isAutoLocation?(e.openBlock(),e.createElementBlock("view",{key:0,class:"location-tag"},[e.createVNode(r,{type:"location",size:"14",color:"#999"}),e.createElementVNode("text",{class:"location-text"},"è‡ªåŠ¨å®šä½")])):e.createCommentVNode("",!0)],8,["onClick"])))),128))])):e.createCommentVNode("",!0)])])}}},we=s(fe,[["__scopeId","data-v-52b79278"]]),ye={data:()=>({hospitalInfo:{name:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",level:"ä¸‰ç”²ç”²ç­‰",type:"ç»¼åˆåŒ»é™¢",insurance:"éå®šç‚¹åŒ»ä¿",address:"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œå•åŒ—å¤§è¡—53å·"},searchKeyword:"",activeCategoryIndex:0,categories:[{name:"å†…ç§‘",departments:[{name:"ç¥ç»å†…ç§‘",tags:[{text:"å›½å®¶é‡ç‚¹",type:"national"}]},{name:"å†…åˆ†æ³Œç§‘",tags:[{text:"å›½å®¶é‡ç‚¹",type:"national"}]},{name:"å‘¼å¸å†…ç§‘",tags:[]},{name:"å†…åˆ†æ³Œç§‘(è¥¿é™¢)",tags:[{text:"äº’è”ç½‘",type:"internet"}]},{name:"ç‰¹éœ€å†…åˆ†æ³Œç§‘",tags:[]},{name:"æ¶ˆåŒ–å†…ç§‘",tags:[]},{name:"è¡€æ¶²ç§‘",tags:[]},{name:"è‚ç—…ç§‘",tags:[]},{name:"è€å¹´ç§‘",tags:[]},{name:"å…ç–«ç§‘",tags:[]}]},{name:"ä¸­åŒ»ç§‘",departments:[{name:"ä¸­åŒ»å†…ç§‘",tags:[]},{name:"ä¸­åŒ»å¤–ç§‘",tags:[]},{name:"é’ˆç¸ç§‘",tags:[]}]},{name:"å¦‡äº§ç§‘",departments:[{name:"å¦‡ç§‘",tags:[]},{name:"äº§ç§‘",tags:[]},{name:"è®¡åˆ’ç”Ÿè‚²ç§‘",tags:[]}]},{name:"å˜æ€ååº”ç§‘",departments:[{name:"è¿‡æ•ååº”ç§‘",tags:[]}]},{name:"è¥å…»ç§‘",departments:[{name:"ä¸´åºŠè¥å…»ç§‘",tags:[]}]},{name:"å„¿ç§‘",departments:[{name:"å°å„¿å†…ç§‘",tags:[]},{name:"å°å„¿å¤–ç§‘",tags:[]},{name:"æ–°ç”Ÿå„¿ç§‘",tags:[]}]},{name:"äº”å®˜ç§‘",departments:[{name:"çœ¼ç§‘",tags:[]},{name:"è€³é¼»å–‰ç§‘",tags:[]},{name:"å£è…”ç§‘",tags:[]}]},{name:"å…¶ä»–",departments:[{name:"æ€¥è¯Šç§‘",tags:[]},{name:"åº·å¤ç§‘",tags:[]}]}]}),computed:{filteredDepartments(){const e=this.categories[this.activeCategoryIndex].departments;return this.searchKeyword?e.filter((e=>e.name.includes(this.searchKeyword))):e}},onLoad(e){if(e.hospital)try{this.hospitalInfo=JSON.parse(decodeURIComponent(e.hospital))}catch(Kt){t("error","at pages/doctor/appointment-register.vue:184","è§£æåŒ»é™¢ä¿¡æ¯å¤±è´¥",Kt)}},methods:{selectCategory(e){this.activeCategoryIndex=e,this.searchKeyword=""},selectDepartment(e){uni.navigateTo({url:`/pages/doctor/dept-doctors?dept=${encodeURIComponent(e.name)}&hospital=${encodeURIComponent(this.hospitalInfo.name)}`})},onSearchInput(){},viewOnMap(){uni.setStorageSync("targetHospitalName",this.hospitalInfo.name),uni.setStorageSync("showMapView",!0),uni.switchTab({url:"/pages/doctor/doctor"})},goHospitalHome(){const e=this.hospitalInfo.name,a=this.hospitalInfo.address||this.getHospitalAddress(e),o=this.hospitalInfo.level||"ä¸‰ç”²",n=this.getHospitalLocation(e);uni.navigateTo({url:`/pages/hospital-detail/index?name=${encodeURIComponent(e)}&address=${encodeURIComponent(a)}&level=${encodeURIComponent(o)}&longitude=${n[0]}&latitude=${n[1]}`,fail:e=>{t("error","at pages/doctor/appointment-register.vue:222","è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},getHospitalLocation:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":[116.3732,39.9885],"åŒ—äº¬åå’ŒåŒ»é™¢":[116.4179,39.9042],"åŒ—äº¬å¤©å›åŒ»é™¢":[116.4074,39.8806],"åŒ—äº¬æœé˜³åŒ»é™¢":[116.4681,39.9289],"åŒ—äº¬å‹è°ŠåŒ»é™¢":[116.3607,39.8765],"åŒ—äº¬åŒä»åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬å„¿ç«¥åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å¦‡äº§åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å£è…”åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬301åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬å®‰è´åŒ»é™¢":[116.4074,39.9885],"åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":[116.4179,39.9885],"åŒ—äº¬302åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬306åŒ»é™¢":[116.3509,39.9885],"åŒ—äº¬309åŒ»é™¢":[116.2732,39.9885],"åŒ—äº¬307åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬308åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬å®£æ­¦åŒ»é™¢":[116.3607,39.9042]}[e]||[116.397428,39.90923]),getHospitalAddress:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œå•åŒ—å¤§è¡—53å·","åŒ—äº¬åå’ŒåŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºç‹åºœäº•å¤§è¡—1å·","åŒ—äº¬å¤©å›åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ6å·","åŒ—äº¬æœé˜³åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå·¥äººä½“è‚²åœºå—è·¯8å·","åŒ—äº¬å‹è°ŠåŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ°¸å®‰è·¯95å·","åŒ—äº¬åŒä»åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œäº¤æ°‘å··1å·","åŒ—äº¬å„¿ç«¥åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºå—ç¤¼å£«è·¯56å·","åŒ—äº¬å¦‡äº§åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå§šå®¶å›­è·¯251å·","åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé˜œæˆè·¯52å·","åŒ—äº¬å£è…”åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ4å·","åŒ—äº¬301åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤å…´è·¯28å·","åŒ—äº¬å®‰è´åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰è´è·¯2å·","åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºæ¨±èŠ±å›­ä¸œè¡—2å·","åŒ—äº¬302åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºè¥¿å››ç¯ä¸­è·¯100å·","åŒ—äº¬306åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰ç¿”åŒ—é‡Œ9å·","åŒ—äº¬309åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé»‘å±±æ‰ˆè·¯17å·","åŒ—äº¬307åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºä¸œå¤§è¡—8å·","åŒ—äº¬308åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤ªå¹³è·¯27å·","åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ–°è¡—å£ä¸œè¡—31å·","åŒ—äº¬å®£æ­¦åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºé•¿æ¤¿è¡—45å·"}[e]||"åŒ—äº¬å¸‚"),onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}};const Ee=s(ye,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"hospital-info"},[e.createElementVNode("view",{class:"hospital-header-row"},[e.createElementVNode("view",{class:"hospital-left"},[e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(s.hospitalInfo.name),1),e.createElementVNode("view",{class:"hospital-tags"},[e.createElementVNode("text",{class:"tag tag-level"},e.toDisplayString(s.hospitalInfo.level),1),e.createElementVNode("text",{class:"tag tag-normal"},e.toDisplayString(s.hospitalInfo.type),1),e.createElementVNode("text",{class:"tag tag-normal"},e.toDisplayString(s.hospitalInfo.insurance),1)]),e.createElementVNode("view",{class:"hospital-address"},[e.createElementVNode("text",{class:"location-icon"},"ğŸ“"),e.createElementVNode("text",{class:"address-text"},e.toDisplayString(s.hospitalInfo.address),1),e.createElementVNode("text",{class:"map-link",onClick:a[0]||(a[0]=(...e)=>i.viewOnMap&&i.viewOnMap(...e))},"åœ°å›¾ä¸ŠæŸ¥çœ‹")])]),e.createElementVNode("view",{class:"hospital-homepage",onClick:a[1]||(a[1]=(...e)=>i.goHospitalHome&&i.goHospitalHome(...e))},[e.createElementVNode("text",{class:"homepage-icon"},"ğŸ¥"),e.createElementVNode("text",{class:"homepage-text"},"åŒ»é™¢é¦–é¡µ")])])]),e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-box"},[e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>s.searchKeyword=e),placeholder:"æœç´¢ç§‘å®¤åç§°","placeholder-class":"search-placeholder",onInput:a[3]||(a[3]=(...e)=>i.onSearchInput&&i.onSearchInput(...e))},null,544),[[e.vModelText,s.searchKeyword]]),e.createElementVNode("text",{class:"icon-search"},"ğŸ”")])]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("scroll-view",{class:"left-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.categories,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["category-item",{active:s.activeCategoryIndex===a}]),onClick:e=>i.selectCategory(a)},[e.createElementVNode("text",{class:"category-text"},e.toDisplayString(t.name),1)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"right-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.filteredDepartments,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"dept-item",onClick:e=>i.selectDepartment(t)},[e.createElementVNode("text",{class:"dept-text"},e.toDisplayString(t.name),1),t.tags&&t.tags.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dept-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.tags,((t,a)=>(e.openBlock(),e.createElementBlock("text",{key:a,class:e.normalizeClass(["dept-tag",t.type])},e.toDisplayString(t.text),3)))),128))])):e.createCommentVNode("",!0)],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"float-btn",onClick:a[4]||(a[4]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-df5c3fdd"]]),ke="2fc9d976ec3939b4a0ed423bdfeb74e5",Ne="https://restapi.amap.com/v3/geocode/regeo";function Ve(){return new Promise(((e,t)=>{uni.getLocation({type:"gcj02",altitude:!1,success:t=>{e({latitude:t.latitude,longitude:t.longitude})},fail:e=>{t(new Error(`è·å–ä½ç½®å¤±è´¥: ${e.errMsg}`))}})}))}function Ce(e,a){const{origin:o}=a||{};o?xe(e,{...a,origin:o}):Ve().then((t=>{xe(e,{...a,origin:t})})).catch((e=>{uni.showToast({title:"è·å–ä½ç½®å¤±è´¥ï¼Œæ— æ³•å¯¼èˆª",icon:"error"}),t("error","at utils/location.ts:86","è·å–ä½ç½®å¤±è´¥:",e)}))}function xe(e,a){const{mode:o="drive",mapType:n="auto",origin:s,destinationName:i="ç›®çš„åœ°"}=a,{latitude:r,longitude:l}=e,{latitude:c,longitude:d}=s,u=Te(l,r),m=Te(d,c);let p="";if("gaode"===n)p=`amapuri://route/plan?sourceApplication=myapp&slat=${c}&slon=${d}&sname=æˆ‘çš„ä½ç½®&dlat=${r}&dlon=${l}&dname=${encodeURIComponent(i)}&dev=0&t=${function(e){switch(e){case"drive":default:return 0;case"walk":return 2;case"bike":return 3;case"bus":return 1}}(o)}`;else if("baidu"===n)p=`baidumap://map/direction?origin=latlng:${m.lat},${m.lng}|name:æˆ‘çš„ä½ç½®&destination=latlng:${u.lat},${u.lng}|name:${encodeURIComponent(i)}&mode=${Se(o)}&coord_type=bd09ll`;else{if("qqmap"!==n)return void function(e){uni.showActionSheet({itemList:["é«˜å¾·åœ°å›¾","ç™¾åº¦åœ°å›¾","è…¾è®¯åœ°å›¾","ç½‘é¡µç‰ˆè·¯çº¿"],success:a=>{switch(a.tapIndex){case 0:xe(e.destination,{...e,mapType:"gaode"});break;case 1:xe(e.destination,{...e,mapType:"baidu"});break;case 2:xe(e.destination,{...e,mapType:"qqmap"});break;case 3:!function(e){const{origin:a,destination:o,destinationName:n,mode:s}=e,{latitude:i,longitude:r}=a,{latitude:l,longitude:c}=o,d=Te(c,l),u=Te(r,i);uni.showActionSheet({itemList:["é«˜å¾·åœ°å›¾ç½‘é¡µç‰ˆ","ç™¾åº¦åœ°å›¾ç½‘é¡µç‰ˆ","è…¾è®¯åœ°å›¾ç½‘é¡µç‰ˆ"],success:e=>{let t="";switch(e.tapIndex){case 0:t=`https://uri.amap.com/navigation?from=${r},${i},æˆ‘çš„ä½ç½®&to=${c},${l},${encodeURIComponent(n)}&mode=${s}&src=myapp`;break;case 1:t=`http://api.map.baidu.com/direction?origin=latlng:${u.lat},${u.lng}|name:${encodeURIComponent("æˆ‘çš„ä½ç½®")}&destination=latlng:${d.lat},${d.lng}|name:${encodeURIComponent(n)}&mode=${Se(s)}&output=html&coord_type=bd09ll&src=webapp.myapp`;break;case 2:t=`https://apis.map.qq.com/uri/v1/routeplan?type=${Ie(s)}&from=${encodeURIComponent("æˆ‘çš„ä½ç½®")}&fromcoord=${i},${r}&to=${encodeURIComponent(n)}&tocoord=${l},${c}&policy=1&referer=myapp`}t&&uni.navigateTo({url:`/pages/web-view/index?url=${encodeURIComponent(t)}`})},fail:e=>{t("error","at utils/location.ts:302","é€‰æ‹©åœ°å›¾å¤±è´¥:",e)}})}(e)}},fail:e=>{t("error","at utils/location.ts:243","é€‰æ‹©åœ°å›¾å¤±è´¥:",e)}})}({origin:s,destination:e,destinationName:i,mode:o});p=`qqmap://map/routeplan?type=${Ie(o)}&from=æˆ‘çš„ä½ç½®&fromcoord=${c},${d}&to=${encodeURIComponent(i)}&tocoord=${r},${l}&policy=1&referer=myapp`}var h;h=p,plus.runtime.openURL(h,(e=>{e&&e.code&&(t("error","at utils/location.ts:316","æ‰“å¼€åœ°å›¾å¤±è´¥:",e),uni.showToast({title:"æœªæ£€æµ‹åˆ°åœ°å›¾åº”ç”¨",icon:"error"}))}))}function be(e,a){const{origin:o,destinationName:n="ç›®çš„åœ°"}=a||{};o?xe(e,{...a,origin:o}):new Promise(((e,a)=>{uni.getLocation({type:"gcj02",altitude:!1,success:t=>{e({latitude:t.latitude,longitude:t.longitude})},fail:e=>{t("error","at utils/location.ts:400","è·å–ä½ç½®å¤±è´¥:",e);let o="è·å–ä½ç½®å¤±è´¥";switch(e.errCode){case 1:o="æœªæˆæƒè·å–ä½ç½®ï¼Œè¯·åœ¨è®¾ç½®ä¸­å¼€å¯ä½ç½®æƒé™";break;case 2:o="ä½ç½®è·å–å¤±è´¥ï¼Œæ— æ³•è·å–å½“å‰ä½ç½®";break;case 3:o="ä½ç½®è·å–è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•";break;default:o=`è·å–ä½ç½®å¤±è´¥: ${e.errMsg}`}a(new Error(o))}})})).then((t=>{xe(e,{...a,origin:t})})).catch((o=>{t("error","at utils/location.ts:450","è·å–ä½ç½®å¤±è´¥:",o),uni.showModal({title:"ä½ç½®è·å–å¤±è´¥",content:`${o.message}ï¼Œæ˜¯å¦ç»§ç»­å¯¼èˆªåˆ°${n}ï¼Ÿ`,cancelText:"å–æ¶ˆ",confirmText:"ç»§ç»­å¯¼èˆª",success:t=>{if(t.confirm){const t={latitude:e.latitude+.01,longitude:e.longitude+.01};xe(e,{...a,origin:t})}}})}))}function Se(e){switch(e){case"drive":default:return"driving";case"walk":return"walking";case"bike":return"riding";case"bus":return"transit"}}function Ie(e){switch(e){case"drive":default:return"drive";case"walk":return"walk";case"bike":return"bike";case"bus":return"bus"}}function Te(e,t){const a=3e3*Math.PI/180,o=e,n=t,s=Math.sqrt(o*o+n*n)+2e-5*Math.sin(n*a),i=Math.atan2(n,o)+3e-6*Math.cos(o*a);return{lng:s*Math.cos(i)+.0065,lat:s*Math.sin(i)+.006}}const De=e.defineComponent({__name:"index",setup(o){let n={};try{const e=globalThis.getCurrentPages();if(e&&e.length>0){const t=e[e.length-1];n=t.options||{}}}catch(Kt){n={}}const s=e.ref(!0),r=e.ref(""),l=e.ref(!1),c=e.ref(null),d=e.ref([]),u=e.ref(0),m=e.ref(0),p=e.ref("service"),h=[{key:"service",label:"å°±åŒ»æœåŠ¡"},{key:"departments",label:"é‡ç‚¹ç§‘å®¤"},{key:"comments",label:"æ‚£è€…è¯„ä»·"},{key:"transport",label:"äº¤é€šæŒ‡å—"},{key:"intro",label:"åŒ»é™¢ç®€ä»‹"}],g=e.computed((()=>c.value&&c.value.image?c.value.image:"/static/hospital/hospital.png")),v=async()=>{s.value=!0,r.value="";try{if(n.name){const e=decodeURIComponent(n.name||""),t=decodeURIComponent(n.address||""),a={key:"2fc9d976ec3939b4a0ed423bdfeb74e5",keywords:e,city:"åŒ—äº¬",offset:1,extensions:"all"},o=await uni.request({url:"https://restapi.amap.com/v3/place/text",method:"GET",data:a});let s="116.397428",i="39.90923";if(o&&200===o.statusCode&&o.data&&"1"===o.data.status&&o.data.pois&&o.data.pois.length>0){const e=o.data.pois[0];if(e.location){const[t,a]=e.location.split(",");s=t,i=a}}c.value={id:Date.now(),name:e,level:decodeURIComponent(n.level||"æœªçŸ¥"),address:t,distance:"0m",isInternet:!1,departments:["å†…ç§‘","å£è…”ç§‘","æ™®å¤–ç§‘","ç‰¹éœ€å†…åˆ†æ³Œç§‘","çœ¼ç§‘","ç‰¹éœ€å¿ƒè¡€ç®¡å†…ç§‘","è€³é¼»å–‰ç§‘","æ•´å½¢å¤–ç§‘","å¦‡ç§‘","ç‰¹éœ€å¦‡ç§‘"],image:decodeURIComponent(n.image||"/static/hospital/hospital.png"),longitude:s,latitude:i,phone:decodeURIComponent(n.phone||"010-58266699;010-58269911"),businessArea:"",rating:"",cost:""},d.value=[{id:1,userName:"å¼ å…ˆç”Ÿ",userAvatar:"/static/avatar/default-avatar.png",rating:5,content:"åŒ»ç”Ÿå¾ˆä¸“ä¸šï¼Œæ€åº¦ä¹Ÿå¾ˆå¥½ï¼Œè§£ç­”äº†æˆ‘å¾ˆå¤šç–‘é—®ï¼Œæ²»ç–—æ•ˆæœä¹Ÿä¸é”™ï¼Œå€¼å¾—æ¨èï¼",date:"2025-12-20",department:"å†…ç§‘",doctorName:"æåŒ»ç”Ÿ",helpfulCount:15},{id:2,userName:"æå¥³å£«",userAvatar:"/static/avatar/default-avatar.png",rating:4,content:"åŒ»é™¢ç¯å¢ƒå¾ˆå¥½ï¼ŒæœåŠ¡æ€åº¦ä¸é”™ï¼Œå°±æ˜¯ç­‰å¾…æ—¶é—´æœ‰ç‚¹é•¿ï¼Œæ€»ä½“è¿˜æ˜¯æ»¡æ„çš„ã€‚",date:"2025-12-18",department:"çœ¼ç§‘",doctorName:"ç‹åŒ»ç”Ÿ",helpfulCount:8},{id:3,userName:"ç‹å…ˆç”Ÿ",userAvatar:"/static/avatar/default-avatar.png",rating:5,content:"åŒ»ç”Ÿç»éªŒä¸°å¯Œï¼Œæ‰‹æœ¯å¾ˆæˆåŠŸï¼Œæœ¯åæ¢å¤ä¹Ÿå¾ˆå¿«ï¼Œéå¸¸æ„Ÿè°¢ï¼",date:"2025-12-15",department:"æ™®å¤–ç§‘",doctorName:"èµµåŒ»ç”Ÿ",helpfulCount:22},{id:4,userName:"é™ˆå¥³å£«",userAvatar:"/static/avatar/default-avatar.png",rating:3,content:"åŒ»ç”Ÿçœ‹ç—…å¾ˆä»”ç»†ï¼Œå°±æ˜¯åŒ»é™¢äººå¤ªå¤šäº†ï¼ŒæŒ‚å·æœ‰ç‚¹å›°éš¾ã€‚",date:"2025-12-10",department:"å¦‡ç§‘",doctorName:"åˆ˜åŒ»ç”Ÿ",helpfulCount:5},{id:5,userName:"å¼ å…ˆç”Ÿ",userAvatar:"/static/avatar/default-avatar.png",rating:5,content:"åŒ»é™¢è®¾æ–½å¾ˆæ–°ï¼ŒåŒ»ç”Ÿå’ŒæŠ¤å£«éƒ½å¾ˆæœ‰è€å¿ƒï¼Œéå¸¸æ»¡æ„è¿™æ¬¡å°±è¯Šä½“éªŒã€‚",date:"2025-12-05",department:"å£è…”ç§‘",doctorName:"å­™åŒ»ç”Ÿ",helpfulCount:13}],u.value=d.value.length;const r=d.value.reduce(((e,t)=>e+t.rating),0);m.value=r/u.value}}catch(e){r.value="è·å–åŒ»é™¢è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•",t("error","at pages/hospital-detail/index.vue:505","è·å–åŒ»é™¢è¯¦æƒ…å¤±è´¥:",e)}finally{s.value=!1}},f=()=>{getCurrentPages().length>1?uni.navigateBack({fail:e=>{t("error","at pages/hospital-detail/index.vue:517","è¿”å›å¤±è´¥:",e),uni.switchTab({url:"/pages/index/index",fail:()=>{uni.reLaunch({url:"/pages/index/index"})}})}}):uni.switchTab({url:"/pages/index/index",fail:()=>{uni.reLaunch({url:"/pages/index/index"})}})},w=()=>{l.value=!l.value,uni.showToast({title:l.value?"å·²æ”¶è—":"å·²å–æ¶ˆæ”¶è—",icon:"success"})},y=()=>{if(!c.value)return;const e={name:c.value.name,level:c.value.level,type:"ç»¼åˆåŒ»é™¢",insurance:"éå®šç‚¹åŒ»ä¿",address:c.value.address};uni.navigateTo({url:`/pages/doctor/appointment-register?hospital=${encodeURIComponent(JSON.stringify(e))}`,fail:e=>{t("error","at pages/hospital-detail/index.vue:572","è·³è½¬åˆ°é¢„çº¦æŒ‚å·é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},E=()=>{if(!c.value)return;const e={name:c.value.name,level:c.value.level,address:c.value.address},a=encodeURIComponent(JSON.stringify(d.value));uni.navigateTo({url:`/pages/doctor/reviews?hospital=${encodeURIComponent(JSON.stringify(e))}&comments=${a}`,fail:e=>{t("error","at pages/hospital-detail/index.vue:614","è·³è½¬åˆ°è¯„ä»·åˆ—è¡¨é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},k=()=>{setTimeout((()=>{t("log","at pages/hospital-detail/index.vue:666","æŸ¥æ‰¾åœ°å›¾å®¹å™¨å…ƒç´ ...");const e=document.getElementById("hospitalMap");if(t("log","at pages/hospital-detail/index.vue:668","åœ°å›¾å®¹å™¨å…ƒç´ :",e),e){const o=e.getBoundingClientRect();if(t("log","at pages/hospital-detail/index.vue:673","åœ°å›¾å®¹å™¨å°ºå¯¸:",o.width,"x",o.height),c.value){t("log","at pages/hospital-detail/index.vue:676","åŒ»é™¢ä¿¡æ¯:",c.value);const o=[parseFloat(c.value.longitude)||116.397428,parseFloat(c.value.latitude)||39.90923],n=16;t("log","at pages/hospital-detail/index.vue:685","åœ°å›¾ä¸­å¿ƒç‚¹:",o),t("log","at pages/hospital-detail/index.vue:686","åœ°å›¾ç¼©æ”¾çº§åˆ«:",n);try{const a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.top="0",a.style.left="0",e.innerHTML="",e.appendChild(a),t("log","at pages/hospital-detail/index.vue:701","åˆ›å»ºäº†æ ‡å‡†divä½œä¸ºåœ°å›¾å®¹å™¨:",a);const s=new window.AMap.Map(a,{center:o,zoom:n,resizeEnable:!0,viewMode:"2D",lang:"zh_cn"});t("log","at pages/hospital-detail/index.vue:713","åœ°å›¾å®ä¾‹åˆ›å»ºæˆåŠŸ:",s),s.on("complete",(()=>{t("log","at pages/hospital-detail/index.vue:717","åœ°å›¾åŠ è½½å®Œæˆ")})),s.on("error",(e=>{t("error","at pages/hospital-detail/index.vue:722","åœ°å›¾åŠ è½½å¤±è´¥:",e),e&&(e.message&&e.message.includes("key")||e.message&&e.message.includes("USERKEY"))&&uni.showToast({title:"åœ°å›¾ key é…ç½®é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é…ç½®",icon:"none",duration:3e3})}));const i=new window.AMap.Marker({position:o,title:c.value.name,map:s});t("log","at pages/hospital-detail/index.vue:741","åœ°å›¾æ ‡è®°åˆ›å»ºæˆåŠŸ:",i);const r=new window.AMap.InfoWindow({content:`<h3>${c.value.name}</h3><p>${c.value.address}</p>`,offset:new window.AMap.Pixel(0,-30)});t("log","at pages/hospital-detail/index.vue:750","ä¿¡æ¯çª—å£åˆ›å»ºæˆåŠŸ:",r),i.on("click",(()=>{r.open(s,i.getPosition())})),s.setFitView([i])}catch(a){t("log","at pages/hospital-detail/index.vue:761","åœ°å›¾åˆå§‹åŒ–å¼‚å¸¸:",a)}}else t("log","at pages/hospital-detail/index.vue:764","åŒ»é™¢ä¿¡æ¯ä¸ºç©º")}else t("log","at pages/hospital-detail/index.vue:767","æœªæ‰¾åˆ°åœ°å›¾å®¹å™¨å…ƒç´ ")}),500)},N=()=>{c.value&&uni.navigateTo({url:`/pages/appointment/index?name=${encodeURIComponent(c.value.name)}&level=${encodeURIComponent(c.value.level)}&address=${encodeURIComponent(c.value.address)}`})},V=()=>{uni.navigateTo({url:"/pages/doctor/appointment-register"})},C=()=>{uni.navigateTo({url:"/pages/online-consult/index"})},x=()=>{if(!c.value)return void uni.showToast({title:"åŒ»é™¢ä¿¡æ¯åŠ è½½ä¸­ï¼Œè¯·ç¨å€™",icon:"none",duration:2e3});const e=parseFloat(c.value.latitude)||39.90923,t=parseFloat(c.value.longitude)||116.397428,a=c.value.name||"åŒ»é™¢";be({latitude:e,longitude:t,address:c.value.address||""},{destinationName:a})};return e.watch(p,(e=>{"transport"===e&&setTimeout((()=>{(()=>{if(t("log","at pages/hospital-detail/index.vue:625","å¼€å§‹åˆå§‹åŒ–åœ°å›¾..."),"undefined"!=typeof window)if(void 0===window.AMap){t("log","at pages/hospital-detail/index.vue:636","é«˜å¾·åœ°å›¾APIæœªåŠ è½½ï¼Œç­‰å¾…åŠ è½½...");let e=0;const a=10,o=setInterval((()=>{e++,void 0!==window.AMap?(clearInterval(o),t("log","at pages/hospital-detail/index.vue:644","é«˜å¾·åœ°å›¾APIåŠ è½½æˆåŠŸ"),k()):e>=a&&(clearInterval(o),t("error","at pages/hospital-detail/index.vue:648","é«˜å¾·åœ°å›¾APIåŠ è½½è¶…æ—¶"),uni.showToast({title:"åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•",icon:"none",duration:3e3}))}),200)}else t("log","at pages/hospital-detail/index.vue:657","é«˜å¾·åœ°å›¾APIå·²åŠ è½½æˆåŠŸ"),k();else t("log","at pages/hospital-detail/index.vue:629","ä¸åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œè·³è¿‡åœ°å›¾åˆå§‹åŒ–")})()}),100)})),e.onMounted((()=>{v()})),(o,n)=>{const l=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-header"},[e.createVNode(l,{type:"left",size:"24",color:"#333",onClick:f}),e.createElementVNode("text",{class:"nav-title"},"åŒ»é™¢è¯¦æƒ…é¡µ"),e.createVNode(l,{type:"star",size:"24",color:"#333",onClick:w})]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createVNode(l,{type:"spinner",size:"36",color:"#4a90e2",animation:"spin"}),e.createElementVNode("text",{class:"loading-text"},"åŠ è½½ä¸­...")])):r.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-container"},[e.createVNode(l,{type:"closeempty",size:"64",color:"#ff4d4f"}),e.createElementVNode("text",{class:"error-text"},e.toDisplayString(r.value),1),e.createElementVNode("button",{class:"retry-btn",onClick:v},"é‡æ–°åŠ è½½")])):c.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"hospital-detail"},[e.createElementVNode("view",{class:"hospital-basic"},[e.createElementVNode("view",{class:"hospital-header-section"},[e.createElementVNode("view",{class:"hospital-image"},[e.createElementVNode("image",{src:g.value,mode:"aspectFill",class:"hospital-img"},null,8,["src"])]),e.createElementVNode("view",{class:"hospital-info-main"},[e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(c.value.name),1),e.createElementVNode("view",{class:"hospital-tags"},[e.createElementVNode("view",{class:"tag level-tag"},e.toDisplayString(c.value.level),1),e.createElementVNode("view",{class:"tag type-tag"},"ç»¼åˆåŒ»é™¢"),e.createElementVNode("view",{class:"tag insurance-tag"},"éå®šç‚¹åŒ»ä¿")]),e.createElementVNode("view",{class:"hospital-rank"},[e.createElementVNode("view",{class:"rank-item"},[e.createElementVNode("text",{class:"rank-label"},"ç»¼åˆæ’å"),e.createElementVNode("text",{class:"rank-value"},"ç¬¬ä¸€")]),e.createElementVNode("view",{class:"department-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.departments.slice(0,3),((t,a)=>(e.openBlock(),e.createElementBlock("text",{class:"department-tag",key:a},e.toDisplayString(t),1)))),128))])])])]),e.createElementVNode("view",{class:"nav-tabs"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(h,(t=>e.createElementVNode("view",{key:t.key,class:e.normalizeClass(["tab-item",{active:p.value===t.key}]),onClick:e=>{return a=t.key,void(p.value=a);var a}},e.toDisplayString(t.label),11,["onClick"]))),64))])]),e.createElementVNode("view",{class:"content-area"},["service"===p.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"service-section"},[e.createElementVNode("view",{class:"service-cards"},[e.createElementVNode("view",{class:"service-card",onClick:N},[e.createElementVNode("view",{class:"service-icon appointment"}),e.createElementVNode("text",{class:"service-title"},"é—¨è¯ŠæŒ‚å·"),e.createElementVNode("text",{class:"service-desc"},"é—¨è¯Šå·æºåœ¨çº¿é¢„çº¦")]),e.createElementVNode("view",{class:"service-card",onClick:V},[e.createElementVNode("view",{class:"service-icon internet"}),e.createElementVNode("text",{class:"service-title"},"äº’è”ç½‘é¢„çº¦"),e.createElementVNode("text",{class:"service-desc"},"è¶³ä¸å‡ºæˆ·åœ¨çº¿é—®è¯Š")]),e.createElementVNode("view",{class:"service-card",onClick:C},[e.createElementVNode("view",{class:"service-icon guide"}),e.createElementVNode("text",{class:"service-title"},"æ™ºèƒ½å¯¼è¯Š"),e.createElementVNode("text",{class:"service-desc"},"ç—‡çŠ¶è‡ªæµ‹ç²¾å‡†å¯¼åŒ»")])]),e.createElementVNode("view",{class:"guide-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å°±è¯ŠæŒ‡å—")]),e.createElementVNode("view",{class:"guide-content"},[e.createElementVNode("view",{class:"guide-item"},[e.createElementVNode("view",{class:"guide-icon"},"ğŸ“…"),e.createElementVNode("view",{class:"guide-info"},[e.createElementVNode("text",{class:"guide-title"},"é—¨è¯Šæ—¶é—´"),e.createElementVNode("text",{class:"guide-desc"},"å‘¨ä¸€è‡³å‘¨äº”ï¼š8:00-17:00ï¼›å‘¨å…­ï¼š8:00-12:00")])]),e.createElementVNode("view",{class:"guide-item"},[e.createElementVNode("view",{class:"guide-icon"},"ğŸ’°"),e.createElementVNode("view",{class:"guide-info"},[e.createElementVNode("text",{class:"guide-title"},"æŒ‚å·è´¹ç”¨"),e.createElementVNode("text",{class:"guide-desc"},"æ™®é€šå·ï¼š10å…ƒï¼›ä¸“å®¶å·ï¼š50-100å…ƒ")])]),e.createElementVNode("view",{class:"guide-item"},[e.createElementVNode("view",{class:"guide-icon"},"ğŸ“±"),e.createElementVNode("view",{class:"guide-info"},[e.createElementVNode("text",{class:"guide-title"},"é¢„çº¦æ–¹å¼"),e.createElementVNode("text",{class:"guide-desc"},"æ”¯æŒåœ¨çº¿é¢„çº¦ã€ç”µè¯é¢„çº¦ã€ç°åœºé¢„çº¦")])]),e.createElementVNode("view",{class:"guide-item"},[e.createElementVNode("view",{class:"guide-icon"},"ğŸ‘¨â€âš•ï¸"),e.createElementVNode("view",{class:"guide-info"},[e.createElementVNode("text",{class:"guide-title"},"å°±è¯Šæµç¨‹"),e.createElementVNode("text",{class:"guide-desc"},"1. é¢„çº¦æŒ‚å· â†’ 2. åˆ°é™¢ç­¾åˆ° â†’ 3. å€™è¯Š â†’ 4. å°±è¯Š â†’ 5. ç¼´è´¹ â†’ 6. å–è¯/æ£€æŸ¥")])])])]),e.createElementVNode("view",{class:"contact-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"è”ç³»æ–¹å¼")]),e.createElementVNode("view",{class:"contact-content"},[e.createElementVNode("view",{class:"contact-item"},[e.createElementVNode("view",{class:"contact-icon"},"ğŸ“"),e.createElementVNode("view",{class:"contact-info"},[e.createElementVNode("text",{class:"contact-label"},"å’¨è¯¢ç”µè¯"),e.createElementVNode("text",{class:"contact-value"},e.toDisplayString(c.value.phone||"010-58266699"),1)])]),e.createElementVNode("view",{class:"contact-item"},[e.createElementVNode("view",{class:"contact-icon"},"ğŸ“"),e.createElementVNode("view",{class:"contact-info"},[e.createElementVNode("text",{class:"contact-label"},"åŒ»é™¢åœ°å€"),e.createElementVNode("text",{class:"contact-value"},e.toDisplayString(c.value.address),1)])])])])])):e.createCommentVNode("",!0),"departments"===p.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"departments-section"},[e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("text",{class:"section-title"},"é‡ç‚¹ç§‘å®¤"),e.createElementVNode("text",{class:"view-more",onClick:y},"æŸ¥çœ‹æ›´å¤š >")]),e.createElementVNode("view",{class:"departments-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.departments,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"department-item",onClick:e=>{return o=a,void(c.value&&uni.navigateTo({url:`/pages/doctor/dept-doctors?dept=${encodeURIComponent(o)}&hospital=${encodeURIComponent(c.value.name)}`,fail:e=>{t("error","at pages/hospital-detail/index.vue:589","è·³è½¬åˆ°ç§‘å®¤åŒ»ç”Ÿåˆ—è¡¨å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}));var o}},e.toDisplayString(a),9,["onClick"])))),128))])])):e.createCommentVNode("",!0),"comments"===p.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"comments-section"},[e.createElementVNode("view",{class:"comments-stats"},[e.createElementVNode("view",{class:"rating-overview"},[e.createElementVNode("view",{class:"rating-main"},[e.createElementVNode("text",{class:"rating-score"},e.toDisplayString(m.value.toFixed(1)),1),e.createElementVNode("view",{class:"rating-stars"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(t=>e.createElementVNode("text",{key:t,class:e.normalizeClass(["star",{active:t<=Math.round(m.value)}])},"â˜…",2))),64))])]),e.createElementVNode("text",{class:"rating-count"},e.toDisplayString(u.value)+" æ¡è¯„ä»·",1)]),e.createElementVNode("view",{class:"rating-distribution"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(t=>e.createElementVNode("view",{class:"distribution-item",key:t},[e.createElementVNode("text",{class:"distribution-label"},e.toDisplayString(t)+"æ˜Ÿ",1),e.createElementVNode("view",{class:"distribution-bar"},[e.createElementVNode("view",{class:"bar-fill",style:e.normalizeStyle({width:100*Math.random()+"%"})},null,4)]),e.createElementVNode("text",{class:"distribution-count"},e.toDisplayString(Math.floor(20*Math.random())),1)]))),64))])]),e.createElementVNode("view",{class:"comments-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"comment-item"},[e.createElementVNode("view",{class:"comment-header"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{src:t.userAvatar,mode:"aspectFill",class:"user-avatar"},null,8,["src"]),e.createElementVNode("view",{class:"user-details"},[e.createElementVNode("text",{class:"user-name"},e.toDisplayString(t.userName),1),e.createElementVNode("view",{class:"comment-meta"},[e.createElementVNode("text",{class:"department"},e.toDisplayString(t.department)+" Â· "+e.toDisplayString(t.doctorName),1),e.createElementVNode("text",{class:"comment-date"},e.toDisplayString(t.date),1)])])]),e.createElementVNode("view",{class:"comment-rating"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(a=>e.createElementVNode("text",{key:a,class:e.normalizeClass(["star",{active:a<=t.rating}])},"â˜…",2))),64))])]),e.createElementVNode("text",{class:"comment-content"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"comment-footer"},[e.createElementVNode("view",{class:"helpful-info"},[e.createVNode(l,{type:"like",size:"18",color:"#999"}),e.createElementVNode("text",{class:"helpful-count"},e.toDisplayString(t.helpfulCount),1)])])])))),128))]),d.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"view-more-comments",onClick:E},[e.createElementVNode("text",{class:"view-more-text"},"æŸ¥çœ‹æ›´å¤šè¯„ä»·"),e.createVNode(l,{type:"right",size:"16",color:"#4a90e2"})])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),"transport"===p.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"transport-section"},[e.createElementVNode("view",{class:"map-container"},[e.createElementVNode("view",{id:"hospitalMap",class:"hospital-map"}),e.createElementVNode("view",{class:"navigate-button",onClick:x},[e.createVNode(l,{type:"navigate",size:"20",color:"#fff"}),e.createElementVNode("text",{class:"navigate-text"},"å¯¼èˆª")])]),e.createElementVNode("view",{class:"transport-info"},[e.createElementVNode("view",{class:"info-item"},[e.createVNode(l,{type:"phone",size:"18",color:"#4a90e2"}),e.createElementVNode("text",{class:"info-label"},"åŒ»é™¢ç”µè¯ï¼š"),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(c.value.phone||"æš‚æ— ç”µè¯"),1)]),e.createElementVNode("view",{class:"info-item"},[e.createVNode(l,{type:"location",size:"18",color:"#4a90e2"}),e.createElementVNode("text",{class:"info-label"},"åŒ»é™¢åœ°å€ï¼š"),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(c.value.address),1)]),e.createElementVNode("view",{class:"info-item"},[e.createVNode(l,{type:"navigate",size:"18",color:"#4a90e2"}),e.createElementVNode("text",{class:"info-label"},"äº¤é€šè·¯çº¿ï¼š"),e.createElementVNode("text",{class:"info-value"},"å…¬äº¤ï¼šå¯ä¹˜å1ã€5ã€10è·¯å…¬äº¤è½¦åˆ°åŒ»é™¢ç«™ä¸‹è½¦ï¼›åœ°é“ï¼šå¯ä¹˜å2å·çº¿åˆ°åŒ»é™¢ç«™Aå‡ºå£å‡ºç«™")])])])):e.createCommentVNode("",!0),"intro"===p.value?(e.openBlock(),e.createElementBlock("view",{key:4,class:"intro-section"},[e.createElementVNode("text",{class:"section-placeholder"},"åŒ»é™¢ç®€ä»‹å†…å®¹")])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)])}}});const Be=s({data:()=>({deptName:"",hospitalName:"",selectedDateIndex:0,dateList:[],doctorList:[{name:"ç‹åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒè¡€ç®¡ç–¾ç—…,å¿ƒè„ç—…,å† å¿ƒç—…,å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{name:"æåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"é«˜è¡€å‹ã€å† å¿ƒç—…ã€å¿ƒå¾‹å¤±å¸¸çš„è¯Šæ–­å’Œæ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{name:"å¼ åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒåŠ›è¡°ç«­ã€å¿ƒè‚Œç—…çš„ç»¼åˆæ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{name:"åˆ˜åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å† å¿ƒç—…ä»‹å…¥æ²»ç–—ã€å¿ƒè„èµ·æå™¨æ¤å…¥",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},{name:"é™ˆåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒè¡€ç®¡ç–¾ç—…çš„é¢„é˜²å’Œåº·å¤æ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/1.jpg"}]}),onLoad(e){e.dept&&(this.deptName=decodeURIComponent(e.dept)),e.hospital&&(this.hospitalName=decodeURIComponent(e.hospital)),this.deptName&&uni.setNavigationBarTitle({title:this.deptName}),this.deptName&&(this.doctorList=this.doctorList.map((e=>({...e,dept:this.deptName,hospital:this.hospitalName||e.hospital})))),this.generateDateList()},methods:{generateDateList(){const e=new Date,t=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];this.dateList=[{label:"ä¸é™æ—¥æœŸ",status:"",statusType:"",isFull:!1}];for(let a=0;a<7;a++){const o=new Date(e);o.setDate(e.getDate()+a);const n=(o.getMonth()+1).toString().padStart(2,"0"),s=o.getDate().toString().padStart(2,"0"),i=t[o.getDay()],r=`${n}.${s}`;let l="",c="",d=!1;if(0===a)l="ä»Šæ—¥æœ‰å·",c="available",d=!1;else{Math.random()>.5?(l=`${i}æœ‰å·`,c="available",d=!1):(l=`${i}çº¦æ»¡`,c="full",d=!0)}this.dateList.push({label:r,status:l,statusType:c,isFull:d})}},selectDate(e){this.selectedDateIndex=e,0===e?uni.navigateTo({url:`/pages/doctor/schedule?dept=${encodeURIComponent(this.deptName)}&hospital=${encodeURIComponent(this.hospitalName)}`}):"available"===this.dateList[e].statusType&&uni.navigateTo({url:`/pages/doctor/schedule?dept=${encodeURIComponent(this.deptName)}&hospital=${encodeURIComponent(this.hospitalName)}&date=${encodeURIComponent(this.dateList[e].label)}`})},goDoctorDetail(e){const t=encodeURIComponent(JSON.stringify(e));uni.navigateTo({url:"/pages/doctor/detail?doctor="+t})},onReserve(e){const t=encodeURIComponent(JSON.stringify(e));uni.navigateTo({url:`/pages/doctor/appointment?doctor=${t}`})},onConsult(e){uni.navigateTo({url:"/pages/online-consult/chat?doctor="+encodeURIComponent(e.name)})},onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"date-filter-bar"},[e.createElementVNode("scroll-view",{class:"date-scroll","scroll-x":""},[e.createElementVNode("view",{class:"date-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.dateList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["date-item",{active:s.selectedDateIndex===a,full:t.isFull}]),onClick:e=>i.selectDate(a)},[e.createElementVNode("text",{class:"date-text"},e.toDisplayString(t.label),1),t.status?(e.openBlock(),e.createElementBlock("text",{key:0,class:e.normalizeClass(["date-status",t.statusType])},e.toDisplayString(t.status),3)):e.createCommentVNode("",!0)],10,["onClick"])))),128))])])]),e.createElementVNode("scroll-view",{class:"doctor-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.doctorList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"doctor-card",onClick:e=>i.goDoctorDetail(t)},[e.createElementVNode("view",{class:"doctor-left"},[e.createElementVNode("image",{class:"doctor-avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"])]),e.createElementVNode("view",{class:"doctor-right"},[e.createElementVNode("view",{class:"doctor-header-row"},[e.createElementVNode("view",{class:"doctor-title-box"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(t.level),1)]),e.createElementVNode("button",{class:"btn-reserve",size:"mini",onClick:e.withModifiers((e=>i.onReserve(t)),["stop"])}," é¢„çº¦ ",8,["onClick"])]),e.createElementVNode("view",{class:"doctor-hospital-row"},[e.createElementVNode("text",{class:"hospital"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"dept"},e.toDisplayString(t.dept),1)]),e.createElementVNode("view",{class:"doctor-goodat-row"},[e.createElementVNode("text",{class:"goodat-label"},"æ“…é•¿ï¼š"),e.createElementVNode("text",{class:"goodat-text"},e.toDisplayString(t.goodAt),1)]),e.createElementVNode("view",{class:"doctor-tags-row"},[e.createElementVNode("view",{class:"tag tag-reserve",onClick:e.withModifiers((e=>i.onReserve(t)),["stop"])},[e.createElementVNode("text",{class:"tag-dot"},"â—"),e.createElementVNode("text",null,"é¢„çº¦æŒ‚å·(å¤šç‚¹)")],8,["onClick"]),e.createElementVNode("view",{class:"tag tag-online",onClick:e.withModifiers((e=>i.onConsult(t)),["stop"])},[e.createElementVNode("text",{class:"tag-dot"},"â—"),e.createElementVNode("text",null,"åœ¨çº¿å’¨è¯¢")],8,["onClick"])])])],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"float-btn",onClick:a[0]||(a[0]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-c616d053"]]);const _e=s({data:()=>({weekDays:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],deptName:"",hospitalName:"",selectedDate:null,monthList:[]}),onLoad(e){e.dept&&(this.deptName=decodeURIComponent(e.dept)),e.hospital&&(this.hospitalName=decodeURIComponent(e.hospital)),e.date&&(this.selectedDate=decodeURIComponent(e.date)),this.generateYearCalendar()},methods:{generateYearCalendar(){const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate();this.monthList=[];for(let n=0;n<12;n++){let e=t,s=a+n;s>12&&(s-=12,e+=1);const i=this.generateMonthCalendar(e,s,t,a,o);this.monthList.push({year:e,month:s,dates:i})}},generateMonthCalendar(e,t,a,o,n){const s=new Date(e,t-1,1).getDay(),i=new Date(e,t,0).getDate(),r=[];for(let l=0;l<s;l++)r.push({day:null});for(let l=1;l<=i;l++){const s={day:l},i=e===a&&t===o&&l===n,c=new Date(e,t-1,l)<new Date(a,o-1,n);if(i)s.status="ä»Šæ—¥ æœ‰å·",s.statusType="today";else if(c)s.status="çº¦æ»¡",s.statusType="full";else{const e=Math.random();e>.7?(s.status="æœ‰å·",s.statusType="available"):e>.4&&(s.status="çº¦æ»¡",s.statusType="full")}r.push(s)}return r},getDateClass(e){const t=[];return"today"===e.statusType?t.push("date-today"):"available"===e.statusType?t.push("date-available"):"full"===e.statusType&&t.push("date-full"),t.join(" ")},selectDate(e,t,a){if(e.day)if("available"===e.statusType||"today"===e.statusType){const o=`${t}å¹´${a<10?"0"+a:a}æœˆ${e.day<10?"0"+e.day:e.day}æ—¥`,n=this.getWeekDay(e.day,t,a),s={hospital:this.hospitalName||"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:this.deptName||"å¿ƒè¡€ç®¡å†…ç§‘",date:o,time:n,type:"ä¸“å®¶é—¨è¯Š",fee:318},i={name:"ç‹åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:this.hospitalName||"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:this.deptName||"å¿ƒè¡€ç®¡å†…ç§‘",avatar:"https://randomuser.me/api/portraits/men/1.jpg"},r=encodeURIComponent(JSON.stringify(i)),l=encodeURIComponent(s.hospital),c=encodeURIComponent(s.dept),d=encodeURIComponent(s.date),u=encodeURIComponent(s.time),m=encodeURIComponent(s.type),p=encodeURIComponent(s.fee);uni.navigateTo({url:`/pages/doctor/appointment?doctor=${r}&hospital=${l}&dept=${c}&date=${d}&time=${u}&type=${m}&fee=${p}`})}else"full"===e.statusType&&uni.showToast({title:"è¯¥æ—¥æœŸå·²çº¦æ»¡",icon:"none"})},getWeekDay:(e,t,a)=>["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][new Date(t,a-1,e).getDay()],collapseSchedule(){uni.navigateBack()},onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("scroll-view",{class:"content","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.monthList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"month-section"},[e.createElementVNode("text",{class:"month-title"},e.toDisplayString(t.year)+"å¹´"+e.toDisplayString(t.month)+"æœˆ",1),e.createElementVNode("view",{class:"calendar"},[e.createElementVNode("view",{class:"week-header"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.weekDays,(t=>(e.openBlock(),e.createElementBlock("text",{class:"week-day",key:t},e.toDisplayString(t),1)))),128))]),e.createElementVNode("view",{class:"date-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.dates,((a,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["date-cell",i.getDateClass(a)]),onClick:e=>i.selectDate(a,t.year,t.month)},[a.day?(e.openBlock(),e.createElementBlock("text",{key:0,class:"date-number"},e.toDisplayString(a.day),1)):e.createCommentVNode("",!0),a.status?(e.openBlock(),e.createElementBlock("text",{key:1,class:e.normalizeClass(["date-status",a.statusType])},e.toDisplayString(a.status),3)):e.createCommentVNode("",!0),a.tip?(e.openBlock(),e.createElementBlock("text",{key:2,class:"date-tip"},e.toDisplayString(a.tip),1)):e.createCommentVNode("",!0)],10,["onClick"])))),128))])])])))),128))]),e.createElementVNode("view",{class:"bottom-actions"},[e.createElementVNode("button",{class:"collapse-btn",onClick:a[0]||(a[0]=(...e)=>i.collapseSchedule&&i.collapseSchedule(...e))},[e.createElementVNode("text",{class:"collapse-icon"},"â–²"),e.createElementVNode("text",{class:"collapse-text"},"æ”¶èµ·æ’ç­")])]),e.createElementVNode("view",{class:"float-btn",onClick:a[1]||(a[1]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-65975229"]]);function Pe(e){return new Promise(((a,o)=>{const{url:n,method:s="GET",data:i={},needAuth:r=!0,showLoading:l=!0,showError:c=!0}=e;let d=!1;const u=()=>{if(l&&d)try{uni.hideLoading(),d=!1}catch(Kt){t("warn","at utils/request.js:42","hideLoadingå¤±è´¥:",Kt)}};try{let e="";if(r)try{e=uni.getStorageSync("sso_token")||"",e||(e=uni.getStorageSync("token")||"",e&&(uni.setStorageSync("sso_token",e),t("log","at utils/request.js:60","âœ… ä»æ—§KEYè¯»å–tokenå¹¶åŒæ­¥åˆ°æ–°KEY")))}catch(Kt){t("error","at utils/request.js:75","è·å–tokenå¤±è´¥:",Kt),e=""}const m={"Content-Type":"application/json"};if(e&&r&&(m.Authorization=`Bearer ${e}`),l)try{uni.showLoading({title:"å¤„ç†ä¸­...",mask:!0}),d=!0}catch(Kt){t("warn","at utils/request.js:97","showLoadingå¤±è´¥:",Kt)}const p="http://192.168.8.8:3000/api"+n;t("log","at utils/request.js:103","ğŸ“¡ APIè¯·æ±‚:",s,p),uni.request({url:p,method:s,data:i,header:m,timeout:1e4,success:e=>{var n;if(u(),200===e.statusCode||201===e.statusCode){const t=e.data;if(!1===t.success){const e=t.message||"è¯·æ±‚å¤±è´¥";c&&uni.showToast({title:e,icon:"none",duration:2e3}),o(t)}else a(t)}else if(401===e.statusCode){try{uni.removeStorageSync("sso_token"),uni.removeStorageSync("sso_refresh_token"),uni.removeStorageSync("sso_user_info"),uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.removeStorageSync("userProfile"),uni.removeStorageSync("userProfilesById"),uni.removeStorageSync("currentUserId")}catch(Kt){t("error","at utils/request.js:160","æ¸…é™¤è®¤è¯ä¿¡æ¯å¤±è´¥:",Kt)}c&&uni.showToast({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),1500),o(e.data)}else{const t=(null==(n=e.data)?void 0:n.message)||`è¯·æ±‚å¤±è´¥(${e.statusCode})`;c&&uni.showToast({title:t,icon:"none"}),o(e.data)}},fail:e=>{u(),t("error","at utils/request.js:191","è¯·æ±‚å¤±è´¥:",e);let a=e.errMsg||"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";e.errMsg&&(e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶"))&&(a="è¿æ¥æœåŠ¡å™¨è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•"),c&&uni.showToast({title:a,icon:"none",duration:3e3}),o(e)}})}catch(m){u(),t("error","at utils/request.js:224","è¯·æ±‚å¼‚å¸¸:",m),o(m)}}))}const Ae=Object.freeze(Object.defineProperty({__proto__:null,default:Pe,del:function(e,t={},a=!0){return Pe({url:e,method:"DELETE",data:t,needAuth:a})},get:function(e,t={},a=!0){return Pe({url:e,method:"GET",data:t,needAuth:a})},post:function(e,t={},a=!0){return Pe({url:e,method:"POST",data:t,needAuth:a})},put:function(e,t={},a=!0){return Pe({url:e,method:"PUT",data:t,needAuth:a})},request:Pe},Symbol.toStringTag,{value:"Module"})),Ue={pages:[{path:"pages/index/index",style:{navigationStyle:"custom",navigationBarTitleText:"é¦–é¡µ",backgroundColor:"#FFFFFF"}},{path:"pages/specialty-hospital/index",style:{navigationStyle:"custom",navigationBarTitleText:"ä¸“ç§‘ä¸“ç—…",backgroundColor:"#FFFFFF"}},{path:"pages/doctor/doctor",style:{navigationBarTitleText:"ååŒ»",backgroundColor:"#FFFFFF"}},{path:"pages/buy-medicine/index",style:{navigationBarTitleText:"Buy Medicine",backgroundColor:"#FFFFFF"}},{path:"pages/yishuo/yishuo",style:{navigationBarTitleText:"åŒ»è¯´",backgroundColor:"#FFFFFF"}},{path:"pages/yishuo/article-list",style:{navigationStyle:"custom",navigationBarTitleText:"åŒ»è¯´æ–‡ç« ",backgroundColor:"#FFFFFF"}},{path:"pages/yishuo/article-detail",style:{navigationStyle:"custom",navigationBarTitleText:"æ–‡ç« è¯¦æƒ…",backgroundColor:"#FFFFFF"}},{path:"pages/mine/mine",style:{navigationBarTitleText:"æˆ‘çš„",backgroundColor:"#FFFFFF"}},{path:"pages/city/index",style:{navigationStyle:"custom",navigationBarTitleText:"åˆ‡æ¢åŸå¸‚",backgroundColor:"#F5F5F5"}},{path:"pages/doctor/appointment-register",style:{navigationBarTitleText:"é¢„çº¦æŒ‚å·",backgroundColor:"#FFFFFF"}},{path:"pages/hospital-detail/index",style:{navigationStyle:"custom",navigationBarTitleText:"åŒ»é™¢è¯¦æƒ…",backgroundColor:"#FFFFFF"}},{path:"pages/doctor/dept-doctors",style:{navigationBarTitleText:"ç§‘å®¤åŒ»ç”Ÿ",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/schedule",style:{navigationBarTitleText:"ç§‘å®¤æœˆæ’ç­",backgroundColor:"#F5F6FA"}},{path:"pages/login/login",style:{navigationBarTitleText:"ç™»å½•",navigationStyle:"custom",backgroundColor:"#667eea"}},{path:"pages/login/callback",style:{navigationBarTitleText:"ç™»å½•ä¸­...",navigationStyle:"custom",backgroundColor:"#667eea"},aliasPath:"/pages/login/callback"},{path:"pages/doctor/department",style:{navigationBarTitleText:"ç§‘å®¤é€‰æ‹©",backgroundColor:"#FFFFFF"}},{path:"pages/appointment/index",style:{navigationStyle:"custom",navigationBarTitleText:"é¢„çº¦æŒ‚å·",backgroundColor:"#FFFFFF"}},{path:"pages/doctor/disease",style:{navigationBarTitleText:"ç–¾ç—…é€‰æ‹©",backgroundColor:"#FFFFFF"}},{path:"pages/doctor/detail",style:{navigationBarTitleText:"åŒ»ç”Ÿè¯¦æƒ…",backgroundColor:"#FFFFFF"}},{path:"pages/doctor/appointment",style:{navigationBarTitleText:"é¢„çº¦ä¿¡æ¯",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/reviews",style:{navigationBarTitleText:"æ‚£è€…è¯„ä»·",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/consultation-history",style:{navigationBarTitleText:"å†å²é—®è¯Š",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/consultation-detail",style:{navigationBarTitleText:"é—®è¯Šè¯¦æƒ…",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/live",style:{navigationBarTitleText:"åŒ»ç”Ÿç›´æ’­",backgroundColor:"#000000",navigationBarBackgroundColor:"#000000",navigationBarTextStyle:"white"}},{path:"pages/viewer/live",style:{navigationBarTitleText:"è§‚çœ‹ç›´æ’­",backgroundColor:"#000000",navigationBarBackgroundColor:"#000000",navigationBarTextStyle:"white"}},{path:"pages/live/list",style:{navigationBarTitleText:"ç›´æ’­é—´åˆ—è¡¨",backgroundColor:"#667eea",navigationBarBackgroundColor:"#667eea",navigationBarTextStyle:"white"}},{path:"pages/live/entrance",style:{navigationBarTitleText:"åŒ»ç”Ÿç›´æ’­",backgroundColor:"#667eea",navigationBarBackgroundColor:"#667eea",navigationBarTextStyle:"white"}},{path:"pages/doctor/articles",style:{navigationBarTitleText:"åŒ»ç”Ÿæ–‡ç« ",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/article-detail",style:{navigationBarTitleText:"æ–‡ç« è¯¦æƒ…",backgroundColor:"#F5F6FA"}},{path:"pages/doctor/smart-recommend",style:{navigationBarTitleText:"æ™ºèƒ½æ¨è",backgroundColor:"#F5F6FA"}},{path:"pages/mine/appointments",style:{navigationStyle:"custom",navigationBarTitleText:"æˆ‘çš„é¢„çº¦"}},{path:"pages/mine/patients",style:{navigationBarTitleText:"æˆ‘çš„å°±è¯Šäºº",navigationBarBackgroundColor:"#4a90e2",navigationBarTextStyle:"white"}},{path:"pages/mine/patient-edit",style:{navigationBarTitleText:"å°±è¯Šäººä¿¡æ¯",navigationBarBackgroundColor:"#4a90e2",navigationBarTextStyle:"white"}},{path:"pages/mine/consultations",style:{navigationBarTitleText:"æˆ‘çš„å’¨è¯¢",navigationBarBackgroundColor:"#4a90e2",navigationBarTextStyle:"white"}},{path:"pages/mine/favorites",style:{navigationBarTitleText:"æˆ‘çš„æ”¶è—",navigationBarBackgroundColor:"#4a90e2",navigationBarTextStyle:"white"}},{path:"pages/mine/help",style:{navigationBarTitleText:"å¸®åŠ©ä¸­å¿ƒ",navigationBarBackgroundColor:"#4a90e2",navigationBarTextStyle:"white"}},{path:"pages/mine/messages",style:{navigationBarTitleText:"æˆ‘çš„æ¶ˆæ¯",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f5f5f5"}},{path:"pages/settings/settings",style:{navigationBarTitleText:"è®¾ç½®",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/account/account",style:{navigationBarTitleText:"è´¦å·è®¾ç½®",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/notification/notification",style:{navigationBarTitleText:"æ¶ˆæ¯é€šçŸ¥",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/address/address",style:{navigationBarTitleText:"åœ°å€ç®¡ç†",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/address/address-edit",style:{navigationBarTitleText:"æ–°å¢åœ°å€",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/address/map-selector",style:{navigationBarTitleText:"é€‰æ‹©åœ°å€",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f5f5f5"}},{path:"pages/settings/about/about",style:{navigationBarTitleText:"åŠŸèƒ½ä»‹ç»",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/legal",style:{navigationBarTitleText:"æ³•å¾‹å£°æ˜",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/terms",style:{navigationBarTitleText:"ç”¨æˆ·æœåŠ¡åè®®",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/privacy",style:{navigationBarTitleText:"éšç§æ”¿ç­–",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/settings/realname/realname",style:{navigationBarTitleText:"å®åè®¤è¯",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f3f5fb"}},{path:"pages/online-consult/index",style:{navigationBarTitleText:"åœ¨çº¿é—®è¯Š",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f6f7fb"}},{path:"pages/online-consult/patient",style:{navigationBarTitleText:"é€‰æ‹©å°±è¯Šäºº",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#f6f7fb"}},{path:"pages/online-consult/chat",style:{navigationStyle:"custom",navigationBarTitleText:"åœ¨çº¿å’¨è¯¢",backgroundColor:"#f6f7fb"}},{path:"pages/web-view/index",style:{navigationBarTitleText:"ç½‘é¡µå¯¼èˆª",backgroundColor:"#ffffff"}},{path:"pages/location-demo/index",style:{navigationBarTitleText:"ä½ç½®ä¸å¯¼èˆªæ¼”ç¤º",backgroundColor:"#ffffff"}}],globalStyle:{navigationBarTextStyle:"white",navigationBarTitleText:"é¢„çº¦æŒ‚å·å¹³å°",navigationBarBackgroundColor:"#4a90e2",backgroundColor:"#F5F5F5","app-plus":{background:"#F5F5F5"}},tabBar:{color:"#999999",selectedColor:"#4a90e2",backgroundColor:"#ffffff",borderStyle:"black",list:[{pagePath:"pages/index/index",text:"é¦–é¡µ",iconPath:"static/tabbar/é¦–é¡µ.png",selectedIconPath:"static/tabbar/é¦–é¡µ-é€‰ä¸­.png"},{pagePath:"pages/doctor/doctor",text:"ååŒ»",iconPath:"static/tabbar/ååŒ».png",selectedIconPath:"static/tabbar/ååŒ»-é€‰ä¸­.png"},{pagePath:"pages/buy-medicine/index",text:"Medicine",iconPath:"static/tabbar/medicine.png",selectedIconPath:"static/tabbar/medicine-active.png"},{pagePath:"pages/yishuo/yishuo",text:"åŒ»è¯´",iconPath:"static/tabbar/åŒ»è¯´.png",selectedIconPath:"static/tabbar/åŒ»è¯´-é€‰ä¸­.png"},{pagePath:"pages/mine/mine",text:"æˆ‘çš„",iconPath:"static/tabbar/æˆ‘çš„.png",selectedIconPath:"static/tabbar/æˆ‘çš„-é€‰ä¸­.png"}]},condition:{current:0,list:[{name:"",path:"",query:""}]}};function Me(e,t,a){return e(a={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&a.path)}},a.exports),a.exports}var $e=Me((function(e,t){var a;e.exports=(a=a||function(e,t){var a=Object.create||function(){function e(){}return function(t){var a;return e.prototype=t,a=new e,e.prototype=null,a}}(),o={},n=o.lib={},s=n.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=n.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,a=e.words,o=this.sigBytes,n=e.sigBytes;if(this.clamp(),o%4)for(var s=0;s<n;s++){var i=a[s>>>2]>>>24-s%4*8&255;t[o+s>>>2]|=i<<24-(o+s)%4*8}else for(s=0;s<n;s+=4)t[o+s>>>2]=a[s>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,a=this.sigBytes;t[a>>>2]&=4294967295<<32-a%4*8,t.length=e.ceil(a/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var a,o=[],n=function(t){var a=987654321,o=4294967295;return function(){var n=((a=36969*(65535&a)+(a>>16)&o)<<16)+(t=18e3*(65535&t)+(t>>16)&o)&o;return n/=4294967296,(n+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var r=n(4294967296*(a||e.random()));a=987654071*r(),o.push(4294967296*r()|0)}return new i.init(o,t)}}),r=o.enc={},l=r.Hex={stringify:function(e){for(var t=e.words,a=e.sigBytes,o=[],n=0;n<a;n++){var s=t[n>>>2]>>>24-n%4*8&255;o.push((s>>>4).toString(16)),o.push((15&s).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,a=[],o=0;o<t;o+=2)a[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new i.init(a,t/2)}},c=r.Latin1={stringify:function(e){for(var t=e.words,a=e.sigBytes,o=[],n=0;n<a;n++){var s=t[n>>>2]>>>24-n%4*8&255;o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var t=e.length,a=[],o=0;o<t;o++)a[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new i.init(a,t)}},d=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var a=this._data,o=a.words,n=a.sigBytes,s=this.blockSize,r=n/(4*s),l=(r=t?e.ceil(r):e.max((0|r)-this._minBufferSize,0))*s,c=e.min(4*l,n);if(l){for(var d=0;d<l;d+=s)this._doProcessBlock(o,d);var u=o.splice(0,l);a.sigBytes-=c}return new i.init(u,c)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,a){return new e.init(a).finalize(t)}},_createHmacHelper:function(e){return function(t,a){return new m.HMAC.init(e,a).finalize(t)}}});var m=o.algo={};return o}(Math),a)})),Le=$e,Fe=(Me((function(e,t){var a;e.exports=(a=Le,function(e){var t=a,o=t.lib,n=o.WordArray,s=o.Hasher,i=t.algo,r=[];!function(){for(var t=0;t<64;t++)r[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=i.MD5=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var a=0;a<16;a++){var o=t+a,n=e[o];e[o]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s=this._hash.words,i=e[t+0],l=e[t+1],p=e[t+2],h=e[t+3],g=e[t+4],v=e[t+5],f=e[t+6],w=e[t+7],y=e[t+8],E=e[t+9],k=e[t+10],N=e[t+11],V=e[t+12],C=e[t+13],x=e[t+14],b=e[t+15],S=s[0],I=s[1],T=s[2],D=s[3];S=c(S,I,T,D,i,7,r[0]),D=c(D,S,I,T,l,12,r[1]),T=c(T,D,S,I,p,17,r[2]),I=c(I,T,D,S,h,22,r[3]),S=c(S,I,T,D,g,7,r[4]),D=c(D,S,I,T,v,12,r[5]),T=c(T,D,S,I,f,17,r[6]),I=c(I,T,D,S,w,22,r[7]),S=c(S,I,T,D,y,7,r[8]),D=c(D,S,I,T,E,12,r[9]),T=c(T,D,S,I,k,17,r[10]),I=c(I,T,D,S,N,22,r[11]),S=c(S,I,T,D,V,7,r[12]),D=c(D,S,I,T,C,12,r[13]),T=c(T,D,S,I,x,17,r[14]),S=d(S,I=c(I,T,D,S,b,22,r[15]),T,D,l,5,r[16]),D=d(D,S,I,T,f,9,r[17]),T=d(T,D,S,I,N,14,r[18]),I=d(I,T,D,S,i,20,r[19]),S=d(S,I,T,D,v,5,r[20]),D=d(D,S,I,T,k,9,r[21]),T=d(T,D,S,I,b,14,r[22]),I=d(I,T,D,S,g,20,r[23]),S=d(S,I,T,D,E,5,r[24]),D=d(D,S,I,T,x,9,r[25]),T=d(T,D,S,I,h,14,r[26]),I=d(I,T,D,S,y,20,r[27]),S=d(S,I,T,D,C,5,r[28]),D=d(D,S,I,T,p,9,r[29]),T=d(T,D,S,I,w,14,r[30]),S=u(S,I=d(I,T,D,S,V,20,r[31]),T,D,v,4,r[32]),D=u(D,S,I,T,y,11,r[33]),T=u(T,D,S,I,N,16,r[34]),I=u(I,T,D,S,x,23,r[35]),S=u(S,I,T,D,l,4,r[36]),D=u(D,S,I,T,g,11,r[37]),T=u(T,D,S,I,w,16,r[38]),I=u(I,T,D,S,k,23,r[39]),S=u(S,I,T,D,C,4,r[40]),D=u(D,S,I,T,i,11,r[41]),T=u(T,D,S,I,h,16,r[42]),I=u(I,T,D,S,f,23,r[43]),S=u(S,I,T,D,E,4,r[44]),D=u(D,S,I,T,V,11,r[45]),T=u(T,D,S,I,b,16,r[46]),S=m(S,I=u(I,T,D,S,p,23,r[47]),T,D,i,6,r[48]),D=m(D,S,I,T,w,10,r[49]),T=m(T,D,S,I,x,15,r[50]),I=m(I,T,D,S,v,21,r[51]),S=m(S,I,T,D,V,6,r[52]),D=m(D,S,I,T,h,10,r[53]),T=m(T,D,S,I,k,15,r[54]),I=m(I,T,D,S,l,21,r[55]),S=m(S,I,T,D,y,6,r[56]),D=m(D,S,I,T,b,10,r[57]),T=m(T,D,S,I,f,15,r[58]),I=m(I,T,D,S,C,21,r[59]),S=m(S,I,T,D,g,6,r[60]),D=m(D,S,I,T,N,10,r[61]),T=m(T,D,S,I,p,15,r[62]),I=m(I,T,D,S,E,21,r[63]),s[0]=s[0]+S|0,s[1]=s[1]+I|0,s[2]=s[2]+T|0,s[3]=s[3]+D|0},_doFinalize:function(){var t=this._data,a=t.words,o=8*this._nDataBytes,n=8*t.sigBytes;a[n>>>5]|=128<<24-n%32;var s=e.floor(o/4294967296),i=o;a[15+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),a[14+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(a.length+1),this._process();for(var r=this._hash,l=r.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return r},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,a,o,n,s,i){var r=e+(t&a|~t&o)+n+i;return(r<<s|r>>>32-s)+t}function d(e,t,a,o,n,s,i){var r=e+(t&o|a&~o)+n+i;return(r<<s|r>>>32-s)+t}function u(e,t,a,o,n,s,i){var r=e+(t^a^o)+n+i;return(r<<s|r>>>32-s)+t}function m(e,t,a,o,n,s,i){var r=e+(a^(t|~o))+n+i;return(r<<s|r>>>32-s)+t}t.MD5=s._createHelper(l),t.HmacMD5=s._createHmacHelper(l)}(Math),a.MD5)})),Me((function(e,t){var a,o,n;e.exports=(o=(a=Le).lib.Base,n=a.enc.Utf8,void(a.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var a=e.blockSize,o=4*a;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),i=this._iKey=t.clone(),r=s.words,l=i.words,c=0;c<a;c++)r[c]^=1549556828,l[c]^=909522486;s.sigBytes=i.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,a=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(a))}})))})),Me((function(e,t){e.exports=Le.HmacMD5}))),Re=Me((function(e,t){e.exports=Le.enc.Utf8})),Oe=Me((function(e,t){var a,o,n;e.exports=(n=(o=a=Le).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,a=e.sigBytes,o=this._map;e.clamp();for(var n=[],s=0;s<a;s+=3)for(var i=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,r=0;r<4&&s+.75*r<a;r++)n.push(o.charAt(i>>>6*(3-r)&63));var l=o.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(e){var t=e.length,a=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var s=0;s<a.length;s++)o[a.charCodeAt(s)]=s}var i=a.charAt(64);if(i){var r=e.indexOf(i);-1!==r&&(t=r)}return function(e,t,a){for(var o=[],s=0,i=0;i<t;i++)if(i%4){var r=a[e.charCodeAt(i-1)]<<i%4*2,l=a[e.charCodeAt(i)]>>>6-i%4*2;o[s>>>2]|=(r|l)<<24-s%4*8,s++}return n.create(o,s)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},a.enc.Base64)}));const je="uni_id_token",ze="uni_id_token_expired",qe="FUNCTION",He="OBJECT",We="CLIENT_DB",Je="pending",Ke="rejected";function Ge(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function Ye(e){return"object"===Ge(e)}function Qe(e){return"function"==typeof e}function Xe(e){return function(){try{return e.apply(e,arguments)}catch(t){console.error(t)}}}const Ze="REJECTED",et="NOT_PENDING";class tt{constructor({createPromise:e,retryRule:t=Ze}={}){this.createPromise=e,this.status=null,this.promise=null,this.retryRule=t}get needRetry(){if(!this.status)return!0;switch(this.retryRule){case Ze:return this.status===Ke;case et:return this.status!==Je}}exec(){return this.needRetry?(this.status=Je,this.promise=this.createPromise().then((e=>(this.status="fulfilled",Promise.resolve(e))),(e=>(this.status=Ke,Promise.reject(e)))),this.promise):this.promise}}function at(e){return e&&"string"==typeof e?JSON.parse(e):e}const ot=at([]);at("");const nt=at('[{"provider":"aliyun","spaceName":"ali123","spaceId":"mp-7a43517d-d8d4-4fa6-bf16-36b1c3fe2485","clientSecret":"59z4qLLurmwANAlROsu/mg==","endpoint":"https://api.next.bspapp.com"}]')||[];let st="";try{st="__UNI__E3E33C6"}catch(Kt){}let it,rt={};function lt(e,t={}){var a,o;return a=rt,o=e,Object.prototype.hasOwnProperty.call(a,o)||(rt[e]=t),rt[e]}rt=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={};const ct=["invoke","success","fail","complete"],dt=lt("_globalUniCloudInterceptor");function ut(e,t){dt[e]||(dt[e]={}),Ye(t)&&Object.keys(t).forEach((a=>{ct.indexOf(a)>-1&&function(e,t,a){let o=dt[e][t];o||(o=dt[e][t]=[]),-1===o.indexOf(a)&&Qe(a)&&o.push(a)}(e,a,t[a])}))}function mt(e,t){dt[e]||(dt[e]={}),Ye(t)?Object.keys(t).forEach((a=>{ct.indexOf(a)>-1&&function(e,t,a){const o=dt[e][t];if(!o)return;const n=o.indexOf(a);n>-1&&o.splice(n,1)}(e,a,t[a])})):delete dt[e]}function pt(e,t){return e&&0!==e.length?e.reduce(((e,a)=>e.then((()=>a(t)))),Promise.resolve()):Promise.resolve()}function ht(e,t){return dt[e]&&dt[e][t]||[]}function gt(e){ut("callObject",e)}const vt=lt("_globalUniCloudListener"),ft="response",wt="needLogin",yt="refreshToken",Et="clientdb",kt="cloudfunction",Nt="cloudobject";function Vt(e){return vt[e]||(vt[e]=[]),vt[e]}function Ct(e,t){const a=Vt(e);a.includes(t)||a.push(t)}function xt(e,t){const a=Vt(e),o=a.indexOf(t);-1!==o&&a.splice(o,1)}function bt(e,t){const a=Vt(e);for(let o=0;o<a.length;o++)(0,a[o])(t)}let St,It=!1;function Tt(){return St||(St=new Promise((e=>{It&&e(),function t(){if("function"==typeof getCurrentPages){const t=getCurrentPages();t&&t[0]&&(It=!0,e())}It||setTimeout((()=>{t()}),30)}()})),St)}function Dt(e){const t={};for(const a in e){const o=e[a];Qe(o)&&(t[a]=Xe(o))}return t}class Bt extends Error{constructor(e){const t=e.message||e.errMsg||"unknown system error";super(t),this.errMsg=t,this.code=this.errCode=e.code||e.errCode||"SYSTEM_ERROR",this.errSubject=this.subject=e.subject||e.errSubject,this.cause=e.cause,this.requestId=e.requestId}toJson(e=0){if(!(e>=10))return e++,{errCode:this.errCode,errMsg:this.errMsg,errSubject:this.errSubject,cause:this.cause&&this.cause.toJson?this.cause.toJson(e):this.cause}}}var _t={request:e=>uni.request(e),uploadFile:e=>uni.uploadFile(e),setStorageSync:(e,t)=>uni.setStorageSync(e,t),getStorageSync:e=>uni.getStorageSync(e),removeStorageSync:e=>uni.removeStorageSync(e),clearStorageSync:()=>uni.clearStorageSync(),connectSocket:e=>uni.connectSocket(e)};function Pt(e){return e&&Pt(e.__v_raw)||e}function At(){return{token:_t.getStorageSync(je)||_t.getStorageSync("uniIdToken"),tokenExpired:_t.getStorageSync(ze)}}function Ut({token:e,tokenExpired:t}={}){e&&_t.setStorageSync(je,e),t&&_t.setStorageSync(ze,t)}let Mt,$t;function Lt(){return Mt||(Mt=uni.getSystemInfoSync()),Mt}function Ft(){let e,t;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;const{scene:a,channel:o}=uni.getLaunchOptionsSync();e=o,t=a}}catch(a){}return{channel:e,scene:t}}let Rt={};function Ot(){const e=uni.getLocale&&uni.getLocale()||"en";if($t)return{...Rt,...$t,locale:e,LOCALE:e};const t=Lt(),{deviceId:a,osName:o,uniPlatform:n,appId:s}=t,i=["appId","appLanguage","appName","appVersion","appVersionCode","appWgtVersion","browserName","browserVersion","deviceBrand","deviceId","deviceModel","deviceType","osName","osVersion","romName","romVersion","ua","hostName","hostVersion","uniPlatform","uniRuntimeVersion","uniRuntimeVersionCode","uniCompilerVersion","uniCompilerVersionCode"];for(const r in t)Object.hasOwnProperty.call(t,r)&&-1===i.indexOf(r)&&delete t[r];return $t={PLATFORM:n,OS:o,APPID:s,DEVICEID:a,...Ft(),...t},{...Rt,...$t,locale:e,LOCALE:e}}var jt=function(e,t){let a="";return Object.keys(e).sort().forEach((function(t){e[t]&&(a=a+"&"+t+"="+e[t])})),a=a.slice(1),Fe(a,t).toString()},zt=function(e,t){return new Promise(((a,o)=>{t(Object.assign(e,{complete(e){e||(e={});const t=e.data&&e.data.header&&e.data.header["x-serverless-request-id"]||e.header&&e.header["request-id"];if(!e.statusCode||e.statusCode>=400){const a=e.data&&e.data.error&&e.data.error.code||"SYS_ERR",n=e.data&&e.data.error&&e.data.error.message||e.errMsg||"request:fail";return o(new Bt({code:a,message:n,requestId:t}))}const n=e.data;if(n.error)return o(new Bt({code:n.error.code,message:n.error.message,requestId:t}));n.result=n.data,n.requestId=t,delete n.data,a(n)}}))}))},qt=function(e){return Oe.stringify(Re.parse(e))},Ht={init(e){const t=new class{constructor(e){["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),this.config=Object.assign({},{endpoint:0===e.spaceId.indexOf("mp-")?"https://api.next.bspapp.com":"https://api.bspapp.com"},e),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=_t,this._getAccessTokenPromiseHub=new tt({createPromise:()=>this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then((e=>{if(!e.result||!e.result.accessToken)throw new Bt({code:"AUTH_FAILED",message:"è·å–accessTokenå¤±è´¥"});this.setAccessToken(e.result.accessToken)})),retryRule:et})}get hasAccessToken(){return!!this.accessToken}setAccessToken(e){this.accessToken=e}requestWrapped(e){return zt(e,this.adapter.request)}requestAuth(e){return this.requestWrapped(e)}request(e,t){return Promise.resolve().then((()=>this.hasAccessToken?t?this.requestWrapped(e):this.requestWrapped(e).catch((t=>new Promise(((e,a)=>{!t||"GATEWAY_INVALID_TOKEN"!==t.code&&"InvalidParameter.InvalidToken"!==t.code?a(t):e()})).then((()=>this.getAccessToken())).then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)})))):this.getAccessToken().then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)}))))}rebuildRequest(e){const t=Object.assign({},e);return t.data.token=this.accessToken,t.header["x-basement-token"]=this.accessToken,t.header["x-serverless-sign"]=jt(t.data,this.config.clientSecret),t}setupRequest(e,t){const a=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),o={"Content-Type":"application/json"};return"auth"!==t&&(a.token=this.accessToken,o["x-basement-token"]=this.accessToken),o["x-serverless-sign"]=jt(a,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:a,dataType:"json",header:o}}getAccessToken(){return this._getAccessTokenPromiseHub.exec()}async authorize(){await this.getAccessToken()}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request({...this.setupRequest(t),timeout:e.timeout})}getOSSUploadOptionsFromPath(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}uploadFileToOSS({url:e,formData:t,name:a,filePath:o,fileType:n,onUploadProgress:s}){return new Promise(((i,r)=>{const l=this.adapter.uploadFile({url:e,formData:t,name:a,filePath:o,fileType:n,header:{"X-OSS-server-side-encrpytion":"AES256"},success(e){e&&e.statusCode<400?i(e):r(new Bt({code:"UPLOAD_FAILED",message:"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))},fail(e){r(new Bt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))}});"function"==typeof s&&l&&"function"==typeof l.onProgressUpdate&&l.onProgressUpdate((e=>{s({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}reportOSSUpload(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}async uploadFile({filePath:e,cloudPath:t,fileType:a="image",cloudPathAsRealPath:o=!1,onUploadProgress:n,config:s}){if("string"!==Ge(t))throw new Bt({code:"INVALID_PARAM",message:"cloudPathå¿…é¡»ä¸ºå­—ç¬¦ä¸²ç±»å‹"});if(!(t=t.trim()))throw new Bt({code:"INVALID_PARAM",message:"cloudPathä¸å¯ä¸ºç©º"});if(/:\/\//.test(t))throw new Bt({code:"INVALID_PARAM",message:"cloudPathä¸åˆæ³•"});const i=s&&s.envType||this.config.envType;if(o&&("/"!==t[0]&&(t="/"+t),t.indexOf("\\")>-1))throw new Bt({code:"INVALID_PARAM",message:"ä½¿ç”¨cloudPathä½œä¸ºè·¯å¾„æ—¶ï¼ŒcloudPathä¸å¯åŒ…å«â€œ\\â€"});const r=(await this.getOSSUploadOptionsFromPath({env:i,filename:o?t.split("/").pop():t,fileId:o?t:void 0})).result,l="https://"+r.cdnDomain+"/"+r.ossPath,{securityToken:c,accessKeyId:d,signature:u,host:m,ossPath:p,id:h,policy:g,ossCallbackUrl:v}=r,f={"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:d,Signature:u,host:m,id:h,key:p,policy:g,success_action_status:200};if(c&&(f["x-oss-security-token"]=c),v){const e=JSON.stringify({callbackUrl:v,callbackBody:JSON.stringify({fileId:h,spaceId:this.config.spaceId}),callbackBodyType:"application/json"});f.callback=qt(e)}const w={url:"https://"+r.host,formData:f,fileName:"file",name:"file",filePath:e,fileType:a};if(await this.uploadFileToOSS(Object.assign({},w,{onUploadProgress:n})),v)return{success:!0,filePath:e,fileID:l};if((await this.reportOSSUpload({id:h})).success)return{success:!0,filePath:e,fileID:l};throw new Bt({code:"UPLOAD_FAILED",message:"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"})}getTempFileURL({fileList:e}={}){return new Promise(((t,a)=>{Array.isArray(e)&&0!==e.length||a(new Bt({code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯éç©ºçš„å­—ç¬¦ä¸²"})),this.getFileInfo({fileList:e}).then((a=>{t({fileList:e.map(((e,t)=>{const o=a.fileList[t];return{fileID:e,tempFileURL:o&&o.url||e}}))})}))}))}async getFileInfo({fileList:e}={}){if(!Array.isArray(e)||0===e.length)throw new Bt({code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯éç©ºçš„å­—ç¬¦ä¸²"});const t={method:"serverless.file.resource.info",params:JSON.stringify({id:e.map((e=>e.split("?")[0])).join(",")})};return{fileList:(await this.request(this.setupRequest(t))).result}}}(e),a={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return a},t.customAuth=t.auth,t}};const Wt="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";var Jt,Kt;(Kt=Jt||(Jt={})).local="local",Kt.none="none",Kt.session="session";var Gt=function(){},Yt=Me((function(e,t){var a;e.exports=(a=Le,function(e){var t=a,o=t.lib,n=o.WordArray,s=o.Hasher,i=t.algo,r=[],l=[];!function(){function t(t){for(var a=e.sqrt(t),o=2;o<=a;o++)if(!(t%o))return!1;return!0}function a(e){return 4294967296*(e-(0|e))|0}for(var o=2,n=0;n<64;)t(o)&&(n<8&&(r[n]=a(e.pow(o,.5))),l[n]=a(e.pow(o,1/3)),n++),o++}();var c=[],d=i.SHA256=s.extend({_doReset:function(){this._hash=new n.init(r.slice(0))},_doProcessBlock:function(e,t){for(var a=this._hash.words,o=a[0],n=a[1],s=a[2],i=a[3],r=a[4],d=a[5],u=a[6],m=a[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var h=c[p-15],g=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,v=c[p-2],f=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[p]=g+c[p-7]+f+c[p-16]}var w=o&n^o&s^n&s,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),E=m+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&d^~r&u)+l[p]+c[p];m=u,u=d,d=r,r=i+E|0,i=s,s=n,n=o,o=E+(y+w)|0}a[0]=a[0]+o|0,a[1]=a[1]+n|0,a[2]=a[2]+s|0,a[3]=a[3]+i|0,a[4]=a[4]+r|0,a[5]=a[5]+d|0,a[6]=a[6]+u|0,a[7]=a[7]+m|0},_doFinalize:function(){var t=this._data,a=t.words,o=8*this._nDataBytes,n=8*t.sigBytes;return a[n>>>5]|=128<<24-n%32,a[14+(n+64>>>9<<4)]=e.floor(o/4294967296),a[15+(n+64>>>9<<4)]=o,t.sigBytes=4*a.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(d),t.HmacSHA256=s._createHmacHelper(d)}(Math),a.SHA256)})),Qt=Yt,Xt=Me((function(e,t){e.exports=Le.HmacSHA256}));const Zt=()=>{let e;if(!Promise){e=()=>{},e.promise={};const t=()=>{throw new Bt({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}const t=new Promise(((t,a)=>{e=(e,o)=>e?a(e):t(o)}));return e.promise=t,e};function ea(e){return void 0===e}function ta(e){return"[object Null]"===Object.prototype.toString.call(e)}function aa(e=""){return e.replace(/([\s\S]+)\s+(è¯·å‰å¾€äº‘å¼€å‘AIå°åŠ©æ‰‹æŸ¥çœ‹é—®é¢˜ï¼š.*)/,"$1")}function oa(e=32){let t="";for(let a=0;a<e;a++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}var na;!function(e){e.WEB="web",e.WX_MP="wx_mp"}(na||(na={}));const sa={adapter:null,runtime:void 0},ia=["anonymousUuidKey"];class ra extends Gt{constructor(){super(),sa.adapter.root.tcbObject||(sa.adapter.root.tcbObject={})}setItem(e,t){sa.adapter.root.tcbObject[e]=t}getItem(e){return sa.adapter.root.tcbObject[e]}removeItem(e){delete sa.adapter.root.tcbObject[e]}clear(){delete sa.adapter.root.tcbObject}}function la(e,t){switch(e){case"local":return t.localStorage||new ra;case"none":return new ra;default:return t.sessionStorage||new ra}}class ca{constructor(e){if(!this._storage){this._persistence=sa.adapter.primaryStorage||e.persistence,this._storage=la(this._persistence,sa.adapter);const t=`access_token_${e.env}`,a=`access_token_expire_${e.env}`,o=`refresh_token_${e.env}`,n=`anonymous_uuid_${e.env}`,s=`login_type_${e.env}`,i="device_id",r=`token_type_${e.env}`,l=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o,anonymousUuidKey:n,loginTypeKey:s,userInfoKey:l,deviceIdKey:i,tokenTypeKey:r}}}updatePersistence(e){if(e===this._persistence)return;const t="local"===this._persistence;this._persistence=e;const a=la(e,sa.adapter);for(const o in this.keys){const e=this.keys[o];if(t&&ia.includes(o))continue;const n=this._storage.getItem(e);ea(n)||ta(n)||(a.setItem(e,n),this._storage.removeItem(e))}this._storage=a}setStore(e,t,a){if(!this._storage)return;const o={version:a||"localCachev1",content:t},n=JSON.stringify(o);try{this._storage.setItem(e,n)}catch(s){throw s}}getStore(e,t){try{if(!this._storage)return}catch(o){return""}t=t||"localCachev1";const a=this._storage.getItem(e);return a&&a.indexOf(t)>=0?JSON.parse(a).content:""}removeStore(e){this._storage.removeItem(e)}}const da={},ua={};function ma(e){return da[e]}class pa{constructor(e,t){this.data=t||null,this.name=e}}class ha extends pa{constructor(e,t){super("error",{error:e,data:t}),this.error=e}}const ga=new class{constructor(){this._listeners={}}on(e,t){return a=e,o=t,(n=this._listeners)[a]=n[a]||[],n[a].push(o),this;var a,o,n}off(e,t){return function(e,t,a){if(a&&a[e]){const o=a[e].indexOf(t);-1!==o&&a[e].splice(o,1)}}(e,t,this._listeners),this}fire(e,t){if(e instanceof ha)return console.error(e.error),this;const a="string"==typeof e?new pa(e,t||{}):e,o=a.name;if(this._listens(o)){a.target=this;const e=this._listeners[o]?[...this._listeners[o]]:[];for(const t of e)t.call(this,a)}return this}_listens(e){return this._listeners[e]&&this._listeners[e].length>0}};function va(e,t){ga.on(e,t)}function fa(e,t={}){ga.fire(e,t)}function wa(e,t){ga.off(e,t)}const ya="loginStateChanged",Ea="loginStateExpire",ka="loginTypeChanged",Na="anonymousConverted",Va="refreshAccessToken";var Ca;!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL"}(Ca||(Ca={}));class xa{constructor(){this._fnPromiseMap=new Map}async run(e,t){let a=this._fnPromiseMap.get(e);return a||(a=new Promise((async(a,o)=>{try{await this._runIdlePromise();const o=t();a(await o)}catch(n){o(n)}finally{this._fnPromiseMap.delete(e)}})),this._fnPromiseMap.set(e,a)),a}_runIdlePromise(){return Promise.resolve()}}class ba{constructor(e){this._singlePromise=new xa,this._cache=ma(e.env),this._baseURL=`https://${e.env}.ap-shanghai.tcb-api.tencentcloudapi.com`,this._reqClass=new sa.adapter.reqClass({timeout:e.timeout,timeoutMsg:`è¯·æ±‚åœ¨${e.timeout/1e3}så†…æœªå®Œæˆï¼Œå·²ä¸­æ–­`,restrictedMethods:["post"]})}_getDeviceId(){if(this._deviceID)return this._deviceID;const{deviceIdKey:e}=this._cache.keys;let t=this._cache.getStore(e);return"string"==typeof t&&t.length>=16&&t.length<=48||(t=oa(),this._cache.setStore(e,t)),this._deviceID=t,t}async _request(e,t,a={}){const o={"x-request-id":oa(),"x-device-id":this._getDeviceId()};if(a.withAccessToken){const{tokenTypeKey:e}=this._cache.keys,t=await this.getAccessToken(),a=this._cache.getStore(e);o.authorization=`${a} ${t}`}return this._reqClass["get"===a.method?"get":"post"]({url:`${this._baseURL}${e}`,data:t,headers:o})}async _fetchAccessToken(){const{loginTypeKey:e,accessTokenKey:t,accessTokenExpireKey:a,tokenTypeKey:o}=this._cache.keys,n=this._cache.getStore(e);if(n&&n!==Ca.ANONYMOUS)throw new Bt({code:"INVALID_OPERATION",message:"éåŒ¿åç™»å½•ä¸æ”¯æŒåˆ·æ–° access token"});const s=await this._singlePromise.run("fetchAccessToken",(async()=>(await this._request("/auth/v1/signin/anonymously",{},{method:"post"})).data)),{access_token:i,expires_in:r,token_type:l}=s;return this._cache.setStore(o,l),this._cache.setStore(t,i),this._cache.setStore(a,Date.now()+1e3*r),i}isAccessTokenExpired(e,t){let a=!0;return e&&t&&(a=t<Date.now()),a}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,a=this._cache.getStore(e),o=this._cache.getStore(t);return this.isAccessTokenExpired(a,o)?this._fetchAccessToken():a}async refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,loginTypeKey:a}=this._cache.keys;return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.setStore(a,Ca.ANONYMOUS),this.getAccessToken()}async getUserInfo(){return this._singlePromise.run("getUserInfo",(async()=>(await this._request("/auth/v1/user/me",{},{withAccessToken:!0,method:"get"})).data))}}const Sa=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],Ia={"X-SDK-Version":"1.3.5"};function Ta(e,t,a){const o=e[t];e[t]=function(t){const n={},s={};a.forEach((a=>{const{data:o,headers:i}=a.call(e,t);Object.assign(n,o),Object.assign(s,i)}));const i=t.data;return i&&(()=>{var e;if(e=i,"[object FormData]"!==Object.prototype.toString.call(e))t.data={...i,...n};else for(const t in n)i.append(t,n[t])})(),t.headers={...t.headers||{},...s},o.call(e,t)}}function Da(){const e=Math.random().toString(16).slice(2);return{data:{seqId:e},headers:{...Ia,"x-seqid":e}}}class Ba{constructor(e={}){var t;this.config=e,this._reqClass=new sa.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`è¯·æ±‚åœ¨${this.config.timeout/1e3}så†…æœªå®Œæˆï¼Œå·²ä¸­æ–­`,restrictedMethods:["post"]}),this._cache=ma(this.config.env),this._localCache=(t=this.config.env,ua[t]),this.oauth=new ba(this.config),Ta(this._reqClass,"post",[Da]),Ta(this._reqClass,"upload",[Da]),Ta(this._reqClass,"download",[Da])}async post(e){return await this._reqClass.post(e)}async upload(e){return await this._reqClass.upload(e)}async download(e){return await this._reqClass.download(e)}async refreshAccessToken(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=await this._refreshAccessTokenPromise}catch(a){t=a}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e}async _refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:a,loginTypeKey:o,anonymousUuidKey:n}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let s=this._cache.getStore(a);if(!s)throw new Bt({message:"æœªç™»å½•CloudBase"});const i={refresh_token:s},r=await this.request("auth.fetchAccessTokenWithRefreshToken",i);if(r.data.code){const{code:e}=r.data;if("SIGN_PARAM_INVALID"===e||"REFRESH_TOKEN_EXPIRED"===e||"INVALID_REFRESH_TOKEN"===e){if(this._cache.getStore(o)===Ca.ANONYMOUS&&"INVALID_REFRESH_TOKEN"===e){const e=this._cache.getStore(n),t=this._cache.getStore(a),o=await this.send("auth.signInAnonymously",{anonymous_uuid:e,refresh_token:t});return this.setRefreshToken(o.refresh_token),this._refreshAccessToken()}fa(Ea),this._cache.removeStore(a)}throw new Bt({code:r.data.code,message:`åˆ·æ–°access tokenå¤±è´¥ï¼š${r.data.code}`})}if(r.data.access_token)return fa(Va),this._cache.setStore(e,r.data.access_token),this._cache.setStore(t,r.data.access_token_expire+Date.now()),{accessToken:r.data.access_token,accessTokenExpire:r.data.access_token_expire};r.data.refresh_token&&(this._cache.removeStore(a),this._cache.setStore(a,r.data.refresh_token),this._refreshAccessToken())}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:a}=this._cache.keys;if(!this._cache.getStore(a))throw new Bt({message:"refresh tokenä¸å­˜åœ¨ï¼Œç™»å½•çŠ¶æ€å¼‚å¸¸"});let o=this._cache.getStore(e),n=this._cache.getStore(t),s=!0;return this._shouldRefreshAccessTokenHook&&!(await this._shouldRefreshAccessTokenHook(o,n))&&(s=!1),(!o||!n||n<Date.now())&&s?this.refreshAccessToken():{accessToken:o,accessTokenExpire:n}}async request(e,t,a){const o=`x-tcb-trace_${this.config.env}`;let n="application/x-www-form-urlencoded";const s={action:e,env:this.config.env,dataVersion:"2019-08-16",...t};let i;if(-1===Sa.indexOf(e)&&(this._cache.keys,s.access_token=await this.oauth.getAccessToken()),"storage.uploadFile"===e){i=new FormData;for(let e in i)i.hasOwnProperty(e)&&void 0!==i[e]&&i.append(e,s[e]);n="multipart/form-data"}else{n="application/json",i={};for(let e in s)void 0!==s[e]&&(i[e]=s[e])}let r={headers:{"content-type":n}};a&&a.timeout&&(r.timeout=a.timeout),a&&a.onUploadProgress&&(r.onUploadProgress=a.onUploadProgress);const l=this._localCache.getStore(o);l&&(r.headers["X-TCB-Trace"]=l);const{parse:c,inQuery:d,search:u}=t;let m={env:this.config.env};c&&(m.parse=!0),d&&(m={...d,...m});let p=function(e,t,a={}){const o=/\?/.test(t);let n="";for(let s in a)""===n?!o&&(t+="?"):n+="&",n+=`${s}=${encodeURIComponent(a[s])}`;return/^http(s)?\:\/\//.test(t+=n)?t:`${e}${t}`}(Wt,"//tcb-api.tencentcloudapi.com/web",m);u&&(p+=u);const h=await this.post({url:p,data:i,...r}),g=h.header&&h.header["x-tcb-trace"];if(g&&this._localCache.setStore(o,g),200!==Number(h.status)&&200!==Number(h.statusCode)||!h.data)throw new Bt({code:"NETWORK_ERROR",message:"network request error"});return h}async send(e,t={},a={}){const o=await this.request(e,t,{...a,onUploadProgress:t.onUploadProgress});if(("ACCESS_TOKEN_DISABLED"===o.data.code||"ACCESS_TOKEN_EXPIRED"===o.data.code)&&-1===Sa.indexOf(e)){await this.oauth.refreshAccessToken();const o=await this.request(e,t,{...a,onUploadProgress:t.onUploadProgress});if(o.data.code)throw new Bt({code:o.data.code,message:aa(o.data.message)});return o.data}if(o.data.code)throw new Bt({code:o.data.code,message:aa(o.data.message)});return o.data}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(a),this._cache.setStore(o,e)}}const _a={};function Pa(e){return _a[e]}class Aa{constructor(e){this.config=e,this._cache=ma(e.env),this._request=Pa(e.env)}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:a,refreshTokenKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(a),this._cache.setStore(o,e)}setAccessToken(e,t){const{accessTokenKey:a,accessTokenExpireKey:o}=this._cache.keys;this._cache.setStore(a,e),this._cache.setStore(o,t)}async refreshUserInfo(){const{data:e}=await this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}}class Ua{constructor(e){if(!e)throw new Bt({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=ma(this._envId),this._request=Pa(this._envId),this.setUserInfo()}linkWithTicket(e){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}async getLinkedUidList(){const{data:e}=await this._request.send("auth.getLinkedUidList",{});let t=!1;const{users:a}=e;return a.forEach((e=>{e.wxOpenId&&e.wxPublicId&&(t=!0)})),{users:a,hasPrimaryUid:t}}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}async update(e){const{nickName:t,gender:a,avatarUrl:o,province:n,country:s,city:i}=e,{data:r}=await this._request.send("auth.updateUserInfo",{nickName:t,gender:a,avatarUrl:o,province:n,country:s,city:i});this.setLocalUserInfo(r)}async refresh(){const e=await this._request.oauth.getUserInfo();return this.setLocalUserInfo(e),e}setUserInfo(){const{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach((e=>{this[e]=t[e]})),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}}class Ma{constructor(e){if(!e)throw new Bt({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=ma(e);const{refreshTokenKey:t,accessTokenKey:a,accessTokenExpireKey:o}=this._cache.keys,n=this._cache.getStore(t),s=this._cache.getStore(a),i=this._cache.getStore(o);this.credential={refreshToken:n,accessToken:s,accessTokenExpire:i},this.user=new Ua(e)}get isAnonymousAuth(){return this.loginType===Ca.ANONYMOUS}get isCustomAuth(){return this.loginType===Ca.CUSTOM}get isWeixinAuth(){return this.loginType===Ca.WECHAT||this.loginType===Ca.WECHAT_OPEN||this.loginType===Ca.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}class $a extends Aa{async signIn(){this._cache.updatePersistence("local"),await this._request.oauth.getAccessToken(),fa(ya),fa(ka,{env:this.config.env,loginType:Ca.ANONYMOUS,persistence:"local"});const e=new Ma(this.config.env);return await e.user.refresh(),e}async linkAndRetrieveDataWithTicket(e){const{anonymousUuidKey:t,refreshTokenKey:a}=this._cache.keys,o=this._cache.getStore(t),n=this._cache.getStore(a),s=await this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:o,refresh_token:n,ticket:e});if(s.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(s.refresh_token),await this._request.refreshAccessToken(),fa(Na,{env:this.config.env}),fa(ka,{loginType:Ca.CUSTOM,persistence:"local"}),{credential:{refreshToken:s.refresh_token}};throw new Bt({message:"åŒ¿åè½¬åŒ–å¤±è´¥"})}_setAnonymousUUID(e){const{anonymousUuidKey:t,loginTypeKey:a}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(a,Ca.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}}class La extends Aa{async signIn(e){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"ticket must be a string"});const{refreshTokenKey:t}=this._cache.keys,a=await this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(a.refresh_token)return this.setRefreshToken(a.refresh_token),await this._request.refreshAccessToken(),fa(ya),fa(ka,{env:this.config.env,loginType:Ca.CUSTOM,persistence:this.config.persistence}),await this.refreshUserInfo(),new Ma(this.config.env);throw new Bt({message:"è‡ªå®šä¹‰ç™»å½•å¤±è´¥"})}}class Fa extends Aa{async signIn(e,t){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"email must be a string"});const{refreshTokenKey:a}=this._cache.keys,o=await this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(a)||""}),{refresh_token:n,access_token:s,access_token_expire:i}=o;if(n)return this.setRefreshToken(n),s&&i?this.setAccessToken(s,i):await this._request.refreshAccessToken(),await this.refreshUserInfo(),fa(ya),fa(ka,{env:this.config.env,loginType:Ca.EMAIL,persistence:this.config.persistence}),new Ma(this.config.env);throw o.code?new Bt({code:o.code,message:`é‚®ç®±ç™»å½•å¤±è´¥: ${o.message}`}):new Bt({message:"é‚®ç®±ç™»å½•å¤±è´¥"})}async activate(e){return this._request.send("auth.activateEndUserMail",{token:e})}async resetPasswordWithToken(e,t){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})}}class Ra extends Aa{async signIn(e,t){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"username must be a string"});"string"!=typeof t&&(t="",console.warn("password is empty"));const{refreshTokenKey:a}=this._cache.keys,o=await this._request.send("auth.signIn",{loginType:Ca.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(a)||""}),{refresh_token:n,access_token_expire:s,access_token:i}=o;if(n)return this.setRefreshToken(n),i&&s?this.setAccessToken(i,s):await this._request.refreshAccessToken(),await this.refreshUserInfo(),fa(ya),fa(ka,{env:this.config.env,loginType:Ca.USERNAME,persistence:this.config.persistence}),new Ma(this.config.env);throw o.code?new Bt({code:o.code,message:`ç”¨æˆ·åå¯†ç ç™»å½•å¤±è´¥: ${o.message}`}):new Bt({message:"ç”¨æˆ·åå¯†ç ç™»å½•å¤±è´¥"})}}class Oa{constructor(e){this.config=e,this._cache=ma(e.env),this._request=Pa(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),va(ka,this._onLoginTypeChanged)}get currentUser(){const e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new $a(this.config)}customAuthProvider(){return new La(this.config)}emailAuthProvider(){return new Fa(this.config)}usernameAuthProvider(){return new Ra(this.config)}async signInAnonymously(){return new $a(this.config).signIn()}async signInWithEmailAndPassword(e,t){return new Fa(this.config).signIn(e,t)}signInWithUsernameAndPassword(e,t){return new Ra(this.config).signIn(e,t)}async linkAndRetrieveDataWithTicket(e){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new $a(this.config)),va(Na,this._onAnonymousConverted),await this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)}async signOut(){if(this.loginType===Ca.ANONYMOUS)throw new Bt({message:"åŒ¿åç”¨æˆ·ä¸æ”¯æŒç™»å‡ºæ“ä½œ"});const{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:a}=this._cache.keys,o=this._cache.getStore(e);if(!o)return;const n=await this._request.send("auth.logout",{refresh_token:o});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(a),fa(ya),fa(ka,{env:this.config.env,loginType:Ca.NULL,persistence:this.config.persistence}),n}async signUpWithEmailAndPassword(e,t){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})}async sendPasswordResetEmail(e){return this._request.send("auth.sendPasswordResetEmail",{email:e})}onLoginStateChanged(e){va(ya,(()=>{const t=this.hasLoginState();e.call(this,t)}));const t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){va(Ea,e.bind(this))}onAccessTokenRefreshed(e){va(Va,e.bind(this))}onAnonymousConverted(e){va(Na,e.bind(this))}onLoginTypeChanged(e){va(ka,(()=>{const t=this.hasLoginState();e.call(this,t)}))}async getAccessToken(){return{accessToken:(await this._request.getAccessToken()).accessToken,env:this.config.env}}hasLoginState(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,a=this._cache.getStore(e),o=this._cache.getStore(t);return this._request.oauth.isAccessTokenExpired(a,o)?null:new Ma(this.config.env)}async isUsernameRegistered(e){if("string"!=typeof e)throw new Bt({code:"PARAM_ERROR",message:"username must be a string"});const{data:t}=await this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered}getLoginState(){return Promise.resolve(this.hasLoginState())}async signInWithTicket(e){return new La(this.config).signIn(e)}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then((e=>e.code?e:{...e.data,requestId:e.seqId}))}getAuthHeader(){const{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,a=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+a}}_onAnonymousConverted(e){const{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){const{loginType:t,persistence:a,env:o}=e.data;o===this.config.env&&(this._cache.updatePersistence(a),this._cache.setStore(this._cache.keys.loginTypeKey,t))}}const ja=function(e,t){t=t||Zt();const a=Pa(this.config.env),{cloudPath:o,filePath:n,onUploadProgress:s,fileType:i="image"}=e;return a.send("storage.getUploadMetadata",{path:o}).then((e=>{const{data:{url:r,authorization:l,token:c,fileId:d,cosFileId:u},requestId:m}=e,p={key:o,signature:l,"x-cos-meta-fileid":u,success_action_status:"201","x-cos-security-token":c};a.upload({url:r,data:p,file:n,name:o,fileType:i,onUploadProgress:s}).then((e=>{201===e.statusCode?t(null,{fileID:d,requestId:m}):t(new Bt({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${e.data}`}))})).catch((e=>{t(e)}))})).catch((e=>{t(e)})),t.promise},za=function(e,t){t=t||Zt();const a=Pa(this.config.env),{cloudPath:o}=e;return a.send("storage.getUploadMetadata",{path:o}).then((e=>{t(null,e)})).catch((e=>{t(e)})),t.promise},qa=function({fileList:e},t){if(t=t||Zt(),!e||!Array.isArray(e))return{code:"INVALID_PARAM",message:"fileListå¿…é¡»æ˜¯éç©ºçš„æ•°ç»„"};for(let o of e)if(!o||"string"!=typeof o)return{code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯éç©ºçš„å­—ç¬¦ä¸²"};const a={fileid_list:e};return Pa(this.config.env).send("storage.batchDeleteFile",a).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},Ha=function({fileList:e},t){t=t||Zt(),e&&Array.isArray(e)||t(null,{code:"INVALID_PARAM",message:"fileListå¿…é¡»æ˜¯éç©ºçš„æ•°ç»„"});let a=[];for(let n of e)"object"==typeof n?(n.hasOwnProperty("fileID")&&n.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯åŒ…å«fileIDå’ŒmaxAgeçš„å¯¹è±¡"}),a.push({fileid:n.fileID,max_age:n.maxAge})):"string"==typeof n?a.push({fileid:n}):t(null,{code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯å­—ç¬¦ä¸²"});const o={file_list:a};return Pa(this.config.env).send("storage.batchGetDownloadUrl",o).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},Wa=async function({fileID:e},t){const a=(await Ha.call(this,{fileList:[{fileID:e,maxAge:600}]})).fileList[0];if("SUCCESS"!==a.code)return t?t(a):new Promise((e=>{e(a)}));const o=Pa(this.config.env);let n=a.download_url;if(n=encodeURI(n),!t)return o.download({url:n});t(await o.download({url:n}))},Ja=function({name:e,data:t,query:a,parse:o,search:n,timeout:s},i){const r=i||Zt();let l;try{l=t?JSON.stringify(t):""}catch(d){return Promise.reject(d)}if(!e)return Promise.reject(new Bt({code:"PARAM_ERROR",message:"å‡½æ•°åä¸èƒ½ä¸ºç©º"}));const c={inQuery:a,parse:o,search:n,function_name:e,request_data:l};return Pa(this.config.env).send("functions.invokeFunction",c,{timeout:s}).then((e=>{if(e.code)r(null,e);else{let a=e.data.response_data;if(o)r(null,{result:a,requestId:e.requestId});else try{a=JSON.parse(e.data.response_data),r(null,{result:a,requestId:e.requestId})}catch(t){r(new Bt({message:"response data must be json"}))}}return r.promise})).catch((e=>{r(e)})),r.promise},Ka={timeout:15e3,persistence:"session"},Ga=6e5,Ya={};class Qa{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(sa.adapter||(this.requestClient=new sa.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`è¯·æ±‚åœ¨${(e.timeout||5e3)/1e3}så†…æœªå®Œæˆï¼Œå·²ä¸­æ–­`})),this.config={...Ka,...e},!0){case this.config.timeout>Ga:console.warn("timeoutå¤§äºå¯é…ç½®ä¸Šé™[10åˆ†é’Ÿ]ï¼Œå·²é‡ç½®ä¸ºä¸Šé™æ•°å€¼"),this.config.timeout=Ga;break;case this.config.timeout<100:console.warn("timeoutå°äºå¯é…ç½®ä¸‹é™[100ms]ï¼Œå·²é‡ç½®ä¸ºä¸‹é™æ•°å€¼"),this.config.timeout=100}return new Qa(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;const t=e||sa.adapter.primaryStorage||Ka.persistence;var a;return t!==this.config.persistence&&(this.config.persistence=t),function(e){const{env:t}=e;da[t]=new ca(e),ua[t]=new ca({...e,persistence:"local"})}(this.config),a=this.config,_a[a.env]=new Ba(a),this.authObj=new Oa(this.config),this.authObj}on(e,t){return va.apply(this,[e,t])}off(e,t){return wa.apply(this,[e,t])}callFunction(e,t){return Ja.apply(this,[e,t])}deleteFile(e,t){return qa.apply(this,[e,t])}getTempFileURL(e,t){return Ha.apply(this,[e,t])}downloadFile(e,t){return Wa.apply(this,[e,t])}uploadFile(e,t){return ja.apply(this,[e,t])}getUploadMetadata(e,t){return za.apply(this,[e,t])}registerExtension(e){Ya[e.name]=e}async invokeExtension(e,t){const a=Ya[e];if(!a)throw new Bt({message:`æ‰©å±•${e} å¿…é¡»å…ˆæ³¨å†Œ`});return await a.invoke(t,this)}useAdapters(e){const{adapter:t,runtime:a}=function(e){const t=(a=e,"[object Array]"===Object.prototype.toString.call(a)?e:[e]);var a;for(const o of t){const{isMatch:e,genAdapter:t,runtime:a}=o;if(e())return{adapter:t(),runtime:a}}}(e)||{};t&&(sa.adapter=t),a&&(sa.runtime=a)}}var Xa=new Qa;function Za(e,t,a){void 0===a&&(a={});var o=/\?/.test(t),n="";for(var s in a)""===n?!o&&(t+="?"):n+="&",n+=s+"="+encodeURIComponent(a[s]);return/^http(s)?:\/\//.test(t+=n)?t:""+e+t}class eo{get(e){const{url:t,data:a,headers:o,timeout:n}=e;return new Promise(((e,s)=>{_t.request({url:Za("https:",t),data:a,method:"GET",header:o,timeout:n,success(t){e(t)},fail(e){s(e)}})}))}post(e){const{url:t,data:a,headers:o,timeout:n}=e;return new Promise(((e,s)=>{_t.request({url:Za("https:",t),data:a,method:"POST",header:o,timeout:n,success(t){e(t)},fail(e){s(e)}})}))}upload(e){return new Promise(((t,a)=>{const{url:o,file:n,data:s,headers:i,fileType:r}=e,l=_t.uploadFile({url:Za("https:",o),name:"file",formData:Object.assign({},s),filePath:n,fileType:r,header:i,success(e){const a={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&s.success_action_status&&(a.statusCode=parseInt(s.success_action_status,10)),t(a)},fail(e){a(new Error(e.errMsg||"uploadFile:fail"))}});"function"==typeof e.onUploadProgress&&l&&"function"==typeof l.onProgressUpdate&&l.onProgressUpdate((t=>{e.onUploadProgress({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend})}))}))}}const to={setItem(e,t){_t.setStorageSync(e,t)},getItem:e=>_t.getStorageSync(e),removeItem(e){_t.removeStorageSync(e)},clear(){_t.clearStorageSync()}};var ao={genAdapter:function(){return{root:{},reqClass:eo,localStorage:to,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};Xa.useAdapters(ao);const oo=Xa,no=oo.init;oo.init=function(e){e.env=e.spaceId;const t=no.call(this,e);t.config.provider="tencent",t.config.spaceId=e.spaceId;const a=t.auth;return t.auth=function(e){const t=a.call(this,e);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach((e=>{var a;t[e]=(a=t[e],function(e){e=e||{};const{success:t,fail:o,complete:n}=Dt(e);if(!(t||o||n))return a.call(this,e);a.call(this,e).then((e=>{t&&t(e),n&&n(e)}),(e=>{o&&o(e),n&&n(e)}))}).bind(t)})),t},t.customAuth=t.auth,t};var so=oo;async function io(e,t){const a=`http://${e}:${t}/system/ping`;try{const e=await(o={url:a,timeout:500},new Promise(((e,t)=>{_t.request({...o,success(t){e(t)},fail(e){t(e)}})})));return!(!e.data||0!==e.data.code)}catch(n){return!1}var o}const ro={"serverless.file.resource.generateProximalSign":"storage/generate-proximal-sign","serverless.file.resource.report":"storage/report","serverless.file.resource.delete":"storage/delete","serverless.file.resource.getTempFileURL":"storage/get-temp-file-url"};var lo={init(e){const t=new class{constructor(e){if(["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),!e.endpoint)throw new Error("é›†ç¾¤ç©ºé—´æœªé…ç½®ApiEndpointï¼Œé…ç½®åéœ€è¦é‡æ–°å…³è”æœåŠ¡ç©ºé—´åç”Ÿæ•ˆ");this.config=Object.assign({},e),this.config.provider="dcloud",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.adapter=_t}async request(e,t=!0){return e=this.setupRequest(e),Promise.resolve().then((()=>zt(e,this.adapter.request)))}requestLocal(e){return new Promise(((t,a)=>{this.adapter.request(Object.assign(e,{complete(e){if(e||(e={}),!e.statusCode||e.statusCode>=400){const t=e.data&&e.data.code||"SYS_ERR",o=e.data&&e.data.message||"request:fail";return a(new Bt({code:t,message:o}))}t({success:!0,result:e.data})}}))}))}setupRequest(e){const t=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),a={"Content-Type":"application/json"};a["x-serverless-sign"]=jt(t,this.config.clientSecret);const o=Ot();a["x-client-info"]=encodeURIComponent(JSON.stringify(o));const{token:n}=At();return a["x-client-token"]=n,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(a))}}async setupLocalRequest(e){const t=Ot(),{token:a}=At(),o=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now(),clientInfo:t,token:a}),{address:n,servePort:s}=this.__dev__&&this.__dev__.debugInfo||{},{address:i}=await async function(e,t){let a;for(let o=0;o<e.length;o++){const n=e[o];if(await io(n,t)){a=n;break}}return{address:a,port:t}}(n,s);return{url:`http://${i}:${s}/${ro[e.method]}`,method:"POST",data:o,dataType:"json",header:JSON.parse(JSON.stringify({"Content-Type":"application/json"}))}}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(t,!1)}getUploadFileOptions(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(t)}reportUploadFile(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(t)}uploadFile({filePath:e,cloudPath:t,fileType:a="image",onUploadProgress:o}){if(!t)throw new Bt({code:"CLOUDPATH_REQUIRED",message:"cloudPathä¸å¯ä¸ºç©º"});let n;return this.getUploadFileOptions({cloudPath:t}).then((t=>{const{url:s,formData:i,name:r}=t.result;return n=t.result.fileUrl,new Promise(((t,n)=>{const l=this.adapter.uploadFile({url:s,formData:i,name:r,filePath:e,fileType:a,success(e){e&&e.statusCode<400?t(e):n(new Bt({code:"UPLOAD_FAILED",message:"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))},fail(e){n(new Bt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))}});"function"==typeof o&&l&&"function"==typeof l.onProgressUpdate&&l.onProgressUpdate((e=>{o({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))})).then((()=>this.reportUploadFile({cloudPath:t}))).then((t=>new Promise(((a,o)=>{t.success?a({success:!0,filePath:e,fileID:n}):o(new Bt({code:"UPLOAD_FAILED",message:"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))}))))}deleteFile({fileList:e}){const t={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:e})};return this.request(t).then((e=>{if(e.success)return e.result;throw new Bt({code:"DELETE_FILE_FAILED",message:"åˆ é™¤æ–‡ä»¶å¤±è´¥"})}))}getTempFileURL({fileList:e,maxAge:t}={}){if(!Array.isArray(e)||0===e.length)throw new Bt({code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯éç©ºçš„å­—ç¬¦ä¸²"});const a={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:e,maxAge:t})};return this.request(a).then((e=>{if(e.success)return{fileList:e.result.fileList.map((e=>({fileID:e.fileID,tempFileURL:e.tempFileURL})))};throw new Bt({code:"GET_TEMP_FILE_URL_FAILED",message:"è·å–ä¸´æ—¶æ–‡ä»¶é“¾æ¥å¤±è´¥"})}))}}(e),a={signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return a},t.customAuth=t.auth,t}},co=Me((function(e,t){e.exports=Le.enc.Hex}));function uo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function mo(e="",t={}){const{data:a,functionName:o,method:n,headers:s,signHeaderKeys:i=[],config:r}=t,l=String(Date.now()),c=uo(),d=Object.assign({},s,{"x-from-app-id":r.spaceAppId,"x-from-env-id":r.spaceId,"x-to-env-id":r.spaceId,"x-from-instance-id":l,"x-from-function-name":o,"x-client-timestamp":l,"x-alipay-source":"client","x-request-id":c,"x-alipay-callid":c,"x-trace-id":c}),u=["x-from-app-id","x-from-env-id","x-to-env-id","x-from-instance-id","x-from-function-name","x-client-timestamp"].concat(i),[m="",p=""]=e.split("?")||[],h=function(e){const t="HMAC-SHA256",a=e.signedHeaders.join(";"),o=e.signedHeaders.map((t=>`${t.toLowerCase()}:${e.headers[t]}\n`)).join(""),n=Qt(e.body).toString(co),s=`${e.method.toUpperCase()}\n${e.path}\n${e.query}\n${o}\n${a}\n${n}\n`,i=Qt(s).toString(co),r=`${t}\n${e.timestamp}\n${i}\n`,l=Xt(r,e.secretKey).toString(co);return`${t} Credential=${e.secretId}, SignedHeaders=${a}, Signature=${l}`}({path:m,query:p,method:n,headers:d,timestamp:l,body:JSON.stringify(a),secretId:r.accessKey,secretKey:r.secretKey,signedHeaders:u.sort()});return{url:`${r.endpoint}${e}`,headers:Object.assign({},d,{Authorization:h})}}function po({url:e,data:t,method:a="POST",headers:o={},timeout:n}){return new Promise(((s,i)=>{_t.request({url:e,method:a,data:"object"==typeof t?JSON.stringify(t):t,header:o,dataType:"json",timeout:n,complete:(e={})=>{const t=o["x-trace-id"]||"";if(!e.statusCode||e.statusCode>=400){const{message:a,errMsg:o,trace_id:n}=e.data||{};return i(new Bt({code:"SYS_ERR",message:a||o||"request:fail",requestId:n||t}))}s({status:e.statusCode,data:e.data,headers:e.header,requestId:t})}})}))}function ho(e,t){const{path:a,data:o,method:n="GET"}=e,{url:s,headers:i}=mo(a,{functionName:"",data:o,method:n,headers:{"x-alipay-cloud-mode":"oss","x-data-api-type":"oss","x-expire-timestamp":String(Date.now()+6e4)},signHeaderKeys:["x-data-api-type","x-expire-timestamp"],config:t});return po({url:s,data:o,method:n,headers:i}).then((e=>{const t=e.data||{};if(!t.success)throw new Bt({code:e.errCode,message:e.errMsg,requestId:e.requestId});return t.data||{}})).catch((e=>{throw new Bt({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}function go(e=""){const t=e.trim().replace(/^cloud:\/\//,""),a=t.indexOf("/");if(a<=0)throw new Bt({code:"INVALID_PARAM",message:"fileIDä¸åˆæ³•"});const o=t.substring(0,a),n=t.substring(a+1);return o!==this.config.spaceId&&console.warn("file ".concat(e," does not belong to env ").concat(this.config.spaceId)),n}function vo(e=""){return"cloud://".concat(this.config.spaceId,"/").concat(e.replace(/^\/+/,""))}class fo{constructor(e){this.config=e}signedURL(e,t={}){const a=`/ws/function/${e}`,o=this.config.wsEndpoint.replace(/^ws(s)?:\/\//,""),n=Object.assign({},t,{accessKeyId:this.config.accessKey,signatureNonce:uo(),timestamp:""+Date.now()}),s=[a,["accessKeyId","authorization","signatureNonce","timestamp"].sort().map((function(e){return n[e]?"".concat(e,"=").concat(n[e]):null})).filter(Boolean).join("&"),`host:${o}`].join("\n"),i=["HMAC-SHA256",Qt(s).toString(co)].join("\n"),r=Xt(i,this.config.secretKey).toString(co),l=Object.keys(n).map((e=>`${e}=${encodeURIComponent(n[e])}`)).join("&");return`${this.config.wsEndpoint}${a}?${l}&signature=${r}`}}var wo={init:e=>{e.provider="alipay";const t=new class{constructor(e){if(["spaceId","spaceAppId","accessKey","secretKey"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),e.endpoint){if("string"!=typeof e.endpoint)throw new Error("endpoint must be string");if(!/^https:\/\//.test(e.endpoint))throw new Error("endpoint must start with https://");e.endpoint=e.endpoint.replace(/\/$/,"")}this.config=Object.assign({},e,{endpoint:e.endpoint||`https://${e.spaceId}.api-hz.cloudbasefunction.cn`,wsEndpoint:e.wsEndpoint||`wss://${e.spaceId}.api-hz.cloudbasefunction.cn`}),this._websocket=new fo(this.config)}callFunction(e){return function(e,t){const{name:a,data:o,async:n=!1,timeout:s}=e,i="POST",r={"x-to-function-name":a};n&&(r["x-function-invoke-type"]="async");const{url:l,headers:c}=mo("/functions/invokeFunction",{functionName:a,data:o,method:i,headers:r,signHeaderKeys:["x-to-function-name"],config:t});return po({url:l,data:o,method:i,headers:c,timeout:s}).then((e=>{let t=0;if(n){const a=e.data||{};t="200"===a.errCode?0:a.errCode,e.data=a.data||{},e.errMsg=a.errMsg}if(0!==t)throw new Bt({code:t,message:e.errMsg,requestId:e.requestId});return{errCode:t,success:0===t,requestId:e.requestId,result:e.data}})).catch((e=>{throw new Bt({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}(e,this.config)}uploadFileToOSS({url:e,filePath:t,fileType:a,formData:o,onUploadProgress:n}){return new Promise(((s,i)=>{const r=_t.uploadFile({url:e,filePath:t,fileType:a,formData:o,name:"file",success(e){e&&e.statusCode<400?s(e):i(new Bt({code:"UPLOAD_FAILED",message:"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))},fail(e){i(new Bt({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"}))}});"function"==typeof n&&r&&"function"==typeof r.onProgressUpdate&&r.onProgressUpdate((e=>{n({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}async uploadFile({filePath:e,cloudPath:t="",fileType:a="image",onUploadProgress:o}){if("string"!==Ge(t))throw new Bt({code:"INVALID_PARAM",message:"cloudPathå¿…é¡»ä¸ºå­—ç¬¦ä¸²ç±»å‹"});if(!(t=t.trim()))throw new Bt({code:"INVALID_PARAM",message:"cloudPathä¸å¯ä¸ºç©º"});if(/:\/\//.test(t))throw new Bt({code:"INVALID_PARAM",message:"cloudPathä¸åˆæ³•"});const n=await ho({path:"/".concat(t.replace(/^\//,""),"?post_url")},this.config),{file_id:s,upload_url:i,form_data:r}=n,l=r&&r.reduce(((e,t)=>(e[t.key]=t.value,e)),{});return this.uploadFileToOSS({url:i,filePath:e,fileType:a,formData:l,onUploadProgress:o}).then((()=>({fileID:s})))}async getTempFileURL({fileList:e}){return new Promise(((t,a)=>{(!e||e.length<0)&&t({code:"INVALID_PARAM",message:"fileListä¸èƒ½ä¸ºç©ºæ•°ç»„"}),e.length>50&&t({code:"INVALID_PARAM",message:"fileListæ•°ç»„é•¿åº¦ä¸èƒ½è¶…è¿‡50"});const o=[];for(const s of e){let e;"string"!==Ge(s)&&t({code:"INVALID_PARAM",message:"fileListçš„å…ƒç´ å¿…é¡»æ˜¯éç©ºçš„å­—ç¬¦ä¸²"});try{e=go.call(this,s)}catch(n){console.warn(n.errCode,n.errMsg),e=s}o.push({file_id:e,expire:600})}ho({path:"/?download_url",data:{file_list:o},method:"POST"},this.config).then((e=>{const{file_list:a=[]}=e;t({fileList:a.map((e=>({fileID:vo.call(this,e.file_id),tempFileURL:e.download_url})))})})).catch((e=>a(e)))}))}async connectWebSocket(e){const{name:t,query:a}=e;return _t.connectSocket({url:this._websocket.signedURL(t,a),complete:()=>{}})}}(e);return t.auth=function(){return{signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!0)}}},t}};function yo({data:e}){let t;t=Ot();const a=JSON.parse(JSON.stringify(e||{}));if(Object.assign(a,{clientInfo:t}),!a.uniIdToken){const{token:e}=At();e&&(a.uniIdToken=e)}return a}const Eo=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"ï¼Œäº‘å‡½æ•°[{functionName}]åœ¨äº‘ç«¯ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ­¤äº‘å‡½æ•°åç§°æ˜¯å¦æ­£ç¡®ä»¥åŠè¯¥äº‘å‡½æ•°æ˜¯å¦å·²ä¸Šä¼ åˆ°æœåŠ¡ç©ºé—´",mode:"append"}];var ko=/[\\^$.*+?()[\]{}|]/g,No=RegExp(ko.source);function Vo(e,t,a){return e.replace(new RegExp((o=t)&&No.test(o)?o.replace(ko,"\\$&"):o,"g"),a);var o}const Co="request",xo="response",bo="both",So="_globalUniCloudStatus",Io={code:2e4,message:"System error"},To={code:20101,message:"Invalid client"};function Do(e){const{errSubject:t,subject:a,errCode:o,errMsg:n,code:s,message:i,cause:r}=e||{};return new Bt({subject:t||a||"uni-secure-network",code:o||s||Io.code,message:n||i,cause:r})}let Bo;function _o({secretType:e}={}){return e===Co||e===xo||e===bo}function Po({name:e,data:t={}}={}){return"DCloud-clientDB"===e&&"encryption"===t.redirectTo&&"getAppClientKey"===t.action}function Ao({functionName:e,result:t,logPvd:a}){}function Uo(e){const t=e.callFunction,a=function(a){const o=a.name;a.data=yo.call(e,{data:a.data});const n={aliyun:"aliyun",tencent:"tcb",tcb:"tcb",alipay:"alipay",dcloud:"dcloud"}[this.config.provider],s=_o(a),i=Po(a),r=s||i;return t.call(this,a).then((e=>(e.errCode=0,!r&&Ao.call(this,{functionName:o,result:e,logPvd:n}),Promise.resolve(e))),(e=>(!r&&Ao.call(this,{functionName:o,result:e,logPvd:n}),e&&e.message&&(e.message=function({message:e="",extraInfo:t={},formatter:a=[]}={}){for(let o=0;o<a.length;o++){const{rule:n,content:s,mode:i}=a[o],r=e.match(n);if(!r)continue;let l=s;for(let e=1;e<r.length;e++)l=Vo(l,`{$${e}}`,r[e]);for(const e in t)l=Vo(l,`{${e}}`,t[e]);return"replace"===i?l:e+l}return e}({message:`[${a.name}]: ${e.message}`,formatter:Eo,extraInfo:{functionName:o}})),Promise.reject(e))))};e.callFunction=function(t){const{provider:o,spaceId:n}=e.config,s=t.name;let i,r;return t.data=t.data||{},i=a,i=i.bind(e),r=Po(t)?a.call(e,t):_o(t)?new Bo({secretType:t.secretType,uniCloudIns:e}).wrapEncryptDataCallFunction(a.bind(e))(t):function({provider:e,spaceId:t,functionName:a}={}){const{appId:o,uniPlatform:n,osName:s}=Lt();let i=n;"app"===n&&(i=s);const r=function({provider:e,spaceId:t}={}){const a=ot;if(!a)return{};e=function(e){return"tencent"===e?"tcb":e}(e);const o=a.find((a=>a.provider===e&&a.spaceId===t));return o&&o.config}({provider:e,spaceId:t});if(!r||!r.accessControl||!r.accessControl.enable)return!1;const l=r.accessControl.function||{},c=Object.keys(l);if(0===c.length)return!0;const d=function(e,t){let a,o,n;for(let s=0;s<e.length;s++){const i=e[s];i!==t?"*"!==i?i.split(",").map((e=>e.trim())).indexOf(t)>-1&&(o=i):n=i:a=i}return a||o||n}(c,a);if(!d)return!1;if((l[d]||[]).find(((e={})=>e.appId===o&&(e.platform||"").toLowerCase()===i.toLowerCase())))return!0;throw console.error(`æ­¤åº”ç”¨[appId: ${o}, platform: ${i}]ä¸åœ¨äº‘ç«¯é…ç½®çš„å…è®¸è®¿é—®çš„åº”ç”¨åˆ—è¡¨å†…ï¼Œå‚è€ƒï¼šhttps://uniapp.dcloud.net.cn/uniCloud/secure-network.html#verify-client`),Do(To)}({provider:o,spaceId:n,functionName:s})?new Bo({secretType:t.secretType,uniCloudIns:e}).wrapVerifyClientCallFunction(a.bind(e))(t):i(t),Object.defineProperty(r,"result",{get:()=>(console.warn("å½“å‰è¿”å›ç»“æœä¸ºPromiseç±»å‹ï¼Œä¸å¯ç›´æ¥è®¿é—®å…¶resultå±æ€§ï¼Œè¯¦æƒ…è¯·å‚è€ƒï¼šhttps://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),r.then((e=>e))}}Bo=class{constructor(){throw Do({message:"Platform app is not enabled, please check whether secure network module is enabled in your manifest.json"})}};const Mo=Symbol("CLIENT_DB_INTERNAL");function $o(e,t){return e.then="DoNotReturnProxyWithAFunctionNamedThen",e._internalType=Mo,e.inspect=null,e.__v_raw=void 0,new Proxy(e,{get(e,a,o){if("_uniClient"===a)return null;if("symbol"==typeof a)return e[a];if(a in e||"string"!=typeof a){const t=e[a];return"function"==typeof t?t.bind(e):t}return t.get(e,a,o)}})}function Lo(e){return{on:(t,a)=>{e[t]=e[t]||[],e[t].indexOf(a)>-1||e[t].push(a)},off:(t,a)=>{e[t]=e[t]||[];const o=e[t].indexOf(a);-1!==o&&e[t].splice(o,1)}}}const Fo=["db.Geo","db.command","command.aggregate"];function Ro(e,t){return Fo.indexOf(`${e}.${t}`)>-1}function Oo(e){switch(Ge(e=Pt(e))){case"array":return e.map((e=>Oo(e)));case"object":return e._internalType===Mo||Object.keys(e).forEach((t=>{e[t]=Oo(e[t])})),e;case"regexp":return{$regexp:{source:e.source,flags:e.flags}};case"date":return{$date:e.toISOString()};default:return e}}function jo(e){return e&&e.content&&e.content.$method}class zo{constructor(e,t,a){this.content=e,this.prevStage=t||null,this.udb=null,this._database=a}toJSON(){let e=this;const t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map((e=>({$method:e.$method,$param:Oo(e.$param)})))}}toString(){return JSON.stringify(this.toJSON())}getAction(){const e=this.toJSON().$db.find((e=>"action"===e.$method));return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter((e=>"action"!==e.$method))}}get isAggregate(){let e=this;for(;e;){const t=jo(e),a=jo(e.prevStage);if("aggregate"===t&&"collection"===a||"pipeline"===t)return!0;e=e.prevStage}return!1}get isCommand(){let e=this;for(;e;){if("command"===jo(e))return!0;e=e.prevStage}return!1}get isAggregateCommand(){let e=this;for(;e;){const t=jo(e),a=jo(e.prevStage);if("aggregate"===t&&"command"===a)return!0;e=e.prevStage}return!1}getNextStageFn(e){const t=this;return function(){return qo({$method:e,$param:Oo(Array.from(arguments))},t,t._database)}}get count(){return this.isAggregate?this.getNextStageFn("count"):function(){return this._send("count",Array.from(arguments))}}get remove(){return this.isCommand?this.getNextStageFn("remove"):function(){return this._send("remove",Array.from(arguments))}}get(){return this._send("get",Array.from(arguments))}get add(){return this.isCommand?this.getNextStageFn("add"):function(){return this._send("add",Array.from(arguments))}}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}get set(){return this.isCommand?this.getNextStageFn("set"):function(){throw new Error("JQLç¦æ­¢ä½¿ç”¨setæ–¹æ³•")}}_send(e,t){const a=this.getAction(),o=this.getCommand();return o.$db.push({$method:e,$param:Oo(t)}),this._database._callCloudFunction({action:a,command:o})}}function qo(e,t,a){return $o(new zo(e,t,a),{get(e,t){let o="db";return e&&e.content&&(o=e.content.$method),Ro(o,t)?qo({$method:t},e,a):function(){return qo({$method:t,$param:Oo(Array.from(arguments))},e,a)}}})}function Ho({path:e,method:t}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...e.map((e=>({$method:e}))),{$method:t,$param:this.param}]}}toString(){return JSON.stringify(this.toJSON())}}}function Wo(e,t={}){return $o(new e(t),{get:(e,t)=>Ro("db",t)?qo({$method:t},null,e):function(){return qo({$method:t,$param:Oo(Array.from(arguments))},null,e)}})}class Jo extends class{constructor({uniClient:e={},isJQL:t=!1}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e._isDefault&&(this._dbCallBacks=lt("_globalUniCloudDatabaseCallback")),t||(this.auth=Lo(this._authCallBacks)),this._isJQL=t,Object.assign(this,Lo(this._dbCallBacks)),this.env=$o({},{get:(e,t)=>({$env:t})}),this.Geo=$o({},{get:(e,t)=>Ho({path:["Geo"],method:t})}),this.serverDate=Ho({path:[],method:"serverDate"}),this.RegExp=Ho({path:[],method:"RegExp"})}getCloudEnv(e){if("string"!=typeof e||!e.trim())throw new Error("getCloudEnvå‚æ•°é”™è¯¯");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){const a=this._dbCallBacks;a[e]&&a[e].forEach((e=>{e(...t)}))}_callbackAuth(e,t){const a=this._authCallBacks;a[e]&&a[e].forEach((e=>{e(...t)}))}multiSend(){const e=Array.from(arguments),t=e.map((e=>{const t=e.getAction(),a=e.getCommand();if("getTemp"!==a.$db[a.$db.length-1].$method)throw new Error("multiSendåªæ”¯æŒå­å‘½ä»¤å†…ä½¿ç”¨getTemp");return{action:t,command:a}}));return this._callCloudFunction({multiCommand:t,queryList:e})}}{_parseResult(e){return this._isJQL?e.result:e}_callCloudFunction({action:e,command:t,multiCommand:a,queryList:o}){function n(e,t){if(a&&o)for(let a=0;a<o.length;a++){const n=o[a];n.udb&&"function"==typeof n.udb.setResult&&(t?n.udb.setResult(t):n.udb.setResult(e.result.dataList[a]))}}const s=this,i=this._isJQL?"databaseForJQL":"database";function r(e){return s._callback("error",[e]),pt(ht(i,"fail"),e).then((()=>pt(ht(i,"complete"),e))).then((()=>(n(null,e),bt(ft,{type:Et,content:e}),Promise.reject(e))))}const l=pt(ht(i,"invoke")),c=this._uniClient;return l.then((()=>c.callFunction({name:"DCloud-clientDB",type:We,data:{action:e,command:t,multiCommand:a}}))).then((e=>{const{code:t,message:a,token:o,tokenExpired:l,systemInfo:c=[]}=e.result;if(c)for(let n=0;n<c.length;n++){const{level:e,message:t,detail:a}=c[n];let o="[System Info]"+t;a&&(o=`${o}\nè¯¦ç»†ä¿¡æ¯ï¼š${a}`),(console["warn"===e?"error":e]||console.log)(o)}if(t)return r(new Bt({code:t,message:a,requestId:e.requestId}));e.result.errCode=e.result.errCode||e.result.code,e.result.errMsg=e.result.errMsg||e.result.message,o&&l&&(Ut({token:o,tokenExpired:l}),this._callbackAuth("refreshToken",[{token:o,tokenExpired:l}]),this._callback("refreshToken",[{token:o,tokenExpired:l}]),bt(yt,{token:o,tokenExpired:l}));const d=[{prop:"affectedDocs",tips:"affectedDocsä¸å†æ¨èä½¿ç”¨ï¼Œè¯·ä½¿ç”¨inserted/deleted/updated/data.lengthæ›¿ä»£"},{prop:"code",tips:"codeä¸å†æ¨èä½¿ç”¨ï¼Œè¯·ä½¿ç”¨errCodeæ›¿ä»£"},{prop:"message",tips:"messageä¸å†æ¨èä½¿ç”¨ï¼Œè¯·ä½¿ç”¨errMsgæ›¿ä»£"}];for(let n=0;n<d.length;n++){const{prop:t,tips:a}=d[n];if(t in e.result){const o=e.result[t];Object.defineProperty(e.result,t,{get:()=>(console.warn(a),o)})}}return u=e,pt(ht(i,"success"),u).then((()=>pt(ht(i,"complete"),u))).then((()=>{n(u,null);const e=s._parseResult(u);return bt(ft,{type:Et,content:e}),Promise.resolve(e)}));var u}),(e=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(e.message)&&console.warn("clientDBæœªåˆå§‹åŒ–ï¼Œè¯·åœ¨webæ§åˆ¶å°ä¿å­˜ä¸€æ¬¡schemaä»¥å¼€å¯clientDB"),r(new Bt({code:e.code||"SYSTEM_ERROR",message:e.message,requestId:e.requestId})))))}}const Ko="tokenæ— æ•ˆï¼Œè·³è½¬ç™»å½•é¡µé¢",Go="tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•é¡µé¢",Yo={TOKEN_INVALID_TOKEN_EXPIRED:Go,TOKEN_INVALID_INVALID_CLIENTID:Ko,TOKEN_INVALID:Ko,TOKEN_INVALID_WRONG_TOKEN:Ko,TOKEN_INVALID_ANONYMOUS_USER:Ko},Qo={"uni-id-token-expired":Go,"uni-id-check-token-failed":Ko,"uni-id-token-not-exist":Ko,"uni-id-check-device-feature-failed":Ko},Xo={...Yo,...Qo,default:"ç”¨æˆ·æœªç™»å½•æˆ–ç™»å½•çŠ¶æ€è¿‡æœŸï¼Œè‡ªåŠ¨è·³è½¬ç™»å½•é¡µé¢"};function Zo(e,t){let a="";return a=e?`${e}/${t}`:t,a.replace(/^\//,"")}function en(e=[],t=""){const a=[],o=[];return e.forEach((e=>{!0===e.needLogin?a.push(Zo(t,e.path)):!1===e.needLogin&&o.push(Zo(t,e.path))})),{needLoginPage:a,notNeedLoginPage:o}}function tn(e){return e.split("?")[0].replace(/^\//,"")}function an(){return function(e){let t=e&&e.$page&&e.$page.fullPath;return t?("/"!==t.charAt(0)&&(t="/"+t),t):""}(function(){const e=getCurrentPages();return e[e.length-1]}())}function on(){return tn(an())}function nn(e="",t={}){if(!e)return!1;if(!(t&&t.list&&t.list.length))return!1;const a=t.list,o=tn(e);return a.some((e=>e.pagePath===o))}const sn=!!Ue.uniIdRouter,{loginPage:rn,routerNeedLogin:ln,resToLogin:cn,needLoginPage:dn,notNeedLoginPage:un,loginPageInTabBar:mn}=function({pages:e=[],subPackages:t=[],uniIdRouter:a={},tabBar:o={}}=Ue){const{loginPage:n,needLogin:s=[],resToLogin:i=!0}=a,{needLoginPage:r,notNeedLoginPage:l}=en(e),{needLoginPage:c,notNeedLoginPage:d}=function(e=[]){const t=[],a=[];return e.forEach((e=>{const{root:o,pages:n=[]}=e,{needLoginPage:s,notNeedLoginPage:i}=en(n,o);t.push(...s),a.push(...i)})),{needLoginPage:t,notNeedLoginPage:a}}(t);return{loginPage:n,routerNeedLogin:s,resToLogin:i,needLoginPage:[...r,...c],notNeedLoginPage:[...l,...d],loginPageInTabBar:nn(n,o)}}();if(dn.indexOf(rn)>-1)throw new Error(`Login page [${rn}] should not be "needLogin", please check your pages.json`);function pn(e){const t=on();if("/"===e.charAt(0))return e;const[a,o]=e.split("?"),n=a.replace(/^\//,"").split("/"),s=t.split("/");s.pop();for(let i=0;i<n.length;i++){const e=n[i];".."===e?s.pop():"."!==e&&s.push(e)}return""===s[0]&&s.shift(),"/"+s.join("/")+(o?"?"+o:"")}function hn({redirect:e}){const t=tn(e),a=tn(rn);return on()!==a&&t!==a}function gn({api:e,redirect:t}={}){if(!t||!hn({redirect:t}))return;const a=(n=t,"/"!==(o=rn).charAt(0)&&(o="/"+o),n?o.indexOf("?")>-1?o+`&uniIdRedirectUrl=${encodeURIComponent(n)}`:o+`?uniIdRedirectUrl=${encodeURIComponent(n)}`:o);var o,n;mn?"navigateTo"!==e&&"redirectTo"!==e||(e="switchTab"):"switchTab"===e&&(e="navigateTo");const s={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,switchTab:uni.switchTab,reLaunch:uni.reLaunch};setTimeout((()=>{s[e]({url:a})}),0)}function vn({url:e}={}){const t={abortLoginPageJump:!1,autoToLoginPage:!1},a=function(){const{token:e,tokenExpired:t}=At();let a;if(e){if(t<Date.now()){const e="uni-id-token-expired";a={errCode:e,errMsg:Xo[e]}}}else{const e="uni-id-check-token-failed";a={errCode:e,errMsg:Xo[e]}}return a}();if(function(e){const t=tn(pn(e));return!(un.indexOf(t)>-1)&&(dn.indexOf(t)>-1||ln.some((t=>{return a=e,new RegExp(t).test(a);var a})))}(e)&&a){if(a.uniIdRedirectUrl=e,Vt(wt).length>0)return setTimeout((()=>{bt(wt,a)}),0),t.abortLoginPageJump=!0,t;t.autoToLoginPage=!0}return t}function fn(){!function(){const e=an(),{abortLoginPageJump:t,autoToLoginPage:a}=vn({url:e});t||a&&gn({api:"redirectTo",redirect:e})}();const e=["navigateTo","redirectTo","reLaunch","switchTab"];for(let t=0;t<e.length;t++){const a=e[t];uni.addInterceptor(a,{invoke(e){const{abortLoginPageJump:t,autoToLoginPage:o}=vn({url:e.url});return t?e:o?(gn({api:a,redirect:pn(e.url)}),!1):e}})}}function wn(){this.onResponse((e=>{const{type:t,content:a}=e;let o=!1;switch(t){case"cloudobject":o=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in Xo}(a);break;case"clientdb":o=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in Yo}(a)}o&&function(e={}){const t=Vt(wt);Tt().then((()=>{const a=an();if(a&&hn({redirect:a}))return t.length>0?bt(wt,Object.assign({uniIdRedirectUrl:a},e)):void(rn&&gn({api:"navigateTo",redirect:a}))}))}(a)}))}function yn(e){var t;(t=e).onResponse=function(e){Ct(ft,e)},t.offResponse=function(e){xt(ft,e)},function(e){e.onNeedLogin=function(e){Ct(wt,e)},e.offNeedLogin=function(e){xt(wt,e)},sn&&(lt(So).needLoginInit||(lt(So).needLoginInit=!0,Tt().then((()=>{fn.call(e)})),cn&&wn.call(e)))}(e),function(e){e.onRefreshToken=function(e){Ct(yt,e)},e.offRefreshToken=function(e){xt(yt,e)}}(e)}let En;const kn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Nn=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function Vn(){const e=At().token||"",t=e.split(".");if(!e||3!==t.length)return{uid:null,role:[],permission:[],tokenExpired:0};let a;try{a=JSON.parse((o=t[1],decodeURIComponent(En(o).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(n){throw new Error("è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯å‡ºé”™ï¼Œè¯¦ç»†é”™è¯¯ä¿¡æ¯ä¸ºï¼š"+n.message)}var o;return a.tokenExpired=1e3*a.exp,delete a.exp,delete a.iat,a}En="function"!=typeof atob?function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!Nn.test(e))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var a,o,n="",s=0;s<e.length;)t=kn.indexOf(e.charAt(s++))<<18|kn.indexOf(e.charAt(s++))<<12|(a=kn.indexOf(e.charAt(s++)))<<6|(o=kn.indexOf(e.charAt(s++))),n+=64===a?String.fromCharCode(t>>16&255):64===o?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return n}:atob;var Cn=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Me((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const a="chooseAndUploadFile:ok",o="chooseAndUploadFile:fail";function n(e,t){return e.tempFiles.forEach(((e,a)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+a+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function s(e,t,{onChooseFile:o,onUploadProgress:n}){return t.then((e=>{if(o){const t=o(e);if(void 0!==t)return Promise.resolve(t).then((t=>void 0===t?e:t))}return e})).then((t=>!1===t?{errMsg:a,tempFilePaths:[],tempFiles:[]}:function(e,t,o=5,n){(t=Object.assign({},t)).errMsg=a;const s=t.tempFiles,i=s.length;let r=0;return new Promise((a=>{for(;r<o;)l();function l(){const o=r++;if(o>=i)return void(!s.find((e=>!e.url&&!e.errMsg))&&a(t));const c=s[o];e.uploadFile({provider:c.provider,filePath:c.path,cloudPath:c.cloudPath,fileType:c.fileType,cloudPathAsRealPath:c.cloudPathAsRealPath,onUploadProgress(e){e.index=o,e.tempFile=c,e.tempFilePath=c.path,n&&n(e)}}).then((e=>{c.url=e.fileID,o<i&&l()})).catch((e=>{c.errMsg=e.errMsg||e.message,o<i&&l()}))}}))}(e,t,5,n)))}t.initChooseAndUploadFile=function(e){return function(t={type:"all"}){return"image"===t.type?s(e,function(e){const{count:t,sizeType:a,sourceType:s=["album","camera"],extension:i}=e;return new Promise(((e,r)=>{uni.chooseImage({count:t,sizeType:a,sourceType:s,extension:i,success(t){e(n(t,"image"))},fail(e){r({errMsg:e.errMsg.replace("chooseImage:fail",o)})}})}))}(t),t):"video"===t.type?s(e,function(e){const{camera:t,compressed:a,maxDuration:s,sourceType:i=["album","camera"],extension:r}=e;return new Promise(((e,l)=>{uni.chooseVideo({camera:t,compressed:a,maxDuration:s,sourceType:i,extension:r,success(t){const{tempFilePath:a,duration:o,size:s,height:i,width:r}=t;e(n({errMsg:"chooseVideo:ok",tempFilePaths:[a],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:a,size:s,type:t.tempFile&&t.tempFile.type||"",width:r,height:i,duration:o,fileType:"video",cloudPath:""}]},"video"))},fail(e){l({errMsg:e.errMsg.replace("chooseVideo:fail",o)})}})}))}(t),t):s(e,function(e){const{count:t,extension:a}=e;return new Promise(((e,s)=>{let i=uni.chooseFile;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(i=wx.chooseMessageFile),"function"!=typeof i)return s({errMsg:o+" è¯·æŒ‡å®š type ç±»å‹ï¼Œè¯¥å¹³å°ä»…æ”¯æŒé€‰æ‹© image æˆ– videoã€‚"});i({type:"all",count:t,extension:a,success(t){e(n(t))},fail(e){s({errMsg:e.errMsg.replace("chooseFile:fail",o)})}})}))}(t),t)}}})));const xn="manual";function bn(e){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{},mixinDatacomError:null}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach((t=>{e.push(this[t])})),e}),((e,t)=>{if(this.loadtime===xn)return;let a=!1;const o=[];for(let n=2;n<e.length;n++)e[n]!==t[n]&&(o.push(e[n]),a=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(a,o)}))},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:a}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomError=null,this.mixinDatacomGet().then((a=>{this.mixinDatacomLoading=!1;const{data:o,count:n}=a.result;this.getcount&&(this.mixinDatacomPage.count=n),this.mixinDatacomHasMore=o.length<this.pageSize;const s=e?o.length?o[0]:void 0:o;this.mixinDatacomResData=s,t&&t(s)})).catch((e=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=e,this.mixinDatacomError=e,a&&a(e)})))},mixinDatacomGet(t={}){let a;t=t||{},a="undefined"!=typeof __uniX&&__uniX?e.databaseForJQL(this.spaceInfo):e.database(this.spaceInfo);const o=t.action||this.action;o&&(a=a.action(o));const n=t.collection||this.collection;a=Array.isArray(n)?a.collection(...n):a.collection(n);const s=t.where||this.where;s&&Object.keys(s).length&&(a=a.where(s));const i=t.field||this.field;i&&(a=a.field(i));const r=t.foreignKey||this.foreignKey;r&&(a=a.foreignKey(r));const l=t.groupby||this.groupby;l&&(a=a.groupBy(l));const c=t.groupField||this.groupField;c&&(a=a.groupField(c)),!0===(void 0!==t.distinct?t.distinct:this.distinct)&&(a=a.distinct());const d=t.orderby||this.orderby;d&&(a=a.orderBy(d));const u=void 0!==t.pageCurrent?t.pageCurrent:this.mixinDatacomPage.current,m=void 0!==t.pageSize?t.pageSize:this.mixinDatacomPage.size,p=void 0!==t.getcount?t.getcount:this.getcount,h=void 0!==t.gettree?t.gettree:this.gettree,g=void 0!==t.gettreepath?t.gettreepath:this.gettreepath,v={getCount:p},f={limitLevel:void 0!==t.limitlevel?t.limitlevel:this.limitlevel,startWith:void 0!==t.startwith?t.startwith:this.startwith};return h&&(v.getTree=f),g&&(v.getTreePath=f),a=a.skip(m*(u-1)).limit(m).get(v),a}}}}function Sn(e){return lt("_globalUniCloudSecureNetworkCache__{spaceId}".replace("{spaceId}",e.config.spaceId))}async function In({openid:e,callLoginByWeixin:t=!1}={}){throw Sn(this),new Error("[SecureNetwork] API `initSecureNetworkByWeixin` is not supported on platform `app`")}async function Tn(e){const t=Sn(this);return t.initPromise||(t.initPromise=In.call(this,e).then((e=>e)).catch((e=>{throw delete t.initPromise,e}))),t.initPromise}function Dn(e){Rt=e}function Bn(e){const t={getAppBaseInfo:uni.getSystemInfo,getPushClientId:uni.getPushClientId};return function(a){return new Promise(((o,n)=>{t[e]({...a,success(e){o(e)},fail(e){n(e)}})}))}}class _n extends class{constructor(){this._callback={}}addListener(e,t){this._callback[e]||(this._callback[e]=[]),this._callback[e].push(t)}on(e,t){return this.addListener(e,t)}removeListener(e,t){if(!t)throw new Error('The "listener" argument must be of type function. Received undefined');const a=this._callback[e];if(!a)return;const o=function(e,t){for(let a=e.length-1;a>=0;a--)if(e[a]===t)return a;return-1}(a,t);a.splice(o,1)}off(e,t){return this.removeListener(e,t)}removeAllListener(e){delete this._callback[e]}emit(e,...t){const a=this._callback[e];if(a)for(let o=0;o<a.length;o++)a[o](...t)}}{constructor(){super(),this._uniPushMessageCallback=this._receivePushMessage.bind(this),this._currentMessageId=-1,this._payloadQueue=[]}init(){return Promise.all([Bn("getAppBaseInfo")(),Bn("getPushClientId")()]).then((([{appId:e}={},{cid:t}={}]=[])=>{if(!e)throw new Error("Invalid appId, please check the manifest.json file");if(!t)throw new Error("Invalid push client id");this._appId=e,this._pushClientId=t,this._seqId=Date.now()+"-"+Math.floor(9e5*Math.random()+1e5),this.emit("open"),this._initMessageListener()}),(e=>{throw this.emit("error",e),this.close(),e}))}async open(){return this.init()}_isUniCloudSSE(e){if("receive"!==e.type)return!1;const t=e&&e.data&&e.data.payload;return!(!t||"UNI_CLOUD_SSE"!==t.channel||t.seqId!==this._seqId)}_receivePushMessage(e){if(!this._isUniCloudSSE(e))return;const t=e&&e.data&&e.data.payload,{action:a,messageId:o,message:n}=t;this._payloadQueue.push({action:a,messageId:o,message:n}),this._consumMessage()}_consumMessage(){for(;;){const e=this._payloadQueue.find((e=>e.messageId===this._currentMessageId+1));if(!e)break;this._currentMessageId++,this._parseMessagePayload(e)}}_parseMessagePayload(e){const{action:t,messageId:a,message:o}=e;"end"===t?this._end({messageId:a,message:o}):"message"===t&&this._appendMessage({messageId:a,message:o})}_appendMessage({messageId:e,message:t}={}){this.emit("message",t)}_end({messageId:e,message:t}={}){this.emit("end",t),this.close()}_initMessageListener(){uni.onPushMessage(this._uniPushMessageCallback)}_destroy(){uni.offPushMessage(this._uniPushMessageCallback)}toJSON(){return{appId:this._appId,pushClientId:this._pushClientId,seqId:this._seqId}}close(){this._destroy(),this.emit("close")}}const Pn={tcb:so,tencent:so,aliyun:Ht,private:lo,dcloud:lo,alipay:wo};let An=new class{init(e){let t={};const a=Pn[e.provider];if(!a)throw new Error("æœªæä¾›æ­£ç¡®çš„providerå‚æ•°");var o;return t=a.init(e),function(e){e._initPromiseHub||(e._initPromiseHub=new tt({createPromise:function(){let t=Promise.resolve();t=new Promise((e=>{setTimeout((()=>{e()}),1)}));const a=e.auth();return t.then((()=>a.getLoginState())).then((e=>e?Promise.resolve():a.signInAnonymously()))}}))}(t),Uo(t),function(e){const t=e.uploadFile;e.uploadFile=function(e){return t.call(this,e)}}(t),(o=t).database=function(e){if(e&&Object.keys(e).length>0)return o.init(e).database();if(this._database)return this._database;const t=Wo(Jo,{uniClient:o});return this._database=t,t},o.databaseForJQL=function(e){if(e&&Object.keys(e).length>0)return o.init(e).databaseForJQL();if(this._databaseForJQL)return this._databaseForJQL;const t=Wo(Jo,{uniClient:o,isJQL:!0});return this._databaseForJQL=t,t},function(e){e.getCurrentUserInfo=Vn,e.chooseAndUploadFile=Cn.initChooseAndUploadFile(e),Object.assign(e,{get mixinDatacom(){return bn(e)}}),e.SSEChannel=_n,e.initSecureNetworkByWeixin=function(e){return function({openid:t,callLoginByWeixin:a=!1}={}){return Tn.call(e,{openid:t,callLoginByWeixin:a})}}(e),e.setCustomClientInfo=Dn,e.importObject=function(t){return function(a,o={}){o=function(e,t={}){return e.customUI=t.customUI||e.customUI,e.parseSystemError=t.parseSystemError||e.parseSystemError,Object.assign(e.loadingOptions,t.loadingOptions),Object.assign(e.errorOptions,t.errorOptions),"object"==typeof t.secretMethods&&(e.secretMethods=t.secretMethods),e}({customUI:!1,loadingOptions:{title:"åŠ è½½ä¸­...",mask:!0},errorOptions:{type:"modal",retry:!1}},o);const{customUI:n,loadingOptions:s,errorOptions:i,parseSystemError:r}=o,l=!n;return new Proxy({},{get(n,c){switch(c){case"toString":return"[object UniCloudObject]";case"toJSON":return{}}return function({fn:e,interceptorName:t,getCallbackArgs:a}={}){return async function(...o){const n=a?a({params:o}):{};let s,i;try{return await pt(ht(t,"invoke"),{...n}),s=await e(...o),await pt(ht(t,"success"),{...n,result:s}),s}catch(r){throw i=r,await pt(ht(t,"fail"),{...n,error:i}),i}finally{await pt(ht(t,"complete"),i?{...n,error:i}:{...n,result:s})}}}({fn:async function n(...d){let u;l&&uni.showLoading({title:s.title,mask:s.mask});const m={name:a,type:He,data:{method:c,params:d}};"object"==typeof o.secretMethods&&function(e,t){const a=t.data.method,o=e.secretMethods||{},n=o[a]||o["*"];n&&(t.secretType=n)}(o,m);let p=!1;try{u=await t.callFunction(m)}catch(e){p=!0,u={result:new Bt(e)}}const{errSubject:h,errCode:g,errMsg:v,newToken:f}=u.result||{};if(l&&uni.hideLoading(),f&&f.token&&f.tokenExpired&&(Ut(f),bt(yt,{...f})),g){let e=v;if(p&&r&&(e=(await r({objectName:a,methodName:c,params:d,errSubject:h,errCode:g,errMsg:v})).errMsg||v),l)if("toast"===i.type)uni.showToast({title:e,icon:"none"});else{if("modal"!==i.type)throw new Error(`Invalid errorOptions.type: ${i.type}`);{const{confirm:t}=await async function({title:e,content:t,showCancel:a,cancelText:o,confirmText:n}={}){return new Promise(((s,i)=>{uni.showModal({title:e,content:t,showCancel:a,cancelText:o,confirmText:n,success(e){s(e)},fail(){s({confirm:!1,cancel:!0})}})}))}({title:"æç¤º",content:e,showCancel:i.retry,cancelText:"å–æ¶ˆ",confirmText:i.retry?"é‡è¯•":"ç¡®å®š"});if(i.retry&&t)return n(...d)}}const t=new Bt({subject:h,code:g,message:v,requestId:u.requestId});throw t.detail=u.result,bt(ft,{type:Nt,content:t}),t}return bt(ft,{type:Nt,content:u.result}),u.result},interceptorName:"callObject",getCallbackArgs:function({params:e}={}){return{objectName:a,methodName:c,params:e}}})}})}}(e)}(t),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach((e=>{if(!t[e])return;const a=t[e];t[e]=function(){return a.apply(t,Array.from(arguments))},t[e]=function(e,t){return function(a){let o=!1;if("callFunction"===t){const e=a&&a.type||qe;o=e!==qe}const n="callFunction"===t&&!o,s=this._initPromiseHub.exec();a=a||{};const{success:i,fail:r,complete:l}=Dt(a),c=s.then((()=>o?Promise.resolve():pt(ht(t,"invoke"),a))).then((()=>e.call(this,a))).then((e=>o?Promise.resolve(e):pt(ht(t,"success"),e).then((()=>pt(ht(t,"complete"),e))).then((()=>(n&&bt(ft,{type:kt,content:e}),Promise.resolve(e))))),(e=>o?Promise.reject(e):pt(ht(t,"fail"),e).then((()=>pt(ht(t,"complete"),e))).then((()=>(bt(ft,{type:kt,content:e}),Promise.reject(e))))));if(!(i||r||l))return c;c.then((e=>{i&&i(e),l&&l(e),n&&bt(ft,{type:kt,content:e})}),(e=>{r&&r(e),l&&l(e),n&&bt(ft,{type:kt,content:e})}))}}(t[e],e).bind(t)})),t.init=this.init,t}};(()=>{const e=nt;let t={};if(e&&1===e.length)t=e[0],An=An.init(t),An._isDefault=!0;else{const t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile"],a=["database","getCurrentUserInfo","importObject"];let o;o=e&&e.length>0?"åº”ç”¨æœ‰å¤šä¸ªæœåŠ¡ç©ºé—´ï¼Œè¯·é€šè¿‡uniCloud.initæ–¹æ³•æŒ‡å®šè¦ä½¿ç”¨çš„æœåŠ¡ç©ºé—´":"åº”ç”¨æœªå…³è”æœåŠ¡ç©ºé—´ï¼Œè¯·åœ¨uniCloudç›®å½•å³é”®å…³è”æœåŠ¡ç©ºé—´",[...t,...a].forEach((e=>{An[e]=function(){if(console.error(o),-1===a.indexOf(e))return Promise.reject(new Bt({code:"SYS_ERR",message:o}));console.error(o)}}))}Object.assign(An,{get mixinDatacom(){return bn(An)}}),yn(An),An.addInterceptor=ut,An.removeInterceptor=mt,An.interceptObject=gt,uni.__uniCloud=An;{const e=it||(it=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;function e(){return this}return void 0!==e()?e():new Function("return this")()}(),it);e.uniCloud=An,e.UniCloudError=Bt}})();var Un=An;const Mn={univerify:{fullScreen:!0,authButton:{normalColor:"#3478F6",highlightColor:"#2861C5",textColor:"#FFFFFF",title:"æœ¬æœºå·ç ä¸€é”®ç™»å½•",borderRadius:"24px"},otherLoginButton:{visible:!0,title:"å…¶ä»–æ–¹å¼ç™»å½•",bgColor:"rgba(0,0,0,0)"},privacyTerms:{defaultCheckBoxState:!0,termsColor:"#666666",termsUnderlineColor:"#3478F6",buttonsColor:"#3478F6",privacyItems:[{title:"ã€Šç”¨æˆ·åè®®ã€‹",url:"https://www.example.com/agreement"},{title:"ã€Šéšç§æ”¿ç­–ã€‹",url:"https://www.example.com/privacy"}]}},serverVerify:{enable:!0,type:"http",functionName:"",http:{url:"https://fc-mp-7a43517d-d8d4-4fa6-bf16-36b1c3fe2485.next.bspapp.com/getNumber",method:"POST",headers:{"content-type":"application/json"},extraData:{}}}},$n=e=>"[object Object]"===Object.prototype.toString.call(e),Ln=(e={},t={})=>{const a={...e};return Object.keys(t||{}).forEach((e=>{const o=t[e];$n(o)?a[e]=Ln($n(a[e])?a[e]:{},o):a[e]=o})),a},Fn=()=>{try{"undefined"!=typeof uni&&"function"==typeof uni.closeAuthView&&uni.closeAuthView()}catch(e){t("warn","at services/oneclick/oneClickLogin.js:25","[oneclick] closeAuthView failed",e)}},Rn=(...e)=>e.find((e=>!!e&&(!("string"!=typeof e||!e.trim())||"number"==typeof e))),On=()=>(null==Mn?void 0:Mn.serverVerify)||{},jn=async(e={})=>{if(!On().enable){const t=((e={})=>{var t,a;return Rn(null==e?void 0:e.phoneNumber,null==e?void 0:e.phone,null==e?void 0:e.mobile,null==e?void 0:e.tel,null==(t=null==e?void 0:e.data)?void 0:t.phoneNumber,null==(a=null==e?void 0:e.data)?void 0:a.phone)})(e);if(!t)throw new Error("æœªä» DCloud univerify è¿”å›æ‰‹æœºå·ï¼Œè¯·åœ¨æ§åˆ¶å°å¼€å¯â€œç›´æ¥è¿”å›æ‰‹æœºå·â€æˆ–åœ¨ ONECLICK_CONFIG.serverVerify ä¸­å¼€å¯æœåŠ¡å™¨æ ¡éªŒ");return String(t)}if(!(null==e?void 0:e.access_token)||!(null==e?void 0:e.openid))throw new Error("è¿è¥å•†æœªè¿”å› access_token/openidï¼Œæ— æ³•é€šè¿‡äº‘å‡½æ•°æ ¡éªŒ");const t="http"===On().type?await(async e=>{var t,a,o,n;const s=On().http||{};if(!s.url)throw new Error("æœªé…ç½® serverVerify.http.urlï¼Œæ— æ³•å‘èµ·éªŒè¯è¯·æ±‚");const[i,r]=await uni.request({url:s.url,method:s.method||"POST",header:Object.assign({"content-type":"application/json"},s.headers||{}),data:Object.assign({access_token:null==e?void 0:e.access_token,openid:null==e?void 0:e.openid},s.extraData||{})}).then((e=>[null,e])).catch((e=>[e,null]));if(i)throw i;const{data:l}=r||{};return Rn(null==l?void 0:l.phoneNumber,null==(t=null==l?void 0:l.data)?void 0:t.phoneNumber,null==(o=null==(a=null==l?void 0:l.data)?void 0:a.data)?void 0:o.phoneNumber,null==(n=null==l?void 0:l.result)?void 0:n.phoneNumber)})(e):await(async e=>{var t,a,o,n,s,i;const r=On();if(!r.functionName)throw new Error("æœªé…ç½® serverVerify.functionNameï¼Œæ— æ³•è°ƒç”¨ uniCloud äº‘å‡½æ•°");if(void 0===Un||"function"!=typeof Un.callFunction)throw new Error("å½“å‰å·¥ç¨‹æœªå¯ç”¨ uniCloudï¼Œæ— æ³•å®ŒæˆæœåŠ¡å™¨æ ¡éªŒ");const l=await Un.callFunction({name:r.functionName,data:{access_token:null==e?void 0:e.access_token,openid:null==e?void 0:e.openid,...r.extraData||{}}}),c=(null==l?void 0:l.result)||{};if(0!==c.code&&0!==c.errCode)throw new Error(c.message||"äº‘å‡½æ•°è¿”å›å¤±è´¥");return Rn(null==(t=null==c?void 0:c.data)?void 0:t.phoneNumber,null==(o=null==(a=null==c?void 0:c.data)?void 0:a.data)?void 0:o.phoneNumber,null==(i=null==(s=null==(n=null==c?void 0:c.data)?void 0:n.data)?void 0:s.data)?void 0:i.phoneNumber,null==c?void 0:c.phoneNumber)})(e);if(!t)throw new Error("æœåŠ¡å™¨æ ¡éªŒæˆåŠŸä½†æœªè¿”å›æ‰‹æœºå·ï¼Œè¯·æ£€æŸ¥äº‘å‡½æ•°/æ¥å£çš„è¿”å›æ•°æ®ç»“æ„");return String(t)},zn=async({onStatus:e,univerifyStyle:a}={})=>{try{await new Promise(((e,a)=>{uni.preLogin({provider:"univerify",success:e,fail:e=>{t("warn","at services/oneclick/oneClickLogin.js:72","[oneclick] preLogin failed",e),a(e)}})}))}catch(n){}const o=Ln((null==Mn?void 0:Mn.univerify)||{},a||{});return new Promise(((a,s)=>{uni.login({provider:"univerify",univerifyStyle:o,success:async o=>{const i=(null==o?void 0:o.authResult)||{};if("function"==typeof e)try{e({stage:"univerify:success",payload:i})}catch(r){t("warn","at services/oneclick/oneClickLogin.js:211","[oneclick] onStatus error",r)}try{const e=await jn(i);t("log","at services/oneclick/oneClickLogin.js:217","[oneclick] obtained phone from univerify/server:",e);const o=await(async e=>{var a,o,n;t("log","at services/oneclick/oneClickLogin.js:30","[oneclick] requesting backend /login/onekey with phone:",e);const s=await Pe({url:"/login/onekey",method:"POST",data:{phone:e},needAuth:!1,showLoading:!1,showError:!1}),i=(null==s?void 0:s.token)||(null==(a=null==s?void 0:s.data)?void 0:a.token)||(null==(o=null==s?void 0:s.result)?void 0:o.token)||(null==(n=null==s?void 0:s.raw)?void 0:n.token),r=$n(null==s?void 0:s.data)&&s.data||$n(null==s?void 0:s.result)&&s.result||(null==s?void 0:s.user)||(null==s?void 0:s.profile)||s,l={success:(null==s?void 0:s.success)??0===(null==s?void 0:s.code)??"ok"===(null==s?void 0:s.status),token:i,data:r,message:(null==s?void 0:s.message)||(null==s?void 0:s.msg)||(null==s?void 0:s.errorMsg)||(null==s?void 0:s.error),raw:s};return t("log","at services/oneclick/oneClickLogin.js:61","[oneclick] backend /login/onekey response:",l),l})(e);if(!(null==o?void 0:o.success))throw new Error((null==o?void 0:o.message)||"åå°ç™»å½•å¤±è´¥");Fn(),a(o)}catch(n){Fn(),s(n instanceof Error?n:new Error((null==n?void 0:n.msg)||"ä¸€é”®ç™»å½•å¤±è´¥"))}},fail:e=>{Fn(),s(e instanceof Error?e:new Error((null==e?void 0:e.errMsg)||"ä¸€é”®ç™»å½•å¤±è´¥"))}})}))},qn={data:()=>({wv:null,lastTime:"",defaultConfig:{clientVersion:"uniapp-v1.0",clientType:uni.getSystemInfoSync().platform,protocol:"http://",mi:{geeid:{bd:"",d:"",e:"",fp:"",ts:"",ver:"",client_type:""},packageName:"",displayName:"",appVer:"",build:"",clientVersion:"",process_id:"",process_id_test:"",zid:""}}}),props:{config:{type:Object,default:function(){return{}}}},methods:{showCaptcha(){const e=this;!function(e){if("function"==typeof Object.assign)return Object.assign.apply(Object,arguments);if(null==e)throw new Error("Cannot convert undefined or null to object");const t=Object(e);for(let a=1;a<arguments.length;a++){const e=arguments[a];if(null!==e)for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}}(this.defaultConfig,this.config,{challenge:this.getUuid()}),this.wv=plus.webview.create(`hybrid/html/captcha4/index.html?data=${encodeURIComponent(JSON.stringify(this.defaultConfig))}`,"gt_webview",{background:"transparent",width:"100%",height:"100%"});this.$root.$scope.$getAppWebview().append(this.wv),plus.globalEvent.addEventListener("plusMessage",(t=>{const a=t.data.args.data;if("postMessage"===a.name){if(a.arg.time===e.lastTime)return;switch(e.lastTime=a.arg.time,a.arg.type){case"ready":e.captchaReady();break;case"error":e.captchaError(a.arg.data);break;case"fail":e.captchaFail();break;case"close":e.captchaClose();break;case"result":e.captchaSuccess(a.arg.data)}}})),this.wv.overrideUrlLoading({mode:"reject"},(e=>{plus.runtime.openURL(e.url)}))},captchaReady(){this.$emit("captchaReady"),this.wv.evalJS("jsBridge.callback('showBox')")},captchaSuccess(e){this.$emit("captchaSuccess",e),this.wv.hide()},captchaClose(){this.$emit("captchaClose"),this.wv.hide()},captchaError(e){uni.showToast({title:JSON.stringify(e),icon:"none",duration:2e3}),this.$emit("captchaError",e),this.wv.hide()},captchaFail(){this.$emit("captchaFail")},getUuid:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}};const Hn=s(qn,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"geetest_component"})}]]),Wn="409ff4b182c43e02ca3c5fb3ea85a4f2",Jn={__name:"login",setup(a){const o=e.ref("account"),n=e.ref(!1),s=e.ref(!1),i=e.ref(""),r=e.ref(""),l=e.ref({username:"",password:""}),c=e.ref({phone:"",code:"",outId:""}),d=e.ref({username:"",password:""}),u=e.ref(!1),m=e.ref(!1),p=e.ref(!1),h=e.ref(0),g=e.ref(null),v=e.ref({captchaId:Wn,product:"bind",protocol:"https://"}),f=e.ref(null),w=e=>{o.value=e,i.value=""},y=()=>{m.value=!m.value},E=e=>{p.value=e.detail.value.includes("remember")},k=e.computed((()=>d.value.username&&d.value.password&&d.value.username.length>=3&&d.value.username.length<=30&&d.value.password.length>=6)),N=async()=>{if(i.value="",!l.value.username||!l.value.password)return i.value="è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",void uni.showToast({title:"è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",icon:"none",duration:2e3});n.value=!0;try{const e=l.value.username?l.value.username.trim():"",a=l.value.password?l.value.password.trim():"";t("log","at pages/login/login.vue:374","ğŸ“¤ å‘é€ç™»å½•è¯·æ±‚:",{username:e?`${e.substring(0,3)}***`:"(ç©º)",passwordLength:a.length,hasUsername:!!e,hasPassword:!!a});const o=await Pe({url:"/auth/login",method:"POST",data:{username:e,password:a},needAuth:!1,showLoading:!0,showError:!1});if(o.success&&o.token){if(te(o.token),o.data){oe(o.data),uni.setStorageSync("userInfo",o.data);const e=o.data.id||o.data._id||o.data.userId||o.data.username;try{const a=uni.getStorageSync("userProfilesById")||{};let n=a[e]||{avatarUrl:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",nickname:o.data.username||"ç”¨æˆ·æ˜µç§°",gender:"ä¿å¯†",phone:"",authStatus:"æœªè®¤è¯",realname:"",idCard:""};void 0!==o.data.avatarUrl&&null!==o.data.avatarUrl&&(n.avatarUrl=o.data.avatarUrl||n.avatarUrl||"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar"),void 0!==o.data.nickname&&null!==o.data.nickname&&(n.nickname=o.data.nickname||n.nickname||o.data.username||"ç”¨æˆ·æ˜µç§°"),void 0!==o.data.gender&&null!==o.data.gender&&(n.gender=o.data.gender||n.gender||"ä¿å¯†"),void 0!==o.data.phone&&null!==o.data.phone&&(n.phone=o.data.phone||n.phone||""),void 0!==o.data.authStatus&&null!==o.data.authStatus&&(n.authStatus=o.data.authStatus||n.authStatus||"æœªè®¤è¯"),void 0!==o.data.realname&&null!==o.data.realname&&(n.realname=o.data.realname||n.realname||""),void 0!==o.data.idCard&&null!==o.data.idCard&&(n.idCard=o.data.idCard||n.idCard||""),n.nickname||(n.nickname=o.data.username||"ç”¨æˆ·æ˜µç§°"),a[e]=n,uni.setStorageSync("userProfilesById",a),uni.setStorageSync("currentUserId",e);const s=getApp&&getApp();s&&s.globalData&&(s.globalData.userInfo=o.data,s.globalData.userProfile=n),uni.setStorageSync("userProfile",n),t("log","at pages/login/login.vue:464","âœ… ç™»å½•æˆåŠŸï¼Œå·²åŒæ­¥ç”¨æˆ·èµ„æ–™:",{userId:e,avatarUrl:n.avatarUrl?"å·²è®¾ç½®":"æœªè®¾ç½®",nickname:n.nickname,gender:n.gender,phone:n.phone||"æœªè®¾ç½®"})}catch(Kt){t("warn","at pages/login/login.vue:472","åŒæ­¥ç™»å½•ç”¨æˆ·ä¿¡æ¯åˆ°å…¨å±€å¤±è´¥:",Kt)}}uni.showToast({title:"ç™»å½•æˆåŠŸï¼",icon:"success",duration:1500}),setTimeout((()=>{uni.switchTab({url:"/pages/index/index",success:()=>{t("log","at pages/login/login.vue:488","è·³è½¬åˆ°é¦–é¡µæˆåŠŸ")},fail:e=>{t("error","at pages/login/login.vue:491","è·³è½¬å¤±è´¥:",e),uni.reLaunch({url:"/pages/index/index"})}})}),500)}else i.value=o.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•",uni.showToast({title:o.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}catch(e){t("error","at pages/login/login.vue:508","ç™»å½•å¤±è´¥:",e);let a="ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";e.message?a=e.message:e.msg?a=e.msg:e.errMsg?a=e.errMsg.includes("timeout")?"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆhttp://localhost:3000ï¼‰":e.errMsg:"string"==typeof e&&(a=e),i.value=a,uni.showToast({title:a,icon:"none",duration:2e3})}finally{n.value=!1}},V=async()=>{s.value=!0;try{const e=await(async(e={})=>zn(e))({onStatus:e=>{t("log","at pages/login/login.vue:546","[oneclick][app]",e)}});if((null==e?void 0:e.success)&&(null==e?void 0:e.token))await x(e);else{const t=(null==e?void 0:e.message)||"ä¸€é”®ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";uni.showToast({title:t,icon:"none",duration:2e3})}}catch(e){const t=(null==e?void 0:e.message)||"ä¸€é”®ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";uni.showToast({title:t,icon:"none",duration:2e3})}finally{s.value=!1}},C=async()=>{await V()},x=async e=>{if(te(e.token),e.data){oe(e.data),uni.setStorageSync("userInfo",e.data);const a=e.data.id||e.data._id||e.data.userId||e.data.username||e.data.phone;try{const o=uni.getStorageSync("userProfilesById")||{};let n=o[a]||{avatarUrl:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",nickname:e.data.username||e.data.phone||"ç”¨æˆ·æ˜µç§°",gender:"ä¿å¯†",phone:e.data.phone||"",authStatus:"æœªè®¤è¯",realname:"",idCard:""};void 0!==e.data.avatarUrl&&null!==e.data.avatarUrl&&(n.avatarUrl=e.data.avatarUrl||n.avatarUrl||"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar"),void 0!==e.data.nickname&&null!==e.data.nickname&&(n.nickname=e.data.nickname||n.nickname||e.data.username||e.data.phone||"ç”¨æˆ·æ˜µç§°"),void 0!==e.data.gender&&null!==e.data.gender&&(n.gender=e.data.gender||n.gender||"ä¿å¯†"),void 0!==e.data.phone&&null!==e.data.phone&&(n.phone=e.data.phone||n.phone||""),void 0!==e.data.authStatus&&null!==e.data.authStatus&&(n.authStatus=e.data.authStatus||n.authStatus||"æœªè®¤è¯"),void 0!==e.data.realname&&null!==e.data.realname&&(n.realname=e.data.realname||n.realname||""),void 0!==e.data.idCard&&null!==e.data.idCard&&(n.idCard=e.data.idCard||n.idCard||""),n.nickname||(n.nickname=e.data.username||e.data.phone||"ç”¨æˆ·æ˜µç§°"),o[a]=n,uni.setStorageSync("userProfilesById",o),uni.setStorageSync("currentUserId",a);const s=getApp&&getApp();s&&s.globalData&&(s.globalData.userInfo=e.data,s.globalData.userProfile=n),uni.setStorageSync("userProfile",n),t("log","at pages/login/login.vue:658","âœ… æ‰‹æœºå·ç™»å½•æˆåŠŸï¼Œå·²åŒæ­¥ç”¨æˆ·èµ„æ–™:",{userId:a,avatarUrl:n.avatarUrl?"å·²è®¾ç½®":"æœªè®¾ç½®",nickname:n.nickname,gender:n.gender,phone:n.phone||"æœªè®¾ç½®"})}catch(Kt){t("warn","at pages/login/login.vue:666","åŒæ­¥æ‰‹æœºå·ç™»å½•ç”¨æˆ·ä¿¡æ¯åˆ°å…¨å±€å¤±è´¥:",Kt)}}uni.showToast({title:"ç™»å½•æˆåŠŸï¼",icon:"success",duration:1500}),setTimeout((()=>{uni.switchTab({url:"/pages/index/index",success:()=>{t("log","at pages/login/login.vue:682","è·³è½¬åˆ°é¦–é¡µæˆåŠŸ")},fail:e=>{t("error","at pages/login/login.vue:685","è·³è½¬å¤±è´¥:",e),uni.reLaunch({url:"/pages/index/index"})}})}),500)},b=async()=>{if(i.value="",!c.value.phone||!c.value.code)return i.value="è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ",void uni.showToast({title:"è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ",icon:"none",duration:2e3});if(!/^1[3-9]\d{9}$/.test(c.value.phone))return i.value="è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",void uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none",duration:2e3});if(6!==c.value.code.length)return i.value="éªŒè¯ç ä¸º6ä½æ•°å­—",void uni.showToast({title:"éªŒè¯ç ä¸º6ä½æ•°å­—",icon:"none",duration:2e3});n.value=!0;try{const e=await Pe({url:"/login/verify",method:"POST",data:{phone:c.value.phone,code:c.value.code,outId:c.value.outId},needAuth:!1});e.success&&e.token?await x(e):(i.value=e.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•",uni.showToast({title:e.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3}))}catch(e){t("error","at pages/login/login.vue:759","ç™»å½•å¤±è´¥:",e);const a=e.message||e.msg||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";i.value=a,uni.showToast({title:a,icon:"none",duration:2e3})}finally{n.value=!1}},S=async()=>{if(!c.value.phone)return void uni.showToast({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none",duration:2e3});/^1[3-9]\d{9}$/.test(c.value.phone)?h.value>0||g.value&&g.value.showCaptcha():uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none",duration:2e3})},I=async e=>{if(e){n.value=!0;try{const t=await _(e);await P(t),f.value&&(f.value.reset&&f.value.reset(),f.value.hide&&f.value.hide())}catch(t){const e=(null==t?void 0:t.message)||(null==t?void 0:t.msg)||(null==t?void 0:t.errMsg)||"å›¾å½¢éªŒè¯ç éªŒè¯å¤±è´¥";uni.showToast({title:e,icon:"none",duration:2e3})}finally{n.value=!1}}else uni.showToast({title:"è¯·å®Œæˆå›¾å½¢éªŒè¯",icon:"none",duration:2e3})},T=()=>{uni.showToast({title:"å›¾å½¢éªŒè¯ç åŠ è½½å¤±è´¥",icon:"none",duration:2e3})},D=()=>{uni.showToast({title:"å›¾å½¢éªŒè¯ç æ ¡éªŒå¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})},B=()=>{},_=async e=>{const t=await Pe({url:"/login/captcha/verify",method:"POST",data:{phone:c.value.phone,captchaId:e.captcha_id||Wn,lotNumber:e.lot_number,captchaOutput:e.captcha_output,passToken:e.pass_token,genTime:e.gen_time},needAuth:!1,showError:!1});if(!t||!t.captchaToken)throw new Error((null==t?void 0:t.message)||"å›¾å½¢éªŒè¯ç æ ¡éªŒå¤±è´¥");return t.captchaToken},P=async e=>{t("log","at pages/login/login.vue:946","ğŸ“¤ å¼€å§‹å‘é€éªŒè¯ç ï¼Œæ‰‹æœºå·:",c.value.phone);const a=await Pe({url:"/login/send",method:"POST",data:{phone:c.value.phone,type:"login",captchaToken:e},needAuth:!1,showError:!1});if(t("log","at pages/login/login.vue:959","ğŸ“¥ æ”¶åˆ°å“åº”:",a),a&&a.success){a.outId&&(c.value.outId=a.outId),uni.showToast({title:a.message||"éªŒè¯ç å·²å‘é€",icon:"success",duration:2e3}),h.value=60;const e=setInterval((()=>{h.value--,h.value<=0&&clearInterval(e)}),1e3);a.code&&(t("log","at pages/login/login.vue:980","âœ… éªŒè¯ç ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰:",a.code),setTimeout((()=>{uni.showModal({title:"éªŒè¯ç ï¼ˆå¼€å‘ç¯å¢ƒï¼‰",content:`éªŒè¯ç ï¼š${a.code}`,showCancel:!1})}),500))}else{const e=(null==a?void 0:a.message)||(null==a?void 0:a.error)||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•";t("error","at pages/login/login.vue:991","âŒ å‘é€å¤±è´¥:",e),uni.showToast({title:e,icon:"none",duration:3e3})}},A=async()=>{if(!d.value.username||!d.value.password)return r.value="è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",void uni.showToast({title:"è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",icon:"none",duration:2e3});if(d.value.username.length<3||d.value.username.length>30)return r.value="ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-30ä¸ªå­—ç¬¦ä¹‹é—´",void uni.showToast({title:"ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-30ä¸ªå­—ç¬¦ä¹‹é—´",icon:"none",duration:2e3});if(d.value.password.length<6)return r.value="å¯†ç é•¿åº¦è‡³å°‘6ä½",void uni.showToast({title:"å¯†ç é•¿åº¦è‡³å°‘6ä½",icon:"none",duration:2e3});n.value=!0;try{const e=await Pe({url:"/auth/register",method:"POST",data:{username:d.value.username,password:d.value.password},needAuth:!1});e.success?(uni.showToast({title:"æ³¨å†ŒæˆåŠŸï¼",icon:"success",duration:2e3}),setTimeout((()=>{u.value=!1,l.value.username=d.value.username,d.value={username:"",password:""},r.value="",w("account")}),500)):(r.value=e.message||"æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•",uni.showToast({title:e.message||"æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3}))}catch(e){t("error","at pages/login/login.vue:1076","æ³¨å†Œå¤±è´¥:",e);const a=e.message||e.msg||"æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";r.value=a,uni.showToast({title:a,icon:"none",duration:2e3})}finally{n.value=!1}},U=()=>{t("log","at pages/login/login.vue:1092","å¿˜è®°å¯†ç ")};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"bg-decoration"},[e.createElementVNode("view",{class:"bg-circle circle-1"}),e.createElementVNode("view",{class:"bg-circle circle-2"}),e.createElementVNode("view",{class:"bg-circle circle-3"})]),e.createElementVNode("view",{class:"login-card"},[e.createElementVNode("view",{class:"login-header"},[e.createElementVNode("view",{class:"logo-wrapper"},[e.createElementVNode("view",{class:"logo-icon"},"ğŸ¥")]),e.createElementVNode("view",{class:"app-title"},"åŒ»ç–—AIåŠ©æ‰‹"),e.createElementVNode("view",{class:"app-subtitle"},"æ™ºèƒ½åŒ»ç–— Â· å¥åº·å®ˆæŠ¤")]),e.createElementVNode("view",{class:"login-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"account"===o.value}]),onClick:a[0]||(a[0]=e=>w("account"))}," è´¦å·ç™»å½• ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"phone"===o.value}]),onClick:a[1]||(a[1]=e=>w("phone"))}," æ‰‹æœºç™»å½• ",2)]),"account"===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"login-form"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ‘¤"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.username=e),type:"text",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å/æ‰‹æœºå·",class:"form-input",disabled:n.value},null,8,["disabled"]),[[e.vModelText,l.value.username]])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ”’"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.password=e),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",class:"form-input",disabled:n.value},null,8,["disabled"]),[[e.vModelText,l.value.password]]),e.createElementVNode("view",{class:"input-suffix",onClick:y},[m.value?(e.openBlock(),e.createElementBlock("text",{key:0},"ğŸ‘ï¸")):(e.openBlock(),e.createElementBlock("text",{key:1},"ğŸ‘ï¸â€ğŸ—¨ï¸"))])])]),e.createElementVNode("view",{class:"form-options"},[e.createElementVNode("view",{class:"remember-me"},[e.createElementVNode("checkbox-group",{onChange:E},[e.createElementVNode("label",{class:"checkbox-label"},[e.createElementVNode("checkbox",{value:"remember",checked:p.value},null,8,["checked"]),e.createElementVNode("text",null,"è®°ä½å¯†ç ")])],32)]),e.createElementVNode("view",{class:"forgot-password",onClick:U}," å¿˜è®°å¯†ç ï¼Ÿ ")]),e.createElementVNode("button",{class:"primary-button",disabled:n.value||!l.value.username||!l.value.password,onClick:N},e.toDisplayString(n.value?"ç™»å½•ä¸­...":"ç™»å½•"),9,["disabled"]),e.createElementVNode("view",{class:"register-link"},[e.createTextVNode(" è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ "),e.createElementVNode("text",{class:"link-text",onClick:a[4]||(a[4]=e=>u.value=!0)},"ç«‹å³æ³¨å†Œ")]),e.createElementVNode("view",{class:"third-party-login"},[e.createElementVNode("view",{class:"divider"},[e.createElementVNode("view",{class:"divider-line"}),e.createElementVNode("text",{class:"divider-text"},"å…¶ä»–ç™»å½•æ–¹å¼"),e.createElementVNode("view",{class:"divider-line"})]),e.createElementVNode("view",{class:"third-party-buttons"},[e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon wechat"},"ğŸ’¬"),e.createElementVNode("text",{class:"third-party-text"},"å¾®ä¿¡")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon alipay"},"ğŸ’°"),e.createElementVNode("text",{class:"third-party-text"},"æ”¯ä»˜å®")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon qq"},"ğŸ§"),e.createElementVNode("text",{class:"third-party-text"},"QQ")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon douyin"},"ğŸµ"),e.createElementVNode("text",{class:"third-party-text"},"æŠ–éŸ³")])])])])):e.createCommentVNode("",!0),"phone"===o.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"login-form"},[e.createVNode(Hn,{ref_key:"captchaRef",ref:g,config:v.value,onCaptchaSuccess:I,onCaptchaError:T,onCaptchaFail:D,onCaptchaClose:B},null,8,["config"]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ“±"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>c.value.phone=e),type:"number",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",class:"form-input",maxlength:"11",disabled:n.value},null,8,["disabled"]),[[e.vModelText,c.value.phone]])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper code-input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ”"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>c.value.code=e),type:"number",placeholder:"è¯·è¾“å…¥éªŒè¯ç ",class:"form-input code-input",maxlength:"6",disabled:n.value},null,8,["disabled"]),[[e.vModelText,c.value.code]]),e.createElementVNode("button",{class:"code-button",disabled:n.value||!c.value.phone||h.value>0,onClick:S},e.toDisplayString(h.value>0?`${h.value}ç§’åé‡è¯•`:"è·å–éªŒè¯ç "),9,["disabled"])])]),e.createElementVNode("button",{class:"primary-button",disabled:n.value||!c.value.phone||!c.value.code,onClick:b},e.toDisplayString(n.value?"ç™»å½•ä¸­...":"ç™»å½•"),9,["disabled"]),e.createElementVNode("button",{class:"oneclick-button",disabled:s.value,onClick:C},e.toDisplayString(s.value?"ä¸€é”®ç™»å½•ä¸­...":"ä¸€é”®ç™»å½•"),9,["disabled"]),e.createElementVNode("view",{class:"register-link"},[e.createTextVNode(" è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ "),e.createElementVNode("text",{class:"link-text",onClick:a[7]||(a[7]=e=>u.value=!0)},"ç«‹å³æ³¨å†Œ")]),e.createElementVNode("view",{class:"third-party-login"},[e.createElementVNode("view",{class:"divider"},[e.createElementVNode("view",{class:"divider-line"}),e.createElementVNode("text",{class:"divider-text"},"å…¶ä»–ç™»å½•æ–¹å¼"),e.createElementVNode("view",{class:"divider-line"})]),e.createElementVNode("view",{class:"third-party-buttons"},[e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon wechat"},"ğŸ’¬"),e.createElementVNode("text",{class:"third-party-text"},"å¾®ä¿¡")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon alipay"},"ğŸ’°"),e.createElementVNode("text",{class:"third-party-text"},"æ”¯ä»˜å®")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon qq"},"ğŸ§"),e.createElementVNode("text",{class:"third-party-text"},"QQ")]),e.createElementVNode("view",{class:"third-party-item"},[e.createElementVNode("view",{class:"third-party-icon douyin"},"ğŸµ"),e.createElementVNode("text",{class:"third-party-text"},"æŠ–éŸ³")])])])])):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"error-message"},[e.createElementVNode("text",{class:"error-icon"},"âš ï¸"),e.createElementVNode("text",null,e.toDisplayString(i.value),1)])):e.createCommentVNode("",!0)]),u.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"register-modal",onClick:a[12]||(a[12]=e.withModifiers((e=>u.value=!1),["self"]))},[e.createElementVNode("view",{class:"register-content",onClick:a[11]||(a[11]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"register-header"},[e.createElementVNode("text",{class:"register-title"},"ç”¨æˆ·æ³¨å†Œ"),e.createElementVNode("view",{class:"close-button",onClick:a[8]||(a[8]=e=>u.value=!1)},"âœ•")]),e.createElementVNode("view",{class:"register-form"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ‘¤"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>d.value.username=e),type:"text",placeholder:"è¯·è¾“å…¥ç”¨æˆ·åï¼ˆ3-30ä¸ªå­—ç¬¦ï¼‰",class:"form-input",disabled:n.value},null,8,["disabled"]),[[e.vModelText,d.value.username]])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("view",{class:"input-icon"},"ğŸ”’"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[10]||(a[10]=e=>d.value.password=e),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",class:"form-input",disabled:n.value},null,8,["disabled"]),[[e.vModelText,d.value.password]])])]),r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"register-error-message"},[e.createElementVNode("text",{class:"error-icon"},"âš ï¸"),e.createElementVNode("text",null,e.toDisplayString(r.value),1)])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"primary-button",disabled:n.value||!k.value,onClick:A},e.toDisplayString(n.value?"æ³¨å†Œä¸­...":"ç«‹å³æ³¨å†Œ"),9,["disabled"])])])])):e.createCommentVNode("",!0)]))}},Kn=s(Jn,[["__scopeId","data-v-4c0db8f5"]]),Gn=s({__name:"callback",setup:t=>(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"callback-container"},[e.createElementVNode("view",{class:"status-text"}," å·²å…³é—­ç¬¬ä¸‰æ–¹ç™»å½•åŠŸèƒ½ï¼Œè¯·å›åˆ°ç™»å½•é¡µä½¿ç”¨è´¦å·æˆ–éªŒè¯ç ç™»å½•ã€‚ ")]))},[["__scopeId","data-v-431899a8"]]);const Yn=s({data:()=>({searchKeyword:"",activeCategoryIndex:0,lastSelectedDept:"æ™®å†…ç§‘",categories:[{name:"å†…ç§‘",subDepartments:["æ™®å†…ç§‘","å¿ƒè¡€ç®¡å†…ç§‘","ç¥ç»å†…ç§‘","æ¶ˆåŒ–å†…ç§‘","å‘¼å¸å†…ç§‘","è‚¾å†…ç§‘","é«˜å‹æ°§ç§‘","å†…åˆ†æ³Œç§‘"]},{name:"å¤–ç§‘",subDepartments:["æ™®å¤–ç§‘","ç¥ç»å¤–ç§‘","èƒ¸å¤–ç§‘","æ³Œå°¿å¤–ç§‘","è‚›è‚ å¤–ç§‘","ä¹³è…ºå¤–ç§‘","è¡€ç®¡å¤–ç§‘"]},{name:"éª¨ç§‘",subDepartments:["è„ŠæŸ±å¤–ç§‘","å…³èŠ‚å¤–ç§‘","åˆ›ä¼¤éª¨ç§‘","æ‰‹å¤–ç§‘","è¿åŠ¨åŒ»å­¦ç§‘"]},{name:"å¦‡äº§ç§‘",subDepartments:["å¦‡ç§‘","äº§ç§‘","è®¡åˆ’ç”Ÿè‚²ç§‘","ç”Ÿæ®–åŒ»å­¦ç§‘"]},{name:"å„¿ç§‘",subDepartments:["å°å„¿å†…ç§‘","å°å„¿å¤–ç§‘","æ–°ç”Ÿå„¿ç§‘","å„¿ç«¥ä¿å¥ç§‘"]},{name:"è‚¿ç˜¤ç§‘",subDepartments:["è‚¿ç˜¤å†…ç§‘","è‚¿ç˜¤å¤–ç§‘","æ”¾ç–—ç§‘","ä»‹å…¥æ²»ç–—ç§‘"]},{name:"å£è…”ç§‘",subDepartments:["å£è…”å†…ç§‘","å£è…”å¤–ç§‘","å£è…”ä¿®å¤ç§‘","å£è…”æ­£ç•¸ç§‘"]}]}),computed:{filteredSubDepartments(){if(!this.searchKeyword||""===this.searchKeyword.trim())return this.categories[this.activeCategoryIndex].subDepartments;const e=this.searchKeyword.trim().toLowerCase(),t=[];return this.categories.forEach((a=>{a.subDepartments.forEach((a=>{a.toLowerCase().includes(e)&&(t.includes(a)||t.push(a))}))})),t}},methods:{selectCategory(e){this.activeCategoryIndex=e,this.searchKeyword=""},selectDepartment(e){const t=getCurrentPages(),a=t[t.length-2];a&&a.$vm&&(a.$vm.selectedDepartment=e,"function"==typeof a.$vm.applyDepartmentFilter&&a.$vm.applyDepartmentFilter()),uni.navigateBack()},onSearchInput(){this.searchKeyword&&this.activeCategoryIndex},onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("text",{class:"icon-search"},"ğŸ”"),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.searchKeyword=e),placeholder:"æœç´¢ç§‘å®¤åç§°","placeholder-class":"search-placeholder",onInput:a[1]||(a[1]=(...e)=>i.onSearchInput&&i.onSearchInput(...e))},null,544),[[e.vModelText,s.searchKeyword]])])]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("scroll-view",{class:"left-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.categories,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["category-item",{active:s.activeCategoryIndex===a}]),onClick:e=>i.selectCategory(a)},[e.createElementVNode("text",{class:"category-text"},e.toDisplayString(t.name),1)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"right-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.filteredSubDepartments,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"dept-item",onClick:e=>i.selectDepartment(t)},[e.createElementVNode("text",{class:"dept-text"},e.toDisplayString(t),1),t===s.lastSelectedDept?(e.openBlock(),e.createElementBlock("text",{key:0,class:"dept-tag"},"ä¸Šæ¬¡é€‰è¿‡")):e.createCommentVNode("",!0)],8,["onClick"])))),128)),0===i.filteredSubDepartments.length&&s.searchKeyword?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-result"},[e.createElementVNode("text",{class:"empty-text"},"æœªæ‰¾åˆ°ç›¸å…³ç§‘å®¤"),e.createElementVNode("text",{class:"empty-hint"},"è¯·å°è¯•å…¶ä»–å…³é”®è¯")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"float-btn",onClick:a[2]||(a[2]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-1bace7d8"]]),Qn=e.defineComponent({__name:"index",setup(o){const n=getCurrentPages(),s=n[n.length-1].options,r=e.ref(!0),l=e.ref(""),c=e.ref(""),d=e.ref({name:"",level:"",address:""}),u=e.ref([]),m=[{groupName:"å†…ç§‘",departments:[{name:"ç¥ç»å†…ç§‘",tags:[{name:"å›½å®¶é‡ç‚¹",type:"key"}]},{name:"å†…åˆ†æ³Œç§‘",tags:[{name:"å›½å®¶é‡ç‚¹",type:"key"}]},{name:"å‘¼å¸å†…ç§‘",tags:[]},{name:"å†…åˆ†æ³Œç§‘(è¥¿é™¢)",tags:[{name:"äº’è”ç½‘",type:"internet"}]},{name:"ç‰¹éœ€å†…åˆ†æ³Œç§‘",tags:[]},{name:"æ¶ˆåŒ–å†…ç§‘",tags:[]},{name:"è¡€æ¶²ç§‘",tags:[]},{name:"è‚ç—…ç§‘",tags:[]},{name:"å…ç–«ç§‘",tags:[]}]},{groupName:"å…¶ä»–ç§‘å®¤",departments:[{name:"ä¸­åŒ»ç§‘",tags:[]},{name:"å¦‡äº§ç§‘",tags:[]},{name:"å˜æ€ååº”ç§‘",tags:[]},{name:"è¥å…»ç§‘",tags:[]},{name:"å„¿ç§‘",tags:[]},{name:"äº”å®˜ç§‘",tags:[]},{name:"è€å¹´ç§‘",tags:[]}]}],p=()=>{r.value=!0,l.value="";try{s.name&&(d.value={name:decodeURIComponent(s.name||""),level:decodeURIComponent(s.level||"æœªçŸ¥"),address:decodeURIComponent(s.address||"")}),u.value=m}catch(e){l.value="åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·é‡è¯•",t("error","at pages/appointment/index.vue:184","åˆå§‹åŒ–å¤±è´¥:",e)}finally{r.value=!1}},h=()=>{uni.navigateBack()},g=()=>{t("log","at pages/appointment/index.vue:198","æœç´¢ç§‘å®¤:",c.value)};return e.onMounted((()=>{p()})),(t,o)=>{const n=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"top-header"},[e.createVNode(n,{type:"left",size:"24",color:"#333",onClick:h}),e.createElementVNode("text",{class:"nav-title"},"é¢„çº¦æŒ‚å·"),e.createVNode(n,{type:"more",size:"24",color:"#333"})]),r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createVNode(n,{type:"spinner",size:"36",color:"#4a90e2",animation:"spin"}),e.createElementVNode("text",{class:"loading-text"},"åŠ è½½ä¸­...")])):l.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-container"},[e.createVNode(n,{type:"closeempty",size:"64",color:"#ff4d4f"}),e.createElementVNode("text",{class:"error-text"},e.toDisplayString(l.value),1),e.createElementVNode("button",{class:"retry-btn",onClick:p},"é‡æ–°åŠ è½½")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"appointment-content"},[e.createElementVNode("view",{class:"hospital-info"},[e.createElementVNode("view",{class:"hospital-name"},e.toDisplayString(d.value.name),1),e.createElementVNode("view",{class:"hospital-tags"},[e.createElementVNode("view",{class:"tag level-tag"},e.toDisplayString(d.value.level),1),e.createElementVNode("view",{class:"tag type-tag"},"ç»¼åˆåŒ»é™¢"),e.createElementVNode("view",{class:"tag insurance-tag"},"å®šç‚¹åŒ»ä¿")]),e.createElementVNode("view",{class:"hospital-address"},[e.createVNode(n,{type:"location",size:"16",color:"#999"}),e.createElementVNode("text",{class:"address-text"},e.toDisplayString(d.value.address),1),e.createElementVNode("text",{class:"map-link"},"åœ°å›¾æŸ¥çœ‹")]),e.createElementVNode("view",{class:"hospital-homepage"},[e.createVNode(n,{type:"link",size:"16",color:"#4a90e2"}),e.createElementVNode("text",{class:"homepage-text"},"åŒ»é™¢é¦–é¡µ")])]),e.createElementVNode("view",{class:"search-box"},[e.createVNode(n,{type:"search",size:"18",color:"#999"}),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text",placeholder:"æœç´¢ç§‘å®¤åç§°","onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),onInput:g},null,544),[[e.vModelText,c.value]])]),e.createElementVNode("view",{class:"department-section"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"department-group"},[e.createElementVNode("view",{class:"group-title"},e.toDisplayString(t.groupName),1),e.createElementVNode("view",{class:"department-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.departments,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"department-item",onClick:e=>{return a=t,void uni.showToast({title:`é€‰æ‹©äº†${a.name}`,icon:"none"});var a}},[e.createElementVNode("view",{class:"dept-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"dept-tags"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.tags,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["dept-tag",t.type])},e.toDisplayString(t.name),3)))),128))])],8,["onClick"])))),128))])])))),128))])]))])}}});const Xn=s({data:()=>({searchKeyword:"",activeCategoryIndex:0,lastSelectedDisease:"å‘çƒ§",categories:[{name:"å¤´éƒ¨",diseases:["å‘çƒ§","å¤´ç—›","åå¤´ç—›","çœ¼å¹²","çœ¼ç–²åŠ³","é¼»çª¦ç‚","å£è…”æºƒç–¡","å¤´éƒ¨ç–¾ç—…","è€³é¸£","çœ©æ™•","å¤±çœ "]},{name:"å…¨èº«",diseases:["æ„Ÿå†’","å‘çƒ­","ä¹åŠ›","é£Ÿæ¬²ä¸æŒ¯","ä½“é‡ä¸‹é™","å…¨èº«ç–¼ç—›","è¿‡æ•","å…ç–«åŠ›ä½ä¸‹"]},{name:"èƒ¸éƒ¨",diseases:["èƒ¸é—·","èƒ¸ç—›","å¿ƒæ‚¸","å’³å—½","å“®å–˜","å‘¼å¸å›°éš¾","è‚ºç‚","æ”¯æ°”ç®¡ç‚"]},{name:"å››è‚¢",diseases:["å…³èŠ‚ç—›","è‚Œè‚‰é…¸ç—›","å››è‚¢éº»æœ¨","å››è‚¢æ— åŠ›","å…³èŠ‚ç‚","é£æ¹¿","ç—›é£"]},{name:"èƒŒéƒ¨",diseases:["èƒŒç—›","è…°ç—›","é¢ˆæ¤ç—…","è…°æ¤é—´ç›˜çªå‡º","è‚©å‘¨ç‚","è„ŠæŸ±ä¾§å¼¯"]},{name:"éª¨",diseases:["éª¨æŠ˜","éª¨è´¨ç–æ¾","éª¨å…³èŠ‚ç‚","éª¨ç—›","éª¨è‚¿ç˜¤","éª¨æ„ŸæŸ“"]},{name:"è‡€éƒ¨",diseases:["åéª¨ç¥ç»ç—›","è‡€éƒ¨ç–¼ç—›","å°¾éª¨ç—›","é«‹å…³èŠ‚ç—›"]},{name:"æ‰‹éƒ¨",diseases:["æ‰‹ç—›","æ‰‹è…•ç—›","æ‰‹æŒ‡éº»æœ¨","è…±é˜ç‚","ç±»é£æ¹¿å…³èŠ‚ç‚","æ‰‹éƒ¨å¤–ä¼¤"]},{name:"è„šéƒ¨",diseases:["è„šç—›","è„šè¸ç—›","è¶³åº•ç­‹è†œç‚","è„šéƒ¨å¤–ä¼¤","è„šæ°”","ç”²æ²Ÿç‚"]}]}),computed:{filteredDiseases(){if(!this.searchKeyword||""===this.searchKeyword.trim())return this.categories[this.activeCategoryIndex].diseases;const e=this.searchKeyword.trim().toLowerCase(),t=[];return this.categories.forEach((a=>{a.diseases.forEach((a=>{a.toLowerCase().includes(e)&&(t.includes(a)||t.push(a))}))})),t}},methods:{selectCategory(e){this.activeCategoryIndex=e,this.searchKeyword=""},selectDisease(e){const t=getCurrentPages(),a=t[t.length-2];a&&a.$vm&&(a.$vm.selectedDisease=e,"function"==typeof a.$vm.applyDiseaseFilter&&a.$vm.applyDiseaseFilter()),uni.navigateBack()},onSearchInput(){},onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("view",{class:"search-box"},[e.createElementVNode("text",{class:"icon-search"},"ğŸ”"),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>s.searchKeyword=e),placeholder:"æœç´¢ç–¾ç—…åç§°","placeholder-class":"search-placeholder",onInput:a[1]||(a[1]=(...e)=>i.onSearchInput&&i.onSearchInput(...e))},null,544),[[e.vModelText,s.searchKeyword]])])]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("scroll-view",{class:"left-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.categories,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["category-item",{active:s.activeCategoryIndex===a}]),onClick:e=>i.selectCategory(a)},[e.createElementVNode("text",{class:"category-text"},e.toDisplayString(t.name),1)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"right-column","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.filteredDiseases,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"disease-item",onClick:e=>i.selectDisease(t)},[e.createElementVNode("text",{class:"disease-text"},e.toDisplayString(t),1),t===s.lastSelectedDisease?(e.openBlock(),e.createElementBlock("text",{key:0,class:"disease-tag"},"ä¸Šæ¬¡é€‰è¿‡")):e.createCommentVNode("",!0)],8,["onClick"])))),128)),0===i.filteredDiseases.length&&s.searchKeyword?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-result"},[e.createElementVNode("text",{class:"empty-text"},"æœªæ‰¾åˆ°ç›¸å…³ç–¾ç—…"),e.createElementVNode("text",{class:"empty-hint"},"è¯·å°è¯•å…¶ä»–å…³é”®è¯")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"float-btn",onClick:a[2]||(a[2]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-a4b2d715"]]),Zn={data:()=>({doctorInfo:{},activeTabIndex:0,tabs:["é¢„çº¦æŒ‚å·","åŒ»ç–—æœåŠ¡","æ‚£è€…è¯„ä»·","é—®è¯Šå†å²","åŒ»ç”Ÿæ–‡ç« "],appointmentSlots1:[],appointmentSlots2:[],appointmentSlots3:[],isFavorited:!1,reviews:[{rating:5,comment:"åŒ»ç”Ÿå¾ˆæœ‰è€å¿ƒ,ä¸é”™ä¸é”™,æ„Ÿè°¢",reviewer:"ç‹å…ˆç”Ÿ",type:"é—¨è¯ŠæŒ‚å·",department:"ç¥ç»å†…ç§‘",date:"2020-03-03"},{rating:4,comment:"åŒ»ç”Ÿå¾ˆæœ‰è€å¿ƒ,ä¸é”™ä¸é”™,æ„Ÿè°¢",reviewer:"ç‹å…ˆç”Ÿ",type:"é—¨è¯ŠæŒ‚å·",department:"å†…åˆ†æ³Œç§‘",date:"2020-03-02"},{rating:3,comment:"é—®è¯Šé€Ÿåº¦æœ‰ç‚¹å¿«,å¸Œæœ›èƒ½å’ŒåŒ»ç”Ÿæ²Ÿé€šçš„æ›´ä¹…",reviewer:"ç‹å…ˆç”Ÿ",type:"äº’è”ç½‘é¢„çº¦",department:"è‚¿ç˜¤ç§‘",date:"2020-03-02"},{rating:5,comment:"åœ¨çº¿çœ‹ç—…å¾ˆæ–¹ä¾¿,è¯å“è¯å•ç›´æ¥é‚®å¯„åˆ°å®¶å¾ˆå¿«",reviewer:"æå¥³å£«",type:"äº’è”ç½‘é¢„çº¦",department:"å†…åˆ†æ³Œç§‘",date:"2020-03-01"}],consultationHistory:[{patientInfo:"ç”·(31å²)",question:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullQuestion:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?æœ€è¿‘å‘ç°é¢ˆéƒ¨æœ‰è‚¿å—ï¼Œå¹¶ä¸”ä¼´æœ‰çº¢è‚¿å’Œç–¼ç—›æ„Ÿï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œåº”è¯¥å¦‚ä½•ç¼“è§£ç—‡çŠ¶ï¼Ÿ",fullReply:"æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°,ç”²çŠ¶è…ºè‚¿ç˜¤å¼•èµ·çš„çº¢è‚¿ç–¼ç—›éœ€è¦åŠæ—¶å°±åŒ»ã€‚å»ºè®®æ‚¨ï¼š1. é¿å…æŒ‰å‹å’Œæ‘©æ“¦æ‚£å¤„ï¼›2. ä¿æŒå±€éƒ¨æ¸…æ´å¹²ç‡¥ï¼›3. å°½å¿«åˆ°åŒ»é™¢è¿›è¡Œä¸“ä¸šæ£€æŸ¥ï¼›4. æ ¹æ®åŒ»ç”Ÿå»ºè®®è¿›è¡Œç›¸åº”æ²»ç–—ã€‚å¦‚æœç–¼ç—›å‰§çƒˆï¼Œå¯ä»¥æš‚æ—¶ä½¿ç”¨å†·æ•·ç¼“è§£ï¼Œä½†ä¸è¦è‡ªè¡Œç”¨è¯ã€‚"},{patientInfo:"ç”·(42å²)",question:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullQuestion:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†ï¼Ÿæœ€è¿‘å·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸å¤±çœ ï¼Œç™½å¤©ç²¾ç¥ä¸å¥½ï¼Œæ€€ç–‘æ˜¯å†…åˆ†æ³Œé—®é¢˜ï¼Œæƒ³çŸ¥é“å¦‚ä½•è°ƒç†ï¼Ÿ",fullReply:"æ‚¨å¥½,å†…åˆ†æ³Œç´Šä¹±å¯¼è‡´çš„å¤±çœ éœ€è¦ç»¼åˆè°ƒç†ã€‚å»ºè®®æ‚¨ï¼š1. è§„å¾‹ä½œæ¯ï¼Œæ¯å¤©å›ºå®šæ—¶é—´ç¡è§‰å’Œèµ·åºŠï¼›2. ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼›3. é€‚å½“è¿åŠ¨ï¼Œä½†é¿å…ç¡å‰å‰§çƒˆè¿åŠ¨ï¼›4. é¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…æ™šé¤è¿‡é¥±ï¼›5. å¯ä»¥å°è¯•æ”¾æ¾æŠ€å·§å¦‚æ·±å‘¼å¸ã€å†¥æƒ³ï¼›6. å¦‚æœç—‡çŠ¶ä¸¥é‡ï¼Œå»ºè®®åˆ°åŒ»é™¢è¿›è¡Œå†…åˆ†æ³Œæ£€æŸ¥ï¼Œå¿…è¦æ—¶åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ç”¨è¯ã€‚"},{patientInfo:"ç”·(27å²)",question:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullQuestion:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?æœ€è¿‘å‘ç°é¢ˆéƒ¨æœ‰è‚¿å—ï¼Œå¹¶ä¸”ä¼´æœ‰çº¢è‚¿å’Œç–¼ç—›æ„Ÿï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œåº”è¯¥å¦‚ä½•ç¼“è§£ç—‡çŠ¶ï¼Ÿ",fullReply:"æ‚¨å¥½,ç”²çŠ¶è…ºè‚¿ç˜¤éœ€è¦ä¸“ä¸šè¯Šæ–­å’Œæ²»ç–—ã€‚å»ºè®®æ‚¨å°½å¿«åˆ°åŒ»é™¢è¿›è¡Œç”²çŠ¶è…ºBè¶…å’Œç”²çŠ¶è…ºåŠŸèƒ½æ£€æŸ¥ï¼Œä»¥æ˜ç¡®è¯Šæ–­ã€‚åœ¨ç­‰å¾…æ£€æŸ¥æœŸé—´ï¼Œæ³¨æ„ä¼‘æ¯ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ï¼Œä¿æŒæƒ…ç»ªç¨³å®šã€‚"},{patientInfo:"ç”·(42å²)",question:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullQuestion:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†ï¼Ÿæœ€è¿‘å·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸å¤±çœ ï¼Œç™½å¤©ç²¾ç¥ä¸å¥½ï¼Œæ€€ç–‘æ˜¯å†…åˆ†æ³Œé—®é¢˜ï¼Œæƒ³çŸ¥é“å¦‚ä½•è°ƒç†ï¼Ÿ",fullReply:"æ‚¨å¥½,å†…åˆ†æ³Œç´Šä¹±å¯¼è‡´çš„å¤±çœ éœ€è¦ç»¼åˆè°ƒç†ã€‚å»ºè®®æ‚¨ï¼š1. è§„å¾‹ä½œæ¯ï¼Œæ¯å¤©å›ºå®šæ—¶é—´ç¡è§‰å’Œèµ·åºŠï¼›2. ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼›3. é€‚å½“è¿åŠ¨ï¼Œä½†é¿å…ç¡å‰å‰§çƒˆè¿åŠ¨ï¼›4. é¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…æ™šé¤è¿‡é¥±ï¼›5. å¯ä»¥å°è¯•æ”¾æ¾æŠ€å·§å¦‚æ·±å‘¼å¸ã€å†¥æƒ³ï¼›6. å¦‚æœç—‡çŠ¶ä¸¥é‡ï¼Œå»ºè®®åˆ°åŒ»é™¢è¿›è¡Œå†…åˆ†æ³Œæ£€æŸ¥ï¼Œå¿…è¦æ—¶åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ç”¨è¯ã€‚"}],articles:[{id:1,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:2,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:3,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:4,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"}]}),onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/detail.vue:368","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt),e.id?this.loadDoctorById(e.id):this.initDefaultDoctor()}else e.id?this.loadDoctorById(e.id):this.initDefaultDoctor();this.generateAppointmentSlots()},methods:{loadDoctorById(e){const t=[{id:1,name:"å¼ åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…",avatar:"https://randomuser.me/api/portraits/men/1.jpg",appointmentCount:2312,consultationCount:542,followCount:"32k"},{id:2,name:"æåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",dept:"ç¥ç»å†…ç§‘",goodAt:"ç¥ç»ç–¾ç—…ã€å¤´ç—›ã€å¤±çœ ",avatar:"https://randomuser.me/api/portraits/men/2.jpg",appointmentCount:1856,consultationCount:432,followCount:"28k"},{id:3,name:"ç‹åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤©å›åŒ»é™¢",dept:"éª¨ç§‘",goodAt:"éª¨ç§‘ç–¾ç—…ã€éª¨æŠ˜ã€å…³èŠ‚ç–¼ç—›",avatar:"https://randomuser.me/api/portraits/men/3.jpg",appointmentCount:1523,consultationCount:389,followCount:"25k"},{id:4,name:"åˆ˜åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬æœé˜³åŒ»é™¢",dept:"æ¶ˆåŒ–å†…ç§‘",goodAt:"æ¶ˆåŒ–ç³»ç»Ÿç–¾ç—…ã€èƒƒç‚ã€èƒƒæºƒç–¡",avatar:"https://randomuser.me/api/portraits/men/4.jpg",appointmentCount:2098,consultationCount:512,followCount:"30k"},{id:5,name:"é™ˆåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å‹è°ŠåŒ»é™¢",dept:"çš®è‚¤ç§‘",goodAt:"çš®è‚¤ç—…ã€æ¹¿ç–¹ã€è¿‡æ•",avatar:"https://randomuser.me/api/portraits/men/5.jpg",appointmentCount:1245,consultationCount:321,followCount:"22k"},{id:6,name:"èµµåŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åŒä»åŒ»é™¢",dept:"çœ¼ç§‘",goodAt:"çœ¼ç§‘ç–¾ç—…ã€ç™½å†…éšœã€é’å…‰çœ¼",avatar:"https://randomuser.me/api/portraits/men/6.jpg",appointmentCount:2689,consultationCount:623,followCount:"35k"},{id:7,name:"å­™åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å„¿ç«¥åŒ»é™¢",dept:"å„¿ç§‘",goodAt:"å„¿ç§‘ç–¾ç—…ã€å°å„¿æ„Ÿå†’ã€å‘è‚²è¿Ÿç¼“",avatar:"https://randomuser.me/api/portraits/men/7.jpg",appointmentCount:3124,consultationCount:756,followCount:"40k"},{id:8,name:"å‘¨åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¦‡äº§åŒ»é™¢",dept:"å¦‡äº§ç§‘",goodAt:"å¦‡ç§‘ç–¾ç—…ã€äº§ç§‘ã€ä¸å­•ä¸è‚²",avatar:"https://randomuser.me/api/portraits/men/8.jpg",appointmentCount:1987,consultationCount:498,followCount:"29k"},{id:9,name:"å´åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬è‚¿ç˜¤åŒ»é™¢",dept:"è‚¿ç˜¤å†…ç§‘",goodAt:"è‚¿ç˜¤è¯Šæ–­ã€åŒ–ç–—ã€é¶å‘æ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/9.jpg",appointmentCount:1456,consultationCount:389,followCount:"20k"},{id:10,name:"éƒ‘åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å£è…”åŒ»é™¢",dept:"å£è…”ç§‘",goodAt:"å£è…”ç–¾ç—…ã€ç‰™é½¿çŸ«æ­£ã€ç§æ¤ç‰™",avatar:"https://randomuser.me/api/portraits/men/10.jpg",appointmentCount:1678,consultationCount:412,followCount:"24k"},{id:11,name:"é’±åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å®£æ­¦åŒ»é™¢",dept:"ç¥ç»å¤–ç§‘",goodAt:"ç¥ç»å¤–ç§‘æ‰‹æœ¯ã€è„‘è‚¿ç˜¤ã€è„‘è¡€ç®¡ç—…",avatar:"https://randomuser.me/api/portraits/men/11.jpg",appointmentCount:1123,consultationCount:298,followCount:"18k"},{id:12,name:"é©¬åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å®‰è´åŒ»é™¢",dept:"å¿ƒå¤–ç§‘",goodAt:"å¿ƒè„å¤–ç§‘æ‰‹æœ¯ã€å…ˆå¤©æ€§å¿ƒè„ç—…",avatar:"https://randomuser.me/api/portraits/men/12.jpg",appointmentCount:987,consultationCount:245,followCount:"16k"},{id:13,name:"æœ±åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢",dept:"çƒ§ä¼¤ç§‘",goodAt:"çƒ§ä¼¤æ²»ç–—ã€åˆ›é¢ä¿®å¤ã€ç–¤ç—•æ²»ç–—",avatar:"https://randomuser.me/api/portraits/men/13.jpg",appointmentCount:756,consultationCount:187,followCount:"14k"},{id:14,name:"èƒ¡åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢",dept:"å‘¼å¸å†…ç§‘",goodAt:"å‘¼å¸ç³»ç»Ÿç–¾ç—…ã€å“®å–˜ã€æ…¢é˜»è‚º",avatar:"https://randomuser.me/api/portraits/men/14.jpg",appointmentCount:2145,consultationCount:534,followCount:"31k"},{id:15,name:"æ—åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬301åŒ»é™¢",dept:"å†…åˆ†æ³Œç§‘",goodAt:"ç³–å°¿ç—…ã€ç”²çŠ¶è…ºç–¾ç—…ã€è‚¥èƒ–ç—‡",avatar:"https://randomuser.me/api/portraits/men/15.jpg",appointmentCount:1789,consultationCount:467,followCount:"27k"},{id:16,name:"é»„åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬302åŒ»é™¢",dept:"æ„ŸæŸ“ç§‘",goodAt:"æ„ŸæŸ“æ€§ç–¾ç—…ã€è‚ç—…ã€ä¼ æŸ“ç—…",avatar:"https://randomuser.me/api/portraits/men/16.jpg",appointmentCount:1345,consultationCount:356,followCount:"21k"},{id:17,name:"æ¨åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬306åŒ»é™¢",dept:"æ³Œå°¿å¤–ç§‘",goodAt:"æ³Œå°¿ç³»ç»Ÿç–¾ç—…ã€è‚¾ç»“çŸ³ã€å‰åˆ—è…º",avatar:"https://randomuser.me/api/portraits/men/17.jpg",appointmentCount:1567,consultationCount:423,followCount:"23k"},{id:18,name:"ç½—åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬309åŒ»é™¢",dept:"èƒ¸å¤–ç§‘",goodAt:"èƒ¸éƒ¨ç–¾ç—…ã€è‚ºç™Œã€é£Ÿç®¡ç™Œ",avatar:"https://randomuser.me/api/portraits/men/18.jpg",appointmentCount:1098,consultationCount:287,followCount:"17k"},{id:19,name:"é«˜åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬307åŒ»é™¢",dept:"è¡€æ¶²ç§‘",goodAt:"è¡€æ¶²ç–¾ç—…ã€ç™½è¡€ç—…ã€è´«è¡€",avatar:"https://randomuser.me/api/portraits/men/19.jpg",appointmentCount:892,consultationCount:234,followCount:"15k"},{id:20,name:"æ¢åŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬308åŒ»é™¢",dept:"åº·å¤ç§‘",goodAt:"åº·å¤æ²»ç–—ã€è¿åŠ¨æŸä¼¤ã€åº·å¤è®­ç»ƒ",avatar:"https://randomuser.me/api/portraits/men/20.jpg",appointmentCount:1234,consultationCount:312,followCount:"19k"}].find((t=>t.id==e));t?this.doctorInfo=t:this.initDefaultDoctor()},initDefaultDoctor(){this.doctorInfo={name:"ç‹åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",title:"åšå£«ç”Ÿå¯¼å¸ˆ",dept:"å†…åˆ†æ³Œç§‘",avatar:"https://randomuser.me/api/portraits/men/3.jpg",goodAt:"å†…åˆ†æ³Œä¸“å®¶,ç”²çŠ¶è…ºç»¼åˆæ‰‹æœ¯æ²»ç–—ä¸“å®¶,çœçº§å†…åˆ†æ³Œç§‘å§”å‘˜ä¼šå§”å‘˜,ç‹¬åˆ›ä¸­åŒ»ç–—æ³•,å†…åˆ†æ³Œç§‘ç–‘éš¾æ‚ç—‡ç»¼åˆæ²»ç–—",appointmentCount:2312,consultationCount:542,followCount:"32k"}},generateAppointmentSlots(){const e=new Date,t=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];this.appointmentSlots1=[];for(let a=0;a<4;a++){const o=new Date(e);o.setDate(e.getDate()+a);const n=(o.getMonth()+1).toString().padStart(2,"0"),s=o.getDate().toString().padStart(2,"0"),i=t[o.getDay()],r=0===a||a%2==0?"ä¸Šåˆ":"ä¸‹åˆ";this.appointmentSlots1.push({date:`${n}/${s}`,time:`${i}${r}`,status:a<2?"full":"available"})}this.appointmentSlots2=[];for(let a=3;a<5;a++){const o=new Date(e);o.setDate(e.getDate()+a);const n=(o.getMonth()+1).toString().padStart(2,"0"),s=o.getDate().toString().padStart(2,"0"),i=t[o.getDay()],r=3===a?"ä¸Šåˆ":"ä¸‹åˆ";this.appointmentSlots2.push({date:`${n}/${s}`,time:`${i}${r}`,status:"available"})}this.appointmentSlots3=[];for(let a=2;a<4;a++){const o=new Date(e);o.setDate(e.getDate()+a);const n=(o.getMonth()+1).toString().padStart(2,"0"),s=o.getDate().toString().padStart(2,"0"),i=t[o.getDay()],r=2===a||0===o.getDay()?"ä¸Šåˆ":"ä¸‹åˆ";this.appointmentSlots3.push({date:`${n}/${s}`,time:`${i}${r}`,status:2===a?"full":"available"})}},switchTab(e){this.activeTabIndex=e},bookAppointment(e){if("full"===e.status)return void uni.showToast({title:"è¯¥æ—¶é—´æ®µå·²çº¦æ»¡",icon:"none"});const t=encodeURIComponent(JSON.stringify(this.doctorInfo)),a=encodeURIComponent(this.doctorInfo.hospital||"åŒ—äº¬åå’ŒåŒ»é™¢"),o=encodeURIComponent(this.doctorInfo.dept||"å†…åˆ†æ³Œç§‘"),n=(new Date).getFullYear(),s=e.date.split("/"),i=`${n}å¹´${s[0]}æœˆ${s[1]}æ—¥`,r=encodeURIComponent(i),l=encodeURIComponent(e.time),c=encodeURIComponent("ä¸“å®¶é—¨è¯Š"),d=encodeURIComponent(318);uni.navigateTo({url:`/pages/doctor/appointment?doctor=${t}&hospital=${a}&dept=${o}&date=${r}&time=${l}&type=${c}&fee=${d}`})},goHospitalHome(){const e=this.doctorInfo.hospital||"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",a=this.getHospitalAddress(e),o=this.getHospitalLocation(e);uni.navigateTo({url:`/pages/hospital-detail/index?name=${encodeURIComponent(e)}&address=${encodeURIComponent(a)}&level=ä¸‰ç”²&longitude=${o[0]}&latitude=${o[1]}`,fail:e=>{t("error","at pages/doctor/detail.vue:530","è·³è½¬åˆ°åŒ»é™¢è¯¦æƒ…é¡µå¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥",icon:"none"})}})},showInternetDesc(){uni.showModal({title:"äº’è”ç½‘é—¨è¯Šè¯´æ˜",content:"äº’è”ç½‘é—¨è¯Šæ˜¯ä¸€ç§æ–°å‹çš„åŒ»ç–—æœåŠ¡æ¨¡å¼ï¼Œæ‚£è€…å¯ä»¥é€šè¿‡æ‰‹æœºæˆ–ç”µè„‘åœ¨çº¿å’¨è¯¢åŒ»ç”Ÿï¼Œæ— éœ€åˆ°åŒ»é™¢ç°åœºã€‚\n\næœåŠ¡ç‰¹ç‚¹ï¼š\n1. åœ¨çº¿é—®è¯Šï¼šé€šè¿‡è§†é¢‘ã€è¯­éŸ³æˆ–æ–‡å­—ä¸åŒ»ç”Ÿæ²Ÿé€š\n2. ç”µå­å¤„æ–¹ï¼šåŒ»ç”Ÿå¯åœ¨çº¿å¼€å…·ç”µå­å¤„æ–¹\n3. è¯å“é…é€ï¼šæ”¯æŒè¯å“é…é€åˆ°å®¶\n4. å¤è¯Šç»­æ–¹ï¼šæ…¢æ€§ç—…æ‚£è€…å¯åœ¨çº¿å¤è¯Šç»­æ–¹\n5. æŠ¥å‘ŠæŸ¥è¯¢ï¼šåœ¨çº¿æŸ¥çœ‹æ£€æŸ¥æŠ¥å‘Šå’Œç—…å†\n\né€‚ç”¨äººç¾¤ï¼š\nâ€¢ å¸¸è§ç—…ã€æ…¢æ€§ç—…å¤è¯Šæ‚£è€…\nâ€¢ éœ€è¦å¥åº·å’¨è¯¢çš„ç”¨æˆ·\nâ€¢ è¡ŒåŠ¨ä¸ä¾¿çš„æ‚£è€…\nâ€¢ æ—¶é—´ç´§å¼ æ— æ³•åˆ°é™¢çš„æ‚£è€…\n\næ³¨æ„äº‹é¡¹ï¼š\nâ€¢ æ€¥é‡ç—‡æ‚£è€…è¯·åŠæ—¶åˆ°åŒ»é™¢å°±è¯Š\nâ€¢ é¦–æ¬¡å°±è¯Šå»ºè®®åˆ°åŒ»é™¢é¢è¯Š\nâ€¢ äº’è”ç½‘é—¨è¯Šä¸èƒ½å®Œå…¨æ›¿ä»£çº¿ä¸‹è¯Šç–—",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#2979ff"})},getHospitalLocation:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":[116.3732,39.9885],"åŒ—äº¬åå’ŒåŒ»é™¢":[116.4179,39.9042],"åŒ—äº¬å¤©å›åŒ»é™¢":[116.4074,39.8806],"åŒ—äº¬æœé˜³åŒ»é™¢":[116.4681,39.9289],"åŒ—äº¬å‹è°ŠåŒ»é™¢":[116.3607,39.8765],"åŒ—äº¬åŒä»åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬å„¿ç«¥åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å¦‡äº§åŒ»é™¢":[116.4345,39.9042],"åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":[116.3509,39.9042],"åŒ—äº¬å£è…”åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬301åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬å®‰è´åŒ»é™¢":[116.4074,39.9885],"åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":[116.4179,39.9885],"åŒ—äº¬302åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬306åŒ»é™¢":[116.3509,39.9885],"åŒ—äº¬309åŒ»é™¢":[116.2732,39.9885],"åŒ—äº¬307åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬308åŒ»é™¢":[116.2732,39.9042],"åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":[116.3732,39.9042],"åŒ—äº¬å®£æ­¦åŒ»é™¢":[116.3607,39.9042],"æœé˜³åŒ»é™¢ç¤¾åŒºé—¨è¯Šä¸­å¿ƒ":[116.4681,39.9289]}[e]||[116.397428,39.90923]),getHospitalAddress:e=>({"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œå•åŒ—å¤§è¡—53å·","åŒ—äº¬åå’ŒåŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºç‹åºœäº•å¤§è¡—1å·","åŒ—äº¬å¤©å›åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ6å·","åŒ—äº¬æœé˜³åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå·¥äººä½“è‚²åœºå—è·¯8å·","åŒ—äº¬å‹è°ŠåŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ°¸å®‰è·¯95å·","åŒ—äº¬åŒä»åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œäº¤æ°‘å··1å·","åŒ—äº¬å„¿ç«¥åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºå—ç¤¼å£«è·¯56å·","åŒ—äº¬å¦‡äº§åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå§šå®¶å›­è·¯251å·","åŒ—äº¬è‚¿ç˜¤åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé˜œæˆè·¯52å·","åŒ—äº¬å£è…”åŒ»é™¢":"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å›è¥¿é‡Œ4å·","åŒ—äº¬301åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤å…´è·¯28å·","åŒ—äº¬å®‰è´åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰è´è·¯2å·","åŒ—äº¬ä¸­æ—¥å‹å¥½åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºæ¨±èŠ±å›­ä¸œè¡—2å·","åŒ—äº¬302åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºè¥¿å››ç¯ä¸­è·¯100å·","åŒ—äº¬306åŒ»é™¢":"åŒ—äº¬å¸‚æœé˜³åŒºå®‰ç¿”åŒ—é‡Œ9å·","åŒ—äº¬309åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºé»‘å±±æ‰ˆè·¯17å·","åŒ—äº¬307åŒ»é™¢":"åŒ—äº¬å¸‚ä¸°å°åŒºä¸œå¤§è¡—8å·","åŒ—äº¬308åŒ»é™¢":"åŒ—äº¬å¸‚æµ·æ·€åŒºå¤ªå¹³è·¯27å·","åŒ—äº¬ç§¯æ°´æ½­åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºæ–°è¡—å£ä¸œè¡—31å·","åŒ—äº¬å®£æ­¦åŒ»é™¢":"åŒ—äº¬å¸‚è¥¿åŸåŒºé•¿æ¤¿è¡—45å·","æœé˜³åŒ»é™¢ç¤¾åŒºé—¨è¯Šä¸­å¿ƒ":"åŒ—äº¬å¸‚æœé˜³åŒºå·¥äººä½“è‚²åœºå—è·¯8å·"}[e]||"åŒ—äº¬å¸‚"),onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},goBack(){uni.navigateBack()},toggleFavorite(){this.isFavorited=!this.isFavorited,uni.showToast({title:this.isFavorited?"å·²æ”¶è—":"å·²å–æ¶ˆæ”¶è—",icon:"none"})},shareDoctor(){uni.showToast({title:"åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},goExpertConsultation(){uni.navigateTo({url:`/pages/online-consult/index?doctorId=${this.doctorInfo.id||""}`})},viewMoreReviews(){const e=encodeURIComponent(JSON.stringify(this.doctorInfo)),a=encodeURIComponent(JSON.stringify(this.reviews));uni.navigateTo({url:`/pages/doctor/reviews?doctor=${e}&reviews=${a}`,fail:e=>{t("error","at pages/doctor/detail.vue:636","è·³è½¬åˆ°è¯„ä»·é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},viewMoreHistory(){const e=encodeURIComponent(JSON.stringify(this.doctorInfo)),a=encodeURIComponent(JSON.stringify(this.consultationHistory));uni.navigateTo({url:`/pages/doctor/consultation-history?doctor=${e}&consultations=${a}`,fail:e=>{t("error","at pages/doctor/detail.vue:651","è·³è½¬åˆ°å†å²é—®è¯Šé¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},viewMoreArticles(){const e=encodeURIComponent(JSON.stringify(this.doctorInfo)),a=encodeURIComponent(JSON.stringify(this.articles));uni.navigateTo({url:`/pages/doctor/articles?doctor=${e}&articles=${a}`,fail:e=>{t("error","at pages/doctor/detail.vue:666","è·³è½¬åˆ°æ–‡ç« åˆ—è¡¨é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},viewConsultationDetail(e){const a=encodeURIComponent(JSON.stringify(e)),o=encodeURIComponent(JSON.stringify(this.doctorInfo));uni.navigateTo({url:`/pages/doctor/consultation-detail?consultation=${a}&doctor=${o}`,fail:e=>{t("error","at pages/doctor/detail.vue:681","è·³è½¬åˆ°é—®è¯Šè¯¦æƒ…é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},viewArticle(e){const a=encodeURIComponent(JSON.stringify(e)),o=encodeURIComponent(JSON.stringify(this.doctorInfo));uni.navigateTo({url:`/pages/doctor/article-detail?article=${a}&doctor=${o}`,fail:e=>{t("error","at pages/doctor/detail.vue:696","è·³è½¬åˆ°æ–‡ç« è¯¦æƒ…é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})}}};const es=s(Zn,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("view",{class:"nav-actions"},[e.createElementVNode("view",{class:"nav-action-btn",onClick:a[1]||(a[1]=(...e)=>i.toggleFavorite&&i.toggleFavorite(...e))},[e.createElementVNode("text",{class:e.normalizeClass(["action-icon",{favorited:s.isFavorited}])},e.toDisplayString(s.isFavorited?"â˜…":"â˜†"),3)]),e.createElementVNode("view",{class:"nav-action-btn",onClick:a[2]||(a[2]=(...e)=>i.shareDoctor&&i.shareDoctor(...e))},[e.createElementVNode("text",{class:"action-icon"},"â†—")])])]),e.createElementVNode("view",{class:"doctor-header"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar-large",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info-right"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name-large"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level-large"},e.toDisplayString(s.doctorInfo.level),1)]),e.createElementVNode("text",{class:"doctor-hospital-large"},e.toDisplayString(s.doctorInfo.hospital)+e.toDisplayString(s.doctorInfo.title||""),1),e.createElementVNode("view",{class:"doctor-stats"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},"é¢„çº¦é‡ "+e.toDisplayString(s.doctorInfo.appointmentCount||2312),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},"å’¨è¯¢é‡ "+e.toDisplayString(s.doctorInfo.consultationCount||542),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},"å…³æ³¨é‡ "+e.toDisplayString(s.doctorInfo.followCount||"32k"),1)])])])]),e.createElementVNode("view",{class:"doctor-intro"},[e.createElementVNode("text",{class:"intro-quote"},'"'),e.createElementVNode("text",{class:"intro-text"},e.toDisplayString(s.doctorInfo.introduction||s.doctorInfo.goodAt||"å†…åˆ†æ³Œä¸“å®¶,ç”²çŠ¶è…ºç»¼åˆæ‰‹æœ¯æ²»ç–—ä¸“å®¶,çœçº§å†…åˆ†æ³Œç§‘å§”å‘˜ä¼šå§”å‘˜,ç‹¬åˆ›ä¸­åŒ»ç–—æ³•,å†…åˆ†æ³Œç§‘ç–‘éš¾æ‚ç—‡ç»¼åˆæ²»ç–—"),1)])]),e.createElementVNode("view",{class:"nav-tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.tabs,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item",{active:s.activeTabIndex===a}]),onClick:e=>i.switchTab(a)},[e.createElementVNode("text",{class:"tab-text"},e.toDisplayString(t),1)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"content","scroll-y":""},[0===s.activeTabIndex?(e.openBlock(),e.createElementBlock("view",{key:0,class:"appointment-content"},[e.createElementVNode("view",{class:"hospital-section"},[e.createElementVNode("view",{class:"hospital-header"},[e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(s.doctorInfo.hospital),1),e.createElementVNode("text",{class:"hospital-link",onClick:a[3]||(a[3]=(...e)=>i.goHospitalHome&&i.goHospitalHome(...e))},"åŒ»é™¢é¦–é¡µ >")]),e.createElementVNode("view",{class:"dept-section"},[e.createElementVNode("text",{class:"dept-name"},e.toDisplayString(s.doctorInfo.dept)+"é—¨è¯Š",1),e.createElementVNode("view",{class:"time-slots"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.appointmentSlots1,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["time-slot",{disabled:"full"===t.status}]),onClick:e=>i.bookAppointment(t)},[e.createElementVNode("text",{class:"slot-text"},e.toDisplayString(t.date)+" "+e.toDisplayString(t.time)+" "+e.toDisplayString("full"===t.status?"çº¦æ»¡":"é¢„çº¦"),1)],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"dept-section"},[e.createElementVNode("view",{class:"dept-header-row"},[e.createElementVNode("text",{class:"dept-name"},"ç‰¹éœ€"+e.toDisplayString(s.doctorInfo.dept)+"é—¨è¯Š(è¥¿é™¢)",1),e.createElementVNode("text",{class:"internet-link",onClick:a[4]||(a[4]=(...e)=>i.showInternetDesc&&i.showInternetDesc(...e))},"äº’è”ç½‘é—¨è¯Šè¯´æ˜>")]),e.createElementVNode("view",{class:"time-slots"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.appointmentSlots2,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["time-slot",{disabled:"full"===t.status}]),onClick:e=>i.bookAppointment(t)},[e.createElementVNode("text",{class:"slot-text"},e.toDisplayString(t.date)+" "+e.toDisplayString(t.time)+" "+e.toDisplayString("full"===t.status?"çº¦æ»¡":"é¢„çº¦"),1)],10,["onClick"])))),128))])])]),e.createElementVNode("view",{class:"hospital-section"},[e.createElementVNode("view",{class:"hospital-header"},[e.createElementVNode("view",{class:"hospital-name-row"},[e.createElementVNode("text",{class:"hospital-name"},"æœé˜³åŒ»é™¢ç¤¾åŒºé—¨è¯Šä¸­å¿ƒ"),e.createElementVNode("text",{class:"multi-tag"},"å¤šç‚¹åè¯Š")]),e.createElementVNode("text",{class:"hospital-link",onClick:a[5]||(a[5]=(...e)=>i.goHospitalHome&&i.goHospitalHome(...e))},"åŒ»é™¢é¦–é¡µ >")]),e.createElementVNode("view",{class:"dept-section"},[e.createElementVNode("text",{class:"dept-name"},"æ™®é€šå†…ç§‘é—¨è¯Š"),e.createElementVNode("view",{class:"time-slots"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.appointmentSlots3,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["time-slot",{disabled:"full"===t.status}]),onClick:e=>i.bookAppointment(t)},[e.createElementVNode("text",{class:"slot-text"},e.toDisplayString(t.date)+" "+e.toDisplayString(t.time)+" "+e.toDisplayString("full"===t.status?"çº¦æ»¡":"é¢„çº¦"),1)],10,["onClick"])))),128))])])])])):e.createCommentVNode("",!0),1===s.activeTabIndex?(e.openBlock(),e.createElementBlock("view",{key:1,class:"medical-services-content"},[e.createElementVNode("view",{class:"service-item",onClick:a[6]||(a[6]=(...e)=>i.goExpertConsultation&&i.goExpertConsultation(...e))},[e.createElementVNode("view",{class:"service-icon expert-icon"},[e.createElementVNode("view",{class:"icon-chat"})]),e.createElementVNode("view",{class:"service-info"},[e.createElementVNode("text",{class:"service-title"},"ä¸“å®¶é—®è¯Š"),e.createElementVNode("text",{class:"service-desc"},"48å°æ—¶å†…å¯è¿½é—®å’¨è¯¢")]),e.createElementVNode("view",{class:"service-price"},[e.createElementVNode("text",{class:"current-price"},"Â¥49/æ¬¡"),e.createElementVNode("text",{class:"original-price"},"Â¥100/æ¬¡")]),e.createElementVNode("text",{class:"arrow-icon"},"â€º")]),e.createElementVNode("view",{class:"service-item disabled"},[e.createElementVNode("view",{class:"service-icon rehab-icon"},[e.createElementVNode("view",{class:"icon-phone"})]),e.createElementVNode("view",{class:"service-info"},[e.createElementVNode("text",{class:"service-title"},"åº·å¤ç”µè¯"),e.createElementVNode("text",{class:"service-desc"},"è¯Šååº·å¤,ä¸“å®¶éšè®¿ç”µè¯æœåŠ¡")]),e.createElementVNode("text",{class:"service-status"},"æš‚æœªå¼€é€š"),e.createElementVNode("text",{class:"arrow-icon"},"â€º")])])):e.createCommentVNode("",!0),2===s.activeTabIndex?(e.openBlock(),e.createElementBlock("view",{key:2,class:"reviews-content"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"æ‚£è€…è¯„ä»·"),e.createElementVNode("text",{class:"view-more",onClick:a[7]||(a[7]=(...e)=>i.viewMoreReviews&&i.viewMoreReviews(...e))},"æŸ¥çœ‹æ›´å¤š>")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.reviews,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"review-item"},[e.createElementVNode("view",{class:"review-stars"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(a=>e.createElementVNode("text",{key:a,class:e.normalizeClass(["star",{active:a<=t.rating}])},"â˜…",2))),64))]),e.createElementVNode("text",{class:"review-text"},e.toDisplayString(t.comment),1),e.createElementVNode("view",{class:"review-meta"},[e.createElementVNode("text",{class:"reviewer"},e.toDisplayString(t.reviewer)+" "+e.toDisplayString(t.type),1),e.createElementVNode("text",{class:"review-dept"},e.toDisplayString(t.department),1),e.createElementVNode("text",{class:"review-date"},e.toDisplayString(t.date),1)])])))),128))])):e.createCommentVNode("",!0),3===s.activeTabIndex?(e.openBlock(),e.createElementBlock("view",{key:3,class:"consultation-history-content"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å†å²é—®è¯Š"),e.createElementVNode("text",{class:"view-more",onClick:a[8]||(a[8]=(...e)=>i.viewMoreHistory&&i.viewMoreHistory(...e))},"æŸ¥çœ‹æ›´å¤š>")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.consultationHistory,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"consultation-item",onClick:e=>i.viewConsultationDetail(t)},[e.createElementVNode("text",{class:"consultation-question"},e.toDisplayString(t.patientInfo)+" "+e.toDisplayString(t.question),1),e.createElementVNode("text",{class:"consultation-reply"},e.toDisplayString(t.reply),1),e.createElementVNode("text",{class:"consultation-date"},e.toDisplayString(t.date),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0),4===s.activeTabIndex?(e.openBlock(),e.createElementBlock("view",{key:4,class:"articles-content"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"åŒ»ç”Ÿæ–‡ç« "),e.createElementVNode("text",{class:"view-more",onClick:a[9]||(a[9]=(...e)=>i.viewMoreArticles&&i.viewMoreArticles(...e))},"æŸ¥çœ‹æ›´å¤š>")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.articles,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"article-item",onClick:e=>i.viewArticle(t)},[e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("text",{class:"article-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"article-subtitle"},e.toDisplayString(t.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"article-reads"},e.toDisplayString(t.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(t.date),1)])]),e.createElementVNode("view",{class:"article-image"},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"article-img"},null,8,["src"])])],8,["onClick"])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"float-btn",onClick:a[10]||(a[10]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-a0f22f97"]]);function ts(){try{const e=getApp&&getApp(),t=e&&e.globalData&&e.globalData.userInfo||uni.getStorageSync("userInfo")||{};return t.id||t._id||t.userId||t.username||t.phone||"default"}catch(Kt){return"default"}}function as(){try{const e=`patients_${ts()}`;return uni.getStorageSync(e)||[]}catch(Kt){return t("error","at utils/patientStorage.js:30","è·å–å°±è¯Šäººåˆ—è¡¨å¤±è´¥:",Kt),[]}}function os(e){try{const t=`patients_${ts()}`;let a=uni.getStorageSync(t)||[];if(e.id){const t=a.findIndex((t=>t.id===e.id));-1!==t?a[t]={...e,updatedAt:(new Date).toISOString()}:a.push({...e,id:e.id,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}else{const t={...e,id:`patient_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};a.push(t)}return uni.setStorageSync(t,a),e.id||a[a.length-1].id}catch(Kt){throw t("error","at utils/patientStorage.js:68","ä¿å­˜å°±è¯Šäººå¤±è´¥:",Kt),Kt}}function ns(e){try{const t=`patients_${ts()}`;let a=uni.getStorageSync(t)||[];return a=a.filter((t=>t.id!==e)),uni.setStorageSync(t,a),!0}catch(Kt){return t("error","at utils/patientStorage.js:87","åˆ é™¤å°±è¯Šäººå¤±è´¥:",Kt),!1}}function ss(e){try{return as().find((t=>t.id===e))||null}catch(Kt){return t("error","at utils/patientStorage.js:102","è·å–å°±è¯Šäººä¿¡æ¯å¤±è´¥:",Kt),null}}function is(){try{const e=`defaultPatient_${ts()}`,t=uni.getStorageSync(e);if(t)return ss(t);const a=as();return a.length>0?a[0]:null}catch(Kt){return t("error","at utils/patientStorage.js:140","è·å–é»˜è®¤å°±è¯Šäººå¤±è´¥:",Kt),null}}const rs={data:()=>({doctorInfo:{},appointmentInfo:{hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",dept:"ç¥ç»å†…ç§‘",date:"2020å¹´05æœˆ05æ—¥",time:"å‘¨å››ä¸‹åˆ",type:"ä¸“å®¶é—¨è¯Š",fee:318},selectedPatientIndex:0,patientList:[],hasInsurance:!0,insuranceCardNumber:"",phoneNumber:"",verifyCode:"",codeCountdown:0}),computed:{selectedPatient(){return this.patientList[this.selectedPatientIndex]||{}}},onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/appointment.vue:183","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt),this.initDefaultDoctor()}else this.initDefaultDoctor();e.date&&e.time&&(this.appointmentInfo.date=decodeURIComponent(e.date),this.appointmentInfo.time=decodeURIComponent(e.time)),e.hospital&&(this.appointmentInfo.hospital=decodeURIComponent(e.hospital)),e.dept&&(this.appointmentInfo.dept=decodeURIComponent(e.dept)),e.type&&(this.appointmentInfo.type=decodeURIComponent(e.type)),e.fee&&(this.appointmentInfo.fee=parseInt(decodeURIComponent(e.fee))||318),this.loadPatients()},onShow(){this.loadPatients(),uni.$on("patientUpdated",this.loadPatients)},onHide(){uni.$off("patientUpdated",this.loadPatients)},methods:{initDefaultDoctor(){this.doctorInfo={name:"ç‹åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",title:"åšå£«ç”Ÿå¯¼å¸ˆ",avatar:"https://randomuser.me/api/portraits/men/3.jpg"}},loadPatients(){try{const e=as();if(e&&e.length>0){this.patientList=e.map((e=>({id:e.id,name:e.name,gender:e.gender,age:e.age,phone:e.phone||""})));const t=is();if(t){const e=this.patientList.findIndex((e=>e.id===t.id));this.selectedPatientIndex=e>=0?e:0}else this.selectedPatientIndex=0}else this.patientList=[],this.selectedPatientIndex=-1}catch(Kt){t("error","at pages/doctor/appointment.vue:262","åŠ è½½å°±è¯Šäººåˆ—è¡¨å¤±è´¥:",Kt),this.patientList=[],this.selectedPatientIndex=-1}},selectPatient(e){this.selectedPatientIndex=e;const t=this.patientList[e];t&&t.phone&&(this.phoneNumber=t.phone)},addPatient(){uni.navigateTo({url:"/pages/mine/patient-edit",success:()=>{},fail:e=>{t("error","at pages/doctor/appointment.vue:283","è·³è½¬åˆ°æ·»åŠ å°±è¯Šäººé¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})},setInsurance(e){this.hasInsurance=e,e||(this.insuranceCardNumber="")},async sendVerifyCode(){var e,a;if(this.codeCountdown>0)return;if(!this.phoneNumber)return void uni.showToast({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none",duration:2e3});if(/^1[3-9]\d{9}$/.test(this.phoneNumber))try{t("log","at pages/doctor/appointment.vue:324","ğŸ“¤ å¼€å§‹å‘é€éªŒè¯ç ï¼Œæ‰‹æœºå·:",this.phoneNumber);const e=await Pe({url:"/auth/send-code",method:"POST",data:{phone:this.phoneNumber,type:"appointment"},needAuth:!1,showError:!1});if(t("log","at pages/doctor/appointment.vue:337","ğŸ“¥ æ”¶åˆ°å“åº”:",e),e&&e.success){uni.showToast({title:e.message||"éªŒè¯ç å·²å‘é€",icon:"success",duration:2e3}),this.codeCountdown=60;const a=setInterval((()=>{this.codeCountdown--,this.codeCountdown<=0&&clearInterval(a)}),1e3);e.code&&(t("log","at pages/doctor/appointment.vue:357","âœ… éªŒè¯ç ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰:",e.code),setTimeout((()=>{uni.showModal({title:"éªŒè¯ç ï¼ˆå¼€å‘ç¯å¢ƒï¼‰",content:`éªŒè¯ç ï¼š${e.code}`,showCancel:!1})}),500))}else{const a=(null==e?void 0:e.message)||(null==e?void 0:e.error)||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•";t("error","at pages/doctor/appointment.vue:368","âŒ å‘é€å¤±è´¥:",a),uni.showToast({title:a,icon:"none",duration:3e3})}}catch(o){t("error","at pages/doctor/appointment.vue:376","âŒ å‘é€éªŒè¯ç å¼‚å¸¸:",o),t("error","at pages/doctor/appointment.vue:377","é”™è¯¯è¯¦æƒ…:",JSON.stringify(o));let n="å‘é€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";o.message?n=o.message:o.errMsg?n=o.errMsg.includes("timeout")?"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":o.errMsg.includes("fail")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼ˆhttp://localhost:3000ï¼‰":o.errMsg:"string"==typeof o?n=o:o.response&&(n=(null==(e=o.response.data)?void 0:e.message)||(null==(a=o.response.data)?void 0:a.error)||"æœåŠ¡å™¨é”™è¯¯"),uni.showToast({title:n,icon:"none",duration:3e3})}else uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none",duration:2e3})},submitAppointment(){if(!this.selectedPatient.name)return void uni.showToast({title:"è¯·é€‰æ‹©å°±è¯Šäºº",icon:"none"});if(!this.phoneNumber)return void uni.showToast({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none"});if(!/^1[3-9]\d{9}$/.test(this.phoneNumber))return void uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"});if(this.hasInsurance&&!this.insuranceCardNumber)return void uni.showToast({title:"è¯·è¾“å…¥åŒ»ä¿å¡å·",icon:"none"});if(!this.verifyCode)return void uni.showToast({title:"è¯·è¾“å…¥éªŒè¯ç ",icon:"none"});if(6!==this.verifyCode.length)return void uni.showToast({title:"éªŒè¯ç ä¸º6ä½æ•°å­—",icon:"none"});const e={doctorName:this.doctorInfo.name||"ç‹åŒ»ç”Ÿ",title:this.doctorInfo.level||"ä¸»ä»»åŒ»å¸ˆ",hospital:this.appointmentInfo.hospital||"åŒ—äº¬åå’ŒåŒ»é™¢",dept:this.appointmentInfo.dept||"ç¥ç»å†…ç§‘",specialty:this.appointmentInfo.dept||"ç¥ç»å†…ç§‘",expertise:this.doctorInfo.goodAt||"ä¸“ä¸šé¢†åŸŸ",avatar:this.doctorInfo.avatar||"https://randomuser.me/api/portraits/men/3.jpg",patientName:this.selectedPatient.name,patientGender:this.selectedPatient.gender,patientAge:this.selectedPatient.age,patientPhone:this.phoneNumber,date:this.appointmentInfo.date,time:this.appointmentInfo.time,type:this.appointmentInfo.type||"ä¸“å®¶é—¨è¯Š",price:this.appointmentInfo.fee||318,status:"pendingVisit",hasInsurance:this.hasInsurance,insuranceCardNumber:this.insuranceCardNumber||"",verifyCode:this.verifyCode};try{const a=function(e){try{const a=he();e.id||(e.id=`appt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.createdAt||(e.createdAt=Date.now()),e.status||(e.status="pendingVisit"),e.updatedAt=Date.now();const o=a.findIndex((t=>t.id===e.id));return o>=0?a[o]={...a[o],...e,updatedAt:Date.now()}:a.unshift(e),a.length>100&&a.splice(100),uni.setStorageSync(pe,JSON.stringify(a)),t("log","at utils/appointmentStorage.js:69","âœ… é¢„çº¦è®°å½•å·²ä¿å­˜:",e.id),e.id}catch(a){throw t("error","at utils/appointmentStorage.js:72","ä¿å­˜é¢„çº¦è®°å½•å¤±è´¥:",a),a}}(e);t("log","at pages/doctor/appointment.vue:483","é¢„çº¦å·²ä¿å­˜ï¼ŒID:",a),uni.showToast({title:"é¢„çº¦æˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(a){t("error","at pages/doctor/appointment.vue:496","ä¿å­˜é¢„çº¦å¤±è´¥:",a),uni.showToast({title:"é¢„çº¦å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}},onFloatClick(){uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}}};const ls=s(rs,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("scroll-view",{class:"content","scroll-y":""},[e.createElementVNode("view",{class:"doctor-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1)]),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital)+e.toDisplayString(s.doctorInfo.title||""),1)])]),e.createElementVNode("view",{class:"appointment-details"},[e.createElementVNode("view",{class:"detail-row"},[e.createElementVNode("text",{class:"detail-label"},"å°±è¯ŠåŒ»é™¢ç§‘å®¤"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(s.appointmentInfo.hospital)+" - "+e.toDisplayString(s.appointmentInfo.dept),1)]),e.createElementVNode("view",{class:"detail-row"},[e.createElementVNode("text",{class:"detail-label"},"é—¨è¯Šæ—¶é—´"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(s.appointmentInfo.date)+" "+e.toDisplayString(s.appointmentInfo.time),1)]),e.createElementVNode("view",{class:"detail-row"},[e.createElementVNode("text",{class:"detail-label"},"é—¨è¯Šç±»å‹"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(s.appointmentInfo.type),1)]),e.createElementVNode("view",{class:"detail-row"},[e.createElementVNode("text",{class:"detail-label"},"åŒ»äº‹æœåŠ¡è´¹"),e.createElementVNode("text",{class:"detail-value price"},"Â¥"+e.toDisplayString(s.appointmentInfo.fee),1)])]),e.createElementVNode("view",{class:"appointment-notes"},[e.createElementVNode("view",{class:"notes-header"},[e.createElementVNode("view",{class:"info-icon"},"â„¹"),e.createElementVNode("text",{class:"notes-title"},"é—¨è¯Šé¢„çº¦æŒ‚å·é¡»çŸ¥"),e.createElementVNode("text",{class:"notes-subtitle"},"(é¢„çº¦å³ä»£è¡¨åŒæ„ä»¥ä¸‹è§„åˆ™)")]),e.createElementVNode("view",{class:"notes-list"},[e.createElementVNode("text",{class:"note-item"},"1. åŒ»äº‹æœåŠ¡è´¹ç”±åŒ»é™¢è®¾å®šæœ¬å¹³å°ä¸æ”¶å–ä»»ä½•é¢å¤–è´¹ç”¨"),e.createElementVNode("text",{class:"note-item"},"2. åœè¯Šå°†çŸ­ä¿¡é€šçŸ¥,è¯·ä¿æŒæ‰‹æœºç•…é€š"),e.createElementVNode("text",{class:"note-item"},"3. å®ååˆ¶é¢„çº¦,å°±è¯Šäººä¿¡æ¯ä¸ç¬¦å°†æ— æ³•å–å·")])]),e.createElementVNode("view",{class:"patient-section"},[e.createElementVNode("text",{class:"section-title"},"é€‰æ‹©å°±è¯Šäºº:"),e.createElementVNode("view",{class:"patient-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.patientList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["patient-card",{selected:s.selectedPatientIndex===a}]),onClick:e=>i.selectPatient(a)},[e.createElementVNode("text",{class:"patient-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"patient-info"},e.toDisplayString(t.gender)+" | "+e.toDisplayString(t.age)+"å²",1),s.selectedPatientIndex===a?(e.openBlock(),e.createElementBlock("view",{key:0,class:"check-icon"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"])))),128)),e.createElementVNode("view",{class:"patient-card add-patient",onClick:a[0]||(a[0]=(...e)=>i.addPatient&&i.addPatient(...e))},[e.createElementVNode("text",{class:"add-icon"},"+")])])]),e.createElementVNode("view",{class:"insurance-section"},[e.createElementVNode("text",{class:"section-title"},"æ˜¯å¦æœ‰åŒ»ä¿å¡:"),e.createElementVNode("view",{class:"insurance-buttons"},[e.createElementVNode("view",{class:e.normalizeClass(["insurance-btn",{active:s.hasInsurance}]),onClick:a[1]||(a[1]=e=>i.setInsurance(!0))},[e.createElementVNode("text",null,"æ˜¯")],2),e.createElementVNode("view",{class:e.normalizeClass(["insurance-btn",{active:!s.hasInsurance}]),onClick:a[2]||(a[2]=e=>i.setInsurance(!1))},[e.createElementVNode("text",null,"å¦")],2)]),s.hasInsurance?(e.openBlock(),e.createElementBlock("view",{key:0,class:"insurance-input-wrapper"},[e.withDirectives(e.createElementVNode("input",{class:"insurance-input",type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>s.insuranceCardNumber=e),placeholder:"åŒ»ä¿å¡å·","placeholder-class":"input-placeholder"},null,512),[[e.vModelText,s.insuranceCardNumber]])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"contact-section"},[e.createElementVNode("view",{class:"contact-row"},[e.createElementVNode("text",{class:"contact-label"},"å°±è¯Šäººæ‰‹æœº:"),e.withDirectives(e.createElementVNode("input",{class:"phone-input",type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>s.phoneNumber=e),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·","placeholder-class":"input-placeholder",maxlength:"11"},null,512),[[e.vModelText,s.phoneNumber]])]),e.createElementVNode("view",{class:"verify-row"},[e.withDirectives(e.createElementVNode("input",{class:"verify-input",type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>s.verifyCode=e),placeholder:"éªŒè¯ç ","placeholder-class":"input-placeholder",maxlength:"6"},null,512),[[e.vModelText,s.verifyCode]]),e.createElementVNode("button",{class:"send-code-btn",disabled:s.codeCountdown>0||!s.phoneNumber,onClick:a[6]||(a[6]=(...e)=>i.sendVerifyCode&&i.sendVerifyCode(...e))},e.toDisplayString(s.codeCountdown>0?`${s.codeCountdown}ç§’åé‡è¯•`:"å‘é€éªŒè¯ç "),9,["disabled"])])])]),e.createElementVNode("view",{class:"bottom-bar"},[e.createElementVNode("button",{class:"book-btn",onClick:a[7]||(a[7]=(...e)=>i.submitAppointment&&i.submitAppointment(...e))},"ç«‹å³é¢„çº¦")]),e.createElementVNode("view",{class:"float-btn",onClick:a[8]||(a[8]=(...e)=>i.onFloatClick&&i.onFloatClick(...e))},[e.createElementVNode("text",{class:"float-icon"},"â˜€ï¸")])])}],["__scopeId","data-v-b1d05b4e"]]),cs={data:()=>({doctorInfo:{},hospitalInfo:{},allReviews:[],isHospital:!1}),computed:{totalReviews(){return this.allReviews.length},averageRating(){if(0===this.allReviews.length)return 0;return this.allReviews.reduce(((e,t)=>e+t.rating),0)/this.allReviews.length}},onLoad(e){if(e.hospital){this.isHospital=!0;try{this.hospitalInfo=JSON.parse(decodeURIComponent(e.hospital))}catch(Kt){t("error","at pages/doctor/reviews.vue:118","è§£æåŒ»é™¢ä¿¡æ¯å¤±è´¥",Kt)}if(e.comments)try{const t=JSON.parse(decodeURIComponent(e.comments));this.allReviews=t.map((e=>({rating:e.rating,comment:e.content,reviewer:e.userName,type:"é—¨è¯ŠæŒ‚å·",department:e.department,date:e.date})))}catch(Kt){t("error","at pages/doctor/reviews.vue:135","è§£æè¯„ä»·æ•°æ®å¤±è´¥",Kt),this.loadDefaultReviews()}else this.loadDefaultReviews()}else if(e.doctor){this.isHospital=!1;try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/reviews.vue:147","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt)}if(e.reviews)try{this.allReviews=JSON.parse(decodeURIComponent(e.reviews))}catch(Kt){t("error","at pages/doctor/reviews.vue:155","è§£æè¯„ä»·æ•°æ®å¤±è´¥",Kt),this.loadDefaultReviews()}else this.loadDefaultReviews()}else this.loadDefaultReviews()},methods:{goBack(){uni.navigateBack()},loadDefaultReviews(){this.allReviews=[{rating:5,comment:"åŒ»ç”Ÿå¾ˆæœ‰è€å¿ƒ,ä¸é”™ä¸é”™,æ„Ÿè°¢",reviewer:"ç‹å…ˆç”Ÿ",type:"é—¨è¯ŠæŒ‚å·",department:"ç¥ç»å†…ç§‘",date:"2020-03-03"},{rating:4,comment:"åŒ»ç”Ÿå¾ˆæœ‰è€å¿ƒ,ä¸é”™ä¸é”™,æ„Ÿè°¢",reviewer:"ç‹å…ˆç”Ÿ",type:"é—¨è¯ŠæŒ‚å·",department:"å†…åˆ†æ³Œç§‘",date:"2020-03-02"},{rating:3,comment:"é—®è¯Šé€Ÿåº¦æœ‰ç‚¹å¿«,å¸Œæœ›èƒ½å’ŒåŒ»ç”Ÿæ²Ÿé€šçš„æ›´ä¹…",reviewer:"ç‹å…ˆç”Ÿ",type:"äº’è”ç½‘é¢„çº¦",department:"è‚¿ç˜¤ç§‘",date:"2020-03-02"},{rating:5,comment:"åœ¨çº¿çœ‹ç—…å¾ˆæ–¹ä¾¿,è¯å“è¯å•ç›´æ¥é‚®å¯„åˆ°å®¶å¾ˆå¿«",reviewer:"æå¥³å£«",type:"äº’è”ç½‘é¢„çº¦",department:"å†…åˆ†æ³Œç§‘",date:"2020-03-01"},{rating:5,comment:"åŒ»ç”Ÿä¸“ä¸šæ°´å¹³å¾ˆé«˜ï¼Œè¯Šæ–­å‡†ç¡®ï¼Œç”¨è¯åˆç†",reviewer:"å¼ å…ˆç”Ÿ",type:"é—¨è¯ŠæŒ‚å·",department:"ç¥ç»å†…ç§‘",date:"2020-02-28"},{rating:4,comment:"æœåŠ¡æ€åº¦å¾ˆå¥½ï¼Œå°±æ˜¯ç­‰å¾…æ—¶é—´æœ‰ç‚¹é•¿",reviewer:"åˆ˜å¥³å£«",type:"é—¨è¯ŠæŒ‚å·",department:"å†…åˆ†æ³Œç§‘",date:"2020-02-25"},{rating:5,comment:"éå¸¸æ»¡æ„ï¼ŒåŒ»ç”Ÿå¾ˆç»†å¿ƒï¼Œè§£é‡Šå¾—å¾ˆæ¸…æ¥š",reviewer:"é™ˆå…ˆç”Ÿ",type:"äº’è”ç½‘é¢„çº¦",department:"è‚¿ç˜¤ç§‘",date:"2020-02-20"},{rating:4,comment:"æ•´ä½“ä¸é”™ï¼Œå°±æ˜¯æŒ‚å·æœ‰ç‚¹éš¾",reviewer:"èµµå¥³å£«",type:"é—¨è¯ŠæŒ‚å·",department:"ç¥ç»å†…ç§‘",date:"2020-02-18"}]}}};const ds=s(cs,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"æ‚£è€…è¯„ä»·"),e.createElementVNode("view",{class:"nav-placeholder"})]),!s.isHospital&&s.doctorInfo.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital),1)])])])):e.createCommentVNode("",!0),s.isHospital&&s.hospitalInfo.name?(e.openBlock(),e.createElementBlock("view",{key:1,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("view",{class:"hospital-icon-box"},[e.createElementVNode("text",{class:"hospital-icon"},"ğŸ¥")]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.hospitalInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.hospitalInfo.level||""),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.hospitalInfo.address||""),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"stats-section"},[e.createElementVNode("view",{class:"rating-overview"},[e.createElementVNode("text",{class:"rating-score"},e.toDisplayString(i.averageRating.toFixed(1)),1),e.createElementVNode("view",{class:"rating-stars"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(t=>e.createElementVNode("text",{key:t,class:e.normalizeClass(["star",{active:t<=Math.round(i.averageRating)}])},"â˜…",2))),64))]),e.createElementVNode("text",{class:"rating-count"},e.toDisplayString(i.totalReviews)+" æ¡è¯„ä»·",1)])]),e.createElementVNode("scroll-view",{class:"reviews-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.allReviews,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"review-item"},[e.createElementVNode("view",{class:"review-header"},[e.createElementVNode("view",{class:"reviewer-info"},[e.createElementVNode("text",{class:"reviewer-name"},e.toDisplayString(t.reviewer),1),e.createElementVNode("view",{class:"review-meta"},[e.createElementVNode("text",{class:"review-type"},e.toDisplayString(t.type),1),e.createElementVNode("text",{class:"review-dept"},e.toDisplayString(t.department),1),e.createElementVNode("text",{class:"review-date"},e.toDisplayString(t.date),1)])]),e.createElementVNode("view",{class:"review-stars"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(5,(a=>e.createElementVNode("text",{key:a,class:e.normalizeClass(["star",{active:a<=t.rating}])},"â˜…",2))),64))])]),e.createElementVNode("text",{class:"review-text"},e.toDisplayString(t.comment),1)])))),128)),0===s.allReviews.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— è¯„ä»·")])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-ce9aea66"]]),us={data:()=>({doctorInfo:{},allConsultations:[]}),onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/consultation-history.vue:65","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt)}if(e.consultations)try{this.allConsultations=JSON.parse(decodeURIComponent(e.consultations))}catch(Kt){t("error","at pages/doctor/consultation-history.vue:74","è§£æé—®è¯Šå†å²æ•°æ®å¤±è´¥",Kt),this.loadDefaultConsultations()}else this.loadDefaultConsultations()},methods:{goBack(){uni.navigateBack()},loadDefaultConsultations(){this.allConsultations=[{patientInfo:"ç”·(31å²)",question:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullReply:"æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°,ç”²çŠ¶è…ºè‚¿ç˜¤å¼•èµ·çš„çº¢è‚¿ç–¼ç—›éœ€è¦åŠæ—¶å°±åŒ»ã€‚å»ºè®®æ‚¨ï¼š1. é¿å…æŒ‰å‹å’Œæ‘©æ“¦æ‚£å¤„ï¼›2. ä¿æŒå±€éƒ¨æ¸…æ´å¹²ç‡¥ï¼›3. å°½å¿«åˆ°åŒ»é™¢è¿›è¡Œä¸“ä¸šæ£€æŸ¥ï¼›4. æ ¹æ®åŒ»ç”Ÿå»ºè®®è¿›è¡Œç›¸åº”æ²»ç–—ã€‚å¦‚æœç–¼ç—›å‰§çƒˆï¼Œå¯ä»¥æš‚æ—¶ä½¿ç”¨å†·æ•·ç¼“è§£ï¼Œä½†ä¸è¦è‡ªè¡Œç”¨è¯ã€‚",fullQuestion:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?æœ€è¿‘å‘ç°é¢ˆéƒ¨æœ‰è‚¿å—ï¼Œå¹¶ä¸”ä¼´æœ‰çº¢è‚¿å’Œç–¼ç—›æ„Ÿï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œåº”è¯¥å¦‚ä½•ç¼“è§£ç—‡çŠ¶ï¼Ÿ"},{patientInfo:"ç”·(42å²)",question:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullReply:"æ‚¨å¥½,å†…åˆ†æ³Œç´Šä¹±å¯¼è‡´çš„å¤±çœ éœ€è¦ç»¼åˆè°ƒç†ã€‚å»ºè®®æ‚¨ï¼š1. è§„å¾‹ä½œæ¯ï¼Œæ¯å¤©å›ºå®šæ—¶é—´ç¡è§‰å’Œèµ·åºŠï¼›2. ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼›3. é€‚å½“è¿åŠ¨ï¼Œä½†é¿å…ç¡å‰å‰§çƒˆè¿åŠ¨ï¼›4. é¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…æ™šé¤è¿‡é¥±ï¼›5. å¯ä»¥å°è¯•æ”¾æ¾æŠ€å·§å¦‚æ·±å‘¼å¸ã€å†¥æƒ³ï¼›6. å¦‚æœç—‡çŠ¶ä¸¥é‡ï¼Œå»ºè®®åˆ°åŒ»é™¢è¿›è¡Œå†…åˆ†æ³Œæ£€æŸ¥ï¼Œå¿…è¦æ—¶åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ç”¨è¯ã€‚",fullQuestion:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†ï¼Ÿæœ€è¿‘å·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸å¤±çœ ï¼Œç™½å¤©ç²¾ç¥ä¸å¥½ï¼Œæ€€ç–‘æ˜¯å†…åˆ†æ³Œé—®é¢˜ï¼Œæƒ³çŸ¥é“å¦‚ä½•è°ƒç†ï¼Ÿ"},{patientInfo:"ç”·(27å²)",question:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullReply:"æ‚¨å¥½,ç”²çŠ¶è…ºè‚¿ç˜¤éœ€è¦ä¸“ä¸šè¯Šæ–­å’Œæ²»ç–—ã€‚å»ºè®®æ‚¨å°½å¿«åˆ°åŒ»é™¢è¿›è¡Œç”²çŠ¶è…ºBè¶…å’Œç”²çŠ¶è…ºåŠŸèƒ½æ£€æŸ¥ï¼Œä»¥æ˜ç¡®è¯Šæ–­ã€‚åœ¨ç­‰å¾…æ£€æŸ¥æœŸé—´ï¼Œæ³¨æ„ä¼‘æ¯ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ï¼Œä¿æŒæƒ…ç»ªç¨³å®šã€‚",fullQuestion:"ç”²çŠ¶è…ºè‚¿ç˜¤:çº¢è‚¿ç–¼ç—›å¦‚ä½•ç¼“è§£?æœ€è¿‘å‘ç°é¢ˆéƒ¨æœ‰è‚¿å—ï¼Œå¹¶ä¸”ä¼´æœ‰çº¢è‚¿å’Œç–¼ç—›æ„Ÿï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œåº”è¯¥å¦‚ä½•ç¼“è§£ç—‡çŠ¶ï¼Ÿ"},{patientInfo:"ç”·(42å²)",question:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ä¸ºæ‚¨...",date:"2020-03-02",fullReply:"æ‚¨å¥½,å†…åˆ†æ³Œç´Šä¹±å¯¼è‡´çš„å¤±çœ éœ€è¦ç»¼åˆè°ƒç†ã€‚å»ºè®®æ‚¨ï¼š1. è§„å¾‹ä½œæ¯ï¼Œæ¯å¤©å›ºå®šæ—¶é—´ç¡è§‰å’Œèµ·åºŠï¼›2. ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼›3. é€‚å½“è¿åŠ¨ï¼Œä½†é¿å…ç¡å‰å‰§çƒˆè¿åŠ¨ï¼›4. é¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…æ™šé¤è¿‡é¥±ï¼›5. å¯ä»¥å°è¯•æ”¾æ¾æŠ€å·§å¦‚æ·±å‘¼å¸ã€å†¥æƒ³ï¼›6. å¦‚æœç—‡çŠ¶ä¸¥é‡ï¼Œå»ºè®®åˆ°åŒ»é™¢è¿›è¡Œå†…åˆ†æ³Œæ£€æŸ¥ï¼Œå¿…è¦æ—¶åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ç”¨è¯ã€‚",fullQuestion:"å†…åˆ†æ³Œç´Šä¹±å¤±çœ åº”è¯¥å¦‚ä½•è°ƒç†ï¼Ÿæœ€è¿‘å·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸å¤±çœ ï¼Œç™½å¤©ç²¾ç¥ä¸å¥½ï¼Œæ€€ç–‘æ˜¯å†…åˆ†æ³Œé—®é¢˜ï¼Œæƒ³çŸ¥é“å¦‚ä½•è°ƒç†ï¼Ÿ"},{patientInfo:"å¥³(35å²)",question:"æœˆç»ä¸è°ƒéœ€è¦åšå“ªäº›æ£€æŸ¥ï¼Ÿ",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,æœˆç»ä¸è°ƒéœ€è¦åšä»¥ä¸‹æ£€æŸ¥...",date:"2020-03-01",fullReply:"æ‚¨å¥½,æœˆç»ä¸è°ƒéœ€è¦åšä»¥ä¸‹æ£€æŸ¥ï¼š1. å¦‡ç§‘Bè¶…æ£€æŸ¥ï¼Œäº†è§£å­å®«å’Œé™„ä»¶æƒ…å†µï¼›2. æ€§æ¿€ç´ å…­é¡¹æ£€æŸ¥ï¼Œäº†è§£å†…åˆ†æ³Œæ°´å¹³ï¼›3. ç”²çŠ¶è…ºåŠŸèƒ½æ£€æŸ¥ï¼›4. è¡€å¸¸è§„æ£€æŸ¥ã€‚æ ¹æ®æ£€æŸ¥ç»“æœï¼ŒåŒ»ç”Ÿä¼šåˆ¶å®šç›¸åº”çš„æ²»ç–—æ–¹æ¡ˆã€‚",fullQuestion:"æœˆç»ä¸è°ƒéœ€è¦åšå“ªäº›æ£€æŸ¥ï¼Ÿæœ€è¿‘å‡ ä¸ªæœˆæœˆç»å‘¨æœŸä¸è§„å¾‹ï¼Œæœ‰æ—¶æå‰æœ‰æ—¶å»¶åï¼Œæƒ³çŸ¥é“éœ€è¦åšå“ªäº›æ£€æŸ¥æ¥ç¡®è¯Šï¼Ÿ"},{patientInfo:"ç”·(50å²)",question:"ç³–å°¿ç—…é¥®é£Ÿæ³¨æ„äº‹é¡¹",reply:"[åŒ»ç”Ÿå›å¤]æ‚¨å¥½,ç³–å°¿ç—…é¥®é£Ÿéœ€è¦æ³¨æ„...",date:"2020-02-28",fullReply:"æ‚¨å¥½,ç³–å°¿ç—…é¥®é£Ÿéœ€è¦æ³¨æ„ï¼š1. æ§åˆ¶æ€»çƒ­é‡æ‘„å…¥ï¼›2. é€‰æ‹©ä½GIé£Ÿç‰©ï¼›3. å®šæ—¶å®šé‡è¿›é¤ï¼›4. å¤šåƒè”¬èœï¼Œé€‚é‡æ°´æœï¼›5. é™åˆ¶ç³–åˆ†å’Œç²¾åˆ¶é£Ÿå“ï¼›6. é€‚é‡ä¼˜è´¨è›‹ç™½è´¨ï¼›7. æ§åˆ¶ç›åˆ†æ‘„å…¥ã€‚å»ºè®®å’¨è¯¢è¥å…»å¸ˆåˆ¶å®šä¸ªæ€§åŒ–é¥®é£Ÿæ–¹æ¡ˆã€‚",fullQuestion:"ç³–å°¿ç—…é¥®é£Ÿæ³¨æ„äº‹é¡¹ï¼Ÿåˆšç¡®è¯Šç³–å°¿ç—…ï¼Œæƒ³çŸ¥é“æ—¥å¸¸é¥®é£Ÿåº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Œæœ‰å“ªäº›é£Ÿç‰©å¯ä»¥åƒï¼Œå“ªäº›ä¸èƒ½åƒï¼Ÿ"}]},viewConsultationDetail(e,a){const o=encodeURIComponent(JSON.stringify(e)),n=encodeURIComponent(JSON.stringify(this.doctorInfo));uni.navigateTo({url:`/pages/doctor/consultation-detail?consultation=${o}&doctor=${n}`,fail:e=>{t("error","at pages/doctor/consultation-history.vue:147","è·³è½¬åˆ°é—®è¯Šè¯¦æƒ…é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})}}};const ms=s(us,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"å†å²é—®è¯Š"),e.createElementVNode("view",{class:"nav-placeholder"})]),s.doctorInfo.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{class:"consultation-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.allConsultations,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"consultation-item",onClick:e=>i.viewConsultationDetail(t,a)},[e.createElementVNode("view",{class:"consultation-header"},[e.createElementVNode("text",{class:"patient-info"},e.toDisplayString(t.patientInfo),1),e.createElementVNode("text",{class:"consultation-date"},e.toDisplayString(t.date),1)]),e.createElementVNode("text",{class:"consultation-question"},e.toDisplayString(t.question),1),e.createElementVNode("text",{class:"consultation-reply"},e.toDisplayString(t.reply),1),e.createElementVNode("view",{class:"consultation-actions"},[e.createElementVNode("button",{class:"detail-btn",onClick:e.withModifiers((e=>i.viewConsultationDetail(t,a)),["stop"])},"æŸ¥çœ‹é—®è¯Šè¯¦æƒ…",8,["onClick"])])],8,["onClick"])))),128)),0===s.allConsultations.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— é—®è¯Šè®°å½•")])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-5e032849"]]),ps={data:()=>({doctorInfo:{},consultation:{}}),onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/consultation-detail.vue:68","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt)}if(e.consultation)try{this.consultation=JSON.parse(decodeURIComponent(e.consultation))}catch(Kt){t("error","at pages/doctor/consultation-detail.vue:77","è§£æé—®è¯Šè¯¦æƒ…æ•°æ®å¤±è´¥",Kt),uni.showToast({title:"æ•°æ®åŠ è½½å¤±è´¥",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500)}else uni.showToast({title:"ç¼ºå°‘é—®è¯Šæ•°æ®",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500)},methods:{goBack(){uni.navigateBack()}}};const hs=s(ps,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"é—®è¯Šè¯¦æƒ…"),e.createElementVNode("view",{class:"nav-placeholder"})]),s.doctorInfo.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{class:"detail-content","scroll-y":""},[e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},"æ‚£è€…ä¿¡æ¯"),e.createElementVNode("view",{class:"section-content"},[e.createElementVNode("text",{class:"patient-info"},e.toDisplayString(s.consultation.patientInfo),1),e.createElementVNode("text",{class:"consultation-date"},e.toDisplayString(s.consultation.date),1)])]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},"æ‚£è€…é—®é¢˜"),e.createElementVNode("view",{class:"section-content"},[e.createElementVNode("text",{class:"question-text"},e.toDisplayString(s.consultation.fullQuestion||s.consultation.question),1)])]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-title"},"åŒ»ç”Ÿå›å¤"),e.createElementVNode("view",{class:"section-content"},[e.createElementVNode("text",{class:"reply-text"},e.toDisplayString(s.consultation.fullReply||s.consultation.reply),1)])])])])}],["__scopeId","data-v-fe934c34"]]),gs={ICE_SERVERS:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};class vs{constructor(){this.ws=null,this.localStream=null,this.peerConnections=new Map,this.roomId="",this.doctorId="",this.doctorName="",t("log","at utils/webrtc.ts:29","WebRTCDoctor åˆå§‹åŒ–")}async connect(e=gs.SIGNAL_SERVER){return this.ws&&(t("log","at utils/webrtc.ts:38","âš ï¸ å…³é—­æ—§çš„ WebSocket è¿æ¥"),this.ws.close(),this.ws=null),new Promise(((a,o)=>{try{t("log","at utils/webrtc.ts:45","ğŸ”Œ åˆ›å»ºæ–°çš„ WebSocket è¿æ¥:",e),this.ws=new WebSocket(e),this.ws.onopen=()=>{var e;t("log","at utils/webrtc.ts:49","âœ… ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥æˆåŠŸ"),t("log","at utils/webrtc.ts:50","WebSocket readyState:",null==(e=this.ws)?void 0:e.readyState),setTimeout((()=>{t("log","at utils/webrtc.ts:53","âœ… WebSocket å·²å®Œå…¨å°±ç»ª"),a()}),100)},this.ws.onerror=e=>{t("error","at utils/webrtc.ts:59"," ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å¤±è´¥:",e),o(new Error("ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å¤±è´¥"))},this.ws.onmessage=e=>{this.handleSignalMessage(JSON.parse(e.data))},this.ws.onclose=e=>{t("log","at utils/webrtc.ts:68","ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å·²å…³é—­, code:",e.code,"reason:",e.reason)}}catch(n){o(n)}}))}async createRoom(e,a,o,n){var s;if(this.roomId=e,this.doctorId=a,this.doctorName=o,t("log","at utils/webrtc.ts:86","ğŸ” æ£€æŸ¥ WebSocket çŠ¶æ€:"),t("log","at utils/webrtc.ts:87","- this.ws å­˜åœ¨:",!!this.ws),t("log","at utils/webrtc.ts:88","- readyState:",null==(s=this.ws)?void 0:s.readyState),t("log","at utils/webrtc.ts:89","- WebSocket.OPEN:",WebSocket.OPEN),!this.ws||this.ws.readyState!==WebSocket.OPEN)throw t("error","at utils/webrtc.ts:92"," WebSocket æœªå°±ç»ªï¼Œæ— æ³•åˆ›å»ºç›´æ’­é—´"),new Error("ä¿¡ä»¤æœåŠ¡å™¨æœªè¿æ¥");t("log","at utils/webrtc.ts:96","âœ… WebSocket çŠ¶æ€æ­£å¸¸ï¼Œå‘é€åˆ›å»ºç›´æ’­é—´æ¶ˆæ¯"),this.ws.send(JSON.stringify({type:"create-room",roomId:e,doctorId:a,doctorName:o,title:n}))}setLocalStream(e){this.localStream=e,t("log","at utils/webrtc.ts:111","æœ¬åœ°è§†é¢‘æµå·²è®¾ç½®")}handleSignalMessage(e){switch(t("log","at utils/webrtc.ts:119","æ”¶åˆ°ä¿¡ä»¤æ¶ˆæ¯:",e.type),e.type){case"room-created":t("log","at utils/webrtc.ts:123","ç›´æ’­é—´åˆ›å»ºæˆåŠŸ:",e.roomId),this.onRoomCreated&&this.onRoomCreated(e.roomId);break;case"viewer-joined":t("log","at utils/webrtc.ts:130","è§‚ä¼—åŠ å…¥:",e.viewerName),this.handleViewerJoined(e.viewerId,e.viewerName),this.onViewerJoined&&this.onViewerJoined(e.viewerId,e.viewerName,e.viewerCount);break;case"viewer-left":t("log","at utils/webrtc.ts:138","è§‚ä¼—ç¦»å¼€:",e.viewerName),this.closePeerConnection(e.viewerId),this.onViewerLeft&&this.onViewerLeft(e.viewerId,e.viewerName,e.viewerCount);break;case"answer":this.handleAnswer(e.viewerId,e.answer);break;case"ice-candidate":this.handleIceCandidate(e.viewerId,e.candidate);break;case"chat-message":t("log","at utils/webrtc.ts:154","æ”¶åˆ°èŠå¤©æ¶ˆæ¯:",e.senderName,e.message),this.onChatMessage&&this.onChatMessage(e.senderId,e.senderName,e.message,e.timestamp);break;case"error":t("error","at utils/webrtc.ts:161","ä¿¡ä»¤é”™è¯¯:",e.message),this.onError&&this.onError(e.message)}}async handleViewerJoined(e,a){var o,n;try{if(t("log","at utils/webrtc.ts:174",`å¼€å§‹ä¸ºè§‚ä¼— ${e} åˆ›å»ºè¿æ¥`),!this.localStream)return void t("error","at utils/webrtc.ts:178","æœ¬åœ°æµä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºè¿æ¥");t("log","at utils/webrtc.ts:182","æœ¬åœ°æµä¿¡æ¯:"),t("log","at utils/webrtc.ts:183","- è§†é¢‘è½¨é“æ•°:",this.localStream.getVideoTracks().length),t("log","at utils/webrtc.ts:184","- éŸ³é¢‘è½¨é“æ•°:",this.localStream.getAudioTracks().length),t("log","at utils/webrtc.ts:185","- æµæ˜¯å¦æ´»è·ƒ:",this.localStream.active);const a=new RTCPeerConnection({iceServers:gs.ICE_SERVERS});t("log","at utils/webrtc.ts:193","æ·»åŠ æœ¬åœ°æµåˆ° PeerConnection"),this.localStream.getTracks().forEach((e=>{t("log","at utils/webrtc.ts:195",`æ·»åŠ è½¨é“: ${e.kind}, enabled: ${e.enabled}, readyState: ${e.readyState}`),a.addTrack(e,this.localStream)})),a.onicecandidate=a=>{a.candidate&&this.ws&&(t("log","at utils/webrtc.ts:202",`ğŸ“¡ å‘é€ ICE å€™é€‰ç»™è§‚ä¼— ${e}`),this.ws.send(JSON.stringify({type:"ice-candidate",roomId:this.roomId,targetId:e,candidate:a.candidate})))},a.onconnectionstatechange=()=>{t("log","at utils/webrtc.ts:214",`è¿æ¥çŠ¶æ€ [${e}]:`,a.connectionState),this.onConnectionStateChange&&this.onConnectionStateChange(e,a.connectionState),"failed"!==a.connectionState&&"closed"!==a.connectionState||this.closePeerConnection(e)},t("log","at utils/webrtc.ts:225","åˆ›å»º Offer");const s=await a.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});await a.setLocalDescription(s),t("log","at utils/webrtc.ts:232","Offer SDP:",(null==(n=null==(o=a.localDescription)?void 0:o.sdp)?void 0:n.substring(0,200))+"..."),this.ws&&(t("log","at utils/webrtc.ts:236",`å‘é€ Offer ç»™è§‚ä¼— ${e}`),this.ws.send(JSON.stringify({type:"offer",roomId:this.roomId,viewerId:e,offer:a.localDescription}))),this.peerConnections.set(e,a),t("log","at utils/webrtc.ts:247",`ä¸ºè§‚ä¼— ${e} åˆ›å»ºäº† PeerConnection`)}catch(s){t("error","at utils/webrtc.ts:249","å¤„ç†è§‚ä¼—åŠ å…¥å¤±è´¥:",s)}}async handleAnswer(e,a){const o=this.peerConnections.get(e);if(o)try{await o.setRemoteDescription(new RTCSessionDescription(a)),t("log","at utils/webrtc.ts:261",`è®¾ç½® Answer æˆåŠŸ [${e}]`)}catch(n){t("error","at utils/webrtc.ts:263","è®¾ç½® Answer å¤±è´¥:",n)}}async handleIceCandidate(e,a){const o=this.peerConnections.get(e);if(o)try{await o.addIceCandidate(new RTCIceCandidate(a)),t("log","at utils/webrtc.ts:276",`æ·»åŠ  ICE Candidate æˆåŠŸ [${e}]`)}catch(n){t("error","at utils/webrtc.ts:278","æ·»åŠ  ICE Candidate å¤±è´¥:",n)}}closePeerConnection(e){const a=this.peerConnections.get(e);a&&(a.close(),this.peerConnections.delete(e),t("log","at utils/webrtc.ts:291",`ğŸ”Œ å…³é—­äº†ä¸è§‚ä¼— ${e} çš„è¿æ¥`))}sendChatMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(JSON.stringify({type:"chat-message",roomId:this.roomId,senderId:this.doctorId,senderName:this.doctorName,message:e})),t("log","at utils/webrtc.ts:312","å‘é€èŠå¤©æ¶ˆæ¯:",e)):t("error","at utils/webrtc.ts:300"," WebSocket æœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯")}closeRoom(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"close-room",roomId:this.roomId})),this.cleanup()}cleanup(){this.peerConnections.forEach(((e,t)=>{e.close()})),this.peerConnections.clear(),this.ws&&(this.ws.close(),this.ws=null),this.localStream&&(this.localStream.getTracks().forEach((e=>e.stop())),this.localStream=null),t("log","at utils/webrtc.ts:350","èµ„æºå·²æ¸…ç†")}async getStats(e){const t=this.peerConnections.get(e);return t?await t.getStats():null}}class fs{constructor(){this.ws=null,this.pc=null,this.roomId="",this.viewerId="",this.viewerName="",t("log","at utils/webrtc.ts:390","WebRTCViewer åˆå§‹åŒ–")}async connect(e=gs.SIGNAL_SERVER){return new Promise(((a,o)=>{try{this.ws=new WebSocket(e),this.ws.onopen=()=>{t("log","at utils/webrtc.ts:402","ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥æˆåŠŸ"),a()},this.ws.onerror=e=>{t("error","at utils/webrtc.ts:407"," ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å¤±è´¥:",e),o(new Error("ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å¤±è´¥"))},this.ws.onmessage=e=>{this.handleSignalMessage(JSON.parse(e.data))},this.ws.onclose=()=>{t("log","at utils/webrtc.ts:416","ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥å·²å…³é—­"),this.cleanup()}}catch(n){o(n)}}))}async joinRoom(e,t,a){if(this.roomId=e,this.viewerId=t,this.viewerName=a,!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("ä¿¡ä»¤æœåŠ¡å™¨æœªè¿æ¥");this.ws.send(JSON.stringify({type:"join-room",roomId:e,viewerId:t,viewerName:a}))}handleSignalMessage(e){switch(t("log","at utils/webrtc.ts:453","æ”¶åˆ°ä¿¡ä»¤æ¶ˆæ¯:",e.type),e.type){case"room-joined":t("log","at utils/webrtc.ts:457","åŠ å…¥ç›´æ’­é—´æˆåŠŸ"),this.onRoomJoined&&this.onRoomJoined(e.doctorName,e.title,e.viewerCount);break;case"offer":this.handleOffer(e.offer);break;case"ice-candidate":this.handleIceCandidate(e.candidate);break;case"room-closed":t("log","at utils/webrtc.ts:472","ç›´æ’­é—´å·²å…³é—­"),this.onRoomClosed&&this.onRoomClosed(),this.cleanup();break;case"chat-message":t("log","at utils/webrtc.ts:480","æ”¶åˆ°èŠå¤©æ¶ˆæ¯:",e.senderName,e.message),this.onChatMessage&&this.onChatMessage(e.senderId,e.senderName,e.message,e.timestamp);break;case"error":t("error","at utils/webrtc.ts:487","ä¿¡ä»¤é”™è¯¯:",e.message),this.onError&&this.onError(e.message)}}async handleOffer(e){try{this.pc=new RTCPeerConnection({iceServers:gs.ICE_SERVERS}),this.pc.ontrack=e=>{if(t("log","at utils/webrtc.ts:507","ontrack äº‹ä»¶è§¦å‘"),t("log","at utils/webrtc.ts:508","event.streams:",e.streams),t("log","at utils/webrtc.ts:509","event.track:",e.track),e.streams&&e.streams[0]){const a=e.streams[0];t("log","at utils/webrtc.ts:513","æ”¶åˆ°è¿œç¨‹è§†é¢‘æµ"),t("log","at utils/webrtc.ts:514","è§†é¢‘è½¨é“æ•°:",a.getVideoTracks().length),t("log","at utils/webrtc.ts:515","éŸ³é¢‘è½¨é“æ•°:",a.getAudioTracks().length),t("log","at utils/webrtc.ts:516","æµæ˜¯å¦æ´»è·ƒ:",a.active),this.onRemoteStream&&this.onRemoteStream(a)}else{t("warn","at utils/webrtc.ts:522","âš ï¸ event.streams ä¸ºç©ºï¼Œå°è¯•æ‰‹åŠ¨åˆ›å»ºæµ");const a=new MediaStream([e.track]);t("log","at utils/webrtc.ts:525","æ‰‹åŠ¨åˆ›å»ºçš„æµ:",a),this.onRemoteStream&&this.onRemoteStream(a)}},this.pc.onicecandidate=e=>{e.candidate&&this.ws&&this.ws.send(JSON.stringify({type:"ice-candidate",roomId:this.roomId,candidate:e.candidate}))},this.pc.onconnectionstatechange=()=>{var e;t("log","at utils/webrtc.ts:547","è¿æ¥çŠ¶æ€:",null==(e=this.pc)?void 0:e.connectionState),this.onConnectionStateChange&&this.pc&&this.onConnectionStateChange(this.pc.connectionState)},await this.pc.setRemoteDescription(new RTCSessionDescription(e));const a=await this.pc.createAnswer();await this.pc.setLocalDescription(a),this.ws&&this.ws.send(JSON.stringify({type:"answer",roomId:this.roomId,answer:this.pc.localDescription})),t("log","at utils/webrtc.ts:569","Answer å·²å‘é€")}catch(a){t("error","at utils/webrtc.ts:571","å¤„ç† Offer å¤±è´¥:",a)}}async handleIceCandidate(e){if(this.pc)try{await this.pc.addIceCandidate(new RTCIceCandidate(e)),t("log","at utils/webrtc.ts:583","æ·»åŠ  ICE Candidate æˆåŠŸ")}catch(a){t("error","at utils/webrtc.ts:585","æ·»åŠ  ICE Candidate å¤±è´¥:",a)}}sendChatMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ws.send(JSON.stringify({type:"chat-message",roomId:this.roomId,senderId:this.viewerId,senderName:this.viewerName,message:e})),t("log","at utils/webrtc.ts:607","å‘é€èŠå¤©æ¶ˆæ¯:",e)):t("error","at utils/webrtc.ts:595"," WebSocket æœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯")}leaveRoom(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"leave-room",roomId:this.roomId})),this.cleanup()}cleanup(){this.pc&&(this.pc.close(),this.pc=null),this.ws&&(this.ws.close(),this.ws=null),t("log","at utils/webrtc.ts:640","èµ„æºå·²æ¸…ç†")}async getStats(){return this.pc?await this.pc.getStats():null}}const ws=e.defineComponent({__name:"live",setup(a){const o=e.ref(!1),n=e.ref(""),s=e.ref("user"),i=e.ref({action:"",position:"user"}),r=e.ref(!1);let l=[],c=null,d=null;const u=e.ref({avatar:"/static/doctor/doctor.png",name:"ç‹åŒ»ç”Ÿ",title:"ä¸»ä»»åŒ»å¸ˆ Â· å¿ƒå†…ç§‘"}),m=e.ref(0),p=e.ref(0),h=e.ref([]);let g=1;const v=e.computed((()=>h.value.slice(-3))),f=e.ref("00:00");let w=0,y=null,E=null;const k=()=>{y=setInterval((()=>{const e=Math.floor((Date.now()-w)/1e3);f.value=(e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`:`${String(a).padStart(2,"0")}:${String(o).padStart(2,"0")}`})(e)}),1e3)},N=async()=>{if(n.value.trim())try{await(async()=>{try{if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){const e=await navigator.mediaDevices.enumerateDevices();l=e.filter((e=>"videoinput"===e.kind)),r.value=l.length>1,t("log","at pages/doctor/live.vue:199","æ£€æµ‹åˆ°æ‘„åƒå¤´æ•°é‡:",l.length)}}catch(e){t("error","at pages/doctor/live.vue:202","æ£€æµ‹æ‘„åƒå¤´å¤±è´¥:",e)}})(),uni.showLoading({title:"æ­£åœ¨è·å–æ‘„åƒå¤´...",mask:!0}),o.value=!0,i.value={action:"start",position:s.value},t("log","at pages/doctor/live.vue:234","â³ ç­‰å¾…æ‘„åƒå¤´æµå‡†å¤‡..."),setTimeout((()=>{d||(t("warn","at pages/doctor/live.vue:239","âš ï¸ 10ç§’å†…æœªæ”¶åˆ°æ‘„åƒå¤´æµï¼Œå¯èƒ½å‡ºç°é—®é¢˜"),uni.hideLoading(),uni.showModal({title:"æ‘„åƒå¤´å¯åŠ¨è¶…æ—¶",content:"è¯·æ£€æŸ¥æ‘„åƒå¤´æƒé™æˆ–åˆ·æ–°é¡µé¢é‡è¯•",showCancel:!1,success:()=>{o.value=!1}}))}),1e4)}catch(e){t("error","at pages/doctor/live.vue:253","å¼€å§‹ç›´æ’­å¤±è´¥:",e),uni.hideLoading(),uni.showModal({title:"æ— æ³•å¯åŠ¨ç›´æ’­",content:e instanceof Error?e.message:"è¯·ç¡®ä¿å·²æˆäºˆæ‘„åƒå¤´æƒé™",showCancel:!1})}else uni.showToast({title:"è¯·è¾“å…¥ç›´æ’­ä¸»é¢˜",icon:"none"})},V=()=>{uni.showModal({title:"ç»“æŸç›´æ’­",content:`æœ¬æ¬¡ç›´æ’­æ—¶é•¿ ${f.value}ï¼Œå…± ${m.value} äººè§‚çœ‹`,confirmText:"ç»“æŸ",cancelText:"ç»§ç»­",success:e=>{if(e.confirm){i.value={action:"stop",position:s.value},c&&(c.closeRoom(),c=null),o.value=!1,y&&clearInterval(y),E&&clearInterval(E),f.value="00:00";const e=m.value,t=p.value,a=h.value.length;m.value=0,p.value=0,h.value=[],uni.showToast({title:"ç›´æ’­å·²ç»“æŸ",icon:"success"}),setTimeout((()=>{uni.showModal({title:"ç›´æ’­æ•°æ®ç»Ÿè®¡",content:`è§‚çœ‹äººæ•°ï¼š${e}\nç‚¹èµæ•°ï¼š${t}\næ¶ˆæ¯æ•°ï¼š${a}`,showCancel:!1})}),500)}}})},C=async()=>{o.value&&r.value&&(s.value="user"===s.value?"environment":"user",i.value={action:"switch",position:s.value},uni.showToast({title:"æ‘„åƒå¤´å·²åˆ‡æ¢",icon:"none"}))},x=e=>(t("log","at pages/doctor/live.vue:333","ğŸ“¹ æ”¶åˆ°æ¥è‡ª renderjs çš„è§†é¢‘æµ:",e),t("log","at pages/doctor/live.vue:334","è§†é¢‘è½¨é“æ•°:",e.getVideoTracks().length),t("log","at pages/doctor/live.vue:335","éŸ³é¢‘è½¨é“æ•°:",e.getAudioTracks().length),t("log","at pages/doctor/live.vue:336","æµID:",e.id),t("log","at pages/doctor/live.vue:337","æµæ˜¯å¦æ´»è·ƒ:",e.active),d=e,b(e).catch((e=>{t("error","at pages/doctor/live.vue:343","âŒ åˆå§‹åŒ– WebRTC å¤±è´¥:",e),uni.hideLoading(),uni.showModal({title:"æ— æ³•å¯åŠ¨ç›´æ’­",content:e instanceof Error?e.message:"åˆå§‹åŒ–å¤±è´¥",showCancel:!1}),o.value=!1,i.value={action:"stop",position:s.value}})),!0),b=async e=>{t("log","at pages/doctor/live.vue:360","ğŸš€ å¼€å§‹åˆå§‹åŒ– WebRTC..."),c=new vs,c.setLocalStream(e),t("log","at pages/doctor/live.vue:367","âœ… æœ¬åœ°æµå·²è®¾ç½®åˆ° WebRTC"),c.onRoomCreated=e=>{t("log","at pages/doctor/live.vue:371","âœ… ç›´æ’­é—´åˆ›å»ºæˆåŠŸ:",e),uni.hideLoading(),uni.showToast({title:"ç›´æ’­å·²å¼€å§‹",icon:"success"})},c.onViewerJoined=(e,a,o)=>{t("log","at pages/doctor/live.vue:380","ğŸ‘¤ è§‚ä¼—åŠ å…¥:",a),m.value=o,h.value.push({id:g++,type:"system",content:`${a} åŠ å…¥äº†ç›´æ’­é—´`})},c.onViewerLeft=(e,a,o)=>{t("log","at pages/doctor/live.vue:390","ğŸ‘‹ è§‚ä¼—ç¦»å¼€:",a),m.value=o,h.value.push({id:g++,type:"system",content:`${a} ç¦»å¼€äº†ç›´æ’­é—´`})},c.onError=e=>{t("error","at pages/doctor/live.vue:400","âŒ WebRTC é”™è¯¯:",e),uni.showToast({title:e,icon:"none"})},c.onChatMessage=(e,a,o,n)=>{t("log","at pages/doctor/live.vue:408","ğŸ’¬ æ”¶åˆ°èŠå¤©æ¶ˆæ¯:",a,o),h.value.push({id:g++,username:a,content:o,timestamp:n})},t("log","at pages/doctor/live.vue:418","ğŸ”Œ è¿æ¥ä¿¡ä»¤æœåŠ¡å™¨..."),await c.connect(gs.SIGNAL_SERVER);const a="room_"+Date.now(),o="doctor_"+Date.now();t("log","at pages/doctor/live.vue:424","ğŸ  åˆ›å»ºç›´æ’­é—´:",a),await c.createRoom(a,o,u.value.name,n.value),w=Date.now(),k(),S(),t("log","at pages/doctor/live.vue:433","ğŸ‰ ç›´æ’­å¯åŠ¨å®Œæˆï¼æœ¬åœ°æµå·²å‡†å¤‡å¥½ï¼Œè§‚ä¼—å¯ä»¥æ­£å¸¸è§‚çœ‹äº†")};"undefined"!=typeof window&&(window.__setWebRTCStream=x,t("log","at pages/doctor/live.vue:441","âœ… setWebRTCStream å·²æŒ‚è½½åˆ° window"));const S=()=>{E=setInterval((()=>{Math.random()>.5&&(p.value+=Math.floor(5*Math.random())+1)}),2e3)};return e.onMounted((()=>{t("log","at pages/doctor/live.vue:498","ç›´æ’­é¡µé¢å·²åŠ è½½"),uni.$on("webrtc-stream-ready",(e=>{t("log","at pages/doctor/live.vue:502","ğŸ“¹ é€šè¿‡äº‹ä»¶æ¥æ”¶åˆ°è§†é¢‘æµ"),x(e)}))})),e.onUnmounted((()=>{uni.$off("webrtc-stream-ready"),i.value={action:"stop",position:s.value},c&&(c.closeRoom(),c=null),y&&clearInterval(y),E&&clearInterval(E)})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"live-container"},[e.createElementVNode("view",{class:"camera-wrapper"},[o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-container","change:prop":t.renderScript.updateStream,prop:e.wp(i.value)},[e.createElementVNode("view",{id:"videoWrapper",class:"video-wrapper-inner"})],8,["change:prop","prop"])):e.createCommentVNode("",!0),o.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"live-overlay"},[e.createElementVNode("view",{class:"top-bar"},[e.createElementVNode("view",{class:"doctor-card"},[e.createElementVNode("image",{class:"avatar",src:u.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(u.value.name),1),e.createElementVNode("text",{class:"title"},e.toDisplayString(u.value.title),1)]),e.createElementVNode("view",{class:"live-badge"},[e.createElementVNode("view",{class:"pulse-dot"}),e.createElementVNode("text",{class:"badge-text"},"ç›´æ’­ä¸­")])]),e.createElementVNode("view",{class:"top-actions"},[e.createElementVNode("view",{class:"viewer-count"},[e.createElementVNode("text",{class:"count-text"},"ğŸ‘¥ "+e.toDisplayString(m.value),1)])])]),e.createElementVNode("view",{class:"live-time"},[e.createElementVNode("text",{class:"time-text"},"â±ï¸ "+e.toDisplayString(f.value),1)]),e.createElementVNode("view",{class:"right-toolbar"},[r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tool-item",onClick:C},[e.createElementVNode("text",{class:"tool-icon"},"ğŸ”„"),e.createElementVNode("text",{class:"tool-text"},"ç¿»è½¬")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"tool-item"},[e.createElementVNode("text",{class:"tool-icon"},"â¤ï¸"),e.createElementVNode("text",{class:"tool-text"},e.toDisplayString(p.value),1)])]),e.createElementVNode("view",{class:"chat-messages"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"message-item"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(t.username)+"ï¼š",1),e.createElementVNode("text",{class:"content"},e.toDisplayString(t.content),1)])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"preview-container"},[e.createElementVNode("view",{class:"preview-content"},[e.createElementVNode("text",{class:"preview-icon"},"ğŸ“¹"),e.createElementVNode("text",{class:"preview-title"},"å‡†å¤‡å¼€å§‹ç›´æ’­"),e.createElementVNode("text",{class:"preview-desc"},"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å¯æ‘„åƒå¤´ç›´æ’­"),e.createElementVNode("view",{class:"preview-info"},[e.createElementVNode("text",{class:"info-item"},"âœ“ å®æ—¶è§†é¢‘ç›´æ’­"),e.createElementVNode("text",{class:"info-item"},"âœ“ å¥åº·ç§‘æ™®è®²è§£"),e.createElementVNode("text",{class:"info-item"},"âœ“ åœ¨çº¿äº’åŠ¨ç­”ç–‘")])])]))]),e.createTextVNode("- isLivingï¼šæ˜¯å¦æ­£åœ¨ç›´æ’­ï¼ˆtrue/falseï¼‰ - viewerCountï¼šè§‚ä¼—æ•°é‡ - recentMessagesï¼šæœ€è¿‘çš„3æ¡èŠå¤©æ¶ˆæ¯ - videoWrapperï¼šè§†é¢‘æ˜¾ç¤ºçš„å®¹å™¨ "),e.createElementVNode("view",{class:"bottom-bar"},[o.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"living-section"},[e.createElementVNode("view",{class:"live-stats"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-icon"},"ğŸ‘¥"),e.createElementVNode("text",{class:"stat-text"},e.toDisplayString(m.value)+"äººè§‚çœ‹",1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-icon"},"ğŸ’¬"),e.createElementVNode("text",{class:"stat-text"},e.toDisplayString(h.value.length)+"æ¡æ¶ˆæ¯",1)])]),e.createElementVNode("button",{class:"end-btn",onClick:V},[e.createElementVNode("text",{class:"btn-icon"},"â¹ï¸"),e.createElementVNode("text",null,"ç»“æŸç›´æ’­")])])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"start-section"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),class:"title-input",placeholder:"è¾“å…¥ç›´æ’­ä¸»é¢˜ï¼ˆå¦‚ï¼šå¿ƒè¡€ç®¡å¥åº·ç§‘æ™®ï¼‰",maxlength:"30"},null,512),[[e.vModelText,n.value]]),e.createElementVNode("button",{class:"start-btn",onClick:N},[e.createElementVNode("text",{class:"btn-icon"},"ğŸ¬"),e.createElementVNode("text",null,"å¼€å§‹ç›´æ’­")])]))])]))}}),ys=e=>{(e.$renderjs||(e.$renderjs=[])).push("renderScript"),(e.$renderjsModules||(e.$renderjsModules={})).renderScript="7246740a"};ys(ws);const Es=s(ws,[["__scopeId","data-v-49fdf481"]]),ks="/static/doctor/doctor.png",Ns=e.defineComponent({__name:"live",setup(a){const o=e.ref(!1),n=e.ref(!1),s=e.ref({stream:null,timestamp:0}),i=e.ref(""),r=e.ref(""),l=e.ref(""),c=e.ref(0),d=e.ref("viewer_"+Date.now()),u=e.ref("è§‚ä¼—"+Math.floor(1e3*Math.random()));let m=null;const p=e.ref(!1),h=e.ref(!1),g=e.ref([]),v=e.ref("");let f=1;const w=e.computed((()=>g.value.slice(-5))),y=()=>{uni.showModal({title:"æç¤º",content:"ç¡®å®šè¦é€€å‡ºç›´æ’­é—´å—ï¼Ÿ",success:e=>{e.confirm&&(m&&(m.leaveRoom(),m=null),uni.navigateBack())}})},E=()=>{p.value=!p.value,s.value={...s.value,muted:p.value,timestamp:Date.now()}},k=()=>{h.value=!h.value,h.value&&uni.showToast({title:"ç‚¹èµæˆåŠŸ",icon:"success"})},N=()=>{if(!v.value.trim())return;if(!m)return void t("error","at pages/viewer/live.vue:291","WebRTC æœªåˆå§‹åŒ–");const e=v.value.trim();g.value.push({id:f++,username:u.value,content:e,timestamp:Date.now(),isSelf:!0}),m.sendChatMessage(e),v.value=""};return e.onMounted((()=>{const e=getCurrentPages(),a=e[e.length-1];let h={};a.options?h=a.options:a.$mp&&a.$mp.query?h=a.$mp.query:a.$route&&a.$route.query&&(h=a.$route.query),h&&h.roomId?(i.value=h.roomId,(async()=>{try{o.value=!0,m=new fs,m.onRoomJoined=(e,a,s)=>{t("log","at pages/viewer/live.vue:150","åŠ å…¥ç›´æ’­é—´æˆåŠŸ"),r.value=e,l.value=a,c.value=s,o.value=!1,n.value=!0,uni.showToast({title:"å·²è¿›å…¥ç›´æ’­é—´",icon:"success"})},m.onRemoteStream=e=>{t("log","at pages/viewer/live.vue:164","âœ… æ”¶åˆ°è¿œç¨‹è§†é¢‘æµ:",e),t("log","at pages/viewer/live.vue:165","è§†é¢‘è½¨é“æ•°:",e.getVideoTracks().length),t("log","at pages/viewer/live.vue:166","éŸ³é¢‘è½¨é“æ•°:",e.getAudioTracks().length),s.value={stream:e,timestamp:Date.now(),muted:p.value},t("log","at pages/viewer/live.vue:176","å·²è§¦å‘ renderjs æ›´æ–°")},m.onRoomClosed=()=>{t("log","at pages/viewer/live.vue:180","ç›´æ’­é—´å·²å…³é—­"),uni.showModal({title:"æç¤º",content:"ç›´æ’­å·²ç»“æŸ",showCancel:!1,success:()=>{uni.navigateBack()}})},m.onError=e=>{t("error","at pages/viewer/live.vue:192","WebRTC é”™è¯¯:",e),uni.showToast({title:e,icon:"none"})},m.onChatMessage=(e,a,o,n)=>{t("log","at pages/viewer/live.vue:200","ğŸ’¬ æ”¶åˆ°èŠå¤©æ¶ˆæ¯:",a,o),e!==d.value?g.value.push({id:f++,username:a,content:o,timestamp:n}):t("log","at pages/viewer/live.vue:204","è·³è¿‡è‡ªå·±çš„æ¶ˆæ¯ï¼ˆå·²åœ¨å‘é€æ—¶æ·»åŠ ï¼‰")},m.onConnectionStateChange=e=>{t("log","at pages/viewer/live.vue:218","è¿æ¥çŠ¶æ€:",e),"connected"===e?(n.value=!0,o.value=!1):"failed"!==e&&"closed"!==e||(n.value=!1)},await m.connect(gs.SIGNAL_SERVER),await m.joinRoom(i.value,d.value,u.value)}catch(e){t("error","at pages/viewer/live.vue:234","åŠ å…¥ç›´æ’­é—´å¤±è´¥:",e),o.value=!1,uni.showModal({title:"æ— æ³•åŠ å…¥ç›´æ’­é—´",content:e instanceof Error?e.message:"è¯·ç¨åé‡è¯•",showCancel:!1,success:()=>{uni.navigateBack()}})}})()):uni.showModal({title:"é”™è¯¯",content:"ç¼ºå°‘ç›´æ’­é—´ID",showCancel:!1,success:()=>{uni.navigateBack()}})})),e.onUnmounted((()=>{m&&(m.leaveRoom(),m=null)})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"viewer-container"},[e.createElementVNode("view",{class:"video-wrapper"},[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-container","change:prop":t.renderScript.updateRemoteStream,prop:e.wp(s.value)},[e.createElementVNode("view",{id:"remoteVideoWrapper",class:"video-wrapper-inner"})],8,["change:prop","prop"])):o.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"connecting-container"},[e.createElementVNode("view",{class:"connecting-content"},[e.createElementVNode("view",{class:"loading-spinner"}),e.createElementVNode("text",{class:"connecting-text"},"æ­£åœ¨è¿æ¥ç›´æ’­...")])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"preview-container"},[e.createElementVNode("view",{class:"preview-content"},[e.createElementVNode("text",{class:"preview-icon"},"ğŸ“º"),e.createElementVNode("text",{class:"preview-title"},e.toDisplayString(r.value||"åŒ»ç”Ÿ")+"çš„ç›´æ’­é—´",1),e.createElementVNode("text",{class:"preview-desc"},e.toDisplayString(l.value||"å¥åº·ç§‘æ™®ç›´æ’­"),1)])])),n.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"live-overlay"},[e.createElementVNode("view",{class:"top-bar"},[e.createElementVNode("view",{class:"doctor-card"},[e.createElementVNode("image",{class:"avatar",src:ks,mode:"aspectFill"}),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(r.value),1),e.createElementVNode("text",{class:"title"},e.toDisplayString(l.value),1)]),e.createElementVNode("view",{class:"live-badge"},[e.createElementVNode("view",{class:"pulse-dot"}),e.createElementVNode("text",{class:"badge-text"},"ç›´æ’­ä¸­")])]),e.createElementVNode("view",{class:"top-actions"},[e.createElementVNode("view",{class:"viewer-count"},[e.createElementVNode("text",{class:"count-text"},"ğŸ‘¥ "+e.toDisplayString(c.value),1)]),e.createElementVNode("view",{class:"close-btn",onClick:y},[e.createElementVNode("text",{class:"icon"},"âœ•")])])]),e.createElementVNode("view",{class:"right-toolbar"},[e.createElementVNode("view",{class:"tool-item",onClick:k},[e.createElementVNode("text",{class:"tool-icon"},e.toDisplayString(h.value?"â¤ï¸":"ğŸ¤"),1),e.createElementVNode("text",{class:"tool-text"},"ç‚¹èµ")]),e.createElementVNode("view",{class:"tool-item",onClick:E},[e.createElementVNode("text",{class:"tool-icon"},e.toDisplayString(p.value?"ğŸ”‡":"ğŸ”Š"),1),e.createElementVNode("text",{class:"tool-text"},e.toDisplayString(p.value?"é™éŸ³":"å£°éŸ³"),1)])]),e.createElementVNode("scroll-view",{class:"chat-messages","scroll-y":"","scroll-into-view":"msg-"+g.value.length},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,id:"msg-"+a,class:"message-item"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(t.username)+"ï¼š",1),e.createElementVNode("text",{class:"content"},e.toDisplayString(t.content),1)],8,["id"])))),128))],8,["scroll-into-view"])])):e.createCommentVNode("",!0)]),n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"bottom-bar"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),class:"message-input",placeholder:"è¯´ç‚¹ä»€ä¹ˆ...",onConfirm:N},null,544),[[e.vModelText,v.value]])]),e.createElementVNode("button",{class:"send-btn",onClick:N,disabled:!v.value.trim()}," å‘é€ ",8,["disabled"])])):e.createCommentVNode("",!0)]))}}),Vs=e=>{(e.$renderjs||(e.$renderjs=[])).push("renderScript"),(e.$renderjsModules||(e.$renderjsModules={})).renderScript="888897b0"};Vs(Ns);const Cs=s(Ns,[["__scopeId","data-v-9785e226"]]),xs=s(e.defineComponent({__name:"list",setup(a){const o=e.ref([]),n=e.ref(!1),s=e.ref(!1);let i=null;const r=async()=>{try{n.value=!0;const e=await uni.request({url:"http://localhost:3000/api/webrtc/rooms",method:"GET"});if(200===e.statusCode&&e.data){const a=e.data;a.success?(o.value=a.data||[],t("log","at pages/live/list.vue:106","âœ… è·å–ç›´æ’­é—´åˆ—è¡¨æˆåŠŸ:",o.value.length)):t("error","at pages/live/list.vue:108","âŒ è·å–ç›´æ’­é—´åˆ—è¡¨å¤±è´¥:",a.message)}}catch(e){t("error","at pages/live/list.vue:112","âŒ è¯·æ±‚å¤±è´¥:",e),uni.showToast({title:"è·å–åˆ—è¡¨å¤±è´¥",icon:"none"})}finally{n.value=!1,s.value=!1}},l=()=>{s.value=!0,r()},c=()=>{l()},d=e=>{const t=Date.now(),a=Math.floor((t-e)/1e3),o=Math.floor(a/3600),n=Math.floor(a%3600/60);return o>0?`ç›´æ’­ä¸­ ${o}å°æ—¶${n}åˆ†é’Ÿ`:n>0?`ç›´æ’­ä¸­ ${n}åˆ†é’Ÿ`:"åˆšåˆšå¼€å§‹"};return e.onMounted((()=>{t("log","at pages/live/list.vue:176","ç›´æ’­åˆ—è¡¨é¡µé¢å·²åŠ è½½"),r(),i=setInterval((()=>{r()}),1e4)})),e.onUnmounted((()=>{i&&(clearInterval(i),i=null)})),(a,i)=>(e.openBlock(),e.createElementBlock("view",{class:"live-list-container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-content"},[e.createElementVNode("text",{class:"nav-title"},"ç›´æ’­é—´åˆ—è¡¨"),e.createElementVNode("view",{class:"refresh-btn",onClick:l},[e.createElementVNode("text",{class:e.normalizeClass(["refresh-icon",{rotating:s.value}])},"ğŸ”„",2)])])]),e.createElementVNode("scroll-view",{class:"live-list","scroll-y":"","refresher-enabled":"","refresher-triggered":s.value,onRefresherrefresh:c},[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createElementVNode("view",{class:"loading-spinner"}),e.createElementVNode("text",{class:"loading-text"},"åŠ è½½ä¸­...")])):0===o.value.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-container"},[e.createElementVNode("text",{class:"empty-icon"},"ğŸ“º"),e.createElementVNode("text",{class:"empty-title"},"æš‚æ— ç›´æ’­"),e.createElementVNode("text",{class:"empty-desc"},"å½“å‰æ²¡æœ‰åŒ»ç”Ÿåœ¨çº¿ç›´æ’­"),e.createElementVNode("button",{class:"refresh-empty-btn",onClick:l},"åˆ·æ–°åˆ—è¡¨")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"room-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.roomId,class:"room-card",onClick:e=>(e=>{t("log","at pages/live/list.vue:136","åŠ å…¥ç›´æ’­é—´:",e.roomId),uni.navigateTo({url:`/pages/viewer/live?roomId=${e.roomId}`})})(a)},[e.createElementVNode("view",{class:"room-cover"},[e.createElementVNode("image",{class:"cover-image",src:ks,mode:"aspectFill"}),e.createElementVNode("view",{class:"live-badge"},[e.createElementVNode("view",{class:"pulse-dot"}),e.createElementVNode("text",{class:"badge-text"},"ç›´æ’­ä¸­")]),e.createElementVNode("view",{class:"viewer-count"},[e.createElementVNode("text",{class:"count-icon"},"ğŸ‘¥"),e.createElementVNode("text",{class:"count-text"},e.toDisplayString(a.viewerCount),1)])]),e.createElementVNode("view",{class:"room-info"},[e.createElementVNode("view",{class:"room-header"},[e.createElementVNode("image",{class:"doctor-avatar",src:ks,mode:"aspectFill"}),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(a.doctorName),1),e.createElementVNode("text",{class:"live-time"},e.toDisplayString(d(a.startTime)),1)])]),e.createElementVNode("text",{class:"room-title"},e.toDisplayString(a.title),1)])],8,["onClick"])))),128))]))],40,["refresher-triggered"]),e.createElementVNode("view",{class:"bottom-tip"},[e.createElementVNode("text",{class:"tip-text"},"å…± "+e.toDisplayString(o.value.length)+" ä¸ªç›´æ’­é—´",1)])]))}}),[["__scopeId","data-v-90cd72fc"]]),bs=s(e.defineComponent({__name:"entrance",setup(a){const o=e.ref(0),n=()=>{uni.navigateTo({url:"/pages/live/list"})},s=()=>{uni.navigateTo({url:"/pages/doctor/live"})};return e.onMounted((()=>{(async()=>{try{const e=await uni.request({url:"http://localhost:3000/api/webrtc/rooms",method:"GET"});if(200===e.statusCode&&e.data){const a=e.data;a.success&&a.data?(o.value=a.data.length||0,t("log","at pages/live/entrance.vue:94","å½“å‰ç›´æ’­é—´æ•°é‡:",o.value)):o.value=0}else o.value=0}catch(e){t("error","at pages/live/entrance.vue:102","è·å–ç›´æ’­é—´æ•°é‡å¤±è´¥:",e),o.value=0}})()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"live-entrance-container"},[e.createElementVNode("view",{class:"bg-decoration"},[e.createElementVNode("view",{class:"circle circle-1"}),e.createElementVNode("view",{class:"circle circle-2"}),e.createElementVNode("view",{class:"circle circle-3"})]),e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"åŒ»ç”Ÿç›´æ’­"),e.createElementVNode("text",{class:"subtitle"},"å®æ—¶å¥åº·ç§‘æ™®ï¼Œåœ¨çº¿äº’åŠ¨ç­”ç–‘")]),e.createElementVNode("view",{class:"options-container"},[e.createElementVNode("view",{class:"option-card",onClick:n},[e.createElementVNode("view",{class:"card-icon"},"ğŸ“º"),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"card-title"},"è§‚çœ‹ç›´æ’­"),e.createElementVNode("text",{class:"card-desc"},"è§‚çœ‹åŒ»ç”Ÿç›´æ’­ï¼Œå­¦ä¹ å¥åº·çŸ¥è¯†"),o.value>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card-badge"},[e.createElementVNode("view",{class:"badge-dot"}),e.createElementVNode("text",{class:"badge-text"},e.toDisplayString(o.value)+"ä¸ªç›´æ’­é—´",1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"card-arrow"},[e.createElementVNode("text",{class:"arrow-icon"},"â†’")])]),e.createElementVNode("view",{class:"option-card",onClick:s},[e.createElementVNode("view",{class:"card-icon"},"ğŸ¬"),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"card-title"},"æˆ‘è¦ç›´æ’­"),e.createElementVNode("text",{class:"card-desc"},"å¼€å¯ç›´æ’­ï¼Œåˆ†äº«å¥åº·çŸ¥è¯†"),e.createElementVNode("view",{class:"card-tag"},[e.createElementVNode("text",{class:"tag-text"},"åŒ»ç”Ÿä¸“ç”¨")])]),e.createElementVNode("view",{class:"card-arrow"},[e.createElementVNode("text",{class:"arrow-icon"},"â†’")])])]),e.createElementVNode("view",{class:"features"},[e.createElementVNode("view",{class:"feature-item"},[e.createElementVNode("text",{class:"feature-icon"},"âœ“"),e.createElementVNode("text",{class:"feature-text"},"å®æ—¶è§†é¢‘ç›´æ’­")]),e.createElementVNode("view",{class:"feature-item"},[e.createElementVNode("text",{class:"feature-icon"},"âœ“"),e.createElementVNode("text",{class:"feature-text"},"åœ¨çº¿äº’åŠ¨ç­”ç–‘")]),e.createElementVNode("view",{class:"feature-item"},[e.createElementVNode("text",{class:"feature-icon"},"âœ“"),e.createElementVNode("text",{class:"feature-text"},"å¥åº·ç§‘æ™®è®²è§£")])])]))}}),[["__scopeId","data-v-24a52d2d"]]),Ss={data:()=>({doctorInfo:{},allArticles:[]}),onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/articles.vue:67","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt)}if(e.articles)try{this.allArticles=JSON.parse(decodeURIComponent(e.articles))}catch(Kt){t("error","at pages/doctor/articles.vue:76","è§£ææ–‡ç« æ•°æ®å¤±è´¥",Kt),this.loadDefaultArticles()}else this.loadDefaultArticles()},methods:{goBack(){uni.navigateBack()},loadDefaultArticles(){this.allArticles=[{id:1,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:2,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:3,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:4,title:'ç©ºè…¹èƒ½ä¸èƒ½åƒæ±¤åœ†? æ— ç³–æ±¤åœ†ä¸"èƒ–äºº"å—?',subtitle:"å…ƒå®µåƒæ±¤åœ†,æœ‰ä»€ä¹ˆç¦å¿Œå—?",readCount:"8908",date:"2020-03-03",image:"/static/logo.png",content:"æ±¤åœ†æ˜¯å…ƒå®µèŠ‚çš„ä¼ ç»Ÿç¾é£Ÿï¼Œä½†å¾ˆå¤šäººæ‹…å¿ƒç©ºè…¹åƒæ±¤åœ†æ˜¯å¦åˆé€‚ï¼Œä»¥åŠæ— ç³–æ±¤åœ†æ˜¯å¦çœŸçš„ä¸ä¼šè®©äººå‘èƒ–ã€‚\n\né¦–å…ˆï¼Œå…³äºç©ºè…¹åƒæ±¤åœ†çš„é—®é¢˜ï¼š\n1. æ±¤åœ†ä¸»è¦ç”±ç³¯ç±³åˆ¶æˆï¼Œç³¯ç±³å±äºé«˜GIé£Ÿç‰©ï¼Œç©ºè…¹é£Ÿç”¨å®¹æ˜“å¯¼è‡´è¡€ç³–å¿«é€Ÿå‡é«˜ã€‚\n2. å¯¹äºç³–å°¿ç—…æ‚£è€…æˆ–è¡€ç³–æ§åˆ¶ä¸ä½³çš„äººç¾¤ï¼Œä¸å»ºè®®ç©ºè…¹é£Ÿç”¨æ±¤åœ†ã€‚\n3. å»ºè®®åœ¨æ­£é¤åé€‚é‡é£Ÿç”¨ï¼Œæˆ–è€…æ­é…å…¶ä»–é£Ÿç‰©ä¸€èµ·é£Ÿç”¨ã€‚\n\nå…³äºæ— ç³–æ±¤åœ†ï¼š\n1. æ— ç³–æ±¤åœ†è™½ç„¶ä¸å«è”—ç³–ï¼Œä½†ç³¯ç±³æœ¬èº«å«æœ‰å¤§é‡ç¢³æ°´åŒ–åˆç‰©ï¼Œä»ç„¶ä¼šè½¬åŒ–ä¸ºç³–åˆ†ã€‚\n2. æ— ç³–ä¸ç­‰äºæ— çƒ­é‡ï¼Œè¿‡é‡é£Ÿç”¨ä»ç„¶ä¼šå¯¼è‡´ä½“é‡å¢åŠ ã€‚\n3. å»ºè®®æ§åˆ¶é£Ÿç”¨é‡ï¼Œæ¯æ¬¡3-5ä¸ªä¸ºå®œã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ±¤åœ†å¯ä»¥é€‚é‡é£Ÿç”¨ï¼Œä½†è¦æ³¨æ„é£Ÿç”¨æ—¶é—´å’Œæ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰è¡€ç³–é—®é¢˜çš„äººç¾¤ã€‚"},{id:5,title:"æ˜¥å­£å…»ç”Ÿå°è´´å£«",subtitle:"å¦‚ä½•é€šè¿‡é¥®é£Ÿè°ƒç†èº«ä½“",readCount:"5623",date:"2020-03-01",image:"/static/logo.png",content:"æ˜¥å­£æ˜¯ä¸‡ç‰©å¤è‹çš„å­£èŠ‚ï¼Œä¹Ÿæ˜¯å…»ç”Ÿçš„å¥½æ—¶æœºã€‚æ˜¥å­£å…»ç”Ÿéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n1. é¥®é£Ÿè°ƒç†ï¼š\n   - å¤šåƒæ–°é²œè”¬èœå’Œæ°´æœï¼Œè¡¥å……ç»´ç”Ÿç´ \n   - é€‚é‡é£Ÿç”¨æ¸©è¡¥é£Ÿç‰©ï¼Œå¦‚çº¢æ£ã€æ¡‚åœ†ç­‰\n   - å°‘åƒç”Ÿå†·é£Ÿç‰©ï¼Œä¿æŠ¤è„¾èƒƒ\n\n2. è¿åŠ¨é”»ç‚¼ï¼š\n   - é€‰æ‹©é€‚åˆçš„æˆ·å¤–è¿åŠ¨ï¼Œå¦‚æ•£æ­¥ã€æ…¢è·‘\n   - é¿å…å‰§çƒˆè¿åŠ¨ï¼Œå¾ªåºæ¸è¿›\n   - æ³¨æ„è¿åŠ¨åçš„ä¿æš–\n\n3. ä½œæ¯è§„å¾‹ï¼š\n   - æ—©ç¡æ—©èµ·ï¼Œé¡ºåº”è‡ªç„¶è§„å¾‹\n   - ä¿è¯å……è¶³çš„ç¡çœ æ—¶é—´\n   - é¿å…ç†¬å¤œ\n\n4. æƒ…ç»ªè°ƒèŠ‚ï¼š\n   - ä¿æŒå¿ƒæƒ…æ„‰æ‚¦\n   - å¤šä¸æœ‹å‹äº¤æµ\n   - é€‚å½“æ”¾æ¾ï¼Œç¼“è§£å‹åŠ›\n\næ˜¥å­£å…»ç”Ÿè¦é¡ºåº”è‡ªç„¶ï¼Œå¾ªåºæ¸è¿›ï¼Œæ‰èƒ½è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚"},{id:6,title:"å¦‚ä½•é¢„é˜²æ„Ÿå†’",subtitle:"æé«˜å…ç–«åŠ›çš„æ–¹æ³•",readCount:"7234",date:"2020-02-28",image:"/static/logo.png",content:"æ„Ÿå†’æ˜¯å¸¸è§çš„å‘¼å¸é“ç–¾ç—…ï¼Œé¢„é˜²æ„Ÿå†’éœ€è¦ä»å¤šä¸ªæ–¹é¢å…¥æ‰‹ï¼š\n\n1. å¢å¼ºå…ç–«åŠ›ï¼š\n   - ä¿è¯å……è¶³çš„ç¡çœ \n   - å‡è¡¡é¥®é£Ÿï¼Œå¤šæ‘„å…¥ç»´ç”Ÿç´ C\n   - é€‚é‡è¿åŠ¨ï¼Œå¢å¼ºä½“è´¨\n\n2. æ³¨æ„ä¸ªäººå«ç”Ÿï¼š\n   - å‹¤æ´—æ‰‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¥è§¦å…¬å…±ç‰©å“å\n   - é¿å…ç”¨æ‰‹è§¦æ‘¸å£é¼»çœ¼\n   - ä¿æŒå®¤å†…ç©ºæ°”æµé€š\n\n3. é¿å…æ¥è§¦ä¼ æŸ“æºï¼š\n   - é¿å…ä¸æ„Ÿå†’æ‚£è€…å¯†åˆ‡æ¥è§¦\n   - åœ¨æµæ„Ÿé«˜å‘æœŸå‡å°‘å»äººç¾¤å¯†é›†çš„åœ°æ–¹\n   - å¿…è¦æ—¶ä½©æˆ´å£ç½©\n\n4. åŠæ—¶å°±åŒ»ï¼š\n   - å‡ºç°æ„Ÿå†’ç—‡çŠ¶åŠæ—¶å°±åŒ»\n   - éµåŒ»å˜±ç”¨è¯ï¼Œä¸è¦è‡ªè¡Œç”¨è¯\n   - æ³¨æ„ä¼‘æ¯ï¼Œå¤šå–æ°´\n\né¢„é˜²æ„Ÿå†’éœ€è¦é•¿æœŸåšæŒï¼Œå…»æˆè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯æ˜¯å…³é”®ã€‚"}]},viewArticle(e){const a=encodeURIComponent(JSON.stringify(e)),o=encodeURIComponent(JSON.stringify(this.doctorInfo));uni.navigateTo({url:`/pages/doctor/article-detail?article=${a}&doctor=${o}`,fail:e=>{t("error","at pages/doctor/articles.vue:155","è·³è½¬åˆ°æ–‡ç« è¯¦æƒ…é¡µé¢å¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})}}};const Is=s(Ss,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"åŒ»ç”Ÿæ–‡ç« "),e.createElementVNode("view",{class:"nav-placeholder"})]),s.doctorInfo.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital),1)])])])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{class:"articles-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.allArticles,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||a,class:"article-item",onClick:e=>i.viewArticle(t)},[e.createElementVNode("view",{class:"article-content"},[e.createElementVNode("text",{class:"article-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"article-subtitle"},e.toDisplayString(t.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"article-reads"},e.toDisplayString(t.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(t.date),1)])]),e.createElementVNode("view",{class:"article-image"},[e.createElementVNode("image",{src:t.image,mode:"aspectFill",class:"article-img"},null,8,["src"])])],8,["onClick"])))),128)),0===s.allArticles.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— æ–‡ç« ")])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-f5cf5ce8"]]),Ts={data:()=>({doctorInfo:{},article:{}}),onLoad(e){if(e.doctor)try{this.doctorInfo=JSON.parse(decodeURIComponent(e.doctor))}catch(Kt){t("error","at pages/doctor/article-detail.vue:63","è§£æåŒ»ç”Ÿä¿¡æ¯å¤±è´¥",Kt)}if(e.article)try{this.article=JSON.parse(decodeURIComponent(e.article))}catch(Kt){t("error","at pages/doctor/article-detail.vue:72","è§£ææ–‡ç« æ•°æ®å¤±è´¥",Kt),uni.showToast({title:"æ•°æ®åŠ è½½å¤±è´¥",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500)}else uni.showToast({title:"ç¼ºå°‘æ–‡ç« æ•°æ®",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500)},methods:{goBack(){uni.navigateBack()}}};const Ds=s(Ts,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"æ–‡ç« è¯¦æƒ…"),e.createElementVNode("view",{class:"nav-placeholder"})]),e.createElementVNode("scroll-view",{class:"article-content","scroll-y":""},[e.createElementVNode("view",{class:"article-header"},[e.createElementVNode("text",{class:"article-title"},e.toDisplayString(s.article.title),1),e.createElementVNode("text",{class:"article-subtitle"},e.toDisplayString(s.article.subtitle),1),e.createElementVNode("view",{class:"article-meta"},[e.createElementVNode("text",{class:"article-reads"},e.toDisplayString(s.article.readCount)+"é˜…è¯»",1),e.createElementVNode("text",{class:"article-date"},e.toDisplayString(s.article.date),1)])]),s.doctorInfo.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-info-section"},[e.createElementVNode("view",{class:"doctor-info-card"},[e.createElementVNode("image",{class:"doctor-avatar",src:s.doctorInfo.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(s.doctorInfo.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(s.doctorInfo.level),1),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(s.doctorInfo.hospital),1)])])])):e.createCommentVNode("",!0),s.article.image?(e.openBlock(),e.createElementBlock("view",{key:1,class:"article-image-section"},[e.createElementVNode("image",{src:s.article.image,mode:"widthFix",class:"article-image"},null,8,["src"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"article-body"},[e.createElementVNode("text",{class:"article-text"},e.toDisplayString(s.article.content||"æ–‡ç« å†…å®¹åŠ è½½ä¸­..."),1)])])])}],["__scopeId","data-v-f61433af"]]);function Bs(e){return e?`consultation_records_${e}`:(t("warn","at utils/consultationStorage.js:15","âš ï¸ ç”¨æˆ·IDä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤keyï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®æ··ä¹±ï¼‰"),"consultation_records_default")}function _s(e=null){try{if(!e)try{const t=ae();e=(null==t?void 0:t.id)||(null==t?void 0:t._id)||(null==t?void 0:t.userId)||(null==t?void 0:t.username)}catch(Kt){t("warn","at utils/consultationStorage.js:33","æ— æ³•ä»authè·å–ç”¨æˆ·ID:",Kt)}const a=Bs(e),o=uni.getStorageSync(a);return o?JSON.parse(o):[]}catch(a){return t("error","at utils/consultationStorage.js:41","è·å–å’¨è¯¢è®°å½•å¤±è´¥:",a),[]}}function Ps(e,a=null){var o,n;try{const s=e.patientId||(null==(o=e.patientInfo)?void 0:o.id);if(!a&&!(a=s))try{const e=ae();a=(null==e?void 0:e.id)||(null==e?void 0:e._id)||(null==e?void 0:e.userId)||(null==e?void 0:e.username)}catch(Kt){t("warn","at utils/consultationStorage.js:64","æ— æ³•ä»authè·å–ç”¨æˆ·ID:",Kt)}!e.patientId&&s&&(e.patientId=s);const i=_s(a);let r=-1;if(e.id&&(r=i.findIndex((t=>t.id===e.id)),t("log","at utils/consultationStorage.js:82","ğŸ” æ ¹æ®å’¨è¯¢IDæŸ¥æ‰¾:",e.id,r>=0?"æ‰¾åˆ°":"æœªæ‰¾åˆ°")),r<0&&(r=i.findIndex((t=>{var a;const o=t.patientId||(null==(a=t.patientInfo)?void 0:a.id),n=t.patientInfo||{},i=e.patientInfo||{};if(s&&o===s)return!0;const r=i.name&&n.name===i.name,l=(i.gender||"")===(n.gender||""),c=(i.age||"")===(n.age||"");return!!(r&&l&&c)})),t("log","at utils/consultationStorage.js:109","ğŸ” æ ¹æ®æ‚£è€…ä¿¡æ¯æŸ¥æ‰¾:",{patientId:s,patientName:null==(n=e.patientInfo)?void 0:n.name,found:r>=0?"æ‰¾åˆ°":"æœªæ‰¾åˆ°"})),r>=0){const a=i[r],o=a.messages||[],n=e.messages||[],l=new Map;o.forEach((e=>{l.set(e.id||`${e.timestamp}_${e.content}`,e)})),n.forEach((e=>{const t=e.id||`${e.timestamp}_${e.content}`;(!l.has(t)||l.get(t).timestamp<e.timestamp)&&l.set(t,e)}));const c=a.symptomImages||[],d=e.symptomImages||[],u=new Map;c.forEach((e=>{const t=e.path||e.thumb||e;u.set(t,e)})),d.forEach((e=>{const t=e.path||e.thumb||e;u.has(t)||u.set(t,e)}));let m=a.symptomDescription||"";return e.symptomDescription&&(!m||e.symptomDescription.length>m.length)&&(m=e.symptomDescription),i[r]={...a,...e,id:a.id,createdAt:a.createdAt,updatedAt:Date.now(),messages:Array.from(l.values()).sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),symptomImages:Array.from(u.values()),symptomDescription:m,patientId:s||a.patientId,patientInfo:{...a.patientInfo,...e.patientInfo}},t("log","at utils/consultationStorage.js:182","âœ… å’¨è¯¢è®°å½•å·²åˆå¹¶:",a.id,"æ¶ˆæ¯æ•°:",i[r].messages.length,"å›¾ç‰‡æ•°:",i[r].symptomImages.length),a.id}e.id||(e.id=`consult_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.createdAt||(e.createdAt=Date.now()),e.updatedAt=Date.now(),i.unshift(e),t("log","at utils/consultationStorage.js:202","âœ… å’¨è¯¢è®°å½•å·²åˆ›å»º:",e.id),i.length>50&&i.splice(50);const l=Bs(a);return uni.setStorageSync(l,JSON.stringify(i)),e.id||i[0].id}catch(s){throw t("error","at utils/consultationStorage.js:216","ä¿å­˜å’¨è¯¢è®°å½•å¤±è´¥:",s),s}}const As={data:()=>({symptomDescription:"",recommendTags:[],historyRecommendations:[],symptomRecommendations:[],similarCaseRecommendations:[],isLoading:!1,allDoctors:[],hotDepartments:["å†…ç§‘","å¤–ç§‘","å„¿ç§‘","å¦‡ç§‘","çœ¼ç§‘","å£è…”ç§‘","çš®è‚¤ç§‘","éª¨ç§‘","ç¥ç»å†…ç§‘","å¿ƒè¡€ç®¡å†…ç§‘","æ¶ˆåŒ–å†…ç§‘","å‘¼å¸å†…ç§‘"],hotDiseases:["æ„Ÿå†’","å¤´ç—›","èƒƒç—›","å¤±çœ ","é«˜è¡€å‹","ç³–å°¿ç—…","å’³å—½","å‘çƒ§","è…°ç—›","å…³èŠ‚ç—›","çš®è‚¤è¿‡æ•","ç‰™ç—›"],selectedDeptTag:"",selectedDiseaseTag:""}),computed:{allRecommendations(){return[...this.historyRecommendations,...this.symptomRecommendations,...this.similarCaseRecommendations]}},onLoad(){this.loadRecommendations(),this.initRecommendTags()},methods:{goBack(){uni.navigateBack()},initRecommendTags(){this.recommendTags=[{text:"å¤´ç—›",icon:"ğŸ¤•",active:!1,keyword:"å¤´ç—›"},{text:"å‘çƒ­",icon:"ğŸŒ¡ï¸",active:!1,keyword:"å‘çƒ­"},{text:"å’³å—½",icon:"ğŸ˜·",active:!1,keyword:"å’³å—½"},{text:"èƒƒç—›",icon:"ğŸ¤¢",active:!1,keyword:"èƒƒç—›"},{text:"å¤±çœ ",icon:"ğŸ˜´",active:!1,keyword:"å¤±çœ "},{text:"çš®è‚¤",icon:"ğŸ§´",active:!1,keyword:"çš®è‚¤"},{text:"å…³èŠ‚",icon:"ğŸ¦´",active:!1,keyword:"å…³èŠ‚"},{text:"å¿ƒè„",icon:"â¤ï¸",active:!1,keyword:"å¿ƒè„"}]},selectTag(e){e.active=!e.active,e.active&&(this.symptomDescription=e.keyword,this.searchBySymptom())},selectDeptTag(e){this.selectedDeptTag===e?(this.selectedDeptTag="",this.symptomDescription=""):(this.selectedDeptTag=e,this.selectedDiseaseTag="",this.symptomDescription=e,this.searchBySymptom())},selectDiseaseTag(e){this.selectedDiseaseTag===e?(this.selectedDiseaseTag="",this.symptomDescription=""):(this.selectedDiseaseTag=e,this.selectedDeptTag="",this.symptomDescription=e,this.searchBySymptom())},onSymptomInput(){},loadRecommendations(){this.loadHistoryRecommendations(),this.loadSimilarCaseRecommendations()},loadHistoryRecommendations(){try{const e=he(),t=_s(),a=new Set;e.forEach((e=>{e.dept&&a.add(e.dept),e.specialty&&a.add(e.specialty)})),t.forEach((e=>{var t;(null==(t=e.patientInfo)?void 0:t.department)&&a.add(e.patientInfo.department)})),a.size>0&&(this.historyRecommendations=this.getDoctorsByDept(Array.from(a)))}catch(Kt){t("error","at pages/doctor/smart-recommend.vue:348","åŠ è½½å†å²æ¨èå¤±è´¥:",Kt)}},searchBySymptom(){this.symptomDescription.trim()?(this.isLoading=!0,setTimeout((()=>{this.symptomRecommendations=this.matchDoctorsBySymptom(this.symptomDescription),this.isLoading=!1,0===this.symptomRecommendations.length&&uni.showToast({title:"æœªæ‰¾åˆ°åŒ¹é…çš„åŒ»ç”Ÿ",icon:"none"})}),800)):uni.showToast({title:"è¯·è¾“å…¥ç—‡çŠ¶æè¿°",icon:"none"})},matchDoctorsBySymptom(e){const t=this.extractKeywords(e),a=[];return this.getAllDoctors().forEach((e=>{const o=this.calculateMatchScore(e,t);o>0&&a.push({...e,matchScore:o,recommendReason:this.generateRecommendReason(e,t)})})),a.sort(((e,t)=>t.matchScore-e.matchScore)),a.slice(0,5)},extractKeywords(e){const t=[],a=e.toLowerCase(),o={"å¤´ç—›":["å¤´ç—›","å¤´ç–¼","åå¤´ç—›"],"å‘çƒ­":["å‘çƒ­","å‘çƒ§","ä½“æ¸©"],"å’³å—½":["å’³å—½","å’³","å’³ç—°"],"èƒƒç—›":["èƒƒç—›","èƒƒç–¼","èƒƒéƒ¨","èƒƒç‚"],"å¤±çœ ":["å¤±çœ ","ç¡ä¸ç€","ç¡çœ "],"çš®è‚¤":["çš®è‚¤","çš®ç–¹","æ¹¿ç–¹","è¿‡æ•"],"å…³èŠ‚":["å…³èŠ‚","å…³èŠ‚ç—›","å…³èŠ‚ç‚"],"å¿ƒè„":["å¿ƒè„","å¿ƒæ‚¸","èƒ¸é—·","å¿ƒæ…Œ"]};return Object.keys(o).forEach((e=>{o[e].some((e=>a.includes(e)))&&t.push(e)})),t},calculateMatchScore(e,t){let a=0;const o=(e.goodAt||"").toLowerCase(),n=(e.dept||"").toLowerCase();return t.forEach((e=>{const t=e.toLowerCase();o.includes(t)&&(a+=30),n.includes(t)&&(a+=20)})),e.rating&&(a+=10*e.rating),e.appointmentCount&&(a+=Math.min(e.appointmentCount/100,10)),Math.min(a,100)},generateRecommendReason:(e,t)=>t.length>0?`æ“…é•¿æ²»ç–—${t.join("ã€")}ç›¸å…³ç–¾ç—…`:"ä¸“ä¸šæ²»ç–—ç›¸å…³ç—‡çŠ¶ï¼Œç»éªŒä¸°å¯Œ",loadSimilarCaseRecommendations(){this.similarCaseRecommendations=[{id:101,name:"å¼ åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",dept:"ç¥ç»å†…ç§‘",goodAt:"å¤´ç—›ã€åå¤´ç—›ã€ç¥ç»ç—›",avatar:"https://randomuser.me/api/portraits/men/2.jpg",similarCount:128,recommendReason:"128ä½ç›¸ä¼¼ç—‡çŠ¶æ‚£è€…é€‰æ‹©äº†è¿™ä½åŒ»ç”Ÿ"},{id:102,name:"æåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"æ¶ˆåŒ–å†…ç§‘",goodAt:"èƒƒç‚ã€èƒƒç—›ã€æ¶ˆåŒ–ä¸è‰¯",avatar:"https://randomuser.me/api/portraits/men/4.jpg",similarCount:95,recommendReason:"95ä½ç›¸ä¼¼ç—‡çŠ¶æ‚£è€…é€‰æ‹©äº†è¿™ä½åŒ»ç”Ÿ"}]},getDoctorsByDept(e){const t=this.getAllDoctors(),a=[];return e.forEach((e=>{t.filter((t=>t.dept&&t.dept.includes(e)||t.department&&t.department.includes(e))).forEach((t=>{a.find((e=>e.id===t.id))||a.push({...t,recommendReason:`æ‚¨æ›¾å°±è¯Šäº${e}ï¼Œæ¨èç›¸å…³ä¸“å®¶`})}))})),a.slice(0,3)},getAllDoctors(){return 0===this.allDoctors.length&&(this.allDoctors=[{id:1,name:"ç‹åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤§å­¦ç¬¬ä¸€åŒ»é™¢",dept:"å¿ƒè¡€ç®¡å†…ç§‘",department:"å¿ƒè¡€ç®¡å†…ç§‘",goodAt:"å¿ƒè¡€ç®¡ç–¾ç—…ã€å¿ƒè„ç—…ã€å† å¿ƒç—…ã€å¿ƒèƒ¸è¡€...",avatar:"https://randomuser.me/api/portraits/men/1.jpg",rating:4.9,appointmentCount:2312},{id:2,name:"æåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬åå’ŒåŒ»é™¢",dept:"ç¥ç»å†…ç§‘",department:"ç¥ç»å†…ç§‘",goodAt:"ç¥ç»ç–¾ç—…ã€å¤´ç—›ã€å¤±çœ ã€åå¤´ç—›",avatar:"https://randomuser.me/api/portraits/men/2.jpg",rating:4.8,appointmentCount:1856},{id:3,name:"å¼ åŒ»ç”Ÿ",level:"ä¸»æ²»åŒ»å¸ˆ",hospital:"åŒ—äº¬å¤©å›åŒ»é™¢",dept:"éª¨ç§‘",department:"éª¨ç§‘",goodAt:"éª¨ç§‘ç–¾ç—…ã€éª¨æŠ˜ã€å…³èŠ‚ç–¼ç—›ã€å…³èŠ‚ç‚",avatar:"https://randomuser.me/api/portraits/men/3.jpg",rating:4.7,appointmentCount:1523},{id:4,name:"åˆ˜åŒ»ç”Ÿ",level:"ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬æœé˜³åŒ»é™¢",dept:"æ¶ˆåŒ–å†…ç§‘",department:"æ¶ˆåŒ–å†…ç§‘",goodAt:"æ¶ˆåŒ–ç³»ç»Ÿç–¾ç—…ã€èƒƒç‚ã€èƒƒæºƒç–¡ã€èƒƒç—›",avatar:"https://randomuser.me/api/portraits/men/4.jpg",rating:4.85,appointmentCount:2098},{id:5,name:"é™ˆåŒ»ç”Ÿ",level:"å‰¯ä¸»ä»»åŒ»å¸ˆ",hospital:"åŒ—äº¬å‹è°ŠåŒ»é™¢",dept:"çš®è‚¤ç§‘",department:"çš®è‚¤ç§‘",goodAt:"çš®è‚¤ç—…ã€æ¹¿ç–¹ã€è¿‡æ•ã€çš®ç–¹",avatar:"https://randomuser.me/api/portraits/men/5.jpg",rating:4.75,appointmentCount:1245}]),this.allDoctors},viewDoctorDetail(e){const a=encodeURIComponent(JSON.stringify(e));uni.navigateTo({url:`/pages/doctor/detail?doctor=${a}`,fail:e=>{t("error","at pages/doctor/smart-recommend.vue:578","è·³è½¬åˆ°åŒ»ç”Ÿè¯¦æƒ…é¡µå¤±è´¥:",e),uni.showToast({title:"è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}})}}};const Us=s(As,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:a[0]||(a[0]=(...e)=>i.goBack&&i.goBack(...e))},[e.createElementVNode("text",{class:"back-icon"},"â€¹")]),e.createElementVNode("text",{class:"nav-title"},"æ™ºèƒ½æ¨è"),e.createElementVNode("view",{class:"nav-placeholder"})]),e.createElementVNode("view",{class:"symptom-section"},[e.createElementVNode("view",{class:"section-title"},"æè¿°æ‚¨çš„ç—‡çŠ¶"),e.createElementVNode("view",{class:"symptom-input-box"},[e.withDirectives(e.createElementVNode("textarea",{class:"symptom-input","onUpdate:modelValue":a[1]||(a[1]=e=>s.symptomDescription=e),placeholder:"ä¾‹å¦‚ï¼šå¤´ç—›ã€å‘çƒ­ã€å’³å—½ã€èƒƒç—›ç­‰...",maxlength:"200",onInput:a[2]||(a[2]=(...e)=>i.onSymptomInput&&i.onSymptomInput(...e))},null,544),[[e.vModelText,s.symptomDescription]]),e.createElementVNode("view",{class:"char-count"},e.toDisplayString(s.symptomDescription.length)+"/200",1)]),e.createElementVNode("button",{class:"search-btn",onClick:a[3]||(a[3]=(...e)=>i.searchBySymptom&&i.searchBySymptom(...e)),disabled:!s.symptomDescription.trim()}," æ™ºèƒ½åŒ¹é…åŒ»ç”Ÿ ",8,["disabled"])]),e.createElementVNode("view",{class:"hot-tags-section"},[e.createElementVNode("view",{class:"tags-group"},[e.createElementVNode("view",{class:"tags-title"},[e.createElementVNode("text",{class:"title-icon"},"ğŸ¥"),e.createElementVNode("text",{class:"title-text"},"çƒ­é—¨ç§‘å®¤")]),e.createElementVNode("scroll-view",{class:"tags-scroll","scroll-x":"","show-scrollbar":"false"},[e.createElementVNode("view",{class:"tags-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.hotDepartments,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tag-item",{active:s.selectedDeptTag===t}]),onClick:e=>i.selectDeptTag(t)},[e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(t),1)],10,["onClick"])))),128))])])]),e.createElementVNode("view",{class:"tags-group"},[e.createElementVNode("view",{class:"tags-title"},[e.createElementVNode("text",{class:"title-icon"},"ğŸ©º"),e.createElementVNode("text",{class:"title-text"},"çƒ­é—¨ç–¾ç—…")]),e.createElementVNode("scroll-view",{class:"tags-scroll","scroll-x":"","show-scrollbar":"false"},[e.createElementVNode("view",{class:"tags-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.hotDiseases,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tag-item",{active:s.selectedDiseaseTag===t}]),onClick:e=>i.selectDiseaseTag(t)},[e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(t),1)],10,["onClick"])))),128))])])])]),s.recommendTags.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"recommend-tags"},[e.createElementVNode("view",{class:"tags-title"},"ä¸ºæ‚¨æ¨è"),e.createElementVNode("view",{class:"tags-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.recommendTags,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tag-item",{active:t.active}]),onClick:e=>i.selectTag(t)},[e.createElementVNode("text",{class:"tag-icon"},e.toDisplayString(t.icon),1),e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(t.text),1)],10,["onClick"])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{class:"recommend-content","scroll-y":""},[s.historyRecommendations.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"recommend-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title-text"},"åŸºäºæ‚¨çš„å°±è¯Šå†å²"),e.createElementVNode("view",{class:"recommend-badge"},"ä¸ºæ‚¨æ¨è")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.historyRecommendations,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"doctor-card",onClick:e=>i.viewDoctorDetail(t)},[e.createElementVNode("view",{class:"doctor-avatar"},[e.createElementVNode("image",{src:t.avatar,mode:"aspectFill",class:"avatar-img"},null,8,["src"]),e.createElementVNode("view",{class:"recommend-label"},"å†å²å°±è¯Š")]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(t.level),1)]),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"doctor-dept"},e.toDisplayString(t.dept),1),e.createElementVNode("view",{class:"doctor-specialties"},[e.createElementVNode("text",{class:"specialties-label"},"æ“…é•¿ï¼š"),e.createElementVNode("text",{class:"specialties-text"},e.toDisplayString(t.goodAt),1)]),e.createElementVNode("view",{class:"recommend-reason"},[e.createElementVNode("text",{class:"reason-icon"},"ğŸ’¡"),e.createElementVNode("text",{class:"reason-text"},e.toDisplayString(t.recommendReason),1)])])],8,["onClick"])))),128))])):e.createCommentVNode("",!0),s.symptomRecommendations.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"recommend-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title-text"},"æ ¹æ®ç—‡çŠ¶æ™ºèƒ½åŒ¹é…"),e.createElementVNode("view",{class:"recommend-badge"},"æ™ºèƒ½æ¨è")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.symptomRecommendations,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"doctor-card",onClick:e=>i.viewDoctorDetail(t)},[e.createElementVNode("view",{class:"doctor-avatar"},[e.createElementVNode("image",{src:t.avatar,mode:"aspectFill",class:"avatar-img"},null,8,["src"]),e.createElementVNode("view",{class:"recommend-label match-label"},"ç—‡çŠ¶åŒ¹é…")]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(t.level),1)]),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"doctor-dept"},e.toDisplayString(t.dept),1),e.createElementVNode("view",{class:"doctor-specialties"},[e.createElementVNode("text",{class:"specialties-label"},"æ“…é•¿ï¼š"),e.createElementVNode("text",{class:"specialties-text"},e.toDisplayString(t.goodAt),1)]),e.createElementVNode("view",{class:"match-score"},[e.createElementVNode("text",{class:"score-label"},"åŒ¹é…åº¦ï¼š"),e.createElementVNode("view",{class:"score-bar"},[e.createElementVNode("view",{class:"score-fill",style:e.normalizeStyle({width:t.matchScore+"%"})},null,4)]),e.createElementVNode("text",{class:"score-text"},e.toDisplayString(t.matchScore)+"%",1)]),e.createElementVNode("view",{class:"recommend-reason"},[e.createElementVNode("text",{class:"reason-icon"},"ğŸ¯"),e.createElementVNode("text",{class:"reason-text"},e.toDisplayString(t.recommendReason),1)])])],8,["onClick"])))),128))])):e.createCommentVNode("",!0),s.similarCaseRecommendations.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"recommend-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title-text"},"ç›¸ä¼¼ç—…ä¾‹æ‚£è€…é€‰æ‹©"),e.createElementVNode("view",{class:"recommend-badge"},"çƒ­é—¨é€‰æ‹©")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.similarCaseRecommendations,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"doctor-card",onClick:e=>i.viewDoctorDetail(t)},[e.createElementVNode("view",{class:"doctor-avatar"},[e.createElementVNode("image",{src:t.avatar,mode:"aspectFill",class:"avatar-img"},null,8,["src"]),e.createElementVNode("view",{class:"recommend-label similar-label"},"ç›¸ä¼¼ç—…ä¾‹")]),e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"doctor-level"},e.toDisplayString(t.level),1)]),e.createElementVNode("text",{class:"doctor-hospital"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"doctor-dept"},e.toDisplayString(t.dept),1),e.createElementVNode("view",{class:"doctor-specialties"},[e.createElementVNode("text",{class:"specialties-label"},"æ“…é•¿ï¼š"),e.createElementVNode("text",{class:"specialties-text"},e.toDisplayString(t.goodAt),1)]),e.createElementVNode("view",{class:"similar-info"},[e.createElementVNode("text",{class:"similar-text"},e.toDisplayString(t.similarCount)+"ä½ç›¸ä¼¼æ‚£è€…é€‰æ‹©äº†è¿™ä½åŒ»ç”Ÿ",1)]),e.createElementVNode("view",{class:"recommend-reason"},[e.createElementVNode("text",{class:"reason-icon"},"ğŸ‘¥"),e.createElementVNode("text",{class:"reason-text"},e.toDisplayString(t.recommendReason),1)])])],8,["onClick"])))),128))])):e.createCommentVNode("",!0),0!==i.allRecommendations.length||s.isLoading?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:3,class:"empty-state"},[e.createElementVNode("text",{class:"empty-icon"},"ğŸ”"),e.createElementVNode("text",{class:"empty-text"},"æš‚æ— æ¨è"),e.createElementVNode("text",{class:"empty-hint"},"è¯·æè¿°æ‚¨çš„ç—‡çŠ¶æˆ–æŸ¥çœ‹å†å²å°±è¯Šè®°å½•")])),s.isLoading?(e.openBlock(),e.createElementBlock("view",{key:4,class:"loading-state"},[e.createElementVNode("text",{class:"loading-text"},"æ­£åœ¨ä¸ºæ‚¨æ™ºèƒ½åŒ¹é…...")])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-ef1b444c"]]),Ms={components:{ThemeToggle:d},data:()=>({activeTab:"all",theme:l(),tabs:[{key:"all",label:"å…¨éƒ¨"},{key:"pendingVisit",label:"å¾…å°±è¯Š"},{key:"pendingRate",label:"å¾…è¯„ä»·"},{key:"rated",label:"å·²è¯„ä»·"},{key:"history",label:"å†å²"}],appointmentList:[],showPaymentModal:!1,selectedItem:null,paymentMethod:"alipay"}),computed:{navIconColor(){return"dark"===this.theme.name?"#ffffff":this.theme.textColor}},onLoad(e){e&&e.type&&(this.activeTab=e.type),!e||"success"!==e.status&&"alipay"!==e.from||(uni.showToast({title:"æ”¯ä»˜æˆåŠŸ",icon:"success",duration:2e3}),setTimeout((()=>{uni.switchTab({url:"/pages/index/index",success:()=>{t("log","at pages/mine/appointments.vue:159","âœ… æ”¯ä»˜æˆåŠŸï¼Œå·²è·³è½¬åˆ°é¦–é¡µ")},fail:e=>{t("error","at pages/mine/appointments.vue:162","âŒ è·³è½¬é¦–é¡µå¤±è´¥:",e)}})}),2e3)),this.loadAppointments()},onShow(){uni.$on("themeChange",this.updateTheme),this.updateTheme(),this.loadAppointments()},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{goBack(){const e=getCurrentPages();e&&e.length>1?uni.navigateBack({delta:1,fail:e=>{t("warn","at pages/mine/appointments.vue:189","è¿”å›å¤±è´¥ï¼Œè·³è½¬åˆ°æˆ‘çš„é¡µé¢:",e),uni.switchTab({url:"/pages/mine/mine",fail:()=>{uni.showToast({title:"è¿”å›å¤±è´¥",icon:"none",duration:2e3})}})}}):uni.switchTab({url:"/pages/mine/mine",fail:()=>{uni.showToast({title:"æ— æ³•è¿”å›",icon:"none",duration:2e3})}})},switchTab(e){this.activeTab=e,this.filterAppointments()},async loadAppointments(){t("log","at pages/mine/appointments.vue:223","ğŸ” å¼€å§‹åŠ è½½é¢„çº¦æ•°æ®ï¼Œå½“å‰æ ‡ç­¾:",this.activeTab);try{const e=function(e){try{const t=he();return"all"===e?t:t.filter((t=>t.status===e))}catch(a){return t("error","at utils/appointmentStorage.js:127","è·å–é¢„çº¦è®°å½•å¤±è´¥:",a),[]}}(this.activeTab);if(t("log","at pages/mine/appointments.vue:228","ğŸ“¦ æœ¬åœ°å­˜å‚¨æ•°æ®:",{activeTab:this.activeTab,localCount:e?e.length:0,localData:e}),e&&Array.isArray(e)&&e.length>0)return t("log","at pages/mine/appointments.vue:236","âœ… ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®ï¼Œæ•°é‡:",e.length),this.appointmentList=e.map((e=>{let t=e.date;if(t&&t.includes("å¹´")){const e=t.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);if(e){t=`${e[1]}-${e[2].padStart(2,"0")}-${e[3].padStart(2,"0")}`}}return{...e,id:e.id||e._id,date:t,avatar:e.avatar||e.doctorAvatar||"https://dummyimage.com/120x120/4a90e2/ffffff&text=åŒ»ç”Ÿ",expertise:e.expertise||e.doctorExpertise||"ä¸“ä¸šé¢†åŸŸ",price:e.price||0,doctorName:e.doctorName||e.name||"åŒ»ç”Ÿ",hospital:e.hospital||"",specialty:e.specialty||e.dept||"",title:e.title||""}})),void t("log","at pages/mine/appointments.vue:261","ğŸ“‹ æœ€ç»ˆæ˜¾ç¤ºçš„é¢„çº¦åˆ—è¡¨ï¼ˆæœ¬åœ°ï¼‰:",this.appointmentList)}catch(Kt){t("error","at pages/mine/appointments.vue:265","è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:",Kt)}t("log","at pages/mine/appointments.vue:269","âŒ æœ¬åœ°å­˜å‚¨æ²¡æœ‰æ•°æ®"),this.appointmentList=[]},filterAppointments(){this.loadAppointments()},getStatusText:e=>({pendingVisit:"å¾…å°±è¯Š",pendingRate:"å¾…è¯„ä»·",rated:"å·²è¯„ä»·",history:"å†å²"}[e]||"æœªçŸ¥"),updateTheme(e){try{this.theme=e||l()}catch(Kt){t("warn","at pages/mine/appointments.vue:289","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},isMobileDevice:()=>!0,showPaymentOptions(e){t("log","at pages/mine/appointments.vue:350","ğŸ’³ æ˜¾ç¤ºæ”¯ä»˜æ–¹å¼é€‰æ‹©ï¼Œé¢„çº¦ä¿¡æ¯:",e),this.selectedItem=e,this.showPaymentModal=!0},closePaymentModal(){this.showPaymentModal=!1,this.selectedItem=null,this.paymentMethod="alipay"},selectPaymentMethod(e){t("log","at pages/mine/appointments.vue:364","âœ… é€‰æ‹©æ”¯ä»˜æ–¹å¼:",e),this.paymentMethod=e},async confirmPayment(){if(!this.selectedItem)return void uni.showToast({title:"è¯·é€‰æ‹©è¦æ”¯ä»˜çš„è®¢å•",icon:"none"});const e=this.selectedItem,t=this.paymentMethod;this.closePaymentModal(),"alipay"===t?await this.goAlipay(e):"wechat"===t?await this.goWechatPay(e):"unionpay"===t?await this.goUnionpay(e):"stripe"===t&&await this.goStripe(e)},async goAlipay(e){var a,o;t("log","at pages/mine/appointments.vue:399","ğŸ¯ å¼€å§‹æ”¯ä»˜å®æ”¯ä»˜æµç¨‹"),t("log","at pages/mine/appointments.vue:400","ğŸ“¦ ä¼ å…¥çš„ item:",e);let n=!1;try{const o=e.price;if(t("log","at pages/mine/appointments.vue:405","ğŸ’° ä»·æ ¼é‡‘é¢:",o),!o)return t("log","at pages/mine/appointments.vue:408","âŒ é‡‘é¢æ— æ•ˆ"),void uni.showToast({title:"é‡‘é¢æ— æ•ˆï¼Œæ— æ³•å‘èµ·æ”¯ä»˜",icon:"none"});const r=this.isMobileDevice();let l;t("log","at pages/mine/appointments.vue:418","ğŸ“± è®¾å¤‡ç±»å‹æ£€æµ‹:",r?"ç§»åŠ¨ç«¯":"PCç«¯"),r&&uni.showToast({title:"æ­£åœ¨æ‰“å¼€æ”¯ä»˜é¡µé¢...",icon:"loading",duration:2e3}),n=!0,uni.showLoading({title:"æ­£åœ¨åˆ›å»ºæ”¯ä»˜è®¢å•...",mask:!0});try{l=await re("/pay/alipay/wap",{appointmentId:e.id||"",subject:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ`,totalAmount:o.toString(),body:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ - ${e.date} ${e.time}`},{showLoading:!1})}catch(s){n&&(uni.hideLoading(),n=!1);const e=(null==s?void 0:s.message)||(null==(a=null==s?void 0:s.data)?void 0:a.message)||"åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥";return t("error","at pages/mine/appointments.vue:457","âŒ åˆ›å»ºæ”¯ä»˜è®¢å•APIè°ƒç”¨å¤±è´¥:",s),void uni.showToast({title:e,icon:"none",duration:3e3})}if(n&&(uni.hideLoading(),n=!1),!l)return void uni.showToast({title:"åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥ï¼šæœåŠ¡å™¨æ— å“åº”",icon:"none",duration:2e3});if(!l.success)return void uni.showToast({title:(null==l?void 0:l.message)||"åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥",icon:"none",duration:3e3});if(!l.payUrl)return void uni.showToast({title:(null==l?void 0:l.message)||"æ”¯ä»˜URLæ— æ•ˆï¼Œè¯·é‡è¯•",icon:"none",duration:2e3});if(t("log","at pages/mine/appointments.vue:503","âœ… æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸ"),t("log","at pages/mine/appointments.vue:504","ğŸ” å®Œæ•´å“åº”:",l),t("log","at pages/mine/appointments.vue:505","ğŸ” payUrl:",l.payUrl),!l.payUrl||"string"!=typeof l.payUrl)return uni.showToast({title:"æ”¯ä»˜URLæ— æ•ˆï¼Œè¯·é‡è¯•",icon:"none",duration:3e3}),void t("error","at pages/mine/appointments.vue:514","âŒ payUrl æ— æ•ˆ:",l.payUrl);try{t("log","at pages/mine/appointments.vue:548","ğŸ“± Appç¯å¢ƒï¼šå‡†å¤‡æ‰“å¼€æ”¯ä»˜URL..."),t("log","at pages/mine/appointments.vue:549","ğŸ”— payUrlå‰200å­—ç¬¦:",l.payUrl.substring(0,200));const e=l.payUrl.includes("sandbox")||l.payUrl.includes("alipaydev.com");if(t("log","at pages/mine/appointments.vue:553","ğŸ” æ”¯ä»˜ç¯å¢ƒæ£€æµ‹:",e?"âœ… æ²™ç®±ç¯å¢ƒ":"âš ï¸ æ­£å¼ç¯å¢ƒ"),e||(t("warn","at pages/mine/appointments.vue:556","âš ï¸ è­¦å‘Šï¼šå½“å‰æ”¯ä»˜URLä¸æ˜¯æ²™ç®±ç‰ˆæœ¬ï¼"),uni.showToast({title:"è­¦å‘Šï¼šå½“å‰ä¸æ˜¯æ²™ç®±ç¯å¢ƒ",icon:"none",duration:2e3})),!l.payUrl.includes("gateway.do")&&!l.payUrl.includes("mobileclientgw"))return uni.showToast({title:"æ”¯ä»˜URLæ ¼å¼é”™è¯¯",icon:"none",duration:3e3}),void t("error","at pages/mine/appointments.vue:571","âŒ æ”¯ä»˜URLæ ¼å¼é”™è¯¯:",l.payUrl);"undefined"!=typeof plus&&plus.runtime?plus.runtime.openURL(l.payUrl,(e=>{e?(t("error","at pages/mine/appointments.vue:580","âŒ æ‰“å¼€æ”¯ä»˜URLå¤±è´¥:",e),uni.showToast({title:"æ‰“å¼€æ”¯ä»˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å®‰è£…æ”¯ä»˜å®",icon:"none",duration:3e3}),this.showPayUrlModal(l.payUrl)):t("log","at pages/mine/appointments.vue:589","âœ… æ”¯ä»˜URLå·²æ‰“å¼€")})):(t("error","at pages/mine/appointments.vue:593","âŒ plus.runtime ä¸å¯ç”¨"),uni.showToast({title:"å½“å‰ç¯å¢ƒä¸æ”¯æŒæ‰“å¼€æ”¯ä»˜",icon:"none",duration:3e3}),this.showPayUrlModal(l.payUrl))}catch(i){t("error","at pages/mine/appointments.vue:602","âŒ Appç¯å¢ƒæ”¯ä»˜å¤±è´¥:",i),uni.showToast({title:"æ‰“å¼€æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:3e3}),this.showPayUrlModal(l.payUrl)}}catch(r){if(n){try{uni.hideLoading()}catch(Kt){}n=!1}t("error","at pages/mine/appointments.vue:632","âŒ å‘èµ·æ”¯ä»˜å¤±è´¥:",r);let e="å‘èµ·æ”¯ä»˜å¤±è´¥";(null==r?void 0:r.message)?e=r.message:(null==(o=null==r?void 0:r.data)?void 0:o.message)?e=r.data.message:"string"==typeof r&&(e=r),(e.includes("ç½‘ç»œ")||e.includes("timeout")||e.includes("è¿æ¥"))&&(e="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•"),uni.showToast({title:e,icon:"none",duration:3e3})}},async goWechatPay(e){var a,o;t("log","at pages/mine/appointments.vue:659","ğŸ¯ å¼€å§‹å¾®ä¿¡æ”¯ä»˜æµç¨‹"),t("log","at pages/mine/appointments.vue:660","ğŸ“¦ ä¼ å…¥çš„ item:",e);let n=!1;try{const o=e.price;if(t("log","at pages/mine/appointments.vue:665","ğŸ’° ä»·æ ¼é‡‘é¢:",o),!o)return t("log","at pages/mine/appointments.vue:668","âŒ é‡‘é¢æ— æ•ˆ"),void uni.showToast({title:"é‡‘é¢æ— æ•ˆï¼Œæ— æ³•å‘èµ·æ”¯ä»˜",icon:"none"});let r;n=!0,uni.showLoading({title:"æ­£åœ¨åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•...",mask:!0});try{r=await re("/wechatpay/h5",{appointmentId:e.id||"",subject:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ`,totalAmount:o.toString(),body:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ - ${e.date} ${e.time}`},{showLoading:!1})}catch(s){n&&(uni.hideLoading(),n=!1);const e=(null==s?void 0:s.message)||(null==(a=null==s?void 0:s.data)?void 0:a.message)||"åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•å¤±è´¥";return t("error","at pages/mine/appointments.vue:701","âŒ åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•APIè°ƒç”¨å¤±è´¥:",s),void uni.showToast({title:e,icon:"none",duration:3e3})}if(n&&(uni.hideLoading(),n=!1),!r||!r.success)return void uni.showToast({title:(null==r?void 0:r.message)||"åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•å¤±è´¥",icon:"none",duration:3e3});if(!r.payUrl)return void uni.showToast({title:"æ”¯ä»˜URLæ— æ•ˆï¼Œè¯·é‡è¯•",icon:"none",duration:2e3});t("log","at pages/mine/appointments.vue:737","âœ… å¾®ä¿¡æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸ"),t("log","at pages/mine/appointments.vue:738","ğŸ” payUrl:",r.payUrl);try{t("log","at pages/mine/appointments.vue:765","ğŸ“± Appç¯å¢ƒï¼šå‡†å¤‡æ‰“å¼€å¾®ä¿¡æ”¯ä»˜..."),"undefined"!=typeof plus&&plus.runtime?plus.runtime.openURL(r.payUrl,(e=>{e?(t("error","at pages/mine/appointments.vue:770","âŒ æ‰“å¼€å¾®ä¿¡æ”¯ä»˜å¤±è´¥:",e),uni.showToast({title:"æ‰“å¼€å¾®ä¿¡æ”¯ä»˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å®‰è£…å¾®ä¿¡",icon:"none",duration:3e3})):t("log","at pages/mine/appointments.vue:777","âœ… å¾®ä¿¡æ”¯ä»˜å·²æ‰“å¼€")})):(t("error","at pages/mine/appointments.vue:781","âŒ plus.runtime ä¸å¯ç”¨"),uni.showToast({title:"å½“å‰ç¯å¢ƒä¸æ”¯æŒæ‰“å¼€æ”¯ä»˜",icon:"none",duration:3e3}))}catch(i){t("error","at pages/mine/appointments.vue:789","âŒ Appç¯å¢ƒå¾®ä¿¡æ”¯ä»˜å¤±è´¥:",i),uni.showToast({title:"æ‰“å¼€å¾®ä¿¡æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:3e3})}}catch(r){if(n){try{uni.hideLoading()}catch(Kt){}n=!1}t("error","at pages/mine/appointments.vue:816","âŒ å‘èµ·å¾®ä¿¡æ”¯ä»˜å¤±è´¥:",r);let e="å‘èµ·å¾®ä¿¡æ”¯ä»˜å¤±è´¥";(null==r?void 0:r.message)?e=r.message:(null==(o=null==r?void 0:r.data)?void 0:o.message)?e=r.data.message:"string"==typeof r&&(e=r),(e.includes("ç½‘ç»œ")||e.includes("timeout")||e.includes("è¿æ¥"))&&(e="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•"),uni.showToast({title:e,icon:"none",duration:3e3})}},async goUnionpay(e){t("log","at pages/mine/appointments.vue:841","ğŸ¯ å¼€å§‹é“¶è”æ”¯ä»˜æµç¨‹"),t("log","at pages/mine/appointments.vue:842","ğŸ“¦ ä¼ å…¥çš„ item:",e);let a=!1;try{const n=e.price;if(t("log","at pages/mine/appointments.vue:847","ğŸ’° ä»·æ ¼é‡‘é¢:",n),!n)return t("log","at pages/mine/appointments.vue:850","âŒ é‡‘é¢æ— æ•ˆ"),void uni.showToast({title:"é‡‘é¢æ— æ•ˆï¼Œæ— æ³•å‘èµ·æ”¯ä»˜",icon:"none"});a=!0,uni.showLoading({title:"æ­£åœ¨åˆ›å»ºé“¶è”æ”¯ä»˜è®¢å•...",mask:!0});try{const o=await fetch("http://localhost:3000/api/unionpay/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:e.id||"",subject:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ`,totalAmount:n.toString(),body:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ - ${e.date} ${e.time}`})});if(a&&(uni.hideLoading(),a=!1),!o.ok)throw new Error("åˆ›å»ºé“¶è”æ”¯ä»˜è®¢å•å¤±è´¥");await o.text();t("log","at pages/mine/appointments.vue:894","âœ… é“¶è”æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸ"),uni.showModal({title:"æ”¯ä»˜æç¤º",content:"APPç¯å¢ƒæš‚ä¸æ”¯æŒé“¶è”æ”¯ä»˜ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€",showCancel:!1,confirmText:"çŸ¥é“äº†"})}catch(o){a&&(uni.hideLoading(),a=!1);const e=(null==o?void 0:o.message)||"åˆ›å»ºé“¶è”æ”¯ä»˜è®¢å•å¤±è´¥";return t("error","at pages/mine/appointments.vue:943","âŒ åˆ›å»ºé“¶è”æ”¯ä»˜è®¢å•å¤±è´¥:",o),void uni.showToast({title:e,icon:"none",duration:3e3})}}catch(n){if(a){try{uni.hideLoading()}catch(Kt){}a=!1}t("error","at pages/mine/appointments.vue:962","âŒ å‘èµ·é“¶è”æ”¯ä»˜å¤±è´¥:",n);let e="å‘èµ·é“¶è”æ”¯ä»˜å¤±è´¥";(null==n?void 0:n.message)?e=n.message:"string"==typeof n&&(e=n),(e.includes("ç½‘ç»œ")||e.includes("timeout")||e.includes("è¿æ¥"))&&(e="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•"),uni.showToast({title:e,icon:"none",duration:3e3})}},async goStripe(e){var a,o;t("log","at pages/mine/appointments.vue:985","ğŸ¯ å¼€å§‹ Stripe æ”¯ä»˜æµç¨‹"),t("log","at pages/mine/appointments.vue:986","ğŸ“¦ ä¼ å…¥çš„ item:",e);let n=!1;try{const o=e.price;if(t("log","at pages/mine/appointments.vue:991","ğŸ’° ä»·æ ¼é‡‘é¢:",o),!o)return t("log","at pages/mine/appointments.vue:994","âŒ é‡‘é¢æ— æ•ˆ"),void uni.showToast({title:"é‡‘é¢æ— æ•ˆï¼Œæ— æ³•å‘èµ·æ”¯ä»˜",icon:"none"});let r;n=!0,uni.showLoading({title:"æ­£åœ¨åˆ›å»º Stripe æ”¯ä»˜...",mask:!0});try{r=await re("/stripe/create-checkout-session",{appointmentId:e.id||"",subject:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ`,totalAmount:o.toString(),body:`é¢„çº¦${e.doctorName}åŒ»ç”Ÿ - ${e.date} ${e.time}`},{showLoading:!1})}catch(s){n&&(uni.hideLoading(),n=!1);const e=(null==s?void 0:s.message)||(null==(a=null==s?void 0:s.data)?void 0:a.message)||"åˆ›å»º Stripe æ”¯ä»˜å¤±è´¥";return t("error","at pages/mine/appointments.vue:1027","âŒ åˆ›å»º Stripe æ”¯ä»˜APIè°ƒç”¨å¤±è´¥:",s),void uni.showToast({title:e,icon:"none",duration:3e3})}if(n&&(uni.hideLoading(),n=!1),!r||!r.success)return void uni.showToast({title:(null==r?void 0:r.message)||"åˆ›å»º Stripe æ”¯ä»˜å¤±è´¥",icon:"none",duration:3e3});if(!r.payUrl)return void uni.showToast({title:"æ”¯ä»˜URLæ— æ•ˆï¼Œè¯·é‡è¯•",icon:"none",duration:2e3});t("log","at pages/mine/appointments.vue:1063","âœ… Stripe æ”¯ä»˜åˆ›å»ºæˆåŠŸ"),t("log","at pages/mine/appointments.vue:1064","ğŸ” payUrl:",r.payUrl);try{t("log","at pages/mine/appointments.vue:1091","ğŸ“± Appç¯å¢ƒï¼šå‡†å¤‡æ‰“å¼€ Stripe æ”¯ä»˜..."),"undefined"!=typeof plus&&plus.runtime?plus.runtime.openURL(r.payUrl,(e=>{e?(t("error","at pages/mine/appointments.vue:1096","âŒ æ‰“å¼€ Stripe æ”¯ä»˜å¤±è´¥:",e),uni.showToast({title:"æ‰“å¼€ Stripe æ”¯ä»˜å¤±è´¥",icon:"none",duration:3e3})):t("log","at pages/mine/appointments.vue:1103","âœ… Stripe æ”¯ä»˜å·²æ‰“å¼€")})):(t("error","at pages/mine/appointments.vue:1107","âŒ plus.runtime ä¸å¯ç”¨"),uni.showToast({title:"å½“å‰ç¯å¢ƒä¸æ”¯æŒæ‰“å¼€æ”¯ä»˜",icon:"none",duration:3e3}))}catch(i){t("error","at pages/mine/appointments.vue:1115","âŒ Appç¯å¢ƒ Stripe æ”¯ä»˜å¤±è´¥:",i),uni.showToast({title:"æ‰“å¼€ Stripe æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:3e3})}}catch(r){if(n){try{uni.hideLoading()}catch(Kt){}n=!1}t("error","at pages/mine/appointments.vue:1142","âŒ å‘èµ· Stripe æ”¯ä»˜å¤±è´¥:",r);let e="å‘èµ· Stripe æ”¯ä»˜å¤±è´¥";(null==r?void 0:r.message)?e=r.message:(null==(o=null==r?void 0:r.data)?void 0:o.message)?e=r.data.message:"string"==typeof r&&(e=r),(e.includes("ç½‘ç»œ")||e.includes("timeout")||e.includes("è¿æ¥"))&&(e="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•"),uni.showToast({title:e,icon:"none",duration:3e3})}}}};const $s=s(Ms,[["render",function(t,o,n,s,r,l){var c;const d=a(e.resolveDynamicComponent("uni-icons"),i),u=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:o[0]||(o[0]=e.withModifiers(((...e)=>l.goBack&&l.goBack(...e)),["stop"]))},[e.createVNode(d,{type:"left",size:"20",color:l.navIconColor},null,8,["color"])]),e.createElementVNode("text",{class:"nav-title"},"æˆ‘çš„é¢„çº¦"),e.createElementVNode("view",{class:"nav-right"})]),e.createElementVNode("view",{class:"tabs-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.tabs,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.key,class:e.normalizeClass(["tab-item",{active:r.activeTab===t.key}]),onClick:e=>l.switchTab(t.key)},[e.createElementVNode("text",{class:"tab-text"},e.toDisplayString(t.label),1),r.activeTab===t.key?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],10,["onClick"])))),128))]),e.createElementVNode("scroll-view",{class:"appointment-list","scroll-y":""},[0===r.appointmentList.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— é¢„çº¦è®°å½•")])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.appointmentList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||a,class:"appointment-card"},[e.createElementVNode("view",{class:"doctor-info"},[e.createElementVNode("image",{class:"doctor-avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"doctor-details"},[e.createElementVNode("view",{class:"doctor-name-row"},[e.createElementVNode("text",{class:"doctor-name"},e.toDisplayString(t.doctorName),1),e.createElementVNode("text",{class:"doctor-title"},e.toDisplayString(t.title),1)]),e.createElementVNode("text",{class:"hospital-name"},e.toDisplayString(t.hospital),1),e.createElementVNode("text",{class:"specialty"},e.toDisplayString(t.specialty),1),e.createElementVNode("text",{class:"expertise"},"æ“…é•¿:"+e.toDisplayString(t.expertise),1)])]),e.createElementVNode("view",{class:e.normalizeClass(["status-badge","status-"+t.status])},[e.createElementVNode("text",{class:"status-text"},e.toDisplayString(l.getStatusText(t.status)),1)],2),e.createElementVNode("view",{class:"card-footer"},[e.createElementVNode("view",{class:"patient-info"},[e.createElementVNode("text",{class:"patient-text"},"å°±è¯Šäºº:"+e.toDisplayString(t.patientName)+" "+e.toDisplayString(t.date)+" "+e.toDisplayString(t.time),1)]),e.createElementVNode("view",{class:"price-info",onClick:e.withModifiers((e=>l.showPaymentOptions(t)),["stop"])},[e.createElementVNode("text",{class:"price-text"},"Â¥"+e.toDisplayString(t.price),1)],8,["onClick"])])])))),128))]),r.showPaymentModal?(e.openBlock(),e.createElementBlock("view",{key:0,class:"payment-modal",onClick:o[6]||(o[6]=(...e)=>l.closePaymentModal&&l.closePaymentModal(...e))},[e.createElementVNode("view",{class:"payment-modal-content",onClick:o[5]||(o[5]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"payment-modal-header"},[e.createElementVNode("text",{class:"payment-modal-title"},"é€‰æ‹©æ”¯ä»˜æ–¹å¼"),e.createElementVNode("view",{class:"payment-modal-close",onClick:o[1]||(o[1]=(...e)=>l.closePaymentModal&&l.closePaymentModal(...e))},"âœ•")]),e.createElementVNode("view",{class:"payment-amount"},[e.createElementVNode("text",{class:"payment-amount-label"},"æ”¯ä»˜é‡‘é¢"),e.createElementVNode("text",{class:"payment-amount-value"},"Â¥"+e.toDisplayString((null==(c=r.selectedItem)?void 0:c.price)||0),1)]),e.createElementVNode("view",{class:"payment-methods"},[e.createElementVNode("view",{class:"payment-method-item",onClick:o[2]||(o[2]=e=>l.selectPaymentMethod("alipay"))},[e.createElementVNode("view",{class:"payment-method-icon alipay-icon"},"ğŸ’™"),e.createElementVNode("view",{class:"payment-method-info"},[e.createElementVNode("text",{class:"payment-method-name"},"æ”¯ä»˜å®æ”¯ä»˜"),e.createElementVNode("text",{class:"payment-method-desc"},"æ¨èä½¿ç”¨ï¼Œå®‰å…¨å¿«æ·")]),e.createElementVNode("view",{class:e.normalizeClass(["payment-method-radio",{active:"alipay"===r.paymentMethod}])},["alipay"===r.paymentMethod?(e.openBlock(),e.createElementBlock("view",{key:0,class:"payment-method-radio-dot"})):e.createCommentVNode("",!0)],2)])]),e.createElementVNode("view",{class:"payment-modal-footer"},[e.createElementVNode("button",{class:"payment-cancel-btn",onClick:o[3]||(o[3]=(...e)=>l.closePaymentModal&&l.closePaymentModal(...e))},"å–æ¶ˆ"),e.createElementVNode("button",{class:"payment-confirm-btn",onClick:o[4]||(o[4]=(...e)=>l.confirmPayment&&l.confirmPayment(...e))},"ç¡®è®¤æ”¯ä»˜")])])])):e.createCommentVNode("",!0),e.createVNode(u)])}]]),Ls={components:{ThemeToggle:d},data:()=>({theme:l(),allPatients:[],defaultPatientId:null,searchKeyword:"",filterGender:"",filterRelation:"",showGenderMenu:!1,showRelationMenu:!1,genderOptions:["ç”·","å¥³"],relationOptions:["æœ¬äºº","é…å¶","çˆ¶äº²","æ¯äº²","å„¿å­","å¥³å„¿","å…¶ä»–"],sortField:"",sortOrder:"asc",showSortMenu:!1,isSelectMode:!1,selectedPatients:[],showImportPopup:!1,sortOptions:[{label:"æŒ‰å§“å A-Z",value:"name",order:"asc"},{label:"æŒ‰å§“å Z-A",value:"name",order:"desc"},{label:"æŒ‰å¹´é¾„ ä»å°åˆ°å¤§",value:"age",order:"asc"},{label:"æŒ‰å¹´é¾„ ä»å¤§åˆ°å°",value:"age",order:"desc"},{label:"æŒ‰æ·»åŠ æ—¶é—´ æœ€æ–°",value:"createdAt",order:"desc"},{label:"æŒ‰æ·»åŠ æ—¶é—´ æœ€æ—©",value:"createdAt",order:"asc"},{label:"é»˜è®¤æ’åº",value:"",order:"asc"}]}),computed:{filteredPatients(){let e=[...this.allPatients];if(this.searchKeyword&&this.searchKeyword.trim()){const t=this.searchKeyword.trim().toLowerCase();e=e.filter((e=>{const a=e.name&&e.name.toLowerCase().includes(t),o=e.phone&&e.phone.includes(t),n=e.idCard&&e.idCard.includes(t);return a||o||n}))}return this.filterGender&&(e=e.filter((e=>e.gender===this.filterGender))),this.filterRelation&&(e=e.filter((e=>e.relation===this.filterRelation))),this.sortField?e.sort(((e,t)=>{let a=e[this.sortField]||"",o=t[this.sortField]||"";return"createdAt"===this.sortField&&(a=new Date(a).getTime()||0,o=new Date(o).getTime()||0),"age"===this.sortField&&(a=parseInt(a)||0,o=parseInt(o)||0),"string"==typeof a&&(a=a.toLowerCase()),"string"==typeof o&&(o=o.toLowerCase()),"asc"===this.sortOrder?a>o?1:a<o?-1:0:a<o?1:a>o?-1:0})):e.sort(((e,t)=>{const a=e.id===this.defaultPatientId,o=t.id===this.defaultPatientId;if(a&&!o)return-1;if(!a&&o)return 1;const n=new Date(e.createdAt||0).getTime();return new Date(t.createdAt||0).getTime()-n})),e},sortText(){const e=this.sortOptions.find((e=>e.value===this.sortField&&e.order===this.sortOrder));return e?e.label:"æ’åº"},isAllSelected(){return this.filteredPatients.length>0&&this.selectedPatients.length===this.filteredPatients.length}},watch:{allPatients:{handler(){this.updateStatistics()},immediate:!0},showStats(e){}},onShow(){this.loadPatients(),uni.$on("themeChange",this.updateTheme),uni.$on("patientUpdated",this.loadPatients),this.updateTheme()},onHide(){uni.$off("themeChange",this.updateTheme),uni.$off("patientUpdated",this.loadPatients)},methods:{updateTheme(e){try{this.theme=e||l()}catch(Kt){t("warn","at pages/mine/patients.vue:552","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},loadPatients(){this.allPatients=as();const e=is();this.defaultPatientId=e?e.id:null},goBack(){uni.navigateBack()},addPatient(){uni.navigateTo({url:"/pages/mine/patient-edit"})},editPatient(e){uni.navigateTo({url:`/pages/mine/patient-edit?id=${e}`})},setAsDefault(e){!function(e){try{const t=`defaultPatient_${ts()}`;uni.setStorageSync(t,e)}catch(Kt){return t("error","at utils/patientStorage.js:119","è®¾ç½®é»˜è®¤å°±è¯Šäººå¤±è´¥:",Kt),!1}}(e),this.loadPatients(),uni.showToast({title:"å·²è®¾ä¸ºé»˜è®¤",icon:"success"})},deletePatient(e){uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¯¥å°±è¯Šäººå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚",success:a=>{if(a.confirm)try{ns(e),this.loadPatients(),uni.showToast({title:"åˆ é™¤æˆåŠŸ",icon:"success"})}catch(Kt){t("error","at pages/mine/patients.vue:596","åˆ é™¤å°±è¯Šäººå¤±è´¥:",Kt),uni.showToast({title:"åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}})},formatIdCard:e=>e?18===e.length?e.substring(0,6)+"********"+e.substring(14):e:"",formatPhone:e=>e?11===e.length?e.substring(0,3)+"****"+e.substring(7):e:"",async addSamplePatients(){const e=[{name:"å¼ æ˜",gender:"ç”·",age:32,phone:"13800138001",idCard:"110101199001011234",relation:"æœ¬äºº"},{name:"æèŠ³",gender:"å¥³",age:28,phone:"13800138002",idCard:"110101199205152345",relation:"é…å¶"},{name:"ç‹å¼º",gender:"ç”·",age:65,phone:"13800138003",idCard:"110101195807203456",relation:"çˆ¶äº²"},{name:"èµµä¸½",gender:"å¥³",age:62,phone:"13800138004",idCard:"110101196102254567",relation:"æ¯äº²"},{name:"åˆ˜å°å",gender:"ç”·",age:8,phone:"13800138005",idCard:"110101201512156789",relation:"å„¿å­"},{name:"é™ˆé™",gender:"å¥³",age:35,phone:"13800138006",idCard:"110101198805208901",relation:"æœ¬äºº"},{name:"æ¨æ³¢",gender:"ç”·",age:41,phone:"13800138007",idCard:"110101198207123012",relation:"æœ¬äºº"},{name:"å‘¨å¨Ÿ",gender:"å¥³",age:29,phone:"13800138008",idCard:"110101199311074523",relation:"æœ¬äºº"},{name:"å´å»ºå›½",gender:"ç”·",age:58,phone:"13800138009",idCard:"110101196403185634",relation:"çˆ¶äº²"},{name:"å¾ç§€è‹±",gender:"å¥³",age:55,phone:"13800138010",idCard:"110101196811227845",relation:"æ¯äº²"},{name:"å­™å°ç¾",gender:"å¥³",age:12,phone:"13800138011",idCard:"110101201104039056",relation:"å¥³å„¿"},{name:"é©¬å†›",gender:"ç”·",age:45,phone:"13800138012",idCard:"110101197708161267",relation:"æœ¬äºº"},{name:"æœ±ä¸½",gender:"å¥³",age:38,phone:"13800138013",idCard:"110101198503224578",relation:"æœ¬äºº"},{name:"èƒ¡å¼º",gender:"ç”·",age:26,phone:"13800138014",idCard:"110101199708038901",relation:"æœ¬äºº"}];uni.showLoading({title:"æ­£åœ¨æ·»åŠ æ•°æ®...",mask:!0});let a=0,o=0;try{for(let s=0;s<e.length;s++){const i=e[s];try{const n=await re("/api/patients",i,{showLoading:!1,showError:!1});n&&n.success?(a++,t("log","at pages/mine/patients.vue:660",`âœ… æˆåŠŸæ·»åŠ æ‚£è€…: ${i.name}`)):(o++,t("error","at pages/mine/patients.vue:663",`âŒ æ·»åŠ æ‚£è€…å¤±è´¥: ${i.name}`,(null==n?void 0:n.message)||"æœªçŸ¥é”™è¯¯")),s<e.length-1&&await new Promise((e=>setTimeout(e,300)))}catch(n){o++,t("error","at pages/mine/patients.vue:672",`âŒ æ·»åŠ æ‚£è€…å¼‚å¸¸: ${i.name}`,n)}}uni.hideLoading(),a>0?uni.showToast({title:`æˆåŠŸæ·»åŠ  ${a} æ¡æ•°æ®${o>0?`ï¼Œ${o} æ¡å¤±è´¥`:""}`,icon:a===e.length?"success":"none",duration:2e3}):uni.showToast({title:"æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥",icon:"none",duration:2e3})}catch(n){uni.hideLoading(),t("error","at pages/mine/patients.vue:694","æ·»åŠ æ‚£è€…æ•°æ®å¤±è´¥:",n),uni.showToast({title:"æ·»åŠ æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}},handleSearch(){},clearSearch(){this.searchKeyword=""},toggleGenderFilter(){this.showGenderMenu=!this.showGenderMenu,this.showRelationMenu=!1,this.showSortMenu=!1},toggleRelationFilter(){this.showRelationMenu=!this.showRelationMenu,this.showGenderMenu=!1,this.showSortMenu=!1},selectGender(e){this.filterGender=this.filterGender===e?"":e,this.showGenderMenu=!1},selectRelation(e){this.filterRelation=this.filterRelation===e?"":e,this.showRelationMenu=!1},clearAllFilters(){this.filterGender="",this.filterRelation="",this.closeAllMenus()},clearAllFiltersAndSearch(){this.searchKeyword="",this.filterGender="",this.filterRelation="",this.closeAllMenus()},toggleSortMenu(){this.showSortMenu=!this.showSortMenu,this.showGenderMenu=!1,this.showRelationMenu=!1},selectSort(e,t){this.sortField=e,this.sortOrder=t,this.showSortMenu=!1},closeAllMenus(){this.showGenderMenu=!1,this.showRelationMenu=!1,this.showSortMenu=!1},toggleStats(){this.showStats=!this.showStats},updateStatistics(){const e=this.allPatients;if(0===e.length)return void(this.statistics={gender:{male:0,female:0,malePercent:0,femalePercent:0},averageAge:0,ageGroups:[],relations:[]});const t=e.filter((e=>"ç”·"===e.gender)).length,a=e.filter((e=>"å¥³"===e.gender)).length,o=t+a;this.statistics.gender={male:t,female:a,malePercent:o>0?Math.round(t/o*100):0,femalePercent:o>0?Math.round(a/o*100):0};const n=e.map((e=>parseInt(e.age))).filter((e=>!isNaN(e)&&e>0));this.statistics.averageAge=n.length>0?Math.round(n.reduce(((e,t)=>e+t),0)/n.length):0;const s=[{label:"0-18å²",min:0,max:18,color:"#FFB74D",count:0},{label:"19-30å²",min:19,max:30,color:"#4A90E2",count:0},{label:"31-50å²",min:31,max:50,color:"#66BB6A",count:0},{label:"51-65å²",min:51,max:65,color:"#FFA726",count:0},{label:"65å²ä»¥ä¸Š",min:66,max:999,color:"#EF5350",count:0}];n.forEach((e=>{const t=s.find((t=>e>=t.min&&e<=t.max));t&&t.count++})),s.forEach((e=>{e.percent=n.length>0?Math.round(e.count/n.length*100):0})),this.statistics.ageGroups=s;const i={};e.forEach((e=>{const t=e.relation||"æœªè®¾ç½®";i[t]=(i[t]||0)+1}));const r=Object.keys(i).map((t=>({relation:t,count:i[t],percent:Math.round(i[t]/e.length*100)}))).sort(((e,t)=>t.count-e.count));this.statistics.relations=r},getRelationColor:e=>({"æœ¬äºº":"#4A90E2","é…å¶":"#FF6B9D","çˆ¶äº²":"#66BB6A","æ¯äº²":"#FFA726","å„¿å­":"#AB47BC","å¥³å„¿":"#EC407A","å…¶ä»–":"#78909C","æœªè®¾ç½®":"#BDBDBD"}[e]||"#78909C"),toggleSelectMode(){this.isSelectMode=!this.isSelectMode,this.isSelectMode||(this.selectedPatients=[])},toggleSelection(e){const t=this.selectedPatients.indexOf(e);t>-1?this.selectedPatients.splice(t,1):this.selectedPatients.push(e)},isSelected(e){return this.selectedPatients.indexOf(e)>-1},toggleSelectAll(){if(this.isAllSelected){const e=this.filteredPatients.map((e=>e.id));this.selectedPatients=this.selectedPatients.filter((t=>!e.includes(t)))}else{this.filteredPatients.map((e=>e.id)).forEach((e=>{-1===this.selectedPatients.indexOf(e)&&this.selectedPatients.push(e)}))}},batchDelete(){0!==this.selectedPatients.length?uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${this.selectedPatients.length} ä¸ªå°±è¯Šäººå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚`,success:e=>{if(e.confirm)try{let e=0,a=0;this.selectedPatients.forEach((o=>{try{ns(o),e++}catch(Kt){t("error","at pages/mine/patients.vue:891","åˆ é™¤å°±è¯Šäººå¤±è´¥:",Kt),a++}})),this.selectedPatients=[],this.isSelectMode=!1,this.loadPatients(),uni.showToast({title:`æˆåŠŸåˆ é™¤ ${e} ä¸ª${a>0?`ï¼Œ${a} ä¸ªå¤±è´¥`:""}`,icon:e>0?"success":"none",duration:2e3})}catch(Kt){t("error","at pages/mine/patients.vue:906","æ‰¹é‡åˆ é™¤å¤±è´¥:",Kt),uni.showToast({title:"æ‰¹é‡åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}}):uni.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ‚£è€…",icon:"none"})},batchExport(){if(0===this.selectedPatients.length)return void uni.showToast({title:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ‚£è€…",icon:"none"});const e=this.allPatients.filter((e=>this.selectedPatients.includes(e.id)));this.exportPatients(e,`æ‚£è€…åˆ—è¡¨_é€‰ä¸­${this.selectedPatients.length}é¡¹`)},showImportMenu(){this.showImportPopup=!0},closeImportMenu(){this.showImportPopup=!1},chooseImportFile(){uni.showToast({title:"å½“å‰ç¯å¢ƒä¸æ”¯æŒæ–‡ä»¶é€‰æ‹©",icon:"none"})},importCSVFile(e){const a=new FileReader;a.onload=e=>{try{const t=e.target.result.split("\n").filter((e=>e.trim()));if(t.length<2)return void uni.showToast({title:"CSVæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè‡³å°‘éœ€è¦åŒ…å«è¡¨å¤´å’Œä¸€è¡Œæ•°æ®",icon:"none"});const a=e=>{const t=[];let a="",o=!1;for(let n=0;n<e.length;n++){const s=e[n];'"'===s?o&&'"'===e[n+1]?(a+='"',n++):o=!o:","!==s||o?a+=s:(t.push(a.trim()),a="")}return t.push(a.trim()),t},o=a(t[0]),n={};o.forEach(((e,t)=>{n[e.trim()]=t}));const s={"å§“å":"name","åå­—":"name",name:"name","æ€§åˆ«":"gender",gender:"gender","å¹´é¾„":"age",age:"age","ç”µè¯":"phone","æ‰‹æœº":"phone","æ‰‹æœºå·":"phone",phone:"phone","èº«ä»½è¯":"idCard","èº«ä»½è¯å·":"idCard",idCard:"idCard","å…³ç³»":"relation",relation:"relation"},i=[];for(let e=1;e<t.length;e++){const o=a(t[e]);if(0===o.length)continue;const r={};Object.keys(n).forEach((e=>{var t;const a=s[e]||e.toLowerCase(),i=n[e];if(i<o.length){let e=null==(t=o[i])?void 0:t.trim();if(e&&"age"===a){const t=parseInt(e);isNaN(t)||(r[a]=t)}else e&&(r[a]=e)}})),r.name&&i.push(r)}if(0===i.length)return void uni.showToast({title:"CSVæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„æ•°æ®è¡Œ",icon:"none"});uni.showModal({title:"ç¡®è®¤å¯¼å…¥",content:`å°†è¦å¯¼å…¥ ${i.length} æ¡æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`,success:e=>{e.confirm&&this.doImport(i)}})}catch(a){t("error","at pages/mine/patients.vue:1059","è§£æCSVæ–‡ä»¶å¤±è´¥:",a),uni.showToast({title:"è§£ææ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼",icon:"none"})}},a.onerror=()=>{uni.showToast({title:"è¯»å–æ–‡ä»¶å¤±è´¥",icon:"none"})},a.readAsText(e,"UTF-8"),this.closeImportMenu()},async doImport(e){uni.showLoading({title:"æ­£åœ¨å¯¼å…¥...",mask:!0});let a=0,o=0;try{for(let n=0;n<e.length;n++){const s=e[n];try{os(s),a++}catch(Kt){t("error","at pages/mine/patients.vue:1093","å¯¼å…¥æ‚£è€…å¤±è´¥:",Kt),o++}}uni.hideLoading(),uni.showModal({title:"å¯¼å…¥å®Œæˆ",content:`æˆåŠŸ: ${a} æ¡\nå¤±è´¥: ${o} æ¡`,showCancel:!1,success:()=>{this.loadPatients(),uni.$emit("patientUpdated")}})}catch(n){uni.hideLoading(),t("error","at pages/mine/patients.vue:1111","å¯¼å…¥å¤±è´¥:",n),uni.showToast({title:"å¯¼å…¥å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}},exportAllPatients(){0!==this.allPatients.length?this.exportPatients(this.allPatients,"æ‚£è€…åˆ—è¡¨_å…¨éƒ¨"):uni.showToast({title:"æš‚æ— æ•°æ®å¯å¯¼å‡º",icon:"none"})},exportPatients(e,t="æ‚£è€…åˆ—è¡¨"){const a=e.map((e=>({"å§“å":e.name||"-","æ€§åˆ«":e.gender||"-","å¹´é¾„":e.age?String(e.age):"-","æ‰‹æœºå·":e.phone||"-","èº«ä»½è¯å·":e.idCard||"-","å…³ç³»":e.relation||"-"}))),o=["å§“å","æ€§åˆ«","å¹´é¾„","æ‰‹æœºå·","èº«ä»½è¯å·","å…³ç³»"],n=[o.join(",")];a.forEach((e=>{const t=o.map((t=>{let a=e[t]||"";return a="string"==typeof a&&(a.includes(",")||a.includes('"')||a.includes("\n"))?`"${a.replace(/"/g,'""')}"`:`"${a}"`,a}));n.push(t.join(","))}));const s=n.join("\n");new Blob(["\ufeff"+s],{type:"text/csv;charset=utf-8;"}),uni.showModal({title:"æç¤º",content:"å¯¼å‡ºåŠŸèƒ½åœ¨å½“å‰ç¯å¢ƒä¸‹éœ€è¦ä½¿ç”¨æ–‡ä»¶æœåŠ¡ã€‚å»ºè®®ä½¿ç”¨H5ç¯å¢ƒæˆ–é€šè¿‡æœåŠ¡å™¨å¯¼å‡ºã€‚",showCancel:!1})}}};const Fs=s(Ls,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i),d=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"nav-back",onClick:o[0]||(o[0]=(...e)=>l.goBack&&l.goBack(...e))},[e.createVNode(c,{type:"left",size:"20",color:"#333"})]),e.createElementVNode("text",{class:"nav-title"},"æˆ‘çš„å°±è¯Šäºº"),e.createElementVNode("view",{class:"nav-right"},[e.createElementVNode("view",{class:"nav-btn",onClick:o[1]||(o[1]=(...e)=>l.toggleSelectMode&&l.toggleSelectMode(...e))},[e.createElementVNode("text",{class:"nav-btn-text"},e.toDisplayString(r.isSelectMode?"å–æ¶ˆ":"é€‰æ‹©"),1)])])])]),e.createElementVNode("view",{class:"search-container"},[e.createElementVNode("view",{class:"search-box"},[e.createVNode(c,{type:"search",size:"18",color:"#999"}),e.withDirectives(e.createElementVNode("input",{class:"search-input","onUpdate:modelValue":o[2]||(o[2]=e=>r.searchKeyword=e),placeholder:"æœç´¢å§“åã€æ‰‹æœºå·æˆ–èº«ä»½è¯å·",onInput:o[3]||(o[3]=(...e)=>l.handleSearch&&l.handleSearch(...e))},null,544),[[e.vModelText,r.searchKeyword]]),r.searchKeyword?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-clear",onClick:o[4]||(o[4]=(...e)=>l.clearSearch&&l.clearSearch(...e))},[e.createVNode(c,{type:"clear",size:"16",color:"#999"})])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"filter-sort-bar"},[e.createElementVNode("view",{class:"filter-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:r.filterGender}]),onClick:o[5]||(o[5]=(...e)=>l.toggleGenderFilter&&l.toggleGenderFilter(...e))},[e.createElementVNode("text",{class:"filter-text"},e.toDisplayString(r.filterGender||"æ€§åˆ«"),1),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),e.createElementVNode("view",{class:e.normalizeClass(["filter-item",{active:r.filterRelation}]),onClick:o[6]||(o[6]=(...e)=>l.toggleRelationFilter&&l.toggleRelationFilter(...e))},[e.createElementVNode("text",{class:"filter-text"},e.toDisplayString(r.filterRelation||"å…³ç³»"),1),e.createElementVNode("text",{class:"filter-arrow"},"â–¾")],2),r.filterGender||r.filterRelation?(e.openBlock(),e.createElementBlock("view",{key:0,class:"filter-item clear-filter",onClick:o[7]||(o[7]=(...e)=>l.clearAllFilters&&l.clearAllFilters(...e))},[e.createElementVNode("text",{class:"filter-text"},"æ¸…é™¤")])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"sort-bar"},[e.createElementVNode("view",{class:"sort-item",onClick:o[8]||(o[8]=(...e)=>l.toggleSortMenu&&l.toggleSortMenu(...e))},[e.createElementVNode("text",{class:"sort-text"},e.toDisplayString(l.sortText),1),e.createElementVNode("text",{class:"sort-arrow"},"â–¾")])]),r.showGenderMenu?(e.openBlock(),e.createElementBlock("view",{key:0,class:"filter-menu",onClick:o[9]||(o[9]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.genderOptions,(t=>(e.openBlock(),e.createElementBlock("view",{key:t,class:e.normalizeClass(["filter-menu-item",{active:r.filterGender===t}]),onClick:e=>l.selectGender(t)},[e.createElementVNode("text",{class:"filter-menu-text"},e.toDisplayString(t),1),r.filterGender===t?(e.openBlock(),e.createElementBlock("text",{key:0,class:"filter-menu-check"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"])))),128))])):e.createCommentVNode("",!0),r.showRelationMenu?(e.openBlock(),e.createElementBlock("view",{key:1,class:"filter-menu",onClick:o[10]||(o[10]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.relationOptions,(t=>(e.openBlock(),e.createElementBlock("view",{key:t,class:e.normalizeClass(["filter-menu-item",{active:r.filterRelation===t}]),onClick:e=>l.selectRelation(t)},[e.createElementVNode("text",{class:"filter-menu-text"},e.toDisplayString(t),1),r.filterRelation===t?(e.openBlock(),e.createElementBlock("text",{key:0,class:"filter-menu-check"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"])))),128))])):e.createCommentVNode("",!0),r.showSortMenu?(e.openBlock(),e.createElementBlock("view",{key:2,class:"sort-menu",onClick:o[11]||(o[11]=e.withModifiers((()=>{}),["stop"]))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.sortOptions,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.value,class:e.normalizeClass(["sort-menu-item",{active:r.sortField===t.value&&r.sortOrder===t.order}]),onClick:e=>l.selectSort(t.value,t.order)},[e.createElementVNode("text",{class:"sort-menu-text"},e.toDisplayString(t.label),1),r.sortField===t.value&&r.sortOrder===t.order?(e.openBlock(),e.createElementBlock("text",{key:0,class:"sort-menu-check"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"])))),128))])):e.createCommentVNode("",!0),r.showGenderMenu||r.showRelationMenu||r.showSortMenu?(e.openBlock(),e.createElementBlock("view",{key:3,class:"menu-mask",onClick:o[12]||(o[12]=(...e)=>l.closeAllMenus&&l.closeAllMenus(...e))})):e.createCommentVNode("",!0)]),r.allPatients.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"stats-toggle-bar"},[e.createElementVNode("view",{class:"stats-toggle-btn",onClick:o[13]||(o[13]=(...e)=>l.toggleStats&&l.toggleStats(...e))},[e.createVNode(c,{type:t.showStats?"arrowup":"arrowdown",size:"16",color:"#4A90E2"},null,8,["type"]),e.createElementVNode("text",{class:"stats-toggle-text"},e.toDisplayString(t.showStats?"éšè—ç»Ÿè®¡":"æ˜¾ç¤ºç»Ÿè®¡"),1)])])):e.createCommentVNode("",!0),t.showStats&&r.allPatients.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"stats-section"},[e.createElementVNode("view",{class:"stats-cards"},[e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-label"},"æ€»æ‚£è€…æ•°"),e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(r.allPatients.length),1)]),e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-label"},"ç”·æ€§"),e.createElementVNode("text",{class:"stat-value male"},e.toDisplayString(t.statistics.gender.male),1)]),e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-label"},"å¥³æ€§"),e.createElementVNode("text",{class:"stat-value female"},e.toDisplayString(t.statistics.gender.female),1)]),e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-label"},"å¹³å‡å¹´é¾„"),e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(t.statistics.averageAge),1)])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-title"},[e.createElementVNode("text",null,"æ€§åˆ«åˆ†å¸ƒ")]),e.createElementVNode("view",{class:"chart-content"},[e.createElementVNode("view",{class:"pie-chart-container"},[e.createElementVNode("view",{class:"gender-progress"},[e.createElementVNode("view",{class:"gender-progress-item"},[e.createElementVNode("view",{class:"gender-progress-bar"},[e.createElementVNode("view",{class:"gender-progress-fill male-fill",style:e.normalizeStyle({width:t.statistics.gender.malePercent+"%"})},null,4)]),e.createElementVNode("view",{class:"gender-progress-label"},[e.createElementVNode("view",{class:"gender-color-dot",style:{"background-color":"#4A90E2"}}),e.createElementVNode("text",null,"ç”·æ€§ "+e.toDisplayString(t.statistics.gender.malePercent)+"%",1)])]),e.createElementVNode("view",{class:"gender-progress-item"},[e.createElementVNode("view",{class:"gender-progress-bar"},[e.createElementVNode("view",{class:"gender-progress-fill female-fill",style:e.normalizeStyle({width:t.statistics.gender.femalePercent+"%"})},null,4)]),e.createElementVNode("view",{class:"gender-progress-label"},[e.createElementVNode("view",{class:"gender-color-dot",style:{"background-color":"#FF6B9D"}}),e.createElementVNode("text",null,"å¥³æ€§ "+e.toDisplayString(t.statistics.gender.femalePercent)+"%",1)])])])])])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-title"},[e.createElementVNode("text",null,"å¹´é¾„åˆ†å¸ƒ")]),e.createElementVNode("view",{class:"chart-content"},[e.createElementVNode("view",{class:"age-distribution"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.statistics.ageGroups,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"age-group-item"},[e.createElementVNode("view",{class:"age-group-label"},[e.createElementVNode("text",null,e.toDisplayString(t.label),1),e.createElementVNode("text",{class:"age-group-count"},e.toDisplayString(t.count)+"äºº",1)]),e.createElementVNode("view",{class:"age-group-bar"},[e.createElementVNode("view",{class:"age-group-fill",style:e.normalizeStyle({width:t.percent+"%",backgroundColor:t.color})},null,4)]),e.createElementVNode("text",{class:"age-group-percent"},e.toDisplayString(t.percent)+"%",1)])))),128))])])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-title"},[e.createElementVNode("text",null,"å…³ç³»åˆ†å¸ƒ")]),e.createElementVNode("view",{class:"chart-content"},[e.createElementVNode("view",{class:"relation-distribution"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.statistics.relations,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"relation-item"},[e.createElementVNode("view",{class:"relation-label-row"},[e.createElementVNode("text",{class:"relation-label"},e.toDisplayString(t.relation||"æœªè®¾ç½®"),1),e.createElementVNode("text",{class:"relation-count"},e.toDisplayString(t.count)+"äºº ("+e.toDisplayString(t.percent)+"%)",1)]),e.createElementVNode("view",{class:"relation-bar"},[e.createElementVNode("view",{class:"relation-fill",style:e.normalizeStyle({width:t.percent+"%",backgroundColor:l.getRelationColor(t.relation)})},null,4)])])))),128))])])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content"},[0===r.allPatients.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("view",{class:"empty-icon"},"ğŸ‘¤"),e.createElementVNode("text",{class:"empty-text"},"æš‚æ— å°±è¯Šäºº"),e.createElementVNode("text",{class:"empty-hint"},"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ å°±è¯Šäºº")])):0===l.filteredPatients.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("view",{class:"empty-icon"},"ğŸ”"),e.createElementVNode("text",{class:"empty-text"},"æœªæ‰¾åˆ°åŒ¹é…çš„å°±è¯Šäºº"),e.createElementVNode("text",{class:"empty-hint"},"è¯·å°è¯•ä¿®æ”¹æœç´¢æ¡ä»¶"),e.createElementVNode("view",{class:"clear-search-btn",onClick:o[14]||(o[14]=(...e)=>l.clearAllFiltersAndSearch&&l.clearAllFiltersAndSearch(...e))},[e.createElementVNode("text",null,"æ¸…é™¤ç­›é€‰æ¡ä»¶")])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"patient-list"},[r.isSelectMode?(e.openBlock(),e.createElementBlock("view",{key:0,class:"select-all-bar"},[e.createElementVNode("view",{class:"select-all-checkbox",onClick:o[15]||(o[15]=(...e)=>l.toggleSelectAll&&l.toggleSelectAll(...e))},[e.createVNode(c,{type:l.isAllSelected?"checkbox-filled":"checkbox",size:"20",color:l.isAllSelected?"#4A90E2":"#999"},null,8,["type","color"]),e.createElementVNode("text",{class:"select-all-text"},"å…¨é€‰ ("+e.toDisplayString(r.selectedPatients.length)+"/"+e.toDisplayString(l.filteredPatients.length)+")",1)])])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.filteredPatients,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:e.normalizeClass(["patient-card",{"select-mode":r.isSelectMode,selected:l.isSelected(t.id)}]),onClick:e=>r.isSelectMode?l.toggleSelection(t.id):l.editPatient(t.id)},[r.isSelectMode?(e.openBlock(),e.createElementBlock("view",{key:0,class:"patient-select-checkbox"},[e.createVNode(c,{type:l.isSelected(t.id)?"checkbox-filled":"checkbox",size:"24",color:l.isSelected(t.id)?"#4A90E2":"#999"},null,8,["type","color"])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"patient-header"},[e.createElementVNode("view",{class:"patient-info"},[e.createElementVNode("text",{class:"patient-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"patient-tags"},[e.createElementVNode("text",{class:"tag"},e.toDisplayString(t.gender),1),e.createElementVNode("text",{class:"tag"},e.toDisplayString(t.age)+"å²",1),t.relation?(e.openBlock(),e.createElementBlock("text",{key:0,class:"tag relation"},e.toDisplayString(t.relation),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"patient-actions"},[r.defaultPatientId!==t.id?(e.openBlock(),e.createElementBlock("view",{key:0,class:"action-btn",onClick:e.withModifiers((e=>l.setAsDefault(t.id)),["stop"])},[e.createElementVNode("text",{class:"action-text"},"è®¾ä¸ºé»˜è®¤")],8,["onClick"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"default-badge"},[e.createElementVNode("text",null,"é»˜è®¤")]))])]),e.createElementVNode("view",{class:"patient-details"},[t.idCard?(e.openBlock(),e.createElementBlock("view",{key:0,class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"èº«ä»½è¯ï¼š"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(l.formatIdCard(t.idCard)),1)])):e.createCommentVNode("",!0),t.phone?(e.openBlock(),e.createElementBlock("view",{key:1,class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"æ‰‹æœºå·ï¼š"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(l.formatPhone(t.phone)),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"patient-footer"},[e.createElementVNode("view",{class:"edit-btn",onClick:e.withModifiers((e=>l.editPatient(t.id)),["stop"])},[e.createVNode(c,{type:"compose",size:"16",color:"#4A90E2"}),e.createElementVNode("text",null,"ç¼–è¾‘")],8,["onClick"]),e.createElementVNode("view",{class:"delete-btn",onClick:e.withModifiers((e=>l.deletePatient(t.id)),["stop"])},[e.createVNode(c,{type:"trash",size:"16",color:"#ff4d4f"}),e.createElementVNode("text",null,"åˆ é™¤")],8,["onClick"])])],10,["onClick"])))),128))]))]),r.isSelectMode?(e.openBlock(),e.createElementBlock("view",{key:2,class:"batch-action-bar"},[e.createElementVNode("view",{class:"batch-action-info"},[e.createElementVNode("text",{class:"batch-action-text"},"å·²é€‰æ‹© "+e.toDisplayString(r.selectedPatients.length)+" é¡¹",1)]),e.createElementVNode("view",{class:"batch-action-buttons"},[r.selectedPatients.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"batch-action-btn delete",onClick:o[16]||(o[16]=(...e)=>l.batchDelete&&l.batchDelete(...e))},[e.createVNode(c,{type:"trash",size:"18",color:"#ffffff"}),e.createElementVNode("text",null,"åˆ é™¤")])):e.createCommentVNode("",!0),r.selectedPatients.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"batch-action-btn export",onClick:o[17]||(o[17]=(...e)=>l.batchExport&&l.batchExport(...e))},[e.createVNode(c,{type:"download",size:"18",color:"#ffffff"}),e.createElementVNode("text",null,"å¯¼å‡º")])):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["add-button-container",{"with-batch-bar":r.isSelectMode}])},[e.createElementVNode("view",{class:"action-buttons-row"},[e.createElementVNode("button",{class:"add-button secondary import-btn",onClick:o[18]||(o[18]=(...e)=>l.showImportMenu&&l.showImportMenu(...e))},[e.createVNode(c,{type:"upload",size:"20",color:"#4A90E2"}),e.createElementVNode("text",null,"å¯¼å…¥")]),e.createElementVNode("button",{class:"add-button secondary export-btn",onClick:o[19]||(o[19]=(...e)=>l.exportAllPatients&&l.exportAllPatients(...e))},[e.createVNode(c,{type:"download",size:"20",color:"#4A90E2"}),e.createElementVNode("text",null,"å¯¼å‡º")])]),e.createElementVNode("button",{class:"add-button secondary",onClick:o[20]||(o[20]=(...e)=>l.addSamplePatients&&l.addSamplePatients(...e)),style:{"margin-bottom":"20rpx","margin-top":"0"}},[e.createVNode(c,{type:"plus",size:"20",color:"#4A90E2"}),e.createElementVNode("text",null,"æ·»åŠ 14æ¡æ•°æ®åˆ°åç«¯")]),e.createElementVNode("button",{class:"add-button",onClick:o[21]||(o[21]=(...e)=>l.addPatient&&l.addPatient(...e))},[e.createVNode(c,{type:"plus",size:"20",color:"#ffffff"}),e.createElementVNode("text",null,"æ·»åŠ å°±è¯Šäºº")])],2),r.showImportPopup?(e.openBlock(),e.createElementBlock("view",{key:3,class:"import-popup",onClick:o[25]||(o[25]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"import-popup-content"},[e.createElementVNode("view",{class:"import-popup-header"},[e.createElementVNode("text",{class:"import-popup-title"},"å¯¼å…¥æ‚£è€…æ•°æ®"),e.createElementVNode("view",{class:"import-popup-close",onClick:o[22]||(o[22]=(...e)=>l.closeImportMenu&&l.closeImportMenu(...e))},[e.createVNode(c,{type:"close",size:"20",color:"#999"})])]),e.createElementVNode("view",{class:"import-popup-body"},[e.createElementVNode("view",{class:"import-tip"},[e.createElementVNode("text",null,"æ”¯æŒCSVæ ¼å¼æ–‡ä»¶ï¼Œè¯·ç¡®ä¿æ–‡ä»¶åŒ…å«ä»¥ä¸‹å­—æ®µï¼š"),e.createElementVNode("text",{class:"import-tip-field"},"å§“åï¼ˆå¿…éœ€ï¼‰ã€æ€§åˆ«ã€å¹´é¾„ã€æ‰‹æœºå·ã€èº«ä»½è¯å·ã€å…³ç³»")]),e.createElementVNode("button",{class:"import-button",onClick:o[23]||(o[23]=(...e)=>l.chooseImportFile&&l.chooseImportFile(...e))},[e.createVNode(c,{type:"folder",size:"20",color:"#4A90E2"}),e.createElementVNode("text",null,"é€‰æ‹©æ–‡ä»¶")])])]),e.createElementVNode("view",{class:"import-popup-mask",onClick:o[24]||(o[24]=(...e)=>l.closeImportMenu&&l.closeImportMenu(...e))})])):e.createCommentVNode("",!0),e.createVNode(d)])}]]),Rs={components:{ThemeToggle:d},data:()=>({theme:l(),isEdit:!1,patientId:null,formData:{name:"",gender:"",age:"",idCard:"",phone:"",relation:""},relationOptions:["æœ¬äºº","é…å¶","å­å¥³","çˆ¶æ¯","å…¶ä»–äº²å±","å…¶ä»–"]}),computed:{relationIndex(){const e=this.relationOptions.indexOf(this.formData.relation);return e>=0?e:0}},onLoad(e){e.id&&(this.isEdit=!0,this.patientId=e.id,this.loadPatientData())},onShow(){uni.$on("themeChange",this.updateTheme),this.updateTheme()},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{updateTheme(e){try{this.theme=e||l()}catch(Kt){t("warn","at pages/mine/patient-edit.vue:145","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}},loadPatientData(){const e=ss(this.patientId);e&&(this.formData={name:e.name||"",gender:e.gender||"",age:e.age||"",idCard:e.idCard||"",phone:e.phone||"",relation:e.relation||""})},onRelationChange(e){this.formData.relation=this.relationOptions[e.detail.value]},validateForm(){if(!this.formData.name||!this.formData.name.trim())return uni.showToast({title:"è¯·è¾“å…¥å§“å",icon:"none"}),!1;if(!this.formData.gender)return uni.showToast({title:"è¯·é€‰æ‹©æ€§åˆ«",icon:"none"}),!1;if(!this.formData.age||!this.formData.age.trim())return uni.showToast({title:"è¯·è¾“å…¥å¹´é¾„",icon:"none"}),!1;const e=parseInt(this.formData.age);if(isNaN(e)||e<0||e>150)return uni.showToast({title:"è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„",icon:"none"}),!1;if(this.formData.idCard&&this.formData.idCard.trim()){if(!/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/.test(this.formData.idCard))return uni.showToast({title:"èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®",icon:"none"}),!1}if(this.formData.phone&&this.formData.phone.trim()){if(!/^1[3-9]\d{9}$/.test(this.formData.phone))return uni.showToast({title:"æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®",icon:"none"}),!1}return!0},handleSave(){if(this.validateForm())try{os({...this.formData,age:parseInt(this.formData.age),id:this.patientId}),uni.showToast({title:this.isEdit?"ä¿®æ”¹æˆåŠŸ":"æ·»åŠ æˆåŠŸ",icon:"success"}),uni.$emit("patientUpdated"),setTimeout((()=>{uni.navigateBack()}),1500)}catch(Kt){t("error","at pages/mine/patient-edit.vue:245","ä¿å­˜å°±è¯Šäººå¤±è´¥:",Kt),uni.showToast({title:"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}},handleDelete(){uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¯¥å°±è¯Šäººå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚",success:e=>{if(e.confirm)try{ns(this.patientId),uni.showToast({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),uni.$emit("patientUpdated"),setTimeout((()=>{uni.navigateBack()}),1500)}catch(Kt){t("error","at pages/mine/patient-edit.vue:270","åˆ é™¤å°±è¯Šäººå¤±è´¥:",Kt),uni.showToast({title:"åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}})}}};const Os=s(Rs,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i),d=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},[e.createTextVNode("å§“å "),e.createElementVNode("text",{class:"required"},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[0]||(o[0]=e=>r.formData.name=e),placeholder:"è¯·è¾“å…¥å§“å",maxlength:"20"},null,512),[[e.vModelText,r.formData.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},[e.createTextVNode("æ€§åˆ« "),e.createElementVNode("text",{class:"required"},"*")]),e.createElementVNode("view",{class:"radio-group"},[e.createElementVNode("view",{class:e.normalizeClass(["radio-item",{active:"ç”·"===r.formData.gender}]),onClick:o[1]||(o[1]=e=>r.formData.gender="ç”·")},[e.createElementVNode("text",null,"ç”·")],2),e.createElementVNode("view",{class:e.normalizeClass(["radio-item",{active:"å¥³"===r.formData.gender}]),onClick:o[2]||(o[2]=e=>r.formData.gender="å¥³")},[e.createElementVNode("text",null,"å¥³")],2)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},[e.createTextVNode("å¹´é¾„ "),e.createElementVNode("text",{class:"required"},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[3]||(o[3]=e=>r.formData.age=e),type:"number",placeholder:"è¯·è¾“å…¥å¹´é¾„",maxlength:"3"},null,512),[[e.vModelText,r.formData.age]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"èº«ä»½è¯å·"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[4]||(o[4]=e=>r.formData.idCard=e),placeholder:"è¯·è¾“å…¥èº«ä»½è¯å·ï¼ˆé€‰å¡«ï¼‰",maxlength:"18"},null,512),[[e.vModelText,r.formData.idCard]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"æ‰‹æœºå·"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[5]||(o[5]=e=>r.formData.phone=e),type:"number",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·ï¼ˆé€‰å¡«ï¼‰",maxlength:"11"},null,512),[[e.vModelText,r.formData.phone]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ä¸æœ¬äººå…³ç³»"),e.createElementVNode("picker",{mode:"selector",range:r.relationOptions,value:l.relationIndex,onChange:o[6]||(o[6]=(...e)=>l.onRelationChange&&l.onRelationChange(...e))},[e.createElementVNode("view",{class:"picker-view"},[e.createElementVNode("text",{class:e.normalizeClass({placeholder:!r.formData.relation})},e.toDisplayString(r.formData.relation||"è¯·é€‰æ‹©å…³ç³»ï¼ˆé€‰å¡«ï¼‰"),3),e.createVNode(c,{type:"arrowright",size:"16",color:"#999"})])],40,["range","value"])])]),e.createElementVNode("view",{class:"button-container"},[r.isEdit?(e.openBlock(),e.createElementBlock("button",{key:0,class:"delete-btn",onClick:o[7]||(o[7]=(...e)=>l.handleDelete&&l.handleDelete(...e))},"åˆ é™¤å°±è¯Šäºº")):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"save-btn",onClick:o[8]||(o[8]=(...e)=>l.handleSave&&l.handleSave(...e))},"ä¿å­˜")]),e.createVNode(d)])}]]),js={components:{ThemeToggle:d},data:()=>({consultations:[],loading:!1,currentUserInfo:null,currentUserProfile:null}),computed:{currentUserDisplayName(){return this.currentUserInfo&&(this.currentUserInfo.username||this.currentUserInfo.phone||this.currentUserInfo.name)||"å‰å°è´¦å·ä¿¡æ¯"},currentUserDetails(){var e,t,a,o;const n=((null==(e=this.currentUserProfile)?void 0:e.gender)||(null==(t=this.currentUserInfo)?void 0:t.gender)||"").trim(),s=((null==(a=this.currentUserProfile)?void 0:a.age)||(null==(o=this.currentUserInfo)?void 0:o.age)||"").toString().trim();return n||s?`${n}${n&&s?" | ":""}${s}${s?"å²":""}`:""}},onShow(){this.loadUserData(),this.loadConsultations()},mounted(){this.loadUserData(),this.loadConsultations()},methods:{loadUserData(){try{this.currentUserInfo=ae();const e=getApp&&getApp();if(e&&e.globalData&&e.globalData.userProfile)this.currentUserProfile=e.globalData.userProfile;else{const e=uni.getStorageSync("userProfile");e&&(this.currentUserProfile="string"==typeof e?JSON.parse(e):e)}}catch(Kt){t("warn","at pages/mine/consultations.vue:134","åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",Kt)}},async loadConsultations(){this.loading=!0;try{const a=getApp&&getApp();let o=ae()||a&&a.globalData&&a.globalData.userInfo||uni.getStorageSync("userInfo")||{};if("string"==typeof o)try{o=JSON.parse(o)}catch(Kt){o={}}const n=(null==o?void 0:o.id)||(null==o?void 0:o._id)||(null==o?void 0:o.userId)||(null==o?void 0:o.username)||(null==o?void 0:o.phone)||null;if(n)try{t("log","at pages/mine/consultations.vue:158","ğŸ”„ ä»åç«¯åŒæ­¥å’¨è¯¢è®°å½•ï¼Œå‰å°è´¦å·ID:",n);const e=await Pe({url:`/chat/user-consultations?userId=${n}`,method:"GET"});e.success&&e.data&&e.data.length>0?(t("log","at pages/mine/consultations.vue:165","âœ… ä»åç«¯è·å–åˆ°",e.data.length,"æ¡å’¨è¯¢è®°å½•"),e.data.forEach((e=>{Ps({id:e._id||e.id,patientId:e.patientId,doctorId:e.doctorId,doctorInfo:e.doctorInfo||{},patientInfo:e.patientInfo,symptomDescription:e.symptomDescription,symptomImages:e.symptomImages||[],messageCount:e.messageCount||0,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime?new Date(e.lastMessageTime).getTime():Date.now(),createdAt:e.createdAt?new Date(e.createdAt).getTime():Date.now(),updatedAt:e.updatedAt?new Date(e.updatedAt).getTime():Date.now(),messages:[]},n)})),t("log","at pages/mine/consultations.vue:191","âœ… åç«¯æ•°æ®å·²åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨")):t("log","at pages/mine/consultations.vue:193","â„¹ï¸ åç«¯æ²¡æœ‰å’¨è¯¢è®°å½•")}catch(e){t("error","at pages/mine/consultations.vue:196","âŒ ä»åç«¯åŒæ­¥å’¨è¯¢è®°å½•å¤±è´¥:",e)}else t("warn","at pages/mine/consultations.vue:200","âš ï¸ æ— æ³•è·å–å‰å°è´¦å·IDï¼Œè·³è¿‡åç«¯åŒæ­¥");const s=_s(n),i=new Map,r=e=>`${(e.name||"æœªçŸ¥æ‚£è€…").trim()}|${(e.gender||"").trim()}|${e.age||""}`;s.forEach((e=>{const t=e.patientInfo||{},a=r(t);if(i.has(a)){const t=i.get(a),o=t.updatedAt||t.createdAt||t.lastMessageTime||0;(e.updatedAt||e.createdAt||e.lastMessageTime||0)>o&&i.set(a,e)}else i.set(a,e)})),this.consultations=Array.from(i.values()).sort(((e,t)=>{const a=e.updatedAt||e.createdAt||e.lastMessageTime||0;return(t.updatedAt||t.createdAt||t.lastMessageTime||0)-a})),t("log","at pages/mine/consultations.vue:247","âœ… åŠ è½½å’¨è¯¢è®°å½•:",this.consultations.length,"ï¼ˆå»é‡åï¼‰")}catch(a){t("error","at pages/mine/consultations.vue:249","âŒ åŠ è½½å’¨è¯¢è®°å½•å¤±è´¥:",a),this.consultations=[]}finally{this.loading=!1}},formatTime:e=>function(e){if(!e)return"";const t=new Date(e),a=(new Date).getTime()-t.getTime(),o=Math.floor(a/6e4),n=Math.floor(a/36e5),s=Math.floor(a/864e5);return o<1?"åˆšåˆš":o<60?`${o}åˆ†é’Ÿå‰`:n<24?`${n}å°æ—¶å‰`:s<7?`${s}å¤©å‰`:`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥`}(e),getDoctorName(e){var a,o,n,s,i;if(!e)return"åŒ»ç”Ÿ";if(e.doctorInfo&&"object"==typeof e.doctorInfo){const t=e.doctorInfo.name||e.doctorInfo.username||e.doctorInfo.nickname||e.doctorInfo.realname;if(t)return t}const r=null==e?void 0:e.doctorId,l=(null==(a=this.currentUserInfo)?void 0:a.id)||(null==(o=this.currentUserInfo)?void 0:o._id)||(null==(n=this.currentUserInfo)?void 0:n.userId)||(null==(s=this.currentUserInfo)?void 0:s.username)||(null==(i=this.currentUserInfo)?void 0:i.phone);if(r&&l){if(r.startsWith("doctor_")&&l===r.replace("doctor_","")||l===r||(null==l?void 0:l.startsWith("doctor_")))return t("log","at pages/mine/consultations.vue:294","âœ… å½“å‰ç”¨æˆ·æ˜¯åŒ»ç”Ÿï¼Œæ˜¾ç¤ºå½“å‰ç”¨æˆ·åç§°:",this.currentUserDisplayName),this.currentUserDisplayName}if(r){if(r.startsWith("doctor_")){const e=r.replace("doctor_","");return/^\d+$/.test(e)?"åŒ»ç”Ÿ":e||"åŒ»ç”Ÿ"}return/[\u4e00-\u9fa5]/.test(r)||(/^[a-zA-Z]+$/.test(r)||/^[a-zA-Z0-9]+$/.test(r)&&r.length<=20&&r.length>=2)?r:"åŒ»ç”Ÿ"}return"åŒ»ç”Ÿ"},getDoctorDetails(e){var t,a,o,n,s;const i=(null==(t=this.currentUserInfo)?void 0:t.id)||(null==(a=this.currentUserInfo)?void 0:a._id)||(null==(o=this.currentUserInfo)?void 0:o.userId)||(null==(n=this.currentUserInfo)?void 0:n.username)||(null==(s=this.currentUserInfo)?void 0:s.phone),r=null==e?void 0:e.doctorId;if(r&&(r.startsWith("doctor_")&&i===r.replace("doctor_","")||i===r||(null==i?void 0:i.startsWith("doctor_"))))return this.currentUserDetails;if(e.doctorInfo){const t=(e.doctorInfo.gender||"").trim(),a=(e.doctorInfo.age||"").toString().trim();if(t||a)return`${t}${t&&a?" | ":""}${a}${a?"å²":""}`}return""},getAvatarText(e){if(!e||"å‰å°è´¦å·ä¿¡æ¯"===e)return"å‰";const t=e.charAt(0);return/[\u4e00-\u9fa5]/.test(t)?t:t.toUpperCase()},isSamePatient(e,t){if(!e||!t)return!1;const a=(e.name||"").trim(),o=(t.name||"").trim(),n=(e.gender||"").trim(),s=(t.gender||"").trim(),i=e.age||"",r=t.age||"";return a===o&&""!==a&&n===s&&i===r},viewConsultation(e){const a=getApp();a.globalData||(a.globalData={});const o=e.patientInfo||{},n=e=>`${(e.name||"æœªçŸ¥æ‚£è€…").trim()}|${(e.gender||"").trim()}|${e.age||""}`,s=n(o),i=a.globalData.consultData||{};s===n(i.patient||{})&&"æœªçŸ¥æ‚£è€…||"!==s&&e.id?(t("log","at pages/mine/consultations.vue:417","âœ… æ‚£è€…ç›¸åŒï¼Œç»§ç»­ä¹‹å‰çš„å’¨è¯¢:",e.id,"æ‚£è€…:",o.name),a.globalData.consultData={description:e.symptomDescription||i.description||"",patient:o,files:e.symptomImages&&e.symptomImages.length>0?e.symptomImages:i.files||[],consultationId:e.id,doctorId:e.doctorId||i.doctorId,patientId:e.patientId||o.id||i.patientId,messages:e.messages&&e.messages.length>0?e.messages:i.messages||[]}):(t("log","at pages/mine/consultations.vue:433","ğŸ†• æ‚£è€…ä¸åŒæˆ–é¦–æ¬¡å’¨è¯¢ï¼Œæ–°å¼€å’¨è¯¢é¡µé¢ï¼Œæ‚£è€…:",o.name),a.globalData.consultData={description:e.symptomDescription||"",patient:o,files:e.symptomImages||[],consultationId:e.id,doctorId:e.doctorId,patientId:e.patientId||o.id,messages:e.messages||[]}),uni.navigateTo({url:"/pages/online-consult/chat"})}}};const zs=s(js,[["render",function(t,a,o,n,s,i){const r=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"page-title"},"æˆ‘çš„å’¨è¯¢")]),s.consultations.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"consultation-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.consultations,(t=>{var a,o,n,s,r,l,c;return e.openBlock(),e.createElementBlock("view",{key:t.id,class:"consultation-item",onClick:e=>i.viewConsultation(t)},[e.createElementVNode("view",{class:"consultation-header"},[e.createElementVNode("view",{class:"user-info-section"},[e.createElementVNode("view",{class:"user-avatar"},[e.createElementVNode("text",{class:"avatar-text"},e.toDisplayString(i.getAvatarText(i.getDoctorName(t))),1)]),e.createElementVNode("view",{class:"user-info-text"},[e.createElementVNode("text",{class:"user-name"},e.toDisplayString(i.getDoctorName(t)),1),i.getDoctorDetails(t)?(e.openBlock(),e.createElementBlock("text",{key:0,class:"user-details"},e.toDisplayString(i.getDoctorDetails(t)),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"patient-info-section"},[e.createElementVNode("view",{class:"patient-info-text"},[e.createElementVNode("text",{class:"patient-name"},e.toDisplayString((null==(a=t.patientInfo)?void 0:a.name)||"æœªçŸ¥æ‚£è€…"),1),e.createElementVNode("text",{class:"patient-details"},e.toDisplayString((null==(o=t.patientInfo)?void 0:o.gender)||"")+e.toDisplayString((null==(n=t.patientInfo)?void 0:n.gender)&&(null==(s=t.patientInfo)?void 0:s.age)?" | ":"")+e.toDisplayString((null==(r=t.patientInfo)?void 0:r.age)||"")+e.toDisplayString((null==(l=t.patientInfo)?void 0:l.age)?"å²":""),1)]),e.createElementVNode("text",{class:"consultation-time"},e.toDisplayString(i.formatTime(t.updatedAt||t.createdAt)),1)])]),e.createElementVNode("view",{class:"consultation-content"},[t.symptomDescription?(e.openBlock(),e.createElementBlock("text",{key:0,class:"symptom-preview"},e.toDisplayString(t.symptomDescription.length>50?t.symptomDescription.substring(0,50)+"...":t.symptomDescription),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"no-symptom"},"æš‚æ— ç—‡çŠ¶æè¿°"))]),e.createElementVNode("view",{class:"consultation-footer"},[e.createElementVNode("view",{class:"message-count"},[e.createElementVNode("text",{class:"count-text"},e.toDisplayString(t.messageCount||(null==(c=t.messages)?void 0:c.length)||0)+" æ¡æ¶ˆæ¯",1)]),t.symptomImages&&t.symptomImages.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-count"},[e.createElementVNode("text",{class:"image-icon"},"ğŸ“·"),e.createElementVNode("text",{class:"count-text"},e.toDisplayString(t.symptomImages.length),1)])):e.createCommentVNode("",!0)])],8,["onClick"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("text",{class:"empty-icon"},"ğŸ’¬"),e.createElementVNode("text",{class:"empty-text"},"æš‚æ— å’¨è¯¢è®°å½•"),e.createElementVNode("text",{class:"empty-tip"},"å¼€å§‹ä¸€æ¬¡æ–°çš„å’¨è¯¢å§")])),e.createVNode(r)])}]]),qs={components:{ThemeToggle:d},data:()=>({theme:l()}),onShow(){uni.$on("themeChange",this.updateTheme),this.updateTheme()},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{updateTheme(e){try{this.theme=e||l()}catch(Kt){t("warn","at pages/mine/favorites.vue:38","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}}}};const Hs=s(qs,[["render",function(t,a,o,n,s,i){const r=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("text",{class:"title"},"æˆ‘çš„æ”¶è—"),e.createElementVNode("view",{class:"placeholder"},"æ”¶è—çš„åŒ»ç”Ÿã€åŒ»é™¢æˆ–æ–‡ç« å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ")]),e.createVNode(r)])}]]),Ws={components:{ThemeToggle:d},data:()=>({theme:l()}),onShow(){uni.$on("themeChange",this.updateTheme),this.updateTheme()},onHide(){uni.$off("themeChange",this.updateTheme)},methods:{updateTheme(e){try{this.theme=e||l()}catch(Kt){t("warn","at pages/mine/help.vue:38","ä¸»é¢˜æ›´æ–°å¤±è´¥:",Kt),this.theme=l()}}}};const Js=s(Ws,[["render",function(t,a,o,n,s,i){const r=e.resolveComponent("ThemeToggle");return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("text",{class:"title"},"å¸®åŠ©ä¸­å¿ƒ"),e.createElementVNode("view",{class:"placeholder"},"å¸¸è§é—®é¢˜ã€å®¢æœæ–¹å¼å°†åœ¨è¿™é‡Œå±•ç¤º")]),e.createVNode(r)])}]]);const Ks=s({data:()=>({messageList:[{id:1,title:"é¢„çº¦æŒ‚å·å–æ¶ˆé€šçŸ¥",date:"2020-05-01",content:"æ‚¨å·²å–æ¶ˆ2019-05-05çš„éª¨ç§‘æ™®é€šå·é¢„çº¦æŒ‚å·ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœã€‚",type:"appointment_cancel",read:!1},{id:2,title:"é¢„çº¦æŒ‚å·å–æ¶ˆé€šçŸ¥",date:"2020-05-01",content:"æ‚¨å·²å–æ¶ˆ2019-05-05çš„éª¨ç§‘æ™®é€šå·é¢„çº¦æŒ‚å·ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœã€‚",type:"appointment_cancel",read:!1},{id:3,title:"é¢„çº¦æŒ‚å·å–æ¶ˆé€šçŸ¥",date:"2020-05-01",content:"æ‚¨å·²å–æ¶ˆ2019-05-05çš„éª¨ç§‘æ™®é€šå·é¢„çº¦æŒ‚å·ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœã€‚",type:"appointment_cancel",read:!1},{id:4,title:"é¢„çº¦æˆåŠŸé€šçŸ¥",date:"2020-04-28",content:"æ‚¨å·²æˆåŠŸé¢„çº¦2020-05-10çš„å¿ƒè¡€ç®¡å†…ç§‘ä¸“å®¶å·ï¼Œè¯·æŒ‰æ—¶å°±è¯Šã€‚",type:"appointment_success",read:!0},{id:5,title:"å°±è¯Šæé†’",date:"2020-04-25",content:"æ‚¨é¢„çº¦çš„2020-05-05éª¨ç§‘æ™®é€šå·å³å°†åˆ°æœŸï¼Œè¯·æå‰åšå¥½å‡†å¤‡ã€‚",type:"appointment_reminder",read:!0},{id:6,title:"ç³»ç»Ÿé€šçŸ¥",date:"2020-04-20",content:"ç³»ç»Ÿå°†äº2020-04-25 22:00-24:00è¿›è¡Œç»´æŠ¤ï¼ŒæœŸé—´å¯èƒ½æ— æ³•ä½¿ç”¨éƒ¨åˆ†åŠŸèƒ½ã€‚",type:"system",read:!0}]}),onLoad(){this.loadMessages()},methods:{loadMessages(){},viewMessage(e){switch(e.read||(e.read=!0),e.type){case"appointment_cancel":case"appointment_success":case"appointment_reminder":uni.navigateTo({url:"/pages/mine/appointments"});break;default:uni.showToast({title:e.title,icon:"none",duration:2e3})}}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"messages-page"},[e.createElementVNode("scroll-view",{class:"messages-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.messageList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||a,class:"message-card",onClick:e=>i.viewMessage(t)},[e.createElementVNode("view",{class:"message-icon"},[e.createElementVNode("view",{class:"icon-bg"},[e.createElementVNode("view",{class:"icon-inner"},[e.createElementVNode("view",{class:"icon-line"}),e.createElementVNode("view",{class:"icon-line"}),e.createElementVNode("view",{class:"icon-line"}),e.createElementVNode("view",{class:"icon-corner"})])])]),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("view",{class:"message-header"},[e.createElementVNode("text",{class:"message-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"message-date"},e.toDisplayString(t.date),1)]),e.createElementVNode("text",{class:"message-text"},e.toDisplayString(t.content),1)])],8,["onClick"])))),128)),0===s.messageList.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— æ¶ˆæ¯")])):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-73dbd9b2"]]),Gs={data:()=>({cacheSize:"12.3M",version:"1.0.1"}),mounted(){this.calcCache()},methods:{go(e){uni.navigateTo({url:e})},async calcCache(){try{const e=(await uni.getStorageInfo()).currentSize||0;this.cacheSize=this.formatSize(e)}catch(Kt){this.cacheSize="12.3M"}},formatSize(e){const t=e/1024;return t>1?`${t.toFixed(1)}M`:`${e.toFixed(1)}KB`},clearCache(){uni.clearStorage({success:()=>{this.cacheSize="0KB",uni.showToast({title:"ç¼“å­˜å·²æ¸…ç†",icon:"none"})}})},checkUpdate(){uni.showToast({title:"å·²æ˜¯æœ€æ–°ç‰ˆæœ¬",icon:"none"})},async logout(){uni.showModal({title:"æç¤º",content:"ç¡®å®šé€€å‡ºç™»å½•å—ï¼Ÿ",success:async e=>{if(e.confirm){uni.showLoading({title:"é€€å‡ºä¸­...",mask:!0});try{await new Promise((e=>{const a=ee();if(a){const o=a.trim().replace(/[^a-zA-Z0-9\-_.]/g,"");uni.request({url:`${j}/auth/logout`,method:"POST",header:{Authorization:`Bearer ${o}`,authorization:`Bearer ${o}`,"Content-Type":"application/json"},success:a=>{200===a.statusCode?t("log","at utils/auth.js:440","âœ… UniApp ç™»å‡ºæˆåŠŸï¼Œåç«¯ä¼šè¯å·²åˆ é™¤"):t("log","at utils/auth.js:442","âš ï¸ UniApp ç™»å‡ºè¯·æ±‚å¤±è´¥ï¼Œä½†ç»§ç»­æ¸…é™¤æœ¬åœ°token"),ne(),e(!0)},fail:a=>{t("error","at utils/auth.js:449","UniApp ç™»å‡ºè¯·æ±‚å¤±è´¥:",a),ne(),e(!0)}})}else ne(),e(!0)})),t("log","at pages/settings/settings.vue:116","âœ… é€€å‡ºç™»å½•æˆåŠŸ")}catch(Kt){t("error","at pages/settings/settings.vue:118","é€€å‡ºç™»å½•å¤±è´¥:",Kt);try{ne&&ne()}catch(a){t("error","at pages/settings/settings.vue:123","æ¸…ç†æœ¬åœ°è®¤è¯ä¿¡æ¯å¤±è´¥:",a)}}uni.hideLoading(),setTimeout((()=>{uni.reLaunch({url:"/pages/login/login",success:()=>{t("log","at pages/settings/settings.vue:135","âœ… å·²è·³è½¬åˆ°ç™»å½•é¡µ")},fail:e=>{t("error","at pages/settings/settings.vue:138","è·³è½¬ç™»å½•é¡µå¤±è´¥:",e),uni.navigateTo({url:"/pages/login/login"})}})}),300)}}})}}};const Ys=s(Gs,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"settings-page"},[e.createElementVNode("view",{class:"logo-box"},[e.createElementVNode("view",{class:"logo"},"Logo")]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"item",onClick:o[0]||(o[0]=e=>l.go("/pages/settings/account/account"))},[e.createElementVNode("text",null,"è´¦å·è®¾ç½®"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[1]||(o[1]=e=>l.go("/pages/settings/notification/notification"))},[e.createElementVNode("text",null,"æ¶ˆæ¯é€šçŸ¥"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[2]||(o[2]=e=>l.go("/pages/settings/address/address"))},[e.createElementVNode("text",null,"åœ°å€ç®¡ç†"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[3]||(o[3]=(...e)=>l.clearCache&&l.clearCache(...e))},[e.createElementVNode("text",null,"æ¸…é™¤æœ¬åœ°ç¼“å­˜"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("text",{class:"cache"},e.toDisplayString(r.cacheSize),1),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"item",onClick:o[4]||(o[4]=e=>l.go("/pages/settings/about/about"))},[e.createElementVNode("text",null,"åŠŸèƒ½ä»‹ç»"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[5]||(o[5]=e=>l.go("/pages/settings/legal"))},[e.createElementVNode("text",null,"æ³•å¾‹å£°æ˜"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[6]||(o[6]=e=>l.go("/pages/settings/terms"))},[e.createElementVNode("text",null,"ç”¨æˆ·æœåŠ¡åè®®"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item",onClick:o[7]||(o[7]=e=>l.go("/pages/settings/privacy"))},[e.createElementVNode("text",null,"éšç§"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"card single"},[e.createElementVNode("view",{class:"item",onClick:o[8]||(o[8]=(...e)=>l.checkUpdate&&l.checkUpdate(...e))},[e.createElementVNode("text",null,"æ£€æŸ¥æ›´æ–°"),e.createElementVNode("text",{class:"version"},"ç‰ˆæœ¬å· "+e.toDisplayString(r.version),1)])]),e.createElementVNode("view",{class:"logout",onClick:o[9]||(o[9]=(...e)=>l.logout&&l.logout(...e))},"é€€å‡ºç™»å½•")])}]]),Qs={data:()=>({avatarUrl:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",nickname:"ç”¨æˆ·æ˜µç§°",gender:"ä¿å¯†",authStatus:"æœªè®¤è¯",phone:""}),computed:{phoneDesc(){return this.phone?this.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):"æœªç»‘å®š"},authStatusText(){return"å·²è®¤è¯"===this.authStatus?"å·²è®¤è¯":"æœªè®¤è¯"}},onShow(){const e=getApp();e.globalData=e.globalData||{};const a=e.globalData.userInfo||uni.getStorageSync("userInfo")||{};let o={};try{const t=uni.getStorageSync("userProfile");t&&Object.keys(t).length>0&&(o=t,e.globalData.userProfile=o)}catch(Kt){t("warn","at pages/settings/account/account.vue:102","è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:",Kt)}o&&0!==Object.keys(o).length||(o=e.globalData.userProfile||{}),this.avatarUrl=a.avatarUrl||o.avatarUrl||this.avatarUrl,this.nickname=a.nickname||o.nickname||this.nickname,this.gender=a.gender||o.gender||this.gender,this.phone=a.phone||o.phone||"",this.authStatus=a.authStatus||o.authStatus||this.authStatus,this.avatarUrl&&"/static/logo.png"!==this.avatarUrl||(this.avatarUrl="https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar")},methods:{async saveProfile(){const e=getApp();e.globalData=e.globalData||{};const a=e.globalData.userProfile||{},o={...a,avatarUrl:this.avatarUrl,nickname:this.nickname,gender:this.gender,phone:this.phone,authStatus:this.authStatus||a.authStatus||"æœªè®¤è¯"};e.globalData.userProfile=o;try{const a={avatarUrl:this.avatarUrl?String(this.avatarUrl):"",nickname:this.nickname?String(this.nickname).trim():"",gender:this.gender?String(this.gender):"ä¿å¯†",phone:this.phone?String(this.phone).trim():""};t("log","at pages/settings/account/account.vue:153","ğŸ“¤ å‡†å¤‡ä¿å­˜åˆ°æœåŠ¡å™¨:",{avatarUrl:a.avatarUrl?a.avatarUrl.length>50?`${a.avatarUrl.substring(0,50)}...`:a.avatarUrl:"(ç©º)",nickname:a.nickname||"(ç©º)",gender:a.gender||"(ç©º)",phone:a.phone?a.phone.length>=11?`${a.phone.substring(0,3)}****${a.phone.substring(7)}`:a.phone:"(ç©º)",dataKeys:Object.keys(a)});const n=await Pe({url:"/auth/me",method:"PUT",data:a,needAuth:!0});if(!n||!n.success)throw new Error((null==n?void 0:n.message)||"ä¿å­˜åˆ°æœåŠ¡å™¨å¤±è´¥");const s=n.data||{};e.globalData.userInfo={...e.globalData.userInfo||{},avatarUrl:s.avatarUrl,nickname:s.nickname,gender:s.gender,phone:s.phone,authStatus:s.authStatus},uni.setStorageSync("userInfo",e.globalData.userInfo);const i=e.globalData.userInfo.id||e.globalData.userInfo._id||e.globalData.userInfo.userId||e.globalData.userInfo.username;if(i){const t=uni.getStorageSync("userProfilesById")||{};t[i]={...t[i]||{},avatarUrl:s.avatarUrl||o.avatarUrl,nickname:s.nickname||o.nickname,gender:s.gender||o.gender,phone:s.phone||o.phone,authStatus:s.authStatus||o.authStatus},uni.setStorageSync("userProfilesById",t),e.globalData.userProfile=t[i],uni.setStorageSync("userProfile",t[i])}t("log","at pages/settings/account/account.vue:202","âœ… æœåŠ¡å™¨è¿”å›çš„æ›´æ–°åæ•°æ®:",{avatarUrl:s.avatarUrl?"å·²è®¾ç½®":"æœªè®¾ç½®",nickname:s.nickname||"æœªè®¾ç½®",gender:s.gender||"æœªè®¾ç½®",phone:s.phone||"æœªè®¾ç½®"}),uni.showToast({title:"æ›´æ–°æˆåŠŸ",icon:"success",duration:2e3})}catch(n){t("error","at pages/settings/account/account.vue:215","âŒ ä¿å­˜åˆ°æœåŠ¡å™¨å¤±è´¥:",n),uni.showToast({title:n.message||"ä¿å­˜åˆ°æœåŠ¡å™¨å¤±è´¥",icon:"none"})}try{const a=e.globalData.userInfo||uni.getStorageSync("userInfo")||{},n=a.id||a._id||a.userId||a.username||"anonymous",s=uni.getStorageSync("userProfilesById")||{};s[n]=o,uni.setStorageSync("userProfilesById",s),uni.setStorageSync("currentUserId",n),uni.setStorageSync("userProfile",o),t("log","at pages/settings/account/account.vue:236","âœ… ç”¨æˆ·èµ„æ–™å·²æŒ‰ç”¨æˆ·IDä¿å­˜(æœ¬åœ° + æ•°æ®åº“):",n)}catch(Kt){t("error","at pages/settings/account/account.vue:238","âŒ ä¿å­˜æœ¬åœ°ç¼“å­˜å¤±è´¥:",Kt)}},async changeAvatar(){uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{if(e.tempFilePaths&&e.tempFilePaths.length>0){const o=e.tempFilePaths[0];try{const e=await this.compressAndConvertToBase64(o);e.length>5e5?(t("warn","at pages/settings/account/account.vue:255","âš ï¸ å›¾ç‰‡ä»ç„¶è¾ƒå¤§ï¼Œè¿›è¡ŒäºŒæ¬¡å‹ç¼©"),this.avatarUrl=await this.compressAndConvertToBase64(o,.3)):this.avatarUrl=e,t("log","at pages/settings/account/account.vue:261","âœ… å¤´åƒå·²å¤„ç†ï¼Œå¤§å°:",(e.length/1024).toFixed(2)+"KB"),this.saveProfile(),uni.showToast({title:"å¤´åƒå·²æ›´æ–°",icon:"none"})}catch(a){t("error","at pages/settings/account/account.vue:265","âŒ å¤„ç†å¤´åƒå¤±è´¥:",a),uni.showToast({title:"å¤´åƒå¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}}})},editNickname(){uni.showModal({title:"ä¿®æ”¹æ˜µç§°",editable:!0,placeholderText:this.nickname,success:e=>{e.confirm&&e.content&&(this.nickname=e.content,this.saveProfile(),uni.showToast({title:"æ˜µç§°å·²æ›´æ–°",icon:"none"}))}})},editGender(){uni.showActionSheet({itemList:["ç”·","å¥³","ä¿å¯†"],success:e=>{this.gender=["ç”·","å¥³","ä¿å¯†"][e.tapIndex],this.saveProfile()}})},editPhone(){uni.showModal({title:"ä¿®æ”¹æ‰‹æœºå·",editable:!0,placeholderText:this.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"),success:e=>{if(e.confirm&&e.content){const t=e.content.trim();if(!/^1\d{10}$/.test(t))return void uni.showToast({title:"è¯·è¾“å…¥11ä½æ‰‹æœºå·",icon:"none"});this.phone=t,this.saveProfile(),uni.showToast({title:"æ‰‹æœºå·å·²æ›´æ–°",icon:"none"})}}})},goRealname(){uni.navigateTo({url:"/pages/settings/realname/realname"})},async compressAndConvertToBase64(e,a=.7){return new Promise(((o,n)=>{if(!e)return o("");if(e.startsWith("data:"))return o(e);if("undefined"!=typeof window){const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),s=800;let i=t.width,r=t.height;i>r?i>s&&(r=r*s/i,i=s):r>s&&(i=i*s/r,r=s),e.width=i,e.height=r,n.drawImage(t,0,0,i,r);const l=e.toDataURL("image/jpeg",a);o(l)},t.onerror=()=>{this.convertToBase64(e).then(o).catch(n)},t.src=e}else uni.compressImage({src:e,quality:100*a,success:e=>{const t=e.tempFilePath;uni.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:e=>{const a=t.split(".").pop().toLowerCase();o(`data:${"png"===a?"image/png":"image/jpeg"};base64,${e.data}`)},fail:()=>o(t)})},fail:a=>{t("warn","at pages/settings/account/account.vue:390","å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼Œä½¿ç”¨åŸå›¾:",a),this.convertToBase64(e).then(o).catch(n)}})}))},convertToBase64:e=>new Promise((t=>e?e.startsWith("data:")?t(e):void("undefined"!=typeof window?fetch(e).then((e=>e.blob())).then((a=>{const o=new FileReader;o.onload=()=>t(o.result||e),o.onerror=()=>t(e),o.readAsDataURL(a)})).catch((()=>t(e))):t(e)):t("")))}};const Xs=s(Qs,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"item avatar-item",onClick:o[0]||(o[0]=(...e)=>l.changeAvatar&&l.changeAvatar(...e))},[e.createElementVNode("text",null,"å¤´åƒ"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("image",{src:r.avatarUrl,class:"avatar",mode:"aspectFill"},null,8,["src"]),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"item",onClick:o[1]||(o[1]=(...e)=>l.editNickname&&l.editNickname(...e))},[e.createElementVNode("text",null,"æ˜µç§°"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("text",{class:"desc"},e.toDisplayString(r.nickname),1),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"item",onClick:o[2]||(o[2]=(...e)=>l.editGender&&l.editGender(...e))},[e.createElementVNode("text",null,"æ€§åˆ«"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("text",{class:"desc"},e.toDisplayString(r.gender),1),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"item",onClick:o[3]||(o[3]=(...e)=>l.goRealname&&l.goRealname(...e))},[e.createElementVNode("text",null,"å®åè®¤è¯"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("text",{class:e.normalizeClass(["desc",{"auth-success":"å·²è®¤è¯"===r.authStatus,"auth-pending":"æœªè®¤è¯"===r.authStatus}])},e.toDisplayString(l.authStatusText),3),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"item",onClick:o[4]||(o[4]=(...e)=>l.editPhone&&l.editPhone(...e))},[e.createElementVNode("text",null,"æ‰‹æœºå·"),e.createElementVNode("view",{class:"right"},[e.createElementVNode("text",{class:"desc"},e.toDisplayString(l.phoneDesc),1),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])]),e.createElementVNode("view",{class:"item"},[e.createElementVNode("text",null,"ä¿®æ”¹å¯†ç "),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})]),e.createElementVNode("view",{class:"item warn"},[e.createElementVNode("text",null,"æ³¨é”€è´¦å·"),e.createVNode(c,{type:"arrowright",size:"18",color:"#c0c4cc"})])])])}]]);const Zs=s({},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"item"},[e.createElementVNode("text",null,"ç³»ç»Ÿé€šçŸ¥"),e.createElementVNode("switch",{checked:!0,color:"#4a90e2"})]),e.createElementVNode("view",{class:"item"},[e.createElementVNode("text",null,"é¢„çº¦æé†’"),e.createElementVNode("switch",{checked:!0,color:"#4a90e2"})]),e.createElementVNode("view",{class:"item"},[e.createElementVNode("text",null,"å’¨è¯¢å›å¤"),e.createElementVNode("switch",{checked:!0,color:"#4a90e2"})]),e.createElementVNode("view",{class:"item"},[e.createElementVNode("text",null,"è¥é”€ä¸ä¼˜æƒ "),e.createElementVNode("switch",{checked:!1,color:"#4a90e2"})])]),e.createElementVNode("view",{class:"tip"},"æé†’è®¾ç½®å‚è€ƒæŠ–éŸ³æ¶ˆæ¯è®¢é˜…ï¼Œå¯éšæ—¶åœ¨ç³»ç»Ÿé€šçŸ¥ä¸­å…³é—­ã€‚")])}]]),ei=function(e,t,a){let o=Promise.resolve();return o.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))};const ti={data:()=>({addresses:[],loading:!1,errorMessage:""}),onShow(){this.loadAddresses()},methods:{async loadAddresses(){this.loading=!0,this.errorMessage="";try{const e=await Pe({url:"/address",method:"GET",showLoading:!1,showError:!1});e.success&&e.data?this.addresses=e.data.map((e=>({...e,id:e._id||e.id}))):(this.addresses=[],t("warn","at pages/settings/address/address.vue:57","è·å–åœ°å€åˆ—è¡¨å¤±è´¥:",e.message))}catch(e){t("error","at pages/settings/address/address.vue:60","è·å–åœ°å€åˆ—è¡¨å¤±è´¥:",e),this.addresses=[];try{const{getAllAddresses:e}=await ei((()=>Promise.resolve().then((()=>li)))),t=e();if(t&&t.length>0)return void(this.addresses=t)}catch(Kt){t("error","at pages/settings/address/address.vue:71","ä»æœ¬åœ°å­˜å‚¨è·å–åœ°å€ä¹Ÿå¤±è´¥:",Kt)}e.errMsg?e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?this.errorMessage="è¿æ¥æœåŠ¡å™¨è¶…æ—¶,ç‚¹å‡»å±å¹•é‡è¯•":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?this.errorMessage="è¿æ¥æœåŠ¡å™¨å¤±è´¥,ç‚¹å‡»å±å¹•é‡è¯•":this.errorMessage="åŠ è½½å¤±è´¥,ç‚¹å‡»å±å¹•é‡è¯•":this.errorMessage="åŠ è½½å¤±è´¥,ç‚¹å‡»å±å¹•é‡è¯•"}finally{this.loading=!1}},formatPhone:e=>e?11===e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"):e:"",formatAddress:e=>e.region&&e.detail?`${e.region} ${e.detail}`:e.detail||e.region||"",addAddress(){uni.navigateTo({url:"/pages/settings/address/address-edit"})},editAddress(e){uni.navigateTo({url:`/pages/settings/address/address-edit?id=${e}`})},async deleteAddress(e){uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåœ°å€å—ï¼Ÿ",success:async a=>{if(a.confirm)try{const t=await function(e){return Pe({url:`/address/${e}`,method:"DELETE",showLoading:!0,showError:!0})}(e);t.success?(uni.showToast({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.loadAddresses()):uni.showToast({title:t.message||"åˆ é™¤å¤±è´¥",icon:"none"})}catch(o){t("error","at pages/settings/address/address.vue:133","åˆ é™¤åœ°å€å¤±è´¥:",o),uni.showToast({title:"åˆ é™¤å¤±è´¥",icon:"none"})}}})}}};const ai=s(ti,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.addresses,(t=>(e.openBlock(),e.createElementBlock("view",{class:"item",key:t.id,onClick:e=>i.editAddress(t.id)},[e.createElementVNode("view",{class:"item-content"},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"phone"},e.toDisplayString(i.formatPhone(t.phone)),1),t.isDefault?(e.openBlock(),e.createElementBlock("text",{key:0,class:"default-tag"},"é»˜è®¤")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"detail"},e.toDisplayString(i.formatAddress(t)),1)]),e.createElementVNode("view",{class:"item-actions"},[e.createElementVNode("view",{class:"action-btn edit-btn",onClick:e.withModifiers((e=>i.editAddress(t.id)),["stop"])},"ç¼–è¾‘",8,["onClick"]),e.createElementVNode("view",{class:"action-btn delete-btn",onClick:e.withModifiers((e=>i.deleteAddress(t.id)),["stop"])},"åˆ é™¤",8,["onClick"])])],8,["onClick"])))),128)),s.addresses.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},"æš‚æ— åœ°å€ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ–°å¢åœ°å€"))]),e.createElementVNode("view",{class:"add-btn",onClick:a[0]||(a[0]=(...e)=>i.addAddress&&i.addAddress(...e))},"+ æ–°å¢åœ°å€")])}]]),oi="user_addresses";function ni(){try{const e=uni.getStorageSync(oi);return e?JSON.parse(e):[]}catch(e){return t("error","at utils/addressStorage.js:16","è·å–åœ°å€åˆ—è¡¨å¤±è´¥:",e),[]}}function si(e){try{const t=ni();if(e.id){const a=t.findIndex((t=>t.id===e.id));-1!==a&&(t[a]={...e,updatedAt:Date.now()})}else{const a={...e,id:`addr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:Date.now(),updatedAt:Date.now()};t.push(a)}return uni.setStorageSync(oi,JSON.stringify(t)),!0}catch(a){return t("error","at utils/addressStorage.js:51","ä¿å­˜åœ°å€å¤±è´¥:",a),!1}}function ii(e){try{return ni().find((t=>t.id===e))||null}catch(a){return t("error","at utils/addressStorage.js:64","è·å–åœ°å€å¤±è´¥:",a),null}}function ri(e){try{const t=ni();return t.forEach((t=>{t.isDefault=t.id===e})),uni.setStorageSync(oi,JSON.stringify(t)),!0}catch(a){return t("error","at utils/addressStorage.js:96","è®¾ç½®é»˜è®¤åœ°å€å¤±è´¥:",a),!1}}const li=Object.freeze(Object.defineProperty({__proto__:null,clearAllAddresses:function(){try{return uni.removeStorageSync(oi),!0}catch(e){return t("error","at utils/addressStorage.js:122","æ¸…ç©ºåœ°å€å¤±è´¥:",e),!1}},deleteAddress:function(e){try{const t=ni().filter((t=>t.id!==e));return uni.setStorageSync(oi,JSON.stringify(t)),!0}catch(a){return t("error","at utils/addressStorage.js:79","åˆ é™¤åœ°å€å¤±è´¥:",a),!1}},getAddressById:ii,getAllAddresses:ni,getDefaultAddress:function(){try{const e=ni();return e.find((e=>e.isDefault))||e[0]||null}catch(e){return t("error","at utils/addressStorage.js:109","è·å–é»˜è®¤åœ°å€å¤±è´¥:",e),null}},saveAddress:si,setDefaultAddress:ri},Symbol.toStringTag,{value:"Module"})),ci={data:()=>({formData:{name:"",phone:"",region:"",detail:"",isDefault:!1},addressId:null}),onLoad(e){e.id&&(this.addressId=e.id,this.loadAddress()),uni.setNavigationBarTitle({title:e.id?"ç¼–è¾‘åœ°å€":"æ–°å¢åœ°å€"})},onMapSelectConfirm(e){e.region&&(this.formData.region=e.region),e.detail&&(this.formData.detail=e.detail)},onShow(){const e=uni.getStorageSync("mapSelectData");e&&(e.region&&(this.formData.region=e.region),e.detail&&(this.formData.detail=e.detail),uni.removeStorageSync("mapSelectData"))},methods:{loadAddress(){const e=ii(this.addressId);e&&(this.formData={name:e.name||"",phone:e.phone||"",region:e.region||"",detail:e.detail||"",isDefault:e.isDefault||!1})},getCurrentLocation(){uni.showLoading({title:"å®šä½ä¸­...",mask:!0}),this.searchTargetLocation()},async searchTargetLocation(){try{const e=await uni.request({url:"https://restapi.amap.com/v3/place/text",method:"GET",data:{key:ke,keywords:"ä¿å®šç†å·¥å­¦é™¢",city:"ä¿å®šå¸‚",offset:1,output:"JSON"}});if(200===e.statusCode&&e.data&&"1"===e.data.status){const a=e.data.pois;if(a&&a.length>0){const e=a[0].location,[o,n]=e.split(",").map(Number);return t("log","at pages/settings/address/address-edit.vue:168","æœç´¢åˆ°ä¿å®šç†å·¥å­¦é™¢åæ ‡:",o,n),void this.reverseGeocode(o,n)}}uni.hideLoading(),this.showLocationError("æœç´¢ä¿å®šç†å·¥å­¦é™¢å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥åœ°å€")}catch(e){t("error","at pages/settings/address/address-edit.vue:179","æœç´¢ä¿å®šç†å·¥å­¦é™¢å¤±è´¥:",e),uni.hideLoading(),this.showLocationError("æœç´¢å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥åœ°å€")}},reverseGeocode(e,a){uni.request({url:Ne,method:"GET",data:{key:ke,location:`${e},${a}`,radius:500,extensions:"all",output:"JSON"},success:e=>{if(uni.hideLoading(),200===e.statusCode&&e.data){const a=e.data;if("1"===a.status&&a.regeocode){const e=a.regeocode,t=e.addressComponent;if(t){const a=t.province||"",o=t.city||"",n=t.district||"";let s="";if(a&&(s=a,o&&o!==a&&(s+=" "+o),n&&(s+=" "+n)),s){this.formData.region=s.trim();const t=String(e.formatted_address||"");if(t&&!this.formData.detail){const e=t.replace(s,"").trim();e&&(this.formData.detail=e)}uni.showToast({title:"å®šä½æˆåŠŸ",icon:"success",duration:1500})}else this.showLocationError("åœ°å€è§£æå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥")}else this.showLocationError("åœ°å€è§£æå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥")}else{const e=a.info||"åœ°å€è§£æå¤±è´¥";t("error","at pages/settings/address/address-edit.vue:249","é«˜å¾·åœ°å›¾APIé”™è¯¯:",e,a),this.showLocationError(e)}}else this.showLocationError("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")},fail:e=>{t("error","at pages/settings/address/address-edit.vue:257","é€†åœ°ç†ç¼–ç è¯·æ±‚å¤±è´¥:",e),uni.hideLoading(),this.showLocationError("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}})},openMapSelector(){uni.navigateTo({url:"/pages/settings/address/map-selector",fail:e=>{t("error","at pages/settings/address/address-edit.vue:269","æ‰“å¼€åœ°å›¾é€‰æ‹©å™¨å¤±è´¥:",e),uni.showToast({title:"æ‰“å¼€åœ°å›¾å¤±è´¥",icon:"none"})}})},showLocationError(e){uni.showModal({title:"å®šä½å¤±è´¥",content:e+"ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¾“å…¥åœ°å€",showCancel:!1,confirmText:"çŸ¥é“äº†"})},onDefaultChange(e){this.formData.isDefault=e.detail.value},validateForm(){if(!this.formData.name||""===this.formData.name.trim())return uni.showToast({title:"è¯·è¾“å…¥æ”¶è´§äººå§“å",icon:"none"}),!1;if(!this.formData.phone||""===this.formData.phone.trim())return uni.showToast({title:"è¯·è¾“å…¥æ‰‹æœºå·",icon:"none"}),!1;return/^1[3-9]\d{9}$/.test(this.formData.phone)?this.formData.region&&""!==this.formData.region.trim()?!(!this.formData.detail||""===this.formData.detail.trim())||(uni.showToast({title:"è¯·è¾“å…¥è¯¦ç»†åœ°å€",icon:"none"}),!1):(uni.showToast({title:"è¯·é€‰æ‹©æ‰€åœ¨åœ°åŒº",icon:"none"}),!1):(uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"}),!1)},saveAddress(){if(!this.validateForm())return;const e={id:this.addressId,name:this.formData.name.trim(),phone:this.formData.phone.trim(),region:this.formData.region.trim(),detail:this.formData.detail.trim(),isDefault:this.formData.isDefault};if(si(e)){const t=this.addressId?ii(this.addressId):ni().find((t=>t.name===e.name&&t.phone===e.phone&&t.region===e.region));e.isDefault&&t&&ri(t.id),uni.showToast({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:1500}),setTimeout((()=>{uni.navigateBack({delta:1})}),1500)}else uni.showToast({title:"ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}};const di=s(ci,[["render",function(t,o,n,s,r,l){const c=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"æ”¶è´§äºº"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[0]||(o[0]=e=>r.formData.name=e),placeholder:"è¯·è¾“å…¥æ”¶è´§äººå§“å",maxlength:"20"},null,512),[[e.vModelText,r.formData.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"æ‰‹æœºå·"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":o[1]||(o[1]=e=>r.formData.phone=e),type:"number",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",maxlength:"11"},null,512),[[e.vModelText,r.formData.phone]])]),e.createElementVNode("view",{class:"form-item region-input-item"},[e.createElementVNode("text",{class:"label"},"æ‰€åœ¨åœ°åŒº"),e.createElementVNode("view",{class:"region-input-wrapper"},[e.withDirectives(e.createElementVNode("input",{class:"input region-input","onUpdate:modelValue":o[2]||(o[2]=e=>r.formData.region=e),placeholder:"è¯·è¾“å…¥çœ/å¸‚/åŒºï¼Œå¦‚ï¼šåŒ—äº¬å¸‚ æœé˜³åŒº",maxlength:"50"},null,512),[[e.vModelText,r.formData.region]]),e.createElementVNode("view",{class:"location-btn",onClick:o[3]||(o[3]=(...e)=>l.getCurrentLocation&&l.getCurrentLocation(...e))},[e.createVNode(c,{type:"location",size:"18",color:"#4a90e2"})]),e.createElementVNode("view",{class:"map-btn",onClick:o[4]||(o[4]=(...e)=>l.openMapSelector&&l.openMapSelector(...e))},[e.createVNode(c,{type:"map",size:"18",color:"#4a90e2"})])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"è¯¦ç»†åœ°å€"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":o[5]||(o[5]=e=>r.formData.detail=e),placeholder:"è¡—é“ã€é—¨ç‰Œå·ç­‰è¯¦ç»†åœ°å€",maxlength:"100"},null,512),[[e.vModelText,r.formData.detail]])]),e.createElementVNode("view",{class:"form-item checkbox-item"},[e.createElementVNode("text",{class:"label"},"è®¾ä¸ºé»˜è®¤åœ°å€"),e.createElementVNode("switch",{checked:r.formData.isDefault,onChange:o[6]||(o[6]=(...e)=>l.onDefaultChange&&l.onDefaultChange(...e)),color:"#4a90e2"},null,40,["checked"])])]),e.createElementVNode("view",{class:"save-btn",onClick:o[7]||(o[7]=(...e)=>l.saveAddress&&l.saveAddress(...e))},"ä¿å­˜")])}]]),ui={data:()=>({map:null,marker:null,selectedLng:null,selectedLat:null,selectedAddress:"",searchKeyword:""}),onLoad(){uni.chooseLocation({success:e=>{uni.setStorageSync("mapSelectData",{region:e.address||"",detail:e.name||"",longitude:e.longitude,latitude:e.latitude}),uni.navigateBack()},fail:()=>{uni.navigateBack()}})},methods:{initMap(){},createMap(){},getCurrentPosition(){},onMapClick(e){const t=e.lnglat.lng,a=e.lnglat.lat;this.marker?this.marker.setPosition([t,a]):this.marker=new window.AMap.Marker({position:[t,a],map:this.map}),this.reverseGeocode(t,a)},async searchTargetLocation(){try{const e=await uni.request({url:"https://restapi.amap.com/v3/place/text",method:"GET",data:{key:ke,keywords:"ä¿å®šç†å·¥å­¦é™¢",city:"ä¿å®šå¸‚",offset:1,output:"JSON"}});if(200===e.statusCode&&e.data&&"1"===e.data.status){const a=e.data.pois;if(a&&a.length>0){const e=a[0].location,[o,n]=e.split(",").map(Number);return t("log","at pages/settings/address/map-selector.vue:201","æœç´¢åˆ°ä¿å®šç†å·¥å­¦é™¢åæ ‡:",o,n),this.map.setCenter([o,n]),this.map.setZoom(16),this.marker?this.marker.setPosition([o,n]):this.marker=new window.AMap.Marker({position:[o,n],map:this.map}),uni.hideLoading(),this.reverseGeocode(o,n),!0}}return!1}catch(e){return t("error","at pages/settings/address/map-selector.vue:225","æœç´¢ä¿å®šç†å·¥å­¦é™¢å¤±è´¥:",e),uni.hideLoading(),!1}},reverseGeocode(e,a){this.selectedLng=e,this.selectedLat=a,uni.request({url:Ne,method:"GET",data:{key:ke,location:`${e},${a}`,radius:500,extensions:"all",output:"JSON"},success:async e=>{if(200===e.statusCode&&e.data&&"1"===e.data.status){const a=e.data.regeocode,o=a.addressComponent,n=o?o.district:"";if(n&&!n.includes("è²æ± åŒº")){t("log","at pages/settings/address/map-selector.vue:253","å®šä½åˆ°çš„åŒºåŸŸä¸æ˜¯è²æ± åŒºï¼Œå°è¯•æœç´¢ä¿å®šç†å·¥å­¦é™¢");if(await this.searchTargetLocation())return}this.selectedAddress=a.formatted_address||""}},fail:e=>{t("error","at pages/settings/address/map-selector.vue:264","é€†åœ°ç†ç¼–ç å¤±è´¥:",e),uni.hideLoading()}})},searchLocation(){this.searchKeyword.trim()||uni.showToast({title:"è¯·è¾“å…¥æœç´¢å…³é”®è¯",icon:"none"})},confirm(){this.selectedLng&&this.selectedLat?uni.request({url:Ne,method:"GET",data:{key:ke,location:`${this.selectedLng},${this.selectedLat}`,radius:500,extensions:"all",output:"JSON"},success:e=>{if(200===e.statusCode&&e.data&&"1"===e.data.status){const t=e.data.regeocode,a=t.addressComponent,o=a.province||"",n=a.city||"",s=a.district||"";let i="";o&&(i=o,n&&n!==o&&(i+=" "+n),s&&(i+=" "+s)),uni.setStorageSync("mapSelectData",{region:i.trim(),detail:t.formatted_address||"",longitude:this.selectedLng,latitude:this.selectedLat}),uni.navigateBack()}}}):uni.showToast({title:"è¯·é€‰æ‹©ä½ç½®",icon:"none"})},cancel(){uni.navigateBack()}}};const mi=s(ui,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"map-selector-page"},[e.createElementVNode("view",{class:"map-container",id:"map-container"}),e.createElementVNode("view",{class:"search-bar"},[e.withDirectives(e.createElementVNode("input",{class:"search-input","onUpdate:modelValue":a[0]||(a[0]=e=>s.searchKeyword=e),placeholder:"æœç´¢åœ°ç‚¹",onConfirm:a[1]||(a[1]=(...e)=>i.searchLocation&&i.searchLocation(...e))},null,544),[[e.vModelText,s.searchKeyword]]),e.createElementVNode("view",{class:"search-btn",onClick:a[2]||(a[2]=(...e)=>i.searchLocation&&i.searchLocation(...e))},"æœç´¢")]),e.createElementVNode("view",{class:"bottom-bar"},[e.createElementVNode("view",{class:"address-info"},[e.createElementVNode("text",{class:"address-text"},e.toDisplayString(s.selectedAddress||"è¯·åœ¨åœ°å›¾ä¸Šé€‰æ‹©ä½ç½®"),1)]),e.createElementVNode("view",{class:"action-btns"},[e.createElementVNode("view",{class:"btn cancel-btn",onClick:a[3]||(a[3]=(...e)=>i.cancel&&i.cancel(...e))},"å–æ¶ˆ"),e.createElementVNode("view",{class:"btn confirm-btn",onClick:a[4]||(a[4]=(...e)=>i.confirm&&i.confirm(...e))},"ç¡®è®¤")])])])}],["__scopeId","data-v-f314d313"]]);const pi=s({},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"åŠŸèƒ½ä»‹ç»"),e.createElementVNode("view",{class:"paragraph"}," å‚è€ƒæŠ–éŸ³çš„è½»é‡åŒ–ä¿¡æ¯æµè®¾è®¡ï¼Œæˆ‘ä»¬æä¾›é¢„çº¦æŒ‚å·ã€åœ¨çº¿å’¨è¯¢ã€å°±è¯Šäººç®¡ç†ã€æ¶ˆæ¯é€šçŸ¥ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œè®©åŒ»ç–—æœåŠ¡åƒåˆ·çŸ­è§†é¢‘ä¸€æ ·ä¾¿æ·ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," æ”¯æŒå¿«é€Ÿæœç´¢åŒ»é™¢/åŒ»ç”Ÿã€æ¶ˆæ¯å³æ—¶æé†’ã€è®¢å•è¯„ä»·ä¸æ”¶è—ï¼Œå¤šç«¯åŒæ­¥æ•°æ®ï¼Œä¿æŒç™»å½•çŠ¶æ€ä¸‹çš„æŒç»­ä½“éªŒã€‚ ")])])}]]);const hi=s({},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"æ³•å¾‹å£°æ˜"),e.createElementVNode("view",{class:"paragraph"}," æœ¬åº”ç”¨éµå¾ªæŠ–éŸ³å¹³å°æƒ¯ä¾‹ï¼Œå°Šé‡å¹¶ä¿æŠ¤ç”¨æˆ·çš„åˆæ³•æƒç›Šã€‚ç”¨æˆ·ä¸å¾—åˆ©ç”¨æœ¬åº”ç”¨ä»äº‹ä¾µæƒã€è¿æ³•ã€è¿ç¦å†…å®¹çš„ä¼ æ’­ã€‚è‹¥å‘ç°è¿è§„å†…å®¹ï¼Œæˆ‘ä»¬å°†é…åˆå¹³å°è¿›è¡Œå¤„ç†ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," æ‰€æœ‰å±•ç¤ºçš„ç´ æã€æ–‡å­—ã€æ¥å£æ•°æ®å‡ä»…ä¾›ä¸ªäººä½¿ç”¨ï¼Œä¸å¾—æœªç»æˆæƒç”¨äºå•†ä¸šç”¨é€”ã€‚å¦‚éœ€å•†ä¸šåˆä½œï¼Œè¯·å…ˆå–å¾—ä¹¦é¢è®¸å¯ã€‚ ")])])}]]);const gi=s({},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"ç”¨æˆ·æœåŠ¡åè®®"),e.createElementVNode("view",{class:"paragraph"}," 1. è´¦å·ä¸å®‰å…¨ï¼šè¯·ä½¿ç”¨æœ¬äººæ‰‹æœºå·/ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•ï¼Œè´¦å·ä»…é™æœ¬äººä½¿ç”¨ï¼Œå¦¥å–„ä¿ç®¡å¯†ç ä¸éªŒè¯ç ï¼Œå‘ç°å¼‚å¸¸åŠæ—¶ä¿®æ”¹æˆ–æ³¨é”€ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," 2. å†…å®¹è§„èŒƒï¼šå‘å¸ƒå’¨è¯¢ã€è¯„ä»·æˆ–ç•™è¨€åº”éµå®ˆå¹³å°è§„åˆ™ï¼Œä¸å¾—å«æœ‰è¿æ³•ã€ä¾µæƒã€è™šå‡æˆ–ä¸å½“ä¿¡æ¯ã€‚å‚è€ƒæŠ–éŸ³ç¤¾åŒºå…¬çº¦ä¿æŒå‹å–„äº¤æµã€‚ "),e.createElementVNode("view",{class:"paragraph"}," 3. æœåŠ¡ä¸è´¹ç”¨ï¼šéƒ¨åˆ†å¢å€¼åŠŸèƒ½å¯èƒ½æ”¶å–è´¹ç”¨ï¼Œå…·ä½“ä»¥é¡µé¢å±•ç¤ºæˆ–è®¢å•è¯´æ˜ä¸ºå‡†ã€‚æäº¤å‰è¯·ä»”ç»†ç¡®è®¤ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," 4. æ•°æ®ä¸éšç§ï¼šæˆ‘ä»¬ä¾æ®éšç§æ”¿ç­–æ”¶é›†å’Œä½¿ç”¨å¿…è¦æ•°æ®ï¼Œç”¨äºæä¾›åŒ»ç–—å’¨è¯¢ã€é¢„çº¦ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæœªç»æˆæƒä¸ä¼šå‘æ— å…³æ–¹æŠ«éœ²ã€‚ ")])])}]]);const vi=s({data:()=>({}),methods:{}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"éšç§æ”¿ç­–"),e.createElementVNode("view",{class:"paragraph"}," æˆ‘ä»¬å‚è€ƒæŠ–éŸ³çš„æƒé™ä¸ä¿¡æ¯æœ€å°åŒ–åŸåˆ™ï¼Œä»…æ”¶é›†æä¾›é¢„çº¦ã€å’¨è¯¢ã€æ¶ˆæ¯é€šçŸ¥æ‰€éœ€çš„æ•°æ®ï¼Œä¾‹å¦‚è´¦å·ä¿¡æ¯ã€è®¾å¤‡æ ‡è¯†ã€æ“ä½œæ—¥å¿—ç­‰ï¼Œå¹¶ç”¨äºå®‰å…¨é£æ§ä¸æœåŠ¡ä½“éªŒä¼˜åŒ–ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," ä½ç½®ã€ç›¸å†Œã€ç›¸æœºã€éº¦å…‹é£ç­‰æ•æ„Ÿæƒé™ä»…åœ¨ç”¨æˆ·æˆæƒä¸”ä¸åŠŸèƒ½ç›¸å…³æ—¶æ‰ä¼šè°ƒç”¨ï¼Œå¯åœ¨ç³»ç»Ÿæˆ–æœ¬é¡µéšæ—¶å…³é—­ã€‚ "),e.createElementVNode("view",{class:"paragraph"}," æ‚¨å¯é€šè¿‡è´¦å·è®¾ç½®æŸ¥çœ‹ã€å¯¼å‡ºæˆ–æ³¨é”€è´¦å·ï¼Œæ³¨é”€åæ•°æ®å°†æŒ‰æ³•è§„è¦æ±‚è¿›è¡Œåˆ é™¤æˆ–åŒ¿ååŒ–å¤„ç†ã€‚ ")])])}]]);function fi(e,a){return new Promise(((o,n)=>{const s=ee(),i={};s&&(i.Authorization=`Bearer ${s}`),t("log","at api/idcard.js:20","ğŸ“¤ å¼€å§‹ä¸Šä¼ å›¾ç‰‡è¿›è¡ŒOCRè¯†åˆ«..."),uni.uploadFile({url:`${j}/idcard/ocr-recognize`,filePath:e,name:"frontImage",header:i,timeout:3e4,success:e=>{try{const s="string"==typeof e.data?JSON.parse(e.data):e.data;if(!1===s.success&&!s.partial)return void n(new Error(s.message||"OCRè¯†åˆ«å¤±è´¥"));a?uni.uploadFile({url:`${j}/idcard/ocr-recognize`,filePath:a,name:"backImage",formData:{frontImageId:s.frontImageId||""},header:i,timeout:3e4,success:e=>{var a,n,i;try{const r="string"==typeof e.data?JSON.parse(e.data):e.data;if(r.success){const e={...s,data:{...s.data,issueDate:(null==(a=r.data)?void 0:a.issueDate)||"",expiryDate:(null==(n=r.data)?void 0:n.expiryDate)||"",issueAuthority:(null==(i=r.data)?void 0:i.issueAuthority)||""},backImageId:r.backImageId||s.backImageId};t("log","at api/idcard.js:67","âœ… OCRè¯†åˆ«æˆåŠŸï¼ˆåŒ…å«åé¢ï¼‰:",e.data),o(e)}else t("log","at api/idcard.js:71","âš ï¸ åé¢è¯†åˆ«å¤±è´¥ï¼Œä½†æ­£é¢è¯†åˆ«æˆåŠŸ"),o(s)}catch(Kt){t("error","at api/idcard.js:75","è§£æåé¢OCRè¯†åˆ«å“åº”å¤±è´¥:",Kt),o(s)}},fail:e=>{t("warn","at api/idcard.js:81","ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥ï¼Œä½†æ­£é¢è¯†åˆ«æˆåŠŸ:",e),o(s)}}):(t("log","at api/idcard.js:88","âœ… OCRè¯†åˆ«æˆåŠŸ:",s.data),o(s))}catch(Kt){t("error","at api/idcard.js:92","è§£æOCRè¯†åˆ«å“åº”å¤±è´¥:",Kt),n(new Error("è§£æOCRè¯†åˆ«å“åº”å¤±è´¥"))}},fail:e=>{t("error","at api/idcard.js:97","OCRè¯†åˆ«è¯·æ±‚å¤±è´¥:",e);let a="OCRè¯†åˆ«è¯·æ±‚å¤±è´¥";a=e.errMsg?e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`OCRè¯†åˆ«è¯·æ±‚å¤±è´¥: ${e.errMsg}`:"OCRè¯†åˆ«è¯·æ±‚å¤±è´¥: ç½‘ç»œé”™è¯¯",n(new Error(a))}})}))}const wi={data:()=>({realname:"",idCard:"",authed:!1,loading:!1,ocrRecognizing:!1,ocrResult:null,frontImageId:null,backImageId:null,username:"",avatarUrl:"/static/logo.png",idCardFront:"",idCardBack:"",idCardFrontPath:"",idCardBackPath:"",faceImageFile:null,isUserInputting:!1,showCameraModal:!1,cameraStream:null,cameraVideo:null,cameraCanvas:null,cameraCanvasCtx:null,cameraAnimationFrame:null,cameraResolve:null,cameraReject:null,isCapturing:!1,cameraResizeObserver:null,errorMessage:""}),onLoad(){this.checkAuthStatusSync()},onShow(){if(this.isUserInputting||this.loading||this.ocrRecognizing)return void t("log","at pages/settings/realname/realname.vue:260","â„¹ï¸ ç”¨æˆ·æ­£åœ¨æ“ä½œä¸­ï¼Œè·³è¿‡è®¤è¯çŠ¶æ€æ£€æŸ¥ï¼Œé¿å…æ¸…ç©ºè¾“å…¥æ¡†");if(this.realname&&this.realname.trim()||this.idCard&&this.idCard.trim()||this.idCardFront||this.idCardBack)return void t("log","at pages/settings/realname/realname.vue:269","â„¹ï¸ æ£€æµ‹åˆ°ç”¨æˆ·è¾“å…¥å†…å®¹ï¼Œè·³è¿‡è®¤è¯çŠ¶æ€æ£€æŸ¥ï¼Œé¿å…æ¸…ç©ºè¾“å…¥æ¡†");this.checkAuthStatusSync();uni.getStorageSync("token")||uni.getStorageSync("sso_token")?this.fetchUserInfoFromBackend():this.loadLocalProfile()},computed:{idCardMasked(){return this.idCard?this.idCard.charAt(0)+"*".repeat(this.idCard.length-2)+this.idCard.charAt(this.idCard.length-1):""},realnameMasked(){return this.realname?1===this.realname.length?"*":2===this.realname.length?"*"+this.realname.slice(-1):"*".repeat(this.realname.length-1)+this.realname.slice(-1):""}},methods:{onInputFocus(){this.isUserInputting=!0,t("log","at pages/settings/realname/realname.vue:304","ğŸ“ ç”¨æˆ·å¼€å§‹è¾“å…¥ï¼Œè®¾ç½®isUserInputting=true")},onInputBlur(){setTimeout((()=>{this.loading||this.ocrRecognizing||(this.isUserInputting=!1,t("log","at pages/settings/realname/realname.vue:312","ğŸ“ ç”¨æˆ·è¾“å…¥ç»“æŸï¼Œæ¸…é™¤isUserInputtingæ ‡è®°"))}),500)},onRealnameInput(e){this.isUserInputting=!0,this.realname=e.detail.value||e.target.value||""},onIdCardInput(e){this.isUserInputting=!0,this.idCard=e.detail.value||e.target.value||""},checkAuthStatusSync(){var e;const a=getApp();try{const o=(null==(e=a.globalData)?void 0:e.userInfo)||uni.getStorageSync("userInfo")||{},n=o.authStatus;let s={};try{s=uni.getStorageSync("userProfile")||{}}catch(Kt){t("warn","at pages/settings/realname/realname.vue:340","è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:",Kt)}s&&0!==Object.keys(s).length||(s=a.globalData&&a.globalData.userProfile||{});"å·²è®¤è¯"===n||s.realname&&"å·²è®¤è¯"===s.authStatus?(this.realname=o.realname||s.realname||"",this.idCard=o.idCard||s.idCard||"",this.authed=!0,this.username=o.username||o.nickname||s.nickname||"ç”¨æˆ·",this.avatarUrl=o.avatarUrl||s.avatarUrl||"/static/logo.png"):(this.isUserInputting||this.realname||this.idCard||this.idCardFront||this.idCardBack||(this.realname="",this.idCard=""),this.authed=!1,this.username=o.username||o.nickname||s.nickname||"ç”¨æˆ·",this.avatarUrl=o.avatarUrl||s.avatarUrl||"/static/logo.png")}catch(Kt){t("error","at pages/settings/realname/realname.vue:370","âŒ åŒæ­¥æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥:",Kt),this.authed=!1}},async fetchUserInfoFromBackend(){const e=getApp();this.errorMessage="";try{if(!(uni.getStorageSync("token")||uni.getStorageSync("sso_token")))return t("log","at pages/settings/realname/realname.vue:383","â„¹ï¸ æœªç™»å½•ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®"),void this.loadLocalProfile();const{request:a}=await ei((()=>Promise.resolve().then((()=>Ae)))),o=await a({url:"/auth/me",method:"GET",showLoading:!1,showError:!1});if(o.success&&o.user){const t=o.user;if(e.globalData.userInfo=t,uni.setStorageSync("userInfo",t),"å·²è®¤è¯"===t.authStatus&&t.realname){this.realname=t.realname,this.idCard=t.idCard||"",this.authed=!0;const a={realname:t.realname,idCard:t.idCard,authStatus:"å·²è®¤è¯"};e.globalData.userProfile=a,uni.setStorageSync("userProfile",a)}else{this.isUserInputting||this.realname||this.idCard||this.idCardFront||this.idCardBack||(this.realname="",this.idCard=""),this.authed=!1;const t={realname:this.realname||"",idCard:this.idCard||"",authStatus:"æœªè®¤è¯"};e.globalData.userProfile=t,uni.setStorageSync("userProfile",t)}this.username=t.username||t.nickname||"ç”¨æˆ·",this.avatarUrl=t.avatarUrl||"/static/logo.png"}else t("warn","at pages/settings/realname/realname.vue:439","âš ï¸ åç«¯è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®"),this.loadLocalProfile()}catch(a){if(t("error","at pages/settings/realname/realname.vue:443","âŒ ä»åç«¯è·å–ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸:",a),a.message&&(a.message.includes("401")||a.message.includes("æœªæä¾›è®¤è¯ä»¤ç‰Œ")||a.message.includes("æœªæˆæƒ")))return t("log","at pages/settings/realname/realname.vue:447","â„¹ï¸ Tokenæ— æ•ˆæˆ–æœªæˆæƒï¼Œæ¸…é™¤tokenå¹¶ä½¿ç”¨æœ¬åœ°æ•°æ®"),uni.removeStorageSync("token"),uni.removeStorageSync("sso_token"),void this.loadLocalProfile();if(!1===a.success||a.message&&!a.errMsg)return t("log","at pages/settings/realname/realname.vue:456","â„¹ï¸ ä¸šåŠ¡é”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®"),void this.loadLocalProfile();if(!a.errMsg)return t("log","at pages/settings/realname/realname.vue:481","â„¹ï¸ æœªçŸ¥é”™è¯¯ç±»å‹ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®"),void this.loadLocalProfile();if(a.errMsg.includes("timeout")||a.errMsg.includes("è¶…æ—¶")){const{API_BASE_URL:e}=await ei((()=>Promise.resolve().then((()=>H)))),t=e.replace("/api","");this.errorMessage=`è¿æ¥æœåŠ¡å™¨è¶…æ—¶\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ\n   åœ°å€ï¼š${t}\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n\nç‚¹å‡»å±å¹•é‡è¯•`}else{if(!a.errMsg.includes("fail")||a.errMsg.includes("401"))return t("log","at pages/settings/realname/realname.vue:475","â„¹ï¸ å…¶ä»–é”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®"),void this.loadLocalProfile();{const{API_BASE_URL:e}=await ei((()=>Promise.resolve().then((()=>H)))),t=e.replace("/api","");this.errorMessage=`è¿æ¥æœåŠ¡å™¨å¤±è´¥\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n   åœ°å€ï¼š${t}\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n\nç‚¹å‡»å±å¹•é‡è¯•`}}this.loadLocalProfile()}},retryLoad(){this.errorMessage="",this.fetchUserInfoFromBackend()},loadLocalProfile(){const e=getApp();let a={};try{a=uni.getStorageSync("userProfile")||{}}catch(Kt){t("warn","at pages/settings/realname/realname.vue:502","è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:",Kt)}a&&0!==Object.keys(a).length||(a=e.globalData&&e.globalData.userProfile||{});const o=e.globalData.userInfo||uni.getStorageSync("userInfo")||{};"å·²è®¤è¯"===o.authStatus||a.realname&&"å·²è®¤è¯"===a.authStatus?(this.realname=o.realname||a.realname||"",this.idCard=o.idCard||a.idCard||"",this.authed=!0):(this.realname="",this.idCard="",this.authed=!1),this.username=o.username||o.nickname||a.nickname||"ç”¨æˆ·",this.avatarUrl=o.avatarUrl||a.avatarUrl||this.avatarUrl||"/static/logo.png",t("log","at pages/settings/realname/realname.vue:532","ğŸ“‹ å®åè®¤è¯é¡µé¢å·²åŠ è½½æœ¬åœ°èµ„æ–™:",{authed:this.authed,realname:this.realname?"å·²è®¾ç½®":"æœªè®¾ç½®"})},async chooseIdCardImage(e){this.isUserInputting=!0,uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera","album"],success:async a=>{const o=a.tempFilePaths[0];"front"===e?(this.idCardFront=o,this.idCardFrontPath=o,this.ocrResult=null,this.frontImageId=null,t("log","at pages/settings/realname/realname.vue:557","ğŸ“¸ å·²é€‰æ‹©èº«ä»½è¯æ­£é¢å›¾ç‰‡ï¼Œå¼€å§‹OCRè¯†åˆ«..."),await this.performOCRForImage("front",o)):(this.idCardBack=o,this.idCardBackPath=o,t("log","at pages/settings/realname/realname.vue:563","ğŸ“¸ å·²é€‰æ‹©èº«ä»½è¯åé¢å›¾ç‰‡ï¼Œå¼€å§‹ä¸Šä¼ ï¼ˆä»…éªŒè¯çœŸå®æ€§ï¼Œä¸è¯†åˆ«ï¼‰..."),await this.uploadBackImageOnly(o)),setTimeout((()=>{this.loading||this.ocrRecognizing||(this.isUserInputting=!1)}),1e3)},fail:e=>{e.errMsg&&e.errMsg.includes("cancel")?t("log","at pages/settings/realname/realname.vue:576","ç”¨æˆ·å–æ¶ˆé€‰æ‹©å›¾ç‰‡"):(t("error","at pages/settings/realname/realname.vue:579","é€‰æ‹©å›¾ç‰‡å¤±è´¥:",e),e.errMsg&&e.errMsg.includes("cancel")||uni.showToast({title:"é€‰æ‹©å›¾ç‰‡å¤±è´¥",icon:"none"}))}})},async performOCRForImage(e,a){if(a){try{const e=await new Promise((e=>{uni.getNetworkType({success:a=>{t("log","at pages/settings/realname/realname.vue:600","ğŸ“¶ å½“å‰ç½‘ç»œç±»å‹:",a.networkType),e(a.networkType)},fail:()=>{t("warn","at pages/settings/realname/realname.vue:604","âš ï¸ æ— æ³•è·å–ç½‘ç»œçŠ¶æ€"),e("unknown")}})}));if("none"===e)return uni.hideLoading(),void uni.showModal({title:"ç½‘ç»œæœªè¿æ¥",content:"è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"});"2g"===e&&t("warn","at pages/settings/realname/realname.vue:623","âš ï¸ å½“å‰ä¸º2Gç½‘ç»œï¼Œä¸Šä¼ å¯èƒ½è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…")}catch(Kt){t("warn","at pages/settings/realname/realname.vue:626","âš ï¸ æ— æ³•æ£€æµ‹ç½‘ç»œçŠ¶æ€:",Kt)}this.ocrRecognizing=!0;try{this.isUserInputting=!0,t("log","at pages/settings/realname/realname.vue:635",`ğŸ” å¼€å§‹OCRè¯†åˆ«èº«ä»½è¯${"front"===e?"æ­£é¢":"åé¢"}...`),t("log","at pages/settings/realname/realname.vue:636",`ğŸ“¸ å›¾ç‰‡è·¯å¾„: ${a}`),uni.showLoading({title:"æ­£åœ¨è¯†åˆ«ï¼Œè¯·ç¨å€™...",mask:!0});const o="front"===e?a:this.idCardFrontPath;t("log","at pages/settings/realname/realname.vue:647",`ğŸ“¤ è°ƒç”¨OCRè¯†åˆ«æ¥å£ï¼Œæ­£é¢è·¯å¾„: ${o||"ç©º"}`);const n=fi(o||"",""),s=new Promise(((e,t)=>{setTimeout((()=>{t(new Error("è¯†åˆ«è¶…æ—¶ï¼Œè¯·é‡è¯•"))}),25e3)})),i=await Promise.race([n,s]);if(i.isNotIdCard||!i.success&&void 0!==i.isNotIdCard)return t("warn","at pages/settings/realname/realname.vue:661","âš ï¸ ä¸Šä¼ çš„å›¾ç‰‡ä¸æ˜¯èº«ä»½è¯:",i.reason||i.message),uni.hideLoading(),uni.showModal({title:"å›¾ç‰‡éªŒè¯å¤±è´¥",content:i.message||"ä¸Šä¼ çš„å›¾ç‰‡ä¸æ˜¯æœ‰æ•ˆçš„èº«ä»½è¯ç…§ç‰‡ï¼Œè¯·é‡æ–°ä¸Šä¼ æ¸…æ™°çš„èº«ä»½è¯æ­£é¢æˆ–åé¢ç…§ç‰‡",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"}),void("front"===e?(this.idCardFront="",this.idCardFrontPath="",this.frontImageId=null,this.ocrResult=null):(this.idCardBack="",this.idCardBackPath="",this.backImageId=null));if(i.success&&i.data){t("log","at pages/settings/realname/realname.vue:687","ğŸ“‹ OCRè¯†åˆ«è¿”å›æ•°æ®:",JSON.stringify(i.data,null,2)),t("log","at pages/settings/realname/realname.vue:688","ğŸ“‹ å®Œæ•´å“åº”:",JSON.stringify(i,null,2));const a=i.data.name&&""!==i.data.name.trim(),o=i.data.idNumber&&""!==i.data.idNumber.trim();if(t("log","at pages/settings/realname/realname.vue:694","ğŸ“‹ æ£€æŸ¥ç»“æœ - å§“å:",a?i.data.name:"ç©º"),t("log","at pages/settings/realname/realname.vue:695","ğŸ“‹ æ£€æŸ¥ç»“æœ - èº«ä»½è¯å·:",o?i.data.idNumber:"ç©º"),!a&&!o)return i.requiresManualInput||i.partial?(t("log","at pages/settings/realname/realname.vue:701","â„¹ï¸ OCRè¯†åˆ«æœªæå–åˆ°ä¿¡æ¯ï¼Œå…è®¸æ‰‹åŠ¨è¾“å…¥"),uni.hideLoading(),void uni.showToast({title:"è¯†åˆ«æœªæˆåŠŸï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯",icon:"none",duration:2e3})):(t("warn","at pages/settings/realname/realname.vue:711","âš ï¸ OCRè¯†åˆ«ç»“æœä¸ºç©ºï¼Œä¸æ˜¯èº«ä»½è¯"),uni.hideLoading(),uni.showModal({title:"å›¾ç‰‡éªŒè¯å¤±è´¥",content:"æœªè¯†åˆ«åˆ°èº«ä»½è¯ä¿¡æ¯ï¼Œè¯·ç¡®ä¿ä¸Šä¼ çš„æ˜¯æ¸…æ™°çš„èº«ä»½è¯æ­£é¢ç…§ç‰‡",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"}),void("front"===e?(this.idCardFront="",this.idCardFrontPath="",this.frontImageId=null,this.ocrResult=null):(this.idCardBack="",this.idCardBackPath="",this.backImageId=null)));this.ocrResult=i.data,this.frontImageId=i.frontImageId||this.frontImageId,this.backImageId=i.backImageId||this.backImageId,a&&(this.realname=i.data.name,t("log","at pages/settings/realname/realname.vue:744","âœ… å·²è‡ªåŠ¨å¡«å……å§“å:",i.data.name)),o&&(this.idCard=i.data.idNumber,t("log","at pages/settings/realname/realname.vue:748","âœ… å·²è‡ªåŠ¨å¡«å……èº«ä»½è¯å·:",i.data.idNumber)),uni.hideLoading(),!i.partial&&a&&o?(t("log","at pages/settings/realname/realname.vue:764","âœ… OCRè¯†åˆ«æˆåŠŸ:",i.data),uni.showToast({title:"è¯†åˆ«æˆåŠŸï¼Œä¿¡æ¯å·²è‡ªåŠ¨å¡«å……",icon:"success",duration:2e3})):(t("log","at pages/settings/realname/realname.vue:756","â„¹ï¸ OCRéƒ¨åˆ†è¯†åˆ«ï¼Œå·²å¡«å……å¯ç”¨ä¿¡æ¯:",i.data),uni.showToast({title:"è¯†åˆ«éƒ¨åˆ†æˆåŠŸï¼Œè¯·è¡¥å……ç¼ºå¤±ä¿¡æ¯",icon:"none",duration:2e3}))}else t("log","at pages/settings/realname/realname.vue:773","â„¹ï¸ OCRè¯†åˆ«æœªè¿”å›æ•°æ®ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥"),uni.hideLoading(),uni.showToast({title:"è¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯",icon:"none",duration:2e3})}catch(o){t("error","at pages/settings/realname/realname.vue:783","âŒ OCRè¯†åˆ«å¤±è´¥:",o),uni.hideLoading();let e="è¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯";o.message&&(e=o.message.includes("timeout")||o.message.includes("è¶…æ—¶")?"è¯†åˆ«è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•":o.message.includes("ç½‘ç»œ")?"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•":`è¯†åˆ«å¤±è´¥: ${o.message}`),uni.showToast({title:e,icon:"none",duration:3e3})}finally{this.ocrRecognizing=!1,setTimeout((()=>{this.loading||(this.isUserInputting=!1)}),500)}}else t("warn","at pages/settings/realname/realname.vue:591","âš ï¸ å›¾ç‰‡è·¯å¾„ä¸ºç©ºï¼Œæ— æ³•è¿›è¡ŒOCRè¯†åˆ«")},async performOCR(){if(this.idCardFrontPath){this.ocrRecognizing=!0,this.ocrResult=null;try{t("log","at pages/settings/realname/realname.vue:823","ğŸ” å¼€å§‹OCRè¯†åˆ«..."),uni.showLoading({title:"è¯†åˆ«ä¸­...",mask:!0});const e=await fi(this.idCardFrontPath,this.idCardBackPath);e.success&&e.data?(this.ocrResult=e.data,this.frontImageId=e.frontImageId,this.backImageId=e.backImageId,e.data.name&&(this.realname=e.data.name,t("log","at pages/settings/realname/realname.vue:837","âœ… å·²å¡«å……å§“å:",e.data.name)),e.data.idNumber&&(this.idCard=e.data.idNumber,t("log","at pages/settings/realname/realname.vue:841","âœ… å·²å¡«å……èº«ä»½è¯å·:",e.data.idNumber)),uni.hideLoading(),e.partial?(t("log","at pages/settings/realname/realname.vue:849","â„¹ï¸ OCRéƒ¨åˆ†è¯†åˆ«ï¼Œå·²å¡«å……å¯ç”¨ä¿¡æ¯:",e.data),uni.showToast({title:"è¯†åˆ«éƒ¨åˆ†æˆåŠŸï¼Œè¯·è¡¥å……ç¼ºå¤±ä¿¡æ¯",icon:"none",duration:2e3})):(t("log","at pages/settings/realname/realname.vue:857","âœ… OCRè¯†åˆ«æˆåŠŸ:",e.data),uni.showToast({title:"è¯†åˆ«æˆåŠŸ",icon:"success",duration:1500}))):(t("log","at pages/settings/realname/realname.vue:863","â„¹ï¸ OCRè¯†åˆ«æœªè¿”å›æ•°æ®ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥"),uni.hideLoading())}catch(e){t("log","at pages/settings/realname/realname.vue:869","â„¹ï¸ OCRè¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥:",e.message),uni.hideLoading()}finally{this.ocrRecognizing=!1,setTimeout((()=>{this.loading||(this.isUserInputting=!1)}),500)}}},async uploadBackImageOnly(e){if(e){try{const e=await new Promise((e=>{uni.getNetworkType({success:a=>{t("log","at pages/settings/realname/realname.vue:894","ğŸ“¶ å½“å‰ç½‘ç»œç±»å‹:",a.networkType),e(a.networkType)},fail:()=>{t("warn","at pages/settings/realname/realname.vue:898","âš ï¸ æ— æ³•è·å–ç½‘ç»œçŠ¶æ€"),e("unknown")}})}));if("none"===e)return void uni.showModal({title:"ç½‘ç»œæœªè¿æ¥",content:"è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"});"2g"===e&&t("warn","at pages/settings/realname/realname.vue:916","âš ï¸ å½“å‰ä¸º2Gç½‘ç»œï¼Œä¸Šä¼ å¯èƒ½è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…")}catch(Kt){t("warn","at pages/settings/realname/realname.vue:919","âš ï¸ æ— æ³•æ£€æµ‹ç½‘ç»œçŠ¶æ€:",Kt)}try{this.isUserInputting=!0,t("log","at pages/settings/realname/realname.vue:926","ğŸ“¤ å¼€å§‹ä¸Šä¼ èº«ä»½è¯åé¢å›¾ç‰‡ï¼ˆä»…éªŒè¯çœŸå®æ€§ï¼‰..."),t("log","at pages/settings/realname/realname.vue:927",`ğŸ“¸ åé¢å›¾ç‰‡è·¯å¾„: ${e}`),uni.showLoading({title:"æ­£åœ¨ä¸Šä¼ ...",mask:!0});const a=ee(),o={};a&&(o.Authorization=`Bearer ${a}`),await new Promise(((a,n)=>{uni.uploadFile({url:`${j}/idcard/upload-back`,filePath:e,name:"backImage",header:o,timeout:3e4,success:e=>{try{const o="string"==typeof e.data?JSON.parse(e.data):e.data;if(!o.success||!o.imageId)throw new Error(o.message||"ä¸Šä¼ å¤±è´¥");this.backImageId=o.imageId,t("log","at pages/settings/realname/realname.vue:951","âœ… åé¢å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒimageId:",o.imageId),uni.hideLoading(),uni.showToast({title:"ä¸Šä¼ æˆåŠŸ",icon:"success",duration:1500}),a()}catch(Kt){t("error","at pages/settings/realname/realname.vue:963","è§£æåé¢å›¾ç‰‡ä¸Šä¼ å“åº”å¤±è´¥:",Kt),uni.hideLoading(),uni.showToast({title:"ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3}),n(Kt)}},fail:e=>{t("error","at pages/settings/realname/realname.vue:974","ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥:",e),uni.hideLoading();let a="ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•";e.errMsg&&(a=e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`ä¸Šä¼ å¤±è´¥: ${e.errMsg}`),uni.showToast({title:a,icon:"none",duration:3e3}),n(new Error(a))}})}))}catch(a){t("error","at pages/settings/realname/realname.vue:996","ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥:",a),uni.hideLoading()}finally{setTimeout((()=>{this.loading||this.ocrRecognizing||(this.isUserInputting=!1)}),500)}}else t("warn","at pages/settings/realname/realname.vue:885","âš ï¸ åé¢å›¾ç‰‡è·¯å¾„ä¸ºç©ºï¼Œæ— æ³•ä¸Šä¼ ")},removeIdCardImage(e){"front"===e?(this.idCardFront="",this.idCardFrontPath="",this.frontImageId=null,this.ocrResult=null):(this.idCardBack="",this.idCardBackPath="",this.backImageId=null)},async autoVerify(){if(this.loading)return;if(!this.realname||!this.idCard||!this.frontImageId)return void t("warn","at pages/settings/realname/realname.vue:1031","âš ï¸ è‡ªåŠ¨è®¤è¯æ¡ä»¶ä¸æ»¡è¶³ï¼Œç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨æäº¤");const e=this.idCard.trim().toUpperCase();if(/^[1-9]\d{16}[\dXx]$/.test(e)){t("log","at pages/settings/realname/realname.vue:1042","ğŸš€ å¼€å§‹è‡ªåŠ¨è®¤è¯..."),this.loading=!0;try{const l=await(a=this.realname.trim(),o=e,n="",s="",i=this.frontImageId,r=this.backImageId,new Promise(((e,l)=>{const c=ee(),d={};if(c&&(d.Authorization=`Bearer ${c}`),i&&r)return t("log","at api/idcard.js:218","ğŸ“¤ ä½¿ç”¨å·²è¯†åˆ«çš„å›¾ç‰‡IDè¿›è¡Œè®¤è¯..."),void uni.request({url:`${j}/idcard/verify`,method:"POST",header:{"Content-Type":"application/json",...d},data:{name:a.trim(),idNumber:o.trim().toUpperCase(),frontImageId:i,backImageId:r},success:t=>{var a;if(200===t.statusCode)e(t.data);else{const e=(null==(a=t.data)?void 0:a.message)||"éªŒè¯å¤±è´¥";l(new Error(e))}},fail:e=>{t("error","at api/idcard.js:241","âŒ éªŒè¯è¯·æ±‚å¤±è´¥:",e),l(new Error("éªŒè¯è¯·æ±‚å¤±è´¥: "+(e.errMsg||"ç½‘ç»œé”™è¯¯")))}});t("log","at api/idcard.js:248","ğŸ“¤ å¼€å§‹ä¸Šä¼ èº«ä»½è¯æ­£é¢å›¾ç‰‡..."),t("log","at api/idcard.js:249","å›¾ç‰‡è·¯å¾„:",n),uni.uploadFile({url:`${j}/idcard/upload-front`,filePath:n,name:"frontImage",formData:{name:a.trim(),idNumber:o.trim().toUpperCase()},header:d,timeout:3e4,success:n=>{var i,r;t("log","at api/idcard.js:263","ğŸ“¥ æ­£é¢å›¾ç‰‡ä¸Šä¼ å“åº”:",n);try{const c="string"==typeof n.data?JSON.parse(n.data):n.data;t("log","at api/idcard.js:266","âœ… æ­£é¢å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒimageId:",c.imageId||(null==(i=c.data)?void 0:i.imageId)),uni.uploadFile({url:`${j}/idcard/upload-back`,filePath:s,name:"backImage",formData:{name:a.trim(),idNumber:o.trim().toUpperCase(),frontImageId:c.imageId||(null==(r=c.data)?void 0:r.imageId)||""},header:d,timeout:3e4,success:n=>{var s,i;try{const r="string"==typeof n.data?JSON.parse(n.data):n.data;uni.request({url:`${j}/idcard/verify`,method:"POST",header:{"Content-Type":"application/json",...d},data:{name:a.trim(),idNumber:o.trim().toUpperCase(),frontImageId:c.imageId||(null==(s=c.data)?void 0:s.imageId),backImageId:r.imageId||(null==(i=r.data)?void 0:i.imageId)},timeout:3e4,success:a=>{var o;if(200===a.statusCode)e(a.data);else{const e=(null==(o=a.data)?void 0:o.message)||"éªŒè¯å¤±è´¥";t("error","at api/idcard.js:305","éªŒè¯æ¥å£è¿”å›é”™è¯¯:",e),l(new Error(e))}},fail:e=>{t("error","at api/idcard.js:310","âŒ éªŒè¯è¯·æ±‚å¤±è´¥:",e);let a="éªŒè¯è¯·æ±‚å¤±è´¥";a=e.errMsg?e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"éªŒè¯è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`éªŒè¯è¯·æ±‚å¤±è´¥: ${e.errMsg}`:"éªŒè¯è¯·æ±‚å¤±è´¥: ç½‘ç»œé”™è¯¯",l(new Error(a))}})}catch(Kt){t("error","at api/idcard.js:328","è§£æåé¢å›¾ç‰‡ä¸Šä¼ å“åº”å¤±è´¥:",Kt),l(new Error("è§£æåé¢å›¾ç‰‡ä¸Šä¼ å“åº”å¤±è´¥"))}},fail:e=>{t("error","at api/idcard.js:333","ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥:",e);let a="ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥";e.errMsg&&(a=e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`ä¸Šä¼ åé¢å›¾ç‰‡å¤±è´¥: ${e.errMsg}`),uni.showToast({title:a,icon:"none",duration:3e3}),l(new Error(a))}})}catch(Kt){t("error","at api/idcard.js:349","âŒ è§£ææ­£é¢å›¾ç‰‡ä¸Šä¼ å“åº”å¤±è´¥:",Kt),l(new Error("è§£ææ­£é¢å›¾ç‰‡ä¸Šä¼ å“åº”å¤±è´¥ï¼Œè¯·é‡è¯•"))}},fail:e=>{t("error","at api/idcard.js:354","âŒ ä¸Šä¼ æ­£é¢å›¾ç‰‡å¤±è´¥:",e),t("error","at api/idcard.js:355","é”™è¯¯è¯¦æƒ…:",JSON.stringify(e));let a="ä¸Šä¼ æ­£é¢å›¾ç‰‡å¤±è´¥";e.errMsg&&(a=e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`ä¸Šä¼ æ­£é¢å›¾ç‰‡å¤±è´¥: ${e.errMsg}`),uni.showToast({title:a,icon:"none",duration:3e3}),l(new Error(a))}})})));if(l.success&&l.verified){const a=getApp();a.globalData=a.globalData||{},a.globalData.userProfile||(a.globalData.userProfile={}),a.globalData.userProfile.realname=this.realname.trim(),a.globalData.userProfile.idCard=e,a.globalData.userProfile.authStatus="å·²è®¤è¯",a.globalData.userProfile.authTime=(new Date).getTime();try{const e=a.globalData.userInfo||uni.getStorageSync("userInfo")||{},o=e.id||e._id||e.userId||e.username||"anonymous",n=uni.getStorageSync("userProfilesById")||{};n[o]=a.globalData.userProfile,uni.setStorageSync("userProfilesById",n),uni.setStorageSync("currentUserId",o),uni.setStorageSync("userProfile",a.globalData.userProfile),t("log","at pages/settings/realname/realname.vue:1081","âœ… è®¤è¯ä¿¡æ¯å·²æŒ‰ç”¨æˆ·IDä¿å­˜:",o)}catch(Kt){t("error","at pages/settings/realname/realname.vue:1083","âŒ ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",Kt)}this.realname=this.realname.trim(),this.idCard=e,this.authed=!0,this.idCardFront="",this.idCardBack="",this.idCardFrontPath="",this.idCardBackPath="",this.ocrResult=null,this.frontImageId=null,this.backImageId=null,t("log","at pages/settings/realname/realname.vue:1099","ğŸ—‘ï¸ å·²æ¸…ç©ºèº«ä»½è¯å›¾ç‰‡å’ŒOCRç»“æœ"),uni.showToast({title:"è®¤è¯æˆåŠŸ",icon:"success",duration:2e3})}else{this.authed=!1;let e=l.message||"è®¤è¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";uni.showModal({title:"è®¤è¯å¤±è´¥",content:e,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"})}}catch(l){t("error","at pages/settings/realname/realname.vue:1120","âŒ è‡ªåŠ¨è®¤è¯å¤±è´¥:",l),this.authed=!1;let e=l.message||l.errMsg||"è®¤è¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";uni.showModal({title:"è®¤è¯å¤±è´¥",content:e,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"})}finally{this.loading=!1}var a,o,n,s,i,r}else t("warn","at pages/settings/realname/realname.vue:1038","âš ï¸ èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®ï¼Œç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨æäº¤")},async startAuth(){if(this.loading)return void t("log","at pages/settings/realname/realname.vue:1140","âš ï¸ æ­£åœ¨æäº¤ä¸­ï¼Œè¯·å‹¿é‡å¤ç‚¹å‡»");if(t("log","at pages/settings/realname/realname.vue:1144","ğŸ” å¼€å§‹æäº¤è®¤è¯ï¼Œæ£€æŸ¥è¡¨å•æ•°æ®..."),t("log","at pages/settings/realname/realname.vue:1145","å§“å:",this.realname),t("log","at pages/settings/realname/realname.vue:1146","èº«ä»½è¯å·:",this.idCard),t("log","at pages/settings/realname/realname.vue:1147","æ­£é¢å›¾ç‰‡è·¯å¾„:",this.idCardFrontPath),t("log","at pages/settings/realname/realname.vue:1148","åé¢å›¾ç‰‡è·¯å¾„:",this.idCardBackPath),this.idCardFrontPath&&!this.frontImageId&&(t("log","at pages/settings/realname/realname.vue:1152","â„¹ï¸ å·²ä¸Šä¼ å›¾ç‰‡ï¼Œå¼€å§‹è¿›è¡ŒOCRè¯†åˆ«..."),await this.performOCR(),!this.realname||!this.idCard)){if(!this.realname&&!this.idCard)return void uni.showToast({title:"è¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥å§“åå’Œèº«ä»½è¯å·",icon:"none",duration:2e3});if(!this.realname)return void uni.showToast({title:"å§“åè¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥",icon:"none",duration:2e3});if(!this.idCard)return void uni.showToast({title:"èº«ä»½è¯å·è¯†åˆ«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥",icon:"none",duration:2e3})}if(!this.realname||!this.realname.trim())return t("warn","at pages/settings/realname/realname.vue:1173","âŒ å§“åæœªå¡«å†™"),void uni.showToast({title:"è¯·è¾“å…¥å§“åæˆ–ä¸Šä¼ èº«ä»½è¯è¿›è¡Œè¯†åˆ«",icon:"none",duration:2e3});if(!this.idCard||!this.idCard.trim())return t("warn","at pages/settings/realname/realname.vue:1179","âŒ èº«ä»½è¯å·æœªå¡«å†™"),void uni.showToast({title:"è¯·è¾“å…¥èº«ä»½è¯å·æˆ–ä¸Šä¼ èº«ä»½è¯è¿›è¡Œè¯†åˆ«",icon:"none",duration:2e3});const e=this.idCard.trim().toUpperCase();if(!/^[1-9]\d{16}[\dXx]$/.test(e))return t("warn","at pages/settings/realname/realname.vue:1187","âŒ èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®:",e),void uni.showToast({title:"èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥18ä½èº«ä»½è¯å·",icon:"none",duration:2e3});if(!this.idCardFrontPath&&!this.frontImageId)return t("warn","at pages/settings/realname/realname.vue:1194","âŒ æœªä¸Šä¼ èº«ä»½è¯æ­£é¢ç…§ç‰‡"),void uni.showToast({title:"è¯·ä¸Šä¼ èº«ä»½è¯æ­£é¢ç…§ç‰‡",icon:"none",duration:2e3});t("log","at pages/settings/realname/realname.vue:1199","âœ… è¡¨å•éªŒè¯é€šè¿‡ï¼Œå¼€å§‹äººè„¸æ¯”å¯¹è®¤è¯æµç¨‹..."),this.isUserInputting=!0,this.loading=!0;try{t("log","at pages/settings/realname/realname.vue:1209","ğŸ“¸ æ­¥éª¤1: æ‰“å¼€æ‘„åƒå¤´è¿›è¡Œäººè„¸æ‹ç…§...");let i=null,r=null;try{if(i=await this.openCameraForFaceVerify(),!i)return t("log","at pages/settings/realname/realname.vue:1217","âš ï¸ ç”¨æˆ·å–æ¶ˆæ‹ç…§"),void(this.loading=!1);t("log","at pages/settings/realname/realname.vue:1223","ğŸ“¤ æ­¥éª¤2: ä¸Šä¼ äººè„¸ç…§ç‰‡..."),uni.showLoading({title:"ä¸Šä¼ äººè„¸ç…§ç‰‡ä¸­...",mask:!0});const e=ee(),a={};e&&(a.Authorization=`Bearer ${e}`),await new Promise(((e,o)=>{uni.uploadFile({url:`${j}/idcard/upload-face`,filePath:i,name:"faceImage",header:a,timeout:3e4,success:a=>{try{const o="string"==typeof a.data?JSON.parse(a.data):a.data;(o.imageId||o.faceImageId)&&(r=o.imageId||o.faceImageId,t("log","at pages/settings/realname/realname.vue:1315","âœ… è·å–åˆ°äººè„¸å›¾ç‰‡ID:",r)),e()}catch(Kt){o(Kt)}},fail:e=>{t("error","at pages/settings/realname/realname.vue:1323","ä¸Šä¼ äººè„¸å›¾ç‰‡å¤±è´¥:",e);let a="ä¸Šä¼ å¤±è´¥";e.errMsg&&(a=e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`ä¸Šä¼ å¤±è´¥: ${e.errMsg}`),o(new Error(a))}})})),uni.hideLoading()}catch(a){return uni.hideLoading(),this.loading=!1,t("error","at pages/settings/realname/realname.vue:1342","âŒ äººè„¸æ‹ç…§æˆ–ä¸Šä¼ å¤±è´¥:",a),void uni.showModal({title:"äººè„¸æ‹ç…§å¤±è´¥",content:a.message||"äººè„¸æ‹ç…§æˆ–ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"})}if(!this.frontImageId&&this.idCardFrontPath){t("log","at pages/settings/realname/realname.vue:1355","ğŸ“¤ æ­¥éª¤3: ä¸Šä¼ èº«ä»½è¯æ­£é¢å›¾ç‰‡..."),uni.showLoading({title:"ä¸Šä¼ èº«ä»½è¯å›¾ç‰‡ä¸­...",mask:!0});try{const e=ee(),a={};e&&(a.Authorization=`Bearer ${e}`),await new Promise(((e,o)=>{uni.uploadFile({url:`${j}/idcard/upload-front`,filePath:this.idCardFrontPath,name:"frontImage",header:a,timeout:3e4,success:a=>{try{const o="string"==typeof a.data?JSON.parse(a.data):a.data;o.imageId&&(this.frontImageId=o.imageId,t("log","at pages/settings/realname/realname.vue:1378","âœ… è·å–åˆ°èº«ä»½è¯æ­£é¢å›¾ç‰‡ID:",this.frontImageId)),e()}catch(Kt){o(Kt)}},fail:e=>{t("error","at pages/settings/realname/realname.vue:1386","ä¸Šä¼ èº«ä»½è¯æ­£é¢å›¾ç‰‡å¤±è´¥:",e);let a="ä¸Šä¼ å¤±è´¥";e.errMsg&&(a=e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?"ä¸Šä¼ è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥":`ä¸Šä¼ å¤±è´¥: ${e.errMsg}`),o(new Error(a))}})})),uni.hideLoading()}catch(o){return uni.hideLoading(),this.loading=!1,t("error","at pages/settings/realname/realname.vue:1404","âŒ ä¸Šä¼ èº«ä»½è¯å›¾ç‰‡å¤±è´¥:",o),void uni.showModal({title:"ä¸Šä¼ å¤±è´¥",content:"ä¸Šä¼ èº«ä»½è¯å›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"})}}if(!this.frontImageId)return this.loading=!1,void uni.showModal({title:"ç¼ºå°‘èº«ä»½è¯å›¾ç‰‡",content:"è¯·å…ˆä¸Šä¼ èº«ä»½è¯æ­£é¢ç…§ç‰‡",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2"});t("log","at pages/settings/realname/realname.vue:1429","ğŸ“¤ æ­¥éª¤4: è°ƒç”¨äººè„¸èº«ä»½è¯æ¯”å¯¹API..."),uni.showLoading({title:"æ­£åœ¨è¿›è¡Œäººè„¸æ¯”å¯¹å’Œå®åè®¤è¯...",mask:!0});const l=await function(e,a,o,n,s){return new Promise(((i,r)=>{const l=ee(),c={};l&&(c.Authorization=`Bearer ${l}`);const d=`${j}/idcard/face-verify`;t("log","at api/idcard.js:133","ğŸ“¤ å¼€å§‹è°ƒç”¨äººè„¸èº«ä»½è¯æ¯”å¯¹API..."),t("log","at api/idcard.js:134","ğŸ“¤ APIåœ°å€:",d),t("log","at api/idcard.js:135","ğŸ“¤ å‚æ•°:",{name:e,idNumber:a,frontImageId:o,backImageId:n,faceImageId:s}),uni.request({url:d,method:"POST",header:{"Content-Type":"application/json",...c},data:{name:e.trim(),idNumber:a.trim().toUpperCase(),frontImageId:o||"",backImageId:n||"",faceImageId:s||""},timeout:3e4,success:e=>{var a,o;if(t("log","at api/idcard.js:153","ğŸ“¥ æ”¶åˆ°å“åº”:",{statusCode:e.statusCode,data:e.data}),200===e.statusCode)i(e.data);else{const n=(null==(a=e.data)?void 0:a.message)||(null==(o=e.data)?void 0:o.error)||`è¯·æ±‚å¤±è´¥ (HTTP ${e.statusCode})`;t("error","at api/idcard.js:162","âŒ æœåŠ¡å™¨è¿”å›é”™è¯¯:",{statusCode:e.statusCode,message:n,data:e.data}),r(new Error(n))}},fail:e=>{t("error","at api/idcard.js:171","âŒ äººè„¸èº«ä»½è¯æ¯”å¯¹è¯·æ±‚å¤±è´¥:",e),t("error","at api/idcard.js:172","âŒ è¯·æ±‚URL:",d),t("error","at api/idcard.js:173","âŒ API_BASE_URL:",j),t("error","at api/idcard.js:174","âŒ é”™è¯¯è¯¦æƒ…:",JSON.stringify(e,null,2));let a="äººè„¸èº«ä»½è¯æ¯”å¯¹è¯·æ±‚å¤±è´¥";a=e.errMsg?e.errMsg.includes("timeout")||e.errMsg.includes("è¶…æ—¶")?`è¯·æ±‚è¶…æ—¶\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆ${j}ï¼‰\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n3. æœåŠ¡å™¨å“åº”æ˜¯å¦è¿‡æ…¢`:e.errMsg.includes("fail")||e.errMsg.includes("å¤±è´¥")?`ç½‘ç»œè¯·æ±‚å¤±è´¥\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆ${j}ï¼‰\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n3. æ¥å£åœ°å€æ˜¯å¦æ­£ç¡®\n4. æ˜¯å¦æœ‰CORSè·¨åŸŸé—®é¢˜`:e.errMsg.includes("abort")?"è¯·æ±‚è¢«å–æ¶ˆ":`è¯·æ±‚å¤±è´¥: ${e.errMsg}`:`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${JSON.stringify(e)}`,r(new Error(a))}})}))}(this.realname.trim(),e,this.frontImageId,this.backImageId||"",r);if(uni.hideLoading(),t("log","at pages/settings/realname/realname.vue:1441","ğŸ“¥ æ”¶åˆ°äººè„¸æ¯”å¯¹å“åº”:",l),t("log","at pages/settings/realname/realname.vue:1442","ğŸ“Š å“åº”è¯¦æƒ…:",{success:l.success,verified:l.verified,similarity:l.similarity,faceVerified:l.faceVerified,realnameVerified:l.realnameVerified,message:l.message,mode:l.mode}),null!==l.similarity&&void 0!==l.similarity?(t("log","at pages/settings/realname/realname.vue:1454",`ğŸ“Š äººè„¸ç›¸ä¼¼åº¦: ${l.similarity}%`),l.faceVerified?t("log","at pages/settings/realname/realname.vue:1456",`âœ… äººè„¸æ¯”å¯¹é€šè¿‡ï¼ˆç›¸ä¼¼åº¦: ${l.similarity}%ï¼Œé˜ˆå€¼: >=45ï¼‰`):t("log","at pages/settings/realname/realname.vue:1458",`âŒ äººè„¸æ¯”å¯¹æœªé€šè¿‡ï¼ˆç›¸ä¼¼åº¦: ${l.similarity}%ï¼Œé˜ˆå€¼: >=45ï¼‰`)):"face_api_fallback_local_pass"===l.mode?t("warn","at pages/settings/realname/realname.vue:1462","âš ï¸ å½“å‰ä¸ºé™çº§æ¨¡å¼ï¼ŒæœªçœŸæ­£è°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼Œç›¸ä¼¼åº¦: null"):t("warn","at pages/settings/realname/realname.vue:1464","âš ï¸ APIæœªè¿”å›ç›¸ä¼¼åº¦åˆ†æ•°"),t("log","at pages/settings/realname/realname.vue:1469","ğŸ“‹ æ¯”å¯¹ç»“æœæ‘˜è¦:"),t("log","at pages/settings/realname/realname.vue:1470","   - äººè„¸æ¯”å¯¹: "+(l.faceVerified?"âœ… é€šè¿‡":"âŒ æœªé€šè¿‡")),t("log","at pages/settings/realname/realname.vue:1471","   - å®åè®¤è¯: "+(l.realnameVerified?"âœ… é€šè¿‡":"âŒ æœªé€šè¿‡")),t("log","at pages/settings/realname/realname.vue:1472","   - ç»¼åˆç»“æœ: "+(l.verified?"âœ… è®¤è¯æˆåŠŸ":"âŒ è®¤è¯å¤±è´¥")),l.success&&l.verified){this.isUserInputting=!0;const a=ee();let o="å®åè®¤è¯æˆåŠŸï¼";null!==l.similarity&&void 0!==l.similarity&&(o+=`\n\näººè„¸ç›¸ä¼¼åº¦: ${l.similarity}%`,l.similarity>=45?o+="\nâœ… äººè„¸æ¯”å¯¹é€šè¿‡ï¼ˆç¡®è®¤ä¸ºåŒä¸€äººï¼‰":o+="\nâš ï¸ ç›¸ä¼¼åº¦è¾ƒä½ï¼Œè¯·ç¡®ä¿æ˜¯æœ¬äººæ“ä½œ"),l.faceVerified&&l.realnameVerified&&(o+="\nâœ… å®åè®¤è¯é€šè¿‡"),this.realname=this.realname.trim(),this.idCard=e,this.authed=!0;const i=getApp();i.globalData=i.globalData||{},i.globalData.userProfile||(i.globalData.userProfile={}),i.globalData.userProfile.realname=this.realname.trim(),i.globalData.userProfile.idCard=e,i.globalData.userProfile.authStatus="å·²è®¤è¯",i.globalData.userProfile.authTime=(new Date).getTime();try{uni.setStorageSync("userProfile",i.globalData.userProfile),t("log","at pages/settings/realname/realname.vue:1519","âœ… è®¤è¯ä¿¡æ¯å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨")}catch(Kt){t("error","at pages/settings/realname/realname.vue:1521","âŒ ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",Kt);try{uni.removeStorageSync("userProfile"),uni.setStorageSync("userProfile",i.globalData.userProfile)}catch(n){t("error","at pages/settings/realname/realname.vue:1527","âŒ é‡è¯•ä¿å­˜ä¹Ÿå¤±è´¥:",n)}}if(a)try{t("log","at pages/settings/realname/realname.vue:1533","ğŸ“¤ ç”¨æˆ·å·²ç™»å½•ï¼Œåç«¯åº”å·²è‡ªåŠ¨æ›´æ–°Userè¡¨ï¼Œå†æ¬¡ç¡®è®¤æ›´æ–°...");const{request:a}=await ei((()=>Promise.resolve().then((()=>Ae)))),o=await a({url:"/auth/me",method:"PUT",data:{realname:this.realname.trim(),idCard:e,authStatus:"å·²è®¤è¯"},showLoading:!1,showError:!1});o.success?t("log","at pages/settings/realname/realname.vue:1550","âœ… åç«¯ç”¨æˆ·è®¤è¯çŠ¶æ€å·²ç¡®è®¤æ›´æ–°"):t("warn","at pages/settings/realname/realname.vue:1552","âš ï¸ åç«¯æ›´æ–°ç¡®è®¤å¤±è´¥ï¼Œä½†åç«¯è®¤è¯æ¥å£åº”å·²æ›´æ–°:",o.message)}catch(s){t("warn","at pages/settings/realname/realname.vue:1555","âš ï¸ æ›´æ–°åç«¯çŠ¶æ€å¤±è´¥ï¼Œä½†åç«¯è®¤è¯æ¥å£åº”å·²æ›´æ–°:",s.message)}this.idCardFront="",this.idCardBack="",this.idCardFrontPath="",this.idCardBackPath="",this.ocrResult=null,this.frontImageId=null,this.backImageId=null,t("log","at pages/settings/realname/realname.vue:1569","ğŸ—‘ï¸ å·²æ¸…ç©ºèº«ä»½è¯å›¾ç‰‡å’ŒOCRç»“æœ"),setTimeout((async()=>{try{await this.fetchUserInfoFromBackend(),t("log","at pages/settings/realname/realname.vue:1575","âœ… å·²é‡æ–°åŒæ­¥åç«¯ç”¨æˆ·ä¿¡æ¯")}catch(e){t("warn","at pages/settings/realname/realname.vue:1577","âš ï¸ åŒæ­¥åç«¯ä¿¡æ¯å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:",e.message)}}),2e3);const r="è®¤è¯æˆåŠŸ";uni.showToast({title:r,icon:"success",duration:2e3}),o?setTimeout((()=>{uni.showModal({title:"è®¤è¯æˆåŠŸ",content:o+"\n\nâœ… å®åè®¤è¯å·²é€šè¿‡",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2",success:()=>{setTimeout((()=>{this.isUserInputting=!1,t("log","at pages/settings/realname/realname.vue:1605","âœ… è®¤è¯æˆåŠŸï¼Œå·²æ¸…é™¤ä¿æŠ¤æ ‡è®°")}),500)}})}),500):setTimeout((()=>{this.isUserInputting=!1,t("log","at pages/settings/realname/realname.vue:1614","âœ… è®¤è¯æˆåŠŸï¼Œå·²æ¸…é™¤ä¿æŠ¤æ ‡è®°")}),2500),a||(t("log","at pages/settings/realname/realname.vue:1620","â„¹ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œè®¤è¯ä¿¡æ¯å·²ä¿å­˜åˆ°IdCardVerifyè¡¨ï¼Œç™»å½•åå¯åœ¨è´¦å·è®¾ç½®ä¸­æŸ¥çœ‹"),setTimeout((()=>{uni.showModal({title:"è®¤è¯æˆåŠŸ",content:"å®åè®¤è¯å·²æˆåŠŸï¼\n\næç¤ºï¼šæ‚¨å½“å‰æœªç™»å½•ï¼Œè®¤è¯ä¿¡æ¯å·²ä¿å­˜ã€‚ç™»å½•åè®¤è¯ä¿¡æ¯å°†è‡ªåŠ¨å…³è”åˆ°æ‚¨çš„è´¦æˆ·ã€‚",showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2",success:()=>{setTimeout((()=>{this.isUserInputting=!1,t("log","at pages/settings/realname/realname.vue:1631","âœ… è®¤è¯æˆåŠŸï¼Œå·²æ¸…é™¤ä¿æŠ¤æ ‡è®°")}),500)}})}),2500))}else{this.authed=!1;let e=l.message||"è®¤è¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";if(void 0!==l.faceVerified&&void 0!==l.realnameVerified){let t="";null!==l.similarity&&void 0!==l.similarity&&(t=`\n\näººè„¸ç›¸ä¼¼åº¦: ${l.similarity}%`,l.similarity>=45?t+="\nâœ… äººè„¸æ¯”å¯¹é€šè¿‡ï¼ˆç¡®è®¤ä¸ºåŒä¸€äººï¼‰":l.similarity>=40?t+="\nâš ï¸ ç›¸ä¼¼åº¦è¾ƒä½ï¼ˆä¸ç¡®å®šæ˜¯å¦ä¸ºåŒä¸€äººï¼‰":t+="\nâŒ ç›¸ä¼¼åº¦ä¸è¶³ï¼ˆå¯èƒ½ä¸æ˜¯åŒä¸€äººï¼‰"),e=l.faceVerified||l.realnameVerified?l.faceVerified?"âœ… äººè„¸æ¯”å¯¹ï¼šé€šè¿‡\nâŒ å®åè®¤è¯ï¼šæœªé€šè¿‡"+t+"\n\nå§“åæˆ–èº«ä»½è¯å·å¯èƒ½ä¸åŒ¹é…ï¼Œè¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯":"âŒ äººè„¸æ¯”å¯¹ï¼šæœªé€šè¿‡\nâœ… å®åè®¤è¯ï¼šé€šè¿‡"+t+"\n\nè¯·ç¡®ä¿æ˜¯æœ¬äººæ“ä½œï¼Œé‡æ–°æ‹ç…§":"âŒ äººè„¸æ¯”å¯¹ï¼šæœªé€šè¿‡\nâŒ å®åè®¤è¯ï¼šæœªé€šè¿‡"+t+"\n\nè¯·ç¡®ä¿ï¼š\n1. æ˜¯æœ¬äººæ“ä½œ\n2. å§“åå’Œèº«ä»½è¯å·æ­£ç¡®\n3. èº«ä»½è¯ç…§ç‰‡æ¸…æ™°"}else e.includes("è¯†åˆ«å¤±è´¥")||e.includes("ä¸ä¸€è‡´")?e="èº«ä»½è¯å›¾ç‰‡è¯†åˆ«å¤±è´¥æˆ–ä¸è¾“å…¥ä¿¡æ¯ä¸ä¸€è‡´\n\nè¯·æ£€æŸ¥ï¼š\n1. å›¾ç‰‡æ˜¯å¦æ¸…æ™°\n2. å§“åå’Œèº«ä»½è¯å·æ˜¯å¦ä¸å›¾ç‰‡ä¸€è‡´\n3. å›¾ç‰‡æ˜¯å¦ä¸ºèº«ä»½è¯åŸä»¶ç…§ç‰‡":e.includes("å®åè®¤è¯å¤±è´¥")&&(e="å®åè®¤è¯å¤±è´¥\n\nå¯èƒ½åŸå› ï¼š\n1. å§“åä¸èº«ä»½è¯å·ä¸åŒ¹é…\n2. èº«ä»½è¯ä¿¡æ¯æœ‰è¯¯\n3. ç½‘ç»œè¿æ¥é—®é¢˜");uni.showModal({title:"è®¤è¯å¤±è´¥",content:e,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2",success:e=>{e.confirm&&(t("log","at pages/settings/realname/realname.vue:1685","ç”¨æˆ·å·²æŸ¥çœ‹é”™è¯¯æç¤º"),setTimeout((()=>{this.isUserInputting=!1}),500))}}),t("warn","at pages/settings/realname/realname.vue:1694","âŒ è®¤è¯å¤±è´¥:",e)}}catch(i){t("error","at pages/settings/realname/realname.vue:1698","âŒ è®¤è¯å¤±è´¥:",i),t("error","at pages/settings/realname/realname.vue:1699","é”™è¯¯è¯¦æƒ…:",i.message||i),t("error","at pages/settings/realname/realname.vue:1700","é”™è¯¯å †æ ˆ:",i.stack),this.authed=!1;let e=i.message||i.errMsg||"è®¤è¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";const{API_BASE_URL:a}=await ei((()=>Promise.resolve().then((()=>H))));e.includes("timeout")||e.includes("è¶…æ—¶")?e=`è¯·æ±‚è¶…æ—¶\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\n   åœ°å€ï¼š${a}\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n3. æœåŠ¡å™¨å“åº”æ˜¯å¦è¿‡æ…¢\n\næç¤ºï¼šè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆnpm run devï¼‰`:e.includes("fail")||e.includes("å¤±è´¥")?e=`ç½‘ç»œè¯·æ±‚å¤±è´¥\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n   åœ°å€ï¼š${a}\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n3. æ¥å£åœ°å€æ˜¯å¦æ­£ç¡®\n4. æ˜¯å¦æœ‰CORSè·¨åŸŸé—®é¢˜\n\næç¤ºï¼š\n- H5ç¯å¢ƒï¼šç¡®ä¿åç«¯è¿è¡Œåœ¨ http://localhost:3000\n- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰CORSé”™è¯¯`:e.includes("ä¸Šä¼ ")?e="å›¾ç‰‡ä¸Šä¼ å¤±è´¥\n\nè¯·æ£€æŸ¥ï¼š\n1. å›¾ç‰‡æ ¼å¼æ˜¯å¦æ­£ç¡®\n2. å›¾ç‰‡å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸":(e.includes("ä¸å­˜åœ¨")||e.includes("ä¸å­˜åœ¨"))&&(e="å›¾ç‰‡ä¸å­˜åœ¨\n\nå¯èƒ½åŸå› ï¼š\n1. å›¾ç‰‡ä¸Šä¼ å¤±è´¥\n2. å›¾ç‰‡IDæ— æ•ˆ\n3. è¯·é‡æ–°ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡"),uni.showModal({title:"è®¤è¯å¤±è´¥",content:e,showCancel:!1,confirmText:"æˆ‘çŸ¥é“äº†",confirmColor:"#4a90e2",success:e=>{e.confirm&&t("log","at pages/settings/realname/realname.vue:1729","ç”¨æˆ·å·²æŸ¥çœ‹é”™è¯¯æç¤º")}})}finally{this.loading=!1,this.isUserInputting=!1,t("log","at pages/settings/realname/realname.vue:1737","ğŸ è®¤è¯æµç¨‹ç»“æŸ")}},async changeRealname(){uni.showModal({title:"å˜æ›´å®å",content:"ç¡®å®šè¦å˜æ›´å®åä¿¡æ¯å—ï¼Ÿå˜æ›´åéœ€è¦é‡æ–°è®¤è¯ã€‚",success:async e=>{if(e.confirm){this.authed=!1,this.realname="",this.idCard="",this.idCardFront="",this.idCardBack="",this.idCardFrontPath="",this.idCardBackPath="";const e=getApp(),o=e.globalData.userProfile||{};o.authStatus="æœªè®¤è¯",o.realname="",o.idCard="",e.globalData.userProfile=o;try{uni.setStorageSync("userProfile",o)}catch(Kt){t("error","at pages/settings/realname/realname.vue:1763","ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",Kt)}try{if(uni.getStorageSync("token")){t("log","at pages/settings/realname/realname.vue:1770","ğŸ“¤ åŒæ­¥æ›´æ–°åç«¯è®¤è¯çŠ¶æ€ä¸ºæœªè®¤è¯...");const{request:e}=await ei((()=>Promise.resolve().then((()=>Ae))));await e({url:"/auth/me",method:"PUT",data:{realname:"",idCard:"",authStatus:"æœªè®¤è¯"},showLoading:!1,showError:!1}),t("log","at pages/settings/realname/realname.vue:1783","âœ… åç«¯è®¤è¯çŠ¶æ€å·²æ›´æ–°ä¸ºæœªè®¤è¯")}}catch(a){t("warn","at pages/settings/realname/realname.vue:1786","âš ï¸ æ›´æ–°åç«¯çŠ¶æ€å¤±è´¥:",a.message)}}}})},async updateRealname(){uni.showModal({title:"æ›´æ–°å®å",content:"ç¡®å®šè¦æ›´æ–°å®åä¿¡æ¯å—ï¼Ÿæ›´æ–°åéœ€è¦é‡æ–°è®¤è¯ã€‚",success:async e=>{if(e.confirm){this.authed=!1,this.realname="",this.idCard="",this.idCardFront="",this.idCardBack="",this.idCardFrontPath="",this.idCardBackPath="";const e=getApp(),o=e.globalData.userProfile||{};o.authStatus="æœªè®¤è¯",o.realname="",o.idCard="",e.globalData.userProfile=o;try{uni.setStorageSync("userProfile",o)}catch(Kt){t("error","at pages/settings/realname/realname.vue:1815","ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",Kt)}try{if(uni.getStorageSync("token")){t("log","at pages/settings/realname/realname.vue:1822","ğŸ“¤ åŒæ­¥æ›´æ–°åç«¯è®¤è¯çŠ¶æ€ä¸ºæœªè®¤è¯...");const{request:e}=await ei((()=>Promise.resolve().then((()=>Ae))));await e({url:"/auth/me",method:"PUT",data:{realname:"",idCard:"",authStatus:"æœªè®¤è¯"},showLoading:!1,showError:!1}),t("log","at pages/settings/realname/realname.vue:1835","âœ… åç«¯è®¤è¯çŠ¶æ€å·²æ›´æ–°ä¸ºæœªè®¤è¯")}}catch(a){t("warn","at pages/settings/realname/realname.vue:1838","âš ï¸ æ›´æ–°åç«¯çŠ¶æ€å¤±è´¥:",a.message)}}}})},openCameraForFaceVerify:()=>new Promise(((e,a)=>{t("log","at pages/settings/realname/realname.vue:1912","ğŸ“¸ APP/å°ç¨‹åºç¯å¢ƒï¼Œä½¿ç”¨uni.chooseImageè°ƒç”¨æ‘„åƒå¤´..."),uni.chooseImage({count:1,sourceType:["camera"],camera:"front",success:a=>{const o=a.tempFilePaths[0];t("log","at pages/settings/realname/realname.vue:1919","âœ… æ‹æ‘„æˆåŠŸï¼Œç…§ç‰‡è·¯å¾„:",o),e(o)},fail:o=>{t("error","at pages/settings/realname/realname.vue:1923","âŒ è°ƒç”¨æ‘„åƒå¤´å¤±è´¥:",o),o.errMsg&&o.errMsg.includes("cancel")?a(new Error("ç”¨æˆ·å–æ¶ˆ")):uni.showModal({title:"æ‘„åƒå¤´è°ƒç”¨å¤±è´¥",content:"æ— æ³•è°ƒç”¨æ‘„åƒå¤´ï¼Œæ˜¯å¦ä»ç›¸å†Œé€‰æ‹©ç…§ç‰‡ï¼Ÿ",confirmText:"ä»ç›¸å†Œé€‰æ‹©",cancelText:"å–æ¶ˆ",success:o=>{o.confirm?uni.chooseImage({count:1,sourceType:["album"],success:a=>{const o=a.tempFilePaths[0];t("log","at pages/settings/realname/realname.vue:1940","âœ… ä»ç›¸å†Œé€‰æ‹©æˆåŠŸï¼Œç…§ç‰‡è·¯å¾„:",o),e(o)},fail:e=>{t("error","at pages/settings/realname/realname.vue:1944","âŒ ä»ç›¸å†Œé€‰æ‹©å¤±è´¥:",e),a(new Error("é€‰æ‹©ç…§ç‰‡å¤±è´¥: "+(e.errMsg||"æœªçŸ¥é”™è¯¯")))}}):a(new Error("ç”¨æˆ·å–æ¶ˆ"))}})}})}))}};const yi=s(wi,[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[s.authed?(e.openBlock(),e.createElementBlock("view",{key:0,class:"success-page"},[e.createElementVNode("view",{class:"user-section"},[e.createElementVNode("image",{class:"avatar",src:s.avatarUrl,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"username"},e.toDisplayString(s.username),1)]),e.createElementVNode("view",{class:"success-card"},[e.createElementVNode("view",{class:"success-title"},"å®åè®¤è¯æˆåŠŸ"),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"çœŸå®å§“å"),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(i.realnameMasked),1)]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"è¯ä»¶ç±»å‹"),e.createElementVNode("text",{class:"info-value"},"å±…æ°‘èº«ä»½è¯")]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("text",{class:"info-label"},"è¯ä»¶å·ç "),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(i.idCardMasked),1)])]),e.createElementVNode("view",{class:"tips-section"},[e.createElementVNode("view",{class:"tip-item"},[e.createElementVNode("text",{class:"tip-text"},"è‹¥å®åäººéè´¦å·å®é™…ä½¿ç”¨äººè¯·"),e.createElementVNode("text",{class:"tip-link",onClick:a[0]||(a[0]=(...e)=>i.changeRealname&&i.changeRealname(...e))},"å˜æ›´å®å")]),e.createElementVNode("view",{class:"tip-item"},[e.createElementVNode("text",{class:"tip-text"},"è‹¥åœ¨å…¬å®‰æœºå…³å˜æ›´äº†å§“å/è¯ä»¶å·è¯·"),e.createElementVNode("text",{class:"tip-link",onClick:a[1]||(a[1]=(...e)=>i.updateRealname&&i.updateRealname(...e))},"æ›´æ–°å®å")])])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"card"},[e.createElementVNode("view",{class:"title"},"å®åè®¤è¯"),s.errorMessage?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-message",onClick:a[2]||(a[2]=(...e)=>i.retryLoad&&i.retryLoad(...e))},[e.createElementVNode("text",null,e.toDisplayString(s.errorMessage),1)])):e.createCommentVNode("",!0),s.errorMessage?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("view",{class:"paragraph"}," è¯·ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡å¹¶å¡«å†™ä¿¡æ¯è¿›è¡Œå®åè®¤è¯ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶éªŒè¯èº«ä»½è¯çœŸä¼ªã€‚ "),e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"å§“å"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>s.realname=e),class:"input",placeholder:"è‡ªåŠ¨è¯†åˆ«æˆ–æ‰‹åŠ¨è¾“å…¥",disabled:s.ocrRecognizing,onInput:a[4]||(a[4]=(...e)=>i.onRealnameInput&&i.onRealnameInput(...e)),onFocus:a[5]||(a[5]=(...e)=>i.onInputFocus&&i.onInputFocus(...e)),onBlur:a[6]||(a[6]=(...e)=>i.onInputBlur&&i.onInputBlur(...e))},null,40,["disabled"]),[[e.vModelText,s.realname]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"èº«ä»½è¯å·"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>s.idCard=e),class:"input",placeholder:"è‡ªåŠ¨è¯†åˆ«æˆ–æ‰‹åŠ¨è¾“å…¥",maxlength:"18",disabled:s.ocrRecognizing,onInput:a[8]||(a[8]=(...e)=>i.onIdCardInput&&i.onIdCardInput(...e)),onFocus:a[9]||(a[9]=(...e)=>i.onInputFocus&&i.onInputFocus(...e)),onBlur:a[10]||(a[10]=(...e)=>i.onInputBlur&&i.onInputBlur(...e))},null,40,["disabled"]),[[e.vModelText,s.idCard]])]),e.createElementVNode("view",{class:"upload-section"},[e.createElementVNode("text",{class:"upload-label"},"èº«ä»½è¯æ­£é¢"),e.createElementVNode("view",{class:"upload-box",onClick:a[12]||(a[12]=e=>i.chooseIdCardImage("front"))},[s.idCardFront?(e.openBlock(),e.createElementBlock("image",{key:0,src:s.idCardFront,mode:"aspectFill",class:"upload-image"},null,8,["src"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-placeholder"},[e.createElementVNode("text",{class:"upload-icon"},"ğŸ“·"),e.createElementVNode("text",{class:"upload-text"},"ç‚¹å‡»ä¸Šä¼ ")])),s.idCardFront?(e.openBlock(),e.createElementBlock("view",{key:2,class:"upload-remove",onClick:a[11]||(a[11]=e.withModifiers((e=>i.removeIdCardImage("front")),["stop"]))},"Ã—")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"upload-tip"},"è¯·ä¸Šä¼ æ¸…æ™°çš„èº«ä»½è¯æ­£é¢ç…§ç‰‡")]),e.createElementVNode("view",{class:"upload-section"},[e.createElementVNode("text",{class:"upload-label"},"èº«ä»½è¯åé¢"),e.createElementVNode("view",{class:"upload-box",onClick:a[14]||(a[14]=e=>i.chooseIdCardImage("back"))},[s.idCardBack?(e.openBlock(),e.createElementBlock("image",{key:0,src:s.idCardBack,mode:"aspectFill",class:"upload-image"},null,8,["src"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-placeholder"},[e.createElementVNode("text",{class:"upload-icon"},"ğŸ“·"),e.createElementVNode("text",{class:"upload-text"},"ç‚¹å‡»ä¸Šä¼ ")])),s.idCardBack?(e.openBlock(),e.createElementBlock("view",{key:2,class:"upload-remove",onClick:a[13]||(a[13]=e.withModifiers((e=>i.removeIdCardImage("back")),["stop"]))},"Ã—")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"upload-tip"},"è¯·ä¸Šä¼ æ¸…æ™°çš„èº«ä»½è¯åé¢ç…§ç‰‡")])]),e.createElementVNode("view",{class:e.normalizeClass(["btn",{"btn-disabled":s.loading}]),onClick:a[15]||(a[15]=(...e)=>i.startAuth&&i.startAuth(...e))},e.toDisplayString(s.loading?"è®¤è¯ä¸­...":"æäº¤è®¤è¯"),3)]))]))])}]]),Ei=e.defineComponent({__name:"index",setup(o){const n=e.ref(""),s=e.ref([]),r=e.ref(!1),l=e.ref(!1),c=e.ref(""),d=e.ref(""),u=()=>{const e=9-s.value.length;if(e<=0)return;const a=uni.chooseMedia;if(a)return t("log","at pages/online-consult/index.vue:292","ğŸ“¸ ä½¿ç”¨ chooseMedia APIï¼Œå‰©ä½™å¯ä¸Šä¼ :",e),void a({count:e,mediaType:["image","video"],sourceType:["album","camera"],maxDuration:60,success:e=>{var a;t("log","at pages/online-consult/index.vue:299","âœ… chooseMedia æˆåŠŸï¼Œè¿”å›æ–‡ä»¶æ•°:",(null==(a=e.tempFiles)?void 0:a.length)||0);const o=e.tempFiles||[];let n=0;o.forEach(((e,a)=>{if(s.value.length>=9)t("log","at pages/online-consult/index.vue:305",`â­ï¸ è·³è¿‡æ–‡ä»¶ ${a+1}ï¼Œå·²è¾¾åˆ°ä¸Šé™`);else try{"video"===e.fileType?(s.value.push({path:e.tempFilePath,thumb:e.thumbTempFilePath||e.tempFilePath,type:"video"}),n++,t("log","at pages/online-consult/index.vue:317",`âœ… è§†é¢‘ ${a+1} æ·»åŠ æˆåŠŸ`)):(s.value.push({path:e.tempFilePath,type:"image"}),n++,t("log","at pages/online-consult/index.vue:324",`âœ… å›¾ç‰‡ ${a+1} æ·»åŠ æˆåŠŸï¼Œå½“å‰æ–‡ä»¶æ•°: ${s.value.length}`))}catch(o){t("error","at pages/online-consult/index.vue:327",`âŒ å¤„ç†æ–‡ä»¶ ${a+1} æ—¶å‡ºé”™:`,o)}})),n>0&&uni.showToast({title:`å·²é€‰æ‹© ${n} ä¸ªæ–‡ä»¶`,icon:"success",duration:1500})},fail:e=>{t("error","at pages/online-consult/index.vue:340","âŒ chooseMedia å¤±è´¥:",e),e.errMsg&&!e.errMsg.includes("cancel")&&uni.showToast({title:"é€‰æ‹©æ–‡ä»¶å¤±è´¥",icon:"none"})}});t("log","at pages/online-consult/index.vue:354","ğŸ“¸ ä½¿ç”¨ chooseImage APIï¼Œå‰©ä½™å¯ä¸Šä¼ :",e),uni.chooseImage({count:e,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{var a;t("log","at pages/online-consult/index.vue:360","âœ… chooseImage æˆåŠŸï¼Œè¿”å›å›¾ç‰‡æ•°:",(null==(a=e.tempFilePaths)?void 0:a.length)||0);const o=Array.isArray(e.tempFilePaths)?e.tempFilePaths:[];let n=0;o.forEach(((e,a)=>{s.value.length<9?(s.value.push({path:e,type:"image"}),n++,t("log","at pages/online-consult/index.vue:368",`âœ… å›¾ç‰‡ ${a+1} æ·»åŠ æˆåŠŸï¼Œå½“å‰æ–‡ä»¶æ•°: ${s.value.length}`)):t("log","at pages/online-consult/index.vue:370",`â­ï¸ è·³è¿‡å›¾ç‰‡ ${a+1}ï¼Œå·²è¾¾åˆ°ä¸Šé™`)})),n>0&&uni.showToast({title:`å·²é€‰æ‹© ${n} å¼ å›¾ç‰‡`,icon:"success",duration:1500})},fail:e=>{t("error","at pages/online-consult/index.vue:383","âŒ chooseImage å¤±è´¥:",e),e.errMsg&&!e.errMsg.includes("cancel")&&uni.showToast({title:"é€‰æ‹©å›¾ç‰‡å¤±è´¥",icon:"none"})}})},m=e=>{t("error","at pages/online-consult/index.vue:470","è§†é¢‘æ’­æ”¾é”™è¯¯:",e),uni.showToast({title:"è§†é¢‘æ— æ³•æ’­æ”¾ï¼Œè¯·æ£€æŸ¥æ ¼å¼",icon:"none",duration:2e3})},p=()=>{try{const e=uni.getRecorderManager();if(r.value){uni.getRecorderManager().stop()}else r.value=!0,e.start({format:"mp3"}),e.onStop((()=>{r.value=!1,n.value+=(n.value?"\n":"")+"ã€è¯­éŸ³å·²å½•å…¥ï¼Œç¤ºä¾‹æ–‡å­—ï¼šè¿™é‡Œæ˜¯æ ¹æ®è¯­éŸ³ç”Ÿæˆçš„ç—…æƒ…æè¿°ï¼Œè¯·åœ¨çœŸå®é¡¹ç›®ä¸­æ¥å…¥è¯­éŸ³è¯†åˆ«æœåŠ¡ã€‘"})),uni.showToast({title:"å¼€å§‹å½•éŸ³ï¼Œå†æ¬¡ç‚¹å‡»åœæ­¢",icon:"none"})}catch(Kt){uni.showToast({title:"å½“å‰ç«¯èƒ½åŠ›æœ‰é™ï¼Œæ— æ³•ä½¿ç”¨å½•éŸ³",icon:"none"})}},h=()=>{l.value=!1,c.value="",d.value=""},g=()=>{if(!n.value)return void uni.showToast({title:"è¯·å…ˆæè¿°ç—…æƒ…",icon:"none"});getApp().globalData.consultData={description:n.value,files:s.value},uni.navigateTo({url:"/pages/online-consult/patient"})};return(o,v)=>{const f=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"consult-page"},[e.createElementVNode("view",{class:"step-header"},[e.createElementVNode("view",{class:"step-item active"},[e.createElementVNode("text",{class:"step-index"},"1"),e.createElementVNode("text",{class:"step-text"},"è¯·æè¿°æ‚¨çš„ç—…æƒ…")]),e.createElementVNode("view",{class:"step-divider"}),e.createElementVNode("view",{class:"step-item"},[e.createElementVNode("text",{class:"step-index"},"2"),e.createElementVNode("text",{class:"step-text"},"å’¨è¯¢äººé€‰æ‹©")])]),e.createElementVNode("view",{class:"card card-desc"},[e.createElementVNode("view",{class:"card-title"},"ä¸ºäº†æ›´å¥½åœ°è·å¾—åŒ»ç”Ÿå¸®åŠ©ï¼Œè¯·å°½å¯èƒ½è¯¦ç»†æè¿°ç—…æƒ…"),e.createElementVNode("view",{class:"textarea-wrapper"},[e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":v[0]||(v[0]=e=>n.value=e),class:"desc-textarea",placeholder:"è¯·å¡«å†™ç—‡çŠ¶ã€æŒç»­æ—¶é—´ã€ç”¨è¯æƒ…å†µç­‰ä¿¡æ¯",maxlength:-1,"auto-height":""},null,512),[[e.vModelText,n.value]]),e.createElementVNode("view",{class:"voice-btn",onClick:p},[e.createVNode(f,{type:"mic",size:"26",color:"#007AFF"})])]),e.createElementVNode("view",{class:"desc-tips"},[e.createElementVNode("text",null,"æ–‡å­—è¶Šè¯¦ç»†ï¼ŒåŒ»ç”Ÿè¶Šå®¹æ˜“åˆ¤æ–­ç—…æƒ…ã€‚"),r.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"recording-status"},"æ­£åœ¨å½•éŸ³...")):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"card card-upload"},[e.createElementVNode("view",{class:"upload-header"},[e.createElementVNode("text",{class:"card-title"},"ä¸Šä¼ æ£€æŸ¥æŠ¥å‘Šã€å¤„æ–¹ç…§ç‰‡æˆ–è§†é¢‘"),e.createElementVNode("text",{class:"upload-count"},e.toDisplayString(s.value.length)+"/9 å·²ä¸Šä¼ ",1)]),e.createElementVNode("view",{class:"upload-subtitle"},"æ–‡ä»¶ä»…è‡ªå·±å’ŒåŒ»ç”Ÿå¯è§ï¼Œæ”¯æŒå›¾ç‰‡/è§†é¢‘"),e.createElementVNode("view",{class:"upload-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((a,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"upload-item",onClick:e=>(e=>{const t=s.value[e];if("video"===t.type)"string"==typeof t.path&&t.path?(c.value=t.path,d.value=t.thumb||"",l.value=!0):uni.showToast({title:"è§†é¢‘è·¯å¾„æ— æ•ˆ",icon:"none"});else{const t=s.value.filter((e=>"image"===e.type)).map((e=>e.path)),a=s.value.slice(0,e).filter((e=>"image"===e.type)).length;uni.previewImage({current:a,urls:t})}})(n)},[e.createElementVNode("image",{src:a.thumb||a.path,mode:"aspectFill",class:"upload-image",onError:e=>((e,a)=>{var o;t("error","at pages/online-consult/index.vue:406",`âŒ å›¾ç‰‡ ${a+1} åŠ è½½å¤±è´¥:`,e),t("error","at pages/online-consult/index.vue:407","å›¾ç‰‡è·¯å¾„:",null==(o=s.value[a])?void 0:o.path),uni.showToast({title:`å›¾ç‰‡ ${a+1} åŠ è½½å¤±è´¥`,icon:"none",duration:2e3})})(e,n),onLoad:()=>o.__f__("log","at pages/online-consult/index.vue:57",`âœ… å›¾ç‰‡ ${Number(n)+1} åŠ è½½æˆåŠŸ`)},null,40,["src","onError","onLoad"]),"video"===a.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-badge"},"è§†é¢‘")):e.createCommentVNode("",!0),"video"===a.type?(e.openBlock(),e.createElementBlock("view",{key:1,class:"play-icon"},"â–¶")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"delete-icon",onClick:e.withModifiers((e=>(e=>{t("log","at pages/online-consult/index.vue:397",`ğŸ—‘ï¸ åˆ é™¤æ–‡ä»¶ ${e+1}`),s.value.splice(e,1),t("log","at pages/online-consult/index.vue:399",`âœ… åˆ é™¤æˆåŠŸï¼Œå½“å‰æ–‡ä»¶æ•°: ${s.value.length}`)})(n)),["stop"])}," Ã— ",8,["onClick"])],8,["onClick"])))),128)),s.value.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-item add-item",onClick:u},[e.createElementVNode("text",{class:"add-plus"},"+")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"bottom-fixed"},[e.createElementVNode("button",{class:"next-btn",type:"primary",onClick:g}," ä¸‹ä¸€æ­¥ ")]),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-preview-modal",onClick:h},[e.createElementVNode("view",{class:"video-preview-content",onClick:v[1]||(v[1]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"video-preview-header"},[e.createElementVNode("text",{class:"video-preview-title"},"è§†é¢‘é¢„è§ˆ"),e.createElementVNode("view",{class:"video-close-btn",onClick:h},"Ã—")]),e.createElementVNode("video",{src:c.value,class:"video-player",controls:"",autoplay:!1,"show-center-play-btn":!0,"show-play-btn":!0,"enable-play-gesture":!0,onError:m,poster:d.value,"enable-progress-gesture":!0,"object-fit":"contain"},[e.createElementVNode("source",{src:c.value,type:"video/mp4"},null,8,["src"])],40,["src","poster"])])])):e.createCommentVNode("",!0)])}}});let ki=null,Ni=!1,Vi=null;async function Ci(e,a={}){if(ki&&Ni){if(Vi===e)return t("log","at utils/socket.js:81","âœ… Socket.IO å·²è¿æ¥ï¼Œç”¨æˆ·IDç›¸åŒï¼Œå¤ç”¨ç°æœ‰è¿æ¥"),ki;t("log","at utils/socket.js:76","ğŸ”„ æ£€æµ‹åˆ°ç”¨æˆ·IDå˜åŒ–ï¼Œæ–­å¼€æ—§è¿æ¥:",Vi,"->",e),xi()}try{throw new Error("å½“å‰ç¯å¢ƒä¸æ”¯æŒ Socket.IOï¼Œè¯·ä½¿ç”¨ H5 ç¯å¢ƒæˆ–å®‰è£…åŸç”Ÿæ’ä»¶")}catch(o){throw t("error","at utils/socket.js:189","âŒ åˆå§‹åŒ– Socket.IO å¤±è´¥:",o),o}}function xi(){ki&&(ki=null,Ni=!1,Vi=null,t("log","at utils/socket.js:209","âœ… Socket.IO å·²æ–­å¼€è¿æ¥"))}function bi(e,t,a="text",o={},n=null){return new Promise(((e,t)=>{t(ki&&Ni?Vi?new Error("å½“å‰ç¯å¢ƒä¸æ”¯æŒå‘é€æ¶ˆæ¯"):new Error("ç”¨æˆ·IDæœªè®¾ç½®"):new Error("Socket.IO æœªè¿æ¥"))}))}const Si=e.defineComponent({__name:"patient",setup(a){const o=e.ref([]),n=e.ref(null),s=e.ref(null),i=e.ref(!1);e.onMounted((()=>{r()}));const r=()=>{try{const e=as();if(e&&e.length>0){o.value=e.map((e=>({id:e.id,name:e.name,gender:e.gender,age:e.age})));const t=is();t?n.value=t.id:o.value.length>0&&(n.value=o.value[0].id)}else o.value=[],n.value=null}catch(Kt){t("error","at pages/online-consult/patient.vue:131","åŠ è½½å°±è¯Šäººåˆ—è¡¨å¤±è´¥:",Kt),o.value=[],n.value=null}},l=()=>{uni.navigateTo({url:"/pages/mine/patient-edit",success:()=>{uni.$on("patientUpdated",r)}})},c=e=>{s.value=e},d=()=>{uni.showToast({title:"æ‰“å¼€ç—…ä¾‹éšç§åè®®",icon:"none"})},u=async()=>{var e;if(n.value)if(null!==s.value){if(!i.value){i.value=!0,uni.showLoading({title:"æ­£åœ¨æäº¤...",mask:!0});try{const l=o.value.find((e=>e.id===n.value));if(!l)throw new Error("æœªæ‰¾åˆ°é€‰ä¸­çš„æ‚£è€…ä¿¡æ¯");const c=getApp(),d=(null==(e=c.globalData)?void 0:e.consultData)||{};if(!d.description)throw new Error("è¯·å…ˆæè¿°ç—…æƒ…");const u=ae(),m=(null==u?void 0:u.id)||(null==u?void 0:u._id)||(null==u?void 0:u.userId)||(null==u?void 0:u.username)||(null==u?void 0:u.phone)||`patient_${Date.now()}`,p=`patient_${l.name}_${l.gender}_${l.age}`;try{const e=getApp&&getApp();e&&(e.globalData=e.globalData||{},e.globalData.consultData={...e.globalData.consultData||{},patientId:p}),uni.setStorageSync("currentPatientId",p)}catch(Kt){t("warn","at pages/online-consult/patient.vue:222","âš ï¸ ä¿å­˜ patientId åˆ°å…¨å±€/æœ¬åœ°å¤±è´¥:",Kt)}const h="6954c80b51429de7970bc551";t("log","at pages/online-consult/patient.vue:230","ğŸ”’ ä½¿ç”¨å›ºå®šåŒ»ç”ŸID (qmp):",h);try{await Ci(p,{name:l.name,gender:l.gender,age:l.age,userId:p}),t("log","at pages/online-consult/patient.vue:240","âœ… Socket.IO è¿æ¥æˆåŠŸ")}catch(a){throw t("error","at pages/online-consult/patient.vue:242","âŒ Socket.IO è¿æ¥å¤±è´¥:",a),new Error("è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}const g={patientInfo:{name:l.name,gender:l.gender,age:l.age,id:p},symptomDescription:d.description||"",images:(d.files||[]).map((e=>({url:e.path||e.thumb||e,thumb:e.thumb||e.path||e,type:e.type||"image"}))),hasVisited:s.value};try{const e=(null==u?void 0:u.id)||(null==u?void 0:u._id)||(null==u?void 0:u.userId)||(null==u?void 0:u.username)||(null==u?void 0:u.phone)||null;await bi(0,JSON.stringify(g),"patient-card",{patientCardData:g},e),t("log","at pages/online-consult/patient.vue:276","âœ… åˆå§‹æ¶ˆæ¯å·²å‘é€åˆ°åŒ»ç”Ÿ")}catch(a){t("error","at pages/online-consult/patient.vue:278","âŒ å‘é€åˆå§‹æ¶ˆæ¯å¤±è´¥:",a)}const v={patientInfo:{name:l.name,gender:l.gender,age:l.age,id:p},symptomDescription:d.description||"",symptomImages:(d.files||[]).map((e=>({path:e.path||e.thumb||e,thumb:e.thumb||e.path||e,type:e.type||"image"}))),doctorId:h,patientId:p,messages:[],hasVisited:s.value},f=Ps(v,m);t("log","at pages/online-consult/patient.vue:305","âœ… å’¨è¯¢è®°å½•å·²ä¿å­˜åˆ°æœ¬åœ°:",f,"æ‚£è€…:",l.name);try{const e=(null==u?void 0:u.id)||(null==u?void 0:u._id)||(null==u?void 0:u.userId)||(null==u?void 0:u.username)||(null==u?void 0:u.phone)||null;if(e&&h){t("log","at pages/online-consult/patient.vue:313","ğŸ”„ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°...",{patientId:p,doctorId:h,createdBy:e});const a=await Pe({url:"/chat/consultation",method:"POST",data:{patientId:p,doctorId:h,patientInfo:v.patientInfo,symptomDescription:v.symptomDescription,symptomImages:v.symptomImages,createdBy:e},needAuth:!0,showLoading:!0,showError:!0});a.success&&a.data?(t("log","at pages/online-consult/patient.vue:336","âœ… å’¨è¯¢è®°å½•å·²åŒæ­¥åˆ°åå°:",a.data._id||a.data.id),c.globalData&&c.globalData.consultData&&(c.globalData.consultData.consultationId=a.data._id||a.data.id)):t("warn","at pages/online-consult/patient.vue:342","âš ï¸ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°å¤±è´¥:",a.message||"æœªçŸ¥é”™è¯¯")}else t("warn","at pages/online-consult/patient.vue:345","âš ï¸ æ— æ³•åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°ï¼šç¼ºå°‘å‰å°è´¦å·IDæˆ–åŒ»ç”ŸID",{hasFrontDeskUserId:!!e,hasDoctorId:!!h})}catch(r){t("error","at pages/online-consult/patient.vue:351","âŒ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°å¤±è´¥:",r)}c.globalData&&(c.globalData.consultData={...d,patient:l,hasVisited:s.value,doctorId:h,patientId:p,consultationId:f}),uni.hideLoading(),i.value=!1,uni.navigateTo({url:"/pages/online-consult/chat"})}catch(a){uni.hideLoading(),i.value=!1,t("error","at pages/online-consult/patient.vue:378","âŒ æäº¤å’¨è¯¢å¤±è´¥:",a),uni.showToast({title:a.message||"æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}}}else uni.showToast({title:"è¯·é€‰æ‹©æ˜¯å¦å°±è¯Šè¿‡",icon:"none"});else uni.showToast({title:"è¯·é€‰æ‹©å’¨è¯¢æ‚£è€…",icon:"none"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"patient-page"},[e.createElementVNode("view",{class:"step-header"},[e.createElementVNode("view",{class:"step-item"},[e.createElementVNode("text",{class:"step-index"},"1"),e.createElementVNode("text",{class:"step-text"},"ç—…æƒ…æè¿°")]),e.createElementVNode("view",{class:"step-divider"}),e.createElementVNode("view",{class:"step-item active"},[e.createElementVNode("text",{class:"step-index"},"2"),e.createElementVNode("text",{class:"step-text"},"ä½ è¦ä¸ºè°å’¨è¯¢")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-label"},"å’¨è¯¢æ‚£è€…ï¼š"),e.createElementVNode("view",{class:"patient-cards"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:e.normalizeClass(["patient-card",{active:t.id===n.value}]),onClick:e=>{return a=t.id,void(n.value=a);var a}},[e.createElementVNode("view",{class:"patient-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"patient-info"},e.toDisplayString(t.gender)+"ï½œ"+e.toDisplayString(t.age)+"å²",1),t.id===n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"checked-icon"},"âœ”")):e.createCommentVNode("",!0)],10,["onClick"])))),128)),e.createElementVNode("view",{class:"patient-card add-card",onClick:l},[e.createElementVNode("text",{class:"add-plus"},"+")])])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-label"},"æ˜¯å¦å°±è¯¥ç–¾ç—…åˆ°åŒ»é™¢å°±è¯Šè¿‡ï¼š"),e.createElementVNode("view",{class:"bool-buttons"},[e.createElementVNode("view",{class:e.normalizeClass(["bool-btn",{active:!0===s.value}]),onClick:a[0]||(a[0]=e=>c(!0))}," æ˜¯ ",2),e.createElementVNode("view",{class:e.normalizeClass(["bool-btn",{active:!1===s.value}]),onClick:a[1]||(a[1]=e=>c(!1))}," å¦ ",2)])]),e.createElementVNode("view",{class:"bottom-fixed"},[e.createElementVNode("view",{class:"agreement-text"},[e.createTextVNode(" ç‚¹å‡»ç«‹å³å’¨è¯¢å³åŒæ„ "),e.createElementVNode("text",{class:"link",onClick:d},"ã€Šç—…ä¾‹éšç§åè®®ã€‹"),e.createTextVNode(" ï¼Œå®¶åº­ç­¾ç½² ")]),e.createElementVNode("button",{class:"submit-btn",type:"primary",onClick:u}," ç«‹å³å’¨è¯¢ ")])]))}}),Ii=e.defineComponent({__name:"chat",setup(o){const n=e.ref({name:"æ‚£è€…",gender:"æœªçŸ¥",age:0}),s=e.ref(""),r=e.ref([]),l=e.ref(""),c=e.ref(!1),d=e.ref(""),u=e.ref(""),m=e.ref([]),p=e.ref(null),h=e.ref("doctor_001"),g=e.ref(!1);let v=null,f=null,w=null,y=0,E=!1;const k=e.ref(!1),N=e.ref("video"),V=e.ref(!1),C=e.ref(!0),x=e.ref(""),b=e.ref(null),S=e.ref(null);function I(){return v}async function T(e=!1,a){try{if(E)return t("log","at pages/online-consult/chat.vue:325","â³ æ­£åœ¨æ‹‰å–æ¶ˆæ¯ï¼Œè·³è¿‡æœ¬æ¬¡è¯·æ±‚"),[];E=!0;const o=ae(),i=v||(null==o?void 0:o.id)||(null==o?void 0:o._id)||(null==o?void 0:o.userId)||null;if(!i||!h.value)return t("warn","at pages/online-consult/chat.vue:335","âš ï¸ æ— æ³•è·å–æœ€æ–°æ¶ˆæ¯ï¼šç¼ºå°‘æ‚£è€…IDæˆ–åŒ»ç”ŸID"),E=!1,[];let l=`/chat/history?userId=${i}&targetId=${h.value}&limit=200`;e&&a?(l+=`&since=${a}`,t("log","at pages/online-consult/chat.vue:346","ğŸ”„ å¢é‡æ‹‰å–æœ€æ–°æ¶ˆæ¯ï¼ˆè‡ª",new Date(a).toLocaleString(),"èµ·ï¼‰...")):t("log","at pages/online-consult/chat.vue:348","ğŸ”„ ä»åç«¯è·å–æœ€æ–°æ¶ˆæ¯å†å²...",{patientId:i,doctorId:h.value});const c=await Pe({url:l,method:"GET",data:{},needAuth:!0,showLoading:!1,showError:!1});if(c.success&&c.messages&&c.messages.length>0){t("log","at pages/online-consult/chat.vue:361","âœ… ä»åç«¯è·å–åˆ°",c.messages.length,"æ¡æœ€æ–°æ¶ˆæ¯",e?"(å¢é‡)":"");const a=Math.max(...c.messages.map((e=>e.timestamp||(e.createdAt?new Date(e.createdAt).getTime():Date.now()))));y=Math.max(y,a);const o=c.messages.map((e=>{var a;const o=!(e.fromUserId===h.value||e.fromUserId&&e.fromUserId.startsWith("doctor_"))&&e.fromUserId===i,l={id:e.messageId||e._id||e.id,content:e.content||"",type:e.type||"text",isMe:o,timestamp:e.timestamp||(e.createdAt?new Date(e.createdAt).getTime():Date.now()),avatar:""};if("patient-card"===e.type)try{let i;if(null==(a=e.extra)?void 0:a.patientCardData)i=e.extra.patientCardData;else if(e.content)try{i=JSON.parse(e.content)}catch(Kt){t("error","at pages/online-consult/chat.vue:397","è§£ææ‚£è€…ä¿¡æ¯å¡ç‰‡å¤±è´¥:",Kt)}i&&(l.patientCardData=i,o&&i.patientInfo&&(n.value={...n.value,...i.patientInfo}),o&&i.symptomDescription&&(s.value=i.symptomDescription),o&&i.images&&i.images.length>0&&(r.value=i.images.map((e=>({path:e.url,thumb:e.thumb||e.url,type:e.type||"image"})))))}catch(c){t("error","at pages/online-consult/chat.vue:427","âŒ å¤„ç†æ‚£è€…ä¿¡æ¯å¡ç‰‡å¤±è´¥:",c)}return l}));return E=!1,o}return t("log","at pages/online-consult/chat.vue:437","â„¹ï¸ åç«¯æ²¡æœ‰æ¶ˆæ¯å†å²",e?"(å¢é‡æ‹‰å–)":""),E=!1,[]}catch(o){return t("error","at pages/online-consult/chat.vue:442","âŒ ä»åç«¯è·å–æœ€æ–°æ¶ˆæ¯å¤±è´¥:",o),E=!1,[]}}function D(e){if(!e||0===e.length)return;const t=new Map;m.value.forEach((e=>{const a=e.id||`${e.timestamp}_${e.content}`;t.set(a,e)})),e.forEach((e=>{const a=e.id||`${e.timestamp}_${e.content}`,o=t.get(a);(!o||o.timestamp<e.timestamp)&&t.set(a,e)}));const a=Array.from(t.values()).sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0)));(a.length!==m.value.length||a.some(((e,t)=>{var a;return e.id!==(null==(a=m.value[t])?void 0:a.id)})))&&(m.value=a,setTimeout((()=>{U()}),0),P())}function B(){_(),w=setInterval((()=>{g.value?async function(){if(!g.value){const e=await T(!1);return void(e.length>0&&D(e))}const e=y||(m.value.length>0?Math.max(...m.value.map((e=>e.timestamp||0))):Date.now()-864e5),a=await T(!0,e);a.length>0&&(t("log","at pages/online-consult/chat.vue:470","âœ… è‡ªåŠ¨æ‹‰å–åˆ°",a.length,"æ¡æ–°æ¶ˆæ¯"),D(a))}():T(!1).then((e=>{e.length>0&&D(e)}))}),3e4),t("log","at pages/online-consult/chat.vue:541","âœ… å·²å¯åŠ¨è‡ªåŠ¨æ‹‰å–æ¶ˆæ¯å®šæ—¶å™¨ï¼ˆé—´éš”",30,"ç§’ï¼‰")}function _(){w&&(clearInterval(w),w=null,t("log","at pages/online-consult/chat.vue:551","âœ… å·²åœæ­¢è‡ªåŠ¨æ‹‰å–æ¶ˆæ¯å®šæ—¶å™¨"))}async function P(){try{const a=ae();let o=v||(null==a?void 0:a.id)||(null==a?void 0:a._id)||(null==a?void 0:a.userId)||(null==a?void 0:a.username)||(null==a?void 0:a.phone)||null;if(!o&&m.value.length>0){m.value.find((e=>e.isMe))&&t("warn","at pages/online-consult/chat.vue:596","âš ï¸ æ— æ³•è·å–æ‚£è€…IDï¼Œå°è¯•ä»æ¶ˆæ¯ä¸­æå–")}o||(o=`patient_${Date.now()}`,t("warn","at pages/online-consult/chat.vue:603","âš ï¸ æ— æ³•è·å–æ‚£è€…IDï¼Œä½¿ç”¨ä¸´æ—¶ID:",o)),t("log","at pages/online-consult/chat.vue:606","ğŸ’¾ ä¿å­˜å’¨è¯¢è®°å½• - æ‚£è€…ID:",o,"ç”¨æˆ·ä¿¡æ¯:",{hasUserInfo:!!a,currentPatientId:v,userInfoKeys:a?Object.keys(a):[]});const i=await T(),l=new Map;m.value.forEach((e=>{const t=e.id||`${e.timestamp}_${e.content}`;l.set(t,e)})),i.forEach((e=>{const t=e.id||`${e.timestamp}_${e.content}`,a=l.get(t);(!a||a.timestamp<e.timestamp)&&l.set(t,e)}));const c=Array.from(l.values()).sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0)));t("log","at pages/online-consult/chat.vue:636","ğŸ“‹ åˆå¹¶åçš„æ¶ˆæ¯æ•°é‡:",c.length,"ï¼ˆæœ¬åœ°:",m.value.length,"æœåŠ¡å™¨:",i.length,"ï¼‰");const d={id:f,patientInfo:{name:n.value.name,gender:n.value.gender,age:n.value.age,id:o},symptomDescription:s.value,symptomImages:r.value.map((e=>({path:e.path,thumb:e.thumb||e.path,type:e.type||"image"}))),doctorId:h.value,patientId:o,messages:c.map((e=>{const a={id:e.id,content:e.content,type:e.type,isMe:e.isMe,timestamp:e.timestamp};if("image"===e.type){a.content=e.content||"",a.isImage=!0;const o=e.content?e.content.length:0;o>0&&t("log","at pages/online-consult/chat.vue:673","ğŸ“¸ ä¿å­˜å›¾ç‰‡æ¶ˆæ¯:",{messageId:e.id,imageSize:`${(o/1024).toFixed(2)} KB`,isBase64:e.content.startsWith("data:image")})}if("patient-card"===e.type&&e.patientCardData){a.patientCardData=e.patientCardData;const o=a.patientCardData;if(o){if(o.patientInfo&&(d.patientInfo={...d.patientInfo,...o.patientInfo}),o.symptomDescription&&(!d.symptomDescription||o.symptomDescription.length>d.symptomDescription.length)&&(d.symptomDescription=o.symptomDescription),o.images&&o.images.length>0){const e=new Map;d.symptomImages.forEach((t=>{const a=t.path||t.thumb||t;e.set(a,t)})),o.images.forEach((t=>{const a={path:t.url,thumb:t.thumb||t.url,type:t.type||"image"},o=a.path||a.thumb;e.has(o)||e.set(o,a)})),d.symptomImages=Array.from(e.values())}t("log","at pages/online-consult/chat.vue:727","ğŸ’¾ ä¿å­˜æ‚£è€…ä¿¡æ¯å¡ç‰‡åˆ°å’¨è¯¢è®°å½•:",{messageId:e.id,patientInfo:d.patientInfo,symptomDescription:d.symptomDescription,imageCount:d.symptomImages.length})}}return a}))},u=(null==a?void 0:a.id)||(null==a?void 0:a._id)||(null==a?void 0:a.userId)||(null==a?void 0:a.username)||(null==a?void 0:a.phone)||null,p=Ps(d,u);f&&f===p||(f=p,t("log","at pages/online-consult/chat.vue:749","ğŸ“ æ›´æ–°å½“å‰å’¨è¯¢è®°å½•ID:",p));try{const e=(null==a?void 0:a.id)||(null==a?void 0:a._id)||(null==a?void 0:a.userId)||(null==a?void 0:a.username)||(null==a?void 0:a.phone)||null;if(e&&h.value){t("log","at pages/online-consult/chat.vue:758","ğŸ”„ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°...",{patientId:o,doctorId:h.value,createdBy:e});const a=await Pe({url:"/chat/consultation",method:"POST",data:{patientId:o,doctorId:h.value,patientInfo:d.patientInfo,symptomDescription:d.symptomDescription,symptomImages:d.symptomImages,createdBy:e},needAuth:!0,showLoading:!0,showError:!0});a.success&&a.data?(t("log","at pages/online-consult/chat.vue:781","âœ… å’¨è¯¢è®°å½•å·²åŒæ­¥åˆ°åå°:",a.data._id||a.data.id),(a.data._id||a.data.id)&&(f=a.data._id||a.data.id)):t("warn","at pages/online-consult/chat.vue:787","âš ï¸ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°å¤±è´¥:",a.message||"æœªçŸ¥é”™è¯¯")}else t("warn","at pages/online-consult/chat.vue:790","âš ï¸ æ— æ³•åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°ï¼šç¼ºå°‘å‰å°è´¦å·IDæˆ–åŒ»ç”ŸID",{hasFrontDeskUserId:!!e,hasDoctorId:!!h.value})}catch(e){t("error","at pages/online-consult/chat.vue:796","âŒ åŒæ­¥å’¨è¯¢è®°å½•åˆ°åå°å¤±è´¥:",e)}t("log","at pages/online-consult/chat.vue:800","âœ… å’¨è¯¢è®°å½•å·²ä¿å­˜ï¼ˆåŒ…å«æœ€æ–°æ¶ˆæ¯ï¼‰:",p,"æ‚£è€…ID:",o,"æ¶ˆæ¯æ•°:",c.length)}catch(a){t("error","at pages/online-consult/chat.vue:802","âŒ ä¿å­˜å’¨è¯¢è®°å½•å¤±è´¥:",a)}}async function A(e){return new Promise(((t,a)=>{e.startsWith("data:")?t(e):uni.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:a=>{var o;const n=(null==(o=e.split(".").pop())?void 0:o.toLowerCase())||"jpg";t(`data:${"png"===n?"image/png":"image/jpeg"};base64,${a.data}`)},fail:()=>a(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))})}))}function U(){e.nextTick((()=>{X.value=999999,setTimeout((()=>{X.value=999999}),100)}))}e.onMounted((async()=>{const a=getApp();if(a.globalData&&a.globalData.consultData){const o=a.globalData.consultData;o.consultationId&&(f=o.consultationId,t("log","at pages/online-consult/chat.vue:815","âœ… æ¢å¤å’¨è¯¢è®°å½•ID:",f,'ï¼ˆä»"æˆ‘çš„å’¨è¯¢"è¿›å…¥ï¼Œä¸ä¼šåˆ›å»ºæ–°è®°å½•ï¼‰')),o.doctorId&&(h.value=o.doctorId,t("log","at pages/online-consult/chat.vue:821","âœ… æ¢å¤åŒ»ç”ŸID:",h.value,"ï¼ˆç¡®ä¿ä½¿ç”¨åŒä¸€ä¸ªåŒ»ç”Ÿï¼Œä¸ä¼šåˆ›å»ºæ–°è®°å½•ï¼‰")),o.patientId&&(v=o.patientId,t("log","at pages/online-consult/chat.vue:827","âœ… æ¢å¤æ‚£è€…ID:",v)),o.description&&(s.value=o.description),o.patient&&(n.value={name:o.patient.name,gender:o.patient.gender,age:o.patient.age},o.patient.id&&(v=o.patient.id)),o.files&&o.files.length>0&&(r.value=o.files.map((e=>({path:e.path,thumb:e.thumb||e.path,type:e.type||"image"})))),o.messages&&o.messages.length>0&&(m.value=o.messages.map((e=>({id:e.id,content:e.content,type:e.type||"text",isMe:e.isMe,timestamp:e.timestamp}))),e.nextTick((()=>{U()})))}if(!h.value||"doctor_001"===h.value)try{const e=await Pe({url:"/chat/on-duty-doctors",method:"GET",data:{},needAuth:!0,showLoading:!1,showError:!1});e.success&&e.data&&e.data.length>0?(h.value=e.data[0],t("log","at pages/online-consult/chat.vue:887","âœ… ä»åç«¯è·å–åˆ°åœ¨å²—åŒ»ç”ŸID:",h.value)):t("warn","at pages/online-consult/chat.vue:889","âš ï¸ æ²¡æœ‰åœ¨å²—åŒ»ç”Ÿï¼Œä½¿ç”¨é»˜è®¤åŒ»ç”ŸID:",h.value)}catch(o){t("warn","at pages/online-consult/chat.vue:892","âš ï¸ è·å–åœ¨å²—åŒ»ç”Ÿåˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åŒ»ç”ŸID:",o)}await async function(){var a;try{uni.showLoading({title:"è¿æ¥ä¸­..."}),t("log","at pages/online-consult/chat.vue:946","ğŸ”„ å¼€å§‹åˆå§‹åŒ– Socket.IO æœåŠ¡...");const i=ae(),l=getApp&&getApp(),c=(null==(a=null==l?void 0:l.globalData)?void 0:a.consultData)||{};let d=null;try{d=uni.getStorageSync("currentPatientId")||null}catch(Kt){t("warn","at pages/online-consult/chat.vue:958","âš ï¸ è¯»å–æœ¬åœ° patientId å¤±è´¥:",Kt)}let u=d||v||c.patientId||null;i&&!u&&(u=i.id||i._id||i.userId||i.username||i.phone||null,t("log","at pages/online-consult/chat.vue:964","âœ… ä»ç™»å½•ä¿¡æ¯è·å–æ‚£è€…ID:",u,"ç”¨æˆ·ä¿¡æ¯å­—æ®µ:",Object.keys(i))),u||(u=`patient_${Date.now()}`,t("warn","at pages/online-consult/chat.vue:970","âš ï¸ æœªæ‰¾åˆ°æ‚£è€…IDï¼Œä½¿ç”¨ä¸´æ—¶ID:",u)),v=u,t("log","at pages/online-consult/chat.vue:974","ğŸ‘¤ æ‚£è€…ID:",u),t("log","at pages/online-consult/chat.vue:975","ğŸ‘¤ æ‚£è€…ä¿¡æ¯:",n.value),await Ci(u,{name:n.value.name,avatar:(null==i?void 0:i.avatar)||"ğŸ‘¤",gender:n.value.gender,age:n.value.age,userId:u}),g.value=!0,t("log","at pages/online-consult/chat.vue:987","âœ… Socket.IO è¿æ¥æˆåŠŸ"),ki||t("warn","at utils/socket.js:347","âš ï¸ Socket.IO æœªè¿æ¥ï¼Œæ— æ³•ç›‘å¬æ¶ˆæ¯");try{const a=await T();if(a.length>0){t("log","at pages/online-consult/chat.vue:1011","âœ… ä»åç«¯åŠ è½½",a.length,"æ¡æœ€æ–°æ¶ˆæ¯");const o=new Map;m.value.forEach((e=>{const t=e.id||`${e.timestamp}_${e.content}`;o.set(t,e)})),a.forEach((e=>{const t=e.id||`${e.timestamp}_${e.content}`,a=o.get(t);(!a||a.timestamp<e.timestamp)&&o.set(t,e)})),m.value=Array.from(o.values()).sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),e.nextTick((()=>{U()}))}else 0===m.value.length?t("log","at pages/online-consult/chat.vue:1040","â„¹ï¸ åç«¯å’Œæœ¬åœ°éƒ½æ²¡æœ‰æ¶ˆæ¯ï¼Œè¿™æ˜¯æ–°å’¨è¯¢"):t("log","at pages/online-consult/chat.vue:1043",'â„¹ï¸ åç«¯æ²¡æœ‰æ–°æ¶ˆæ¯ï¼Œä½¿ç”¨æœ¬åœ°æ¶ˆæ¯ï¼ˆä»"æˆ‘çš„å’¨è¯¢"è¿›å…¥ï¼‰')}catch(o){t("error","at pages/online-consult/chat.vue:1046","âŒ åŠ è½½æœ€æ–°æ¶ˆæ¯å¤±è´¥:",o),m.value.length>0&&t("log","at pages/online-consult/chat.vue:1049",'âœ… ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯ï¼ˆä»"æˆ‘çš„å’¨è¯¢"è¿›å…¥ï¼‰')}await async function(){try{if(f)return void t("log","at pages/online-consult/chat.vue:1160","â„¹ï¸ è¿™æ˜¯å·²æœ‰å’¨è¯¢è®°å½•ï¼Œè·³è¿‡å‘é€å’¨è¯¢ä¿¡æ¯");const e=s.value&&s.value.trim().length>0,a=r.value&&r.value.length>0;if(!e&&!a)return void t("log","at pages/online-consult/chat.vue:1170","â„¹ï¸ æ²¡æœ‰å’¨è¯¢å†…å®¹ï¼Œè·³è¿‡å‘é€å’¨è¯¢ä¿¡æ¯");let i="";const l=n.value.name&&n.value.name.trim()?n.value.name.trim():"",c=n.value.gender&&n.value.gender.trim()?n.value.gender.trim():"",d=n.value.age&&n.value.age>0?n.value.age:0;if(l||c||d>0){const e=[l,c,d>0?`${d}å²`:""].filter(Boolean).join(" ");e&&(i+=`æ‚£è€…ä¿¡æ¯ï¼š${e}\n\n`)}if(s.value&&s.value.trim()&&(i+=`ç—‡çŠ¶æè¿°ï¼š${s.value.trim()}\n\n`),r.value.length>0){const e=r.value.filter((e=>"image"===e.type)).length,t=r.value.filter((e=>"video"===e.type)).length;e>0&&(i+=`å·²ä¸Šä¼  ${e} å¼ å›¾ç‰‡\n`),t>0&&(i+=`å·²ä¸Šä¼  ${t} ä¸ªè§†é¢‘\n`)}const u=i.trim(),p=s.value&&s.value.trim()||r.value.length>0;if(u&&p)try{const e=ae(),a=(null==e?void 0:e.id)||(null==e?void 0:e._id)||(null==e?void 0:e.userId)||(null==e?void 0:e.username)||(null==e?void 0:e.phone)||null;await bi(h.value,0,"text",{},a),t("log","at pages/online-consult/chat.vue:1218","âœ… æ–‡æœ¬å’¨è¯¢ä¿¡æ¯å·²å‘é€")}catch(o){t("error","at pages/online-consult/chat.vue:1220","âŒ å‘é€æ–‡æœ¬å’¨è¯¢ä¿¡æ¯å¤±è´¥:",o)}else t("log","at pages/online-consult/chat.vue:1224","â„¹ï¸ å’¨è¯¢å†…å®¹ä¸ºç©ºæˆ–æ— æ•ˆï¼Œè·³è¿‡å‘é€æ–‡æœ¬æ¶ˆæ¯");if(r.value.length>0){t("log","at pages/online-consult/chat.vue:1229",`ğŸ“¸ å¼€å§‹é€ä¸ªå‘é€ ${r.value.length} ä¸ªåª’ä½“æ–‡ä»¶`);for(let e=0;e<r.value.length;e++){const a=r.value[e];try{const o=a.path||a.thumb||a;t("log","at pages/online-consult/chat.vue:1235",`ğŸ“¤ æ­£åœ¨å‘é€ç¬¬ ${e+1}/${r.value.length} ä¸ªæ–‡ä»¶...`);await A(o);const n=ae(),s=(null==n?void 0:n.id)||(null==n?void 0:n._id)||(null==n?void 0:n.userId)||(null==n?void 0:n.username)||(null==n?void 0:n.phone)||null;await bi(h.value,0,"image",{index:e,total:r.value.length,originalType:a.type||"image"},s),t("log","at pages/online-consult/chat.vue:1249",`âœ… ç¬¬ ${e+1} ä¸ªæ–‡ä»¶å‘é€æˆåŠŸ`),e<r.value.length-1&&await new Promise((e=>setTimeout(e,500)))}catch(o){t("error","at pages/online-consult/chat.vue:1256",`âŒ å‘é€ç¬¬ ${e+1} ä¸ªæ–‡ä»¶å¤±è´¥:`,o)}}t("log","at pages/online-consult/chat.vue:1261","âœ… æ‰€æœ‰åª’ä½“æ–‡ä»¶å‘é€å®Œæˆ")}if(r.value.length>0&&r.value.length<=3)try{const e=await Promise.all(r.value.map((async e=>{try{const t=e.path||e.thumb||e,a=await A(t);return{url:a,type:e.type||"image",thumb:a}}catch(o){return t("error","at pages/online-consult/chat.vue:1278","è½¬æ¢å›¾ç‰‡å¤±è´¥:",o),{url:e.path||e.thumb||e,type:e.type||"image",thumb:e.thumb||e.path||e}}}))),a={patientInfo:{name:n.value.name,gender:n.value.gender,age:n.value.age},symptomDescription:s.value||"",images:e},i=ae(),l=(null==i?void 0:i.id)||(null==i?void 0:i._id)||(null==i?void 0:i.userId)||(null==i?void 0:i.username)||(null==i?void 0:i.phone)||null,c=await bi(h.value,JSON.stringify(a),"patient-card",{patientCardData:a},l);t("log","at pages/online-consult/chat.vue:1307","âœ… æ‚£è€…ä¿¡æ¯å¡ç‰‡å·²å‘é€ç»™åŒ»ç”Ÿ");const d={id:c.messageId||`card_${Date.now()}`,content:JSON.stringify(a),type:"patient-card",isMe:!0,timestamp:c.timestamp||Date.now(),patientCardData:a};m.value.findIndex((e=>e.id===d.id))<0&&(m.value.push(d),m.value.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),t("log","at pages/online-consult/chat.vue:1325","âœ… æ‚£è€…ä¿¡æ¯å¡ç‰‡å·²æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨")),await P()}catch(o){t("error","at pages/online-consult/chat.vue:1331","âŒ å‘é€æ‚£è€…ä¿¡æ¯å¡ç‰‡å¤±è´¥ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰:",o)}}catch(o){t("error","at pages/online-consult/chat.vue:1337","âŒ å‘é€å’¨è¯¢ä¿¡æ¯å¤±è´¥:",o)}}(),P(),U(),B(),uni.hideLoading(),uni.showToast({title:"è¿æ¥æˆåŠŸ",icon:"success",duration:1500})}catch(o){uni.hideLoading(),t("error","at pages/online-consult/chat.vue:1076","âŒ Socket.IO åˆå§‹åŒ–å¤±è´¥:",o);const a=o.message||"è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";uni.showModal({title:"è¿æ¥å¤±è´¥",content:a+"\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸",showCancel:!1,confirmText:"çŸ¥é“äº†"}),g.value=!1}}()})),e.watch(m,(()=>{m.value.length>0&&(m.value.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),P(),U())})),e.onUnmounted((()=>{_(),P(),xi()}));const M=()=>{uni.navigateBack()},$=async()=>{uni.showModal({title:"åŠŸèƒ½æç¤º",content:"APP ç¯å¢ƒä¸‹å®æ—¶è§†é¢‘é€šè¯éœ€è¦é›†æˆåŸç”Ÿæ’ä»¶æˆ–ç¬¬ä¸‰æ–¹ SDKï¼ˆå¦‚è…¾è®¯äº‘ TRTCã€å£°ç½‘ Agoraï¼‰ã€‚\n\nå½“å‰å¯ä»¥ä½¿ç”¨å›¾ç‰‡/è§†é¢‘é€‰æ‹©åŠŸèƒ½è¿›è¡Œå’¨è¯¢ã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"})},L=async()=>{uni.showModal({title:"åŠŸèƒ½æç¤º",content:"APP ç¯å¢ƒä¸‹å®æ—¶è¯­éŸ³é€šè¯éœ€è¦é›†æˆåŸç”Ÿæ’ä»¶æˆ–ç¬¬ä¸‰æ–¹ SDKï¼ˆå¦‚è…¾è®¯äº‘ TRTCã€å£°ç½‘ Agoraï¼‰ã€‚\n\nå½“å‰å¯ä»¥ä½¿ç”¨å›¾ç‰‡/è§†é¢‘é€‰æ‹©åŠŸèƒ½è¿›è¡Œå’¨è¯¢ã€‚",showCancel:!1,confirmText:"çŸ¥é“äº†"})},F=()=>{k.value=!1,x.value=""},R=()=>{},O=()=>{},j=()=>{},z=e=>{t("error","at pages/online-consult/chat.vue:1869","è§†é¢‘æ’­æ”¾é”™è¯¯:",e),uni.showToast({title:"è§†é¢‘æ— æ³•æ’­æ”¾ï¼Œè¯·æ£€æŸ¥æ ¼å¼",icon:"none",duration:2e3})},q=()=>{c.value=!1,d.value="",u.value=""};function H(){Z.value=!Z.value,Z.value&&(te.value=!1)}function W(){Z.value=!1}function J(){te.value=!te.value,te.value&&(Z.value=!1)}function K(){te.value=!1}function G(){g.value?uni.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:async e=>{t("log","at pages/online-consult/chat.vue:2037","ğŸ“¸ é€‰æ‹©çš„å›¾ç‰‡:",e.tempFilePaths);for(const t of e.tempFilePaths)await Y(t)},fail:e=>{e.errMsg&&!e.errMsg.includes("cancel")&&(t("error","at pages/online-consult/chat.vue:2047","é€‰æ‹©å›¾ç‰‡å¤±è´¥:",e),uni.showToast({title:"é€‰æ‹©å›¾ç‰‡å¤±è´¥",icon:"none"}))}}):uni.showToast({title:"æœªè¿æ¥ï¼Œè¯·ç¨å€™",icon:"none"})}async function Y(e){if(g.value)try{const a=await A(e),o={id:Date.now().toString()+Math.random().toString(36).substr(2,9),content:a,type:"image",isMe:!0,timestamp:Date.now()};m.value.push(o),m.value.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),U();const n=I(),s=ae(),i=(null==s?void 0:s.id)||(null==s?void 0:s._id)||(null==s?void 0:s.userId)||(null==s?void 0:s.username)||(null==s?void 0:s.phone)||null;t("log","at pages/online-consult/chat.vue:2089","ğŸ“¤ æ‚£è€…ç«¯å‘é€å›¾ç‰‡æ¶ˆæ¯:",{fromUserId:n,toUserId:h.value,createdBy:i,imageSize:a.length}),await bi(h.value,0,"image",{},i),await P(),t("log","at pages/online-consult/chat.vue:2100","âœ… å›¾ç‰‡æ¶ˆæ¯å‘é€æˆåŠŸï¼ˆæ‚£è€… -> åŒ»ç”Ÿï¼‰ï¼Œå·²ä¿å­˜åˆ°å’¨è¯¢è®°å½•")}catch(a){t("error","at pages/online-consult/chat.vue:2102","å‘é€å›¾ç‰‡æ¶ˆæ¯å¤±è´¥:",a),uni.showToast({title:a.message||"å‘é€å›¾ç‰‡å¤±è´¥",icon:"none"});const e=m.value.length-1;e>=0&&m.value[e].isMe&&"image"===m.value[e].type&&m.value.splice(e,1)}}async function Q(){if(l.value.trim())if(g.value)try{const e=l.value.trim(),a={id:Date.now().toString(),content:e,type:"text",isMe:!0,timestamp:Date.now()};m.value.push(a),m.value.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),l.value="",U();const o=I();if(!o)throw new Error("æ‚£è€…IDæœªè®¾ç½®");if(!h.value)throw new Error("åŒ»ç”ŸIDæœªè®¾ç½®");const n=ae(),s=(null==n?void 0:n.id)||(null==n?void 0:n._id)||(null==n?void 0:n.userId)||(null==n?void 0:n.username)||(null==n?void 0:n.phone)||null;t("log","at pages/online-consult/chat.vue:2168","ğŸ“¤ æ‚£è€…ç«¯å‘é€æ¶ˆæ¯:",{fromUserId:o,toUserId:h.value,createdBy:s,content:e}),await bi(h.value,0,"text",{},s),await P(),uni.showToast({title:"å·²å‘é€",icon:"success",duration:1e3}),t("log","at pages/online-consult/chat.vue:2185","âœ… æ¶ˆæ¯å‘é€æˆåŠŸï¼ˆæ‚£è€… -> åŒ»ç”Ÿï¼‰ï¼Œå·²ä¿å­˜åˆ°å’¨è¯¢è®°å½•")}catch(e){t("error","at pages/online-consult/chat.vue:2187","å‘é€æ¶ˆæ¯å¤±è´¥:",e),uni.showToast({title:e.message||"å‘é€å¤±è´¥",icon:"none"});const a=m.value.length-1;a>=0&&m.value[a].isMe&&m.value.splice(a,1)}else uni.showToast({title:"æœªè¿æ¥ï¼Œè¯·ç¨å€™",icon:"none"});else uni.showToast({title:"è¯·è¾“å…¥æ¶ˆæ¯",icon:"none"})}const X=e.ref(0),Z=e.ref(!1),ee=["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Œ","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ¤¨","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ¤¯","ğŸ˜³","ğŸ¥µ","ğŸ¥¶","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤”","ğŸ¤­","ğŸ¤«","ğŸ¤¥","ğŸ˜¶","ğŸ˜","ğŸ˜‘","ğŸ˜¬","ğŸ™„","ğŸ˜¯","ğŸ˜¦","ğŸ˜§","ğŸ˜®","ğŸ˜²","ğŸ¥±","ğŸ˜´","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ","ğŸ¤","ğŸ¥´","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤‘","ğŸ¤ ","ğŸ˜ˆ","ğŸ‘¿","ğŸ‘¹","ğŸ‘º","ğŸ¤¡","ğŸ’©","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ¤–","ğŸƒ","ğŸ˜º","ğŸ˜¸","ğŸ˜¹","ğŸ˜»","ğŸ˜¼","ğŸ˜½","ğŸ™€","ğŸ˜¿","ğŸ˜¾","ğŸ‘‹","ğŸ¤š","ğŸ–","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘","ğŸ‘","âœŠ","ğŸ‘Š","ğŸ¤›","ğŸ¤œ","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²","ğŸ¤","ğŸ™","âœï¸","ğŸ’ª","ğŸ¦¾","ğŸ¦¿","ğŸ¦µ","ğŸ¦¶","ğŸ‘‚","ğŸ¦»","ğŸ‘ƒ","ğŸ‘¶","ğŸ‘§","ğŸ§’","ğŸ‘¦","ğŸ‘©","ğŸ§‘","ğŸ‘¨","ğŸ‘©â€ğŸ¦±","ğŸ§‘â€ğŸ¦±","ğŸ‘¨â€ğŸ¦±","ğŸ‘©â€ğŸ¦°","ğŸ§‘â€ğŸ¦°","ğŸ‘¨â€ğŸ¦°","ğŸ‘±â€â™€ï¸","ğŸ‘±","ğŸ‘±â€â™‚ï¸","ğŸ‘©â€ğŸ¦³","ğŸ§‘â€ğŸ¦³","ğŸ‘¨â€ğŸ¦³","ğŸ‘©â€ğŸ¦²","ğŸ§‘â€ğŸ¦²","ğŸ‘¨â€ğŸ¦²","ğŸ§”","ğŸ‘µ","ğŸ§“","ğŸ‘´","ğŸ‘²","ğŸ‘³â€â™€ï¸","ğŸ‘³","ğŸ‘³â€â™‚ï¸","ğŸ§•","ğŸ‘®â€â™€ï¸","ğŸ‘®","ğŸ‘®â€â™‚ï¸","ğŸ‘·â€â™€ï¸","ğŸ‘·","ğŸ‘·â€â™‚ï¸","ğŸ’‚â€â™€ï¸","ğŸ’‚","ğŸ’‚â€â™‚ï¸","ğŸ•µï¸â€â™€ï¸","ğŸ•µï¸","ğŸ•µï¸â€â™‚ï¸","ğŸ‘©â€âš•ï¸","ğŸ§‘â€âš•ï¸","ğŸ‘¨â€âš•ï¸","ğŸ‘©â€ğŸŒ¾","ğŸ§‘â€ğŸŒ¾","ğŸ‘¨â€ğŸŒ¾","ğŸ‘©â€ğŸ³","ğŸ§‘â€ğŸ³","ğŸ‘¨â€ğŸ³","ğŸ‘©â€ğŸ“","ğŸ§‘â€ğŸ“","ğŸ‘¨â€ğŸ“","ğŸ‘©â€ğŸ¤","ğŸ§‘â€ğŸ¤","ğŸ‘¨â€ğŸ¤","ğŸ‘©â€ğŸ«","ğŸ§‘â€ğŸ«","ğŸ‘¨â€ğŸ«","ğŸ‘©â€ğŸ­","ğŸ§‘â€ğŸ­","ğŸ‘¨â€ğŸ­","ğŸ‘©â€ğŸ’»","ğŸ§‘â€ğŸ’»","ğŸ‘¨â€ğŸ’»","ğŸ‘©â€ğŸ’¼","ğŸ§‘â€ğŸ’¼","ğŸ‘¨â€ğŸ’¼","ğŸ‘©â€ğŸ”§","ğŸ§‘â€ğŸ”§","ğŸ‘¨â€ğŸ”§","ğŸ‘©â€ğŸ”¬","ğŸ§‘â€ğŸ”¬","ğŸ‘¨â€ğŸ”¬","ğŸ‘©â€ğŸ¨","ğŸ§‘â€ğŸ¨","ğŸ‘¨â€ğŸ¨","ğŸ‘©â€ğŸš’","ğŸ§‘â€ğŸš’","ğŸ‘¨â€ğŸš’","ğŸ‘©â€âœˆï¸","ğŸ§‘â€âœˆï¸","ğŸ‘¨â€âœˆï¸","ğŸ‘©â€ğŸš€","ğŸ§‘â€ğŸš€","ğŸ‘¨â€ğŸš€","ğŸ‘©â€âš–ï¸","ğŸ§‘â€âš–ï¸","ğŸ‘¨â€âš–ï¸","ğŸ‘°","ğŸ¤µ","ğŸ‘¸","ğŸ¤´","ğŸ¦¸â€â™€ï¸","ğŸ¦¸","ğŸ¦¸â€â™‚ï¸","ğŸ¦¹â€â™€ï¸","ğŸ¦¹","ğŸ¦¹â€â™‚ï¸","ğŸ¤¶","ğŸ…","ğŸ§™â€â™€ï¸","ğŸ§™","ğŸ§™â€â™‚ï¸","ğŸ§â€â™€ï¸","ğŸ§","ğŸ§â€â™‚ï¸","ğŸ§›â€â™€ï¸","ğŸ§›","ğŸ§›â€â™‚ï¸","ğŸ§œâ€â™€ï¸","ğŸ§œ","ğŸ§œâ€â™‚ï¸","ğŸ§šâ€â™€ï¸","ğŸ§š","ğŸ§šâ€â™‚ï¸","ğŸ‘¼","ğŸ¤°","ğŸ¤±","ğŸ‘©â€ğŸ¼","ğŸ§‘â€ğŸ¼","ğŸ‘¨â€ğŸ¼","ğŸ™‡â€â™€ï¸","ğŸ™‡","ğŸ™‡â€â™‚ï¸","ğŸ’â€â™€ï¸","ğŸ’","ğŸ’â€â™‚ï¸","ğŸ™…â€â™€ï¸","ğŸ™…","ğŸ™…â€â™‚ï¸","ğŸ™†â€â™€ï¸","ğŸ™†","ğŸ™†â€â™‚ï¸","ğŸ™‹â€â™€ï¸","ğŸ™‹","ğŸ™‹â€â™‚ï¸","ğŸ§â€â™€ï¸","ğŸ§","ğŸ§â€â™‚ï¸","ğŸ¤¦â€â™€ï¸","ğŸ¤¦","ğŸ¤¦â€â™‚ï¸","ğŸ¤·â€â™€ï¸","ğŸ¤·","ğŸ¤·â€â™‚ï¸","ğŸ™â€â™€ï¸","ğŸ™","ğŸ™â€â™‚ï¸","ğŸ™â€â™€ï¸","ğŸ™","ğŸ™â€â™‚ï¸","ğŸ’‡â€â™€ï¸","ğŸ’‡","ğŸ’‡â€â™‚ï¸","ğŸ’†â€â™€ï¸","ğŸ’†","ğŸ’†â€â™‚ï¸","ğŸ§–â€â™€ï¸","ğŸ§–","ğŸ§–â€â™‚ï¸","ğŸ’ƒ","ğŸ•º","ğŸ•´","ğŸ‘¯â€â™€ï¸","ğŸ‘¯","ğŸ‘¯â€â™‚ï¸","ğŸ§˜â€â™€ï¸","ğŸ§˜","ğŸ§˜â€â™‚ï¸","ğŸ›€","ğŸ›Œ","ğŸ‘­","ğŸ‘«","ğŸ‘¬","ğŸ’","ğŸ’‘","ğŸ‘ª","ğŸ‘¨â€ğŸ‘©â€ğŸ‘§","ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§","ğŸ‘©â€ğŸ‘©â€ğŸ‘¦","ğŸ‘©â€ğŸ‘©â€ğŸ‘§","ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦","ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦","ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§","ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§","ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§","ğŸ‘©â€ğŸ‘¦","ğŸ‘©â€ğŸ‘§","ğŸ‘©â€ğŸ‘§â€ğŸ‘¦","ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦","ğŸ‘©â€ğŸ‘§â€ğŸ‘§","ğŸ‘¨â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘§","ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦","ğŸ‘¨â€ğŸ‘§â€ğŸ‘§","ğŸ§¶","ğŸ§µ","ğŸ§¥","ğŸ¥¼","ğŸ¦º","ğŸ‘š","ğŸ‘•","ğŸ‘–","ğŸ©²","ğŸ©³","ğŸ‘”","ğŸ‘—","ğŸ‘™","ğŸ‘˜","ğŸ¥»","ğŸ©±","ğŸ¥½","ğŸ¥¼","ğŸ§¦","ğŸ§¤","ğŸ§£","ğŸ§¢","ğŸ‘’","ğŸ©","ğŸ“","â›‘","ğŸ“¿","ğŸ’„","ğŸ’","ğŸ’","ğŸ”‡","ğŸ”ˆ","ğŸ”‰","ğŸ”Š","ğŸ“¢","ğŸ“£","ğŸ“¯","ğŸ””","ğŸ”•","ğŸ¼","ğŸµ","ğŸ¶","ğŸ™","ğŸš","ğŸ›","ğŸ¤","ğŸ§","ğŸ“»","ğŸ·","ğŸª—","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸª•","ğŸ¥³","ğŸª","ğŸ­","ğŸ©°","ğŸ¨","ğŸ¬","ğŸ¤","ğŸ§","ğŸ¼","ğŸ¹","ğŸ¸","ğŸº","ğŸ»","ğŸ¥","ğŸ·","ğŸº","ğŸ¸","ğŸ¹","ğŸ¤","ğŸ§"],te=e.ref(!1),oe=["å¥½çš„ï¼Œè°¢è°¢åŒ»ç”Ÿ","æˆ‘æ˜ç™½äº†","è¿˜æœ‰é—®é¢˜","ç—‡çŠ¶å·²ç»å¥½è½¬","éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥","æˆ‘ä¼šæŒ‰æ—¶æœè¯","è°¢è°¢æ‚¨çš„å»ºè®®","æˆ‘ä¼šæ³¨æ„çš„","æ˜ç™½äº†ï¼Œè°¢è°¢","ç—‡çŠ¶æ²¡æœ‰æ”¹å–„","æˆ‘ä¼šæŒ‰æ—¶å¤æŸ¥","è¿˜æœ‰å…¶ä»–ç—‡çŠ¶","éœ€è¦è°ƒæ•´ç”¨è¯å—","è°¢è°¢æ‚¨çš„è€å¿ƒ","æˆ‘ä¼šé…åˆæ²»ç–—","ç—‡çŠ¶æœ‰æ‰€ç¼“è§£","éœ€è¦åšæ£€æŸ¥å—","æˆ‘ä¼šæ³¨æ„é¥®é£Ÿ","è°¢è°¢åŒ»ç”Ÿ","æˆ‘ç†è§£äº†"];return(o,v)=>{const f=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"chat-page"},[e.createElementVNode("view",{class:"header-blue"},[e.createElementVNode("view",{class:"header-content"},[e.createElementVNode("view",{class:"back-btn",onClick:M},[e.createVNode(f,{type:"left",size:"20",color:"#fff"})]),e.createElementVNode("view",{class:"header-center"},[e.createElementVNode("text",{class:"header-title"},"åœ¨çº¿å’¨è¯¢ä¸­"),e.createElementVNode("text",{class:"header-subtitle"},"å’¨è¯¢æ—¶é—´ç»“æŸå‰å¯ä¸é™æ¬¡æ•°å‘åŒ»ç”Ÿæé—®")]),e.createElementVNode("view",{class:"header-time"},[e.createElementVNode("text",{class:"time-text"},"å‰©ä½™å’¨è¯¢æ—¶é—´ 24å°æ—¶")])])]),e.createElementVNode("scroll-view",{ref_key:"scrollViewRef",ref:p,class:"chat-content","scroll-y":"","scroll-top":X.value,"scroll-with-animation":""},[s.value||r.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"message-wrapper patient-wrapper"},[e.createElementVNode("view",{class:"message-card patient-card"},[e.createElementVNode("view",{class:"patient-header"},[e.createElementVNode("view",{class:"patient-avatar"},"ğŸ‘¤"),e.createElementVNode("text",{class:"patient-info"},e.toDisplayString(n.value.name)+" "+e.toDisplayString(n.value.gender)+" | "+e.toDisplayString(n.value.age)+"å²",1)]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"symptom-section"},[e.createElementVNode("text",{class:"symptom-label"},"ç—‡çŠ¶æè¿°:"),e.createElementVNode("text",{class:"symptom-text"},e.toDisplayString(s.value),1)])):e.createCommentVNode("",!0),r.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"symptom-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"image-item",onClick:e=>(e=>{const t=r.value[e];if("video"===t.type){let e=t.path||t.thumb||t;return"string"==typeof e&&e?(d.value=e,u.value=t.thumb||"",void(c.value=!0)):void uni.showToast({title:"è§†é¢‘è·¯å¾„æ— æ•ˆ",icon:"none"})}const a=r.value.filter((e=>"video"!==e.type)).map((e=>e.path||e.thumb||e)),o=r.value.slice(0,e).filter((e=>"video"!==e.type)).length;uni.previewImage({current:o,urls:a})})(a)},[e.createElementVNode("image",{src:t.thumb||t.path||t,mode:"aspectFill",class:"symptom-img"},null,8,["src"]),"video"===t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-badge"},"è§†é¢‘")):e.createCommentVNode("",!0)],8,["onClick"])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"patient-avatar-small"},"ğŸ‘¤")])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||a,class:e.normalizeClass(["message-wrapper",t.isMe?"patient-wrapper":"doctor-wrapper"])},[t.isMe?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"doctor-avatar"},"ğŸ‘¨â€âš•ï¸")),e.createElementVNode("view",{class:e.normalizeClass(["message-card",t.isMe?"patient-message":"doctor-card"])},["text"===t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"message-text"},e.toDisplayString(t.content),1)):"image"===t.type?(e.openBlock(),e.createElementBlock("view",{key:1,class:"message-image"},[e.createElementVNode("image",{src:t.content,mode:"aspectFill",class:"chat-image",onClick:e=>{var a;(a=t.content)&&uni.previewImage({urls:[a],current:a})}},null,8,["src","onClick"])])):e.createCommentVNode("",!0)],2),t.isMe?(e.openBlock(),e.createElementBlock("view",{key:1,class:"patient-avatar-small"},"ğŸ‘¤")):e.createCommentVNode("",!0)],2)))),128)),g.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"connection-status"},[e.createElementVNode("text",null,"æ­£åœ¨è¿æ¥...")]))],8,["scroll-top"]),e.createElementVNode("view",{class:"input-area"},[e.createElementVNode("view",{class:"input-buttons-row"},[e.createElementVNode("view",{class:"call-btn",onClick:$,title:"è§†é¢‘é€šè¯"},[e.createElementVNode("text",{class:"call-icon"},"ğŸ“¹")]),e.createElementVNode("view",{class:"call-btn",onClick:L,title:"è¯­éŸ³é€šè¯"},[e.createElementVNode("text",{class:"call-icon"},"ğŸ“")]),e.createElementVNode("view",{class:"image-btn album-btn",onClick:G,title:"ç›¸å†Œ"},[e.createElementVNode("text",{class:"image-icon"},"ğŸ–¼ï¸")]),e.createElementVNode("view",{class:"emoji-btn",onClick:H,title:"è¡¨æƒ…"},[e.createElementVNode("text",{class:"emoji-icon"},"ğŸ˜Š")]),e.createElementVNode("view",{class:"tag-btn",onClick:J,title:"æ ‡ç­¾"},[e.createElementVNode("text",{class:"tag-icon"},"ğŸ·ï¸")])]),e.createElementVNode("view",{class:"input-row"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":v[0]||(v[0]=e=>l.value=e),class:"chat-input",placeholder:"è¾“å…¥...","placeholder-class":"input-placeholder"},null,512),[[e.vModelText,l.value]]),e.createElementVNode("button",{class:"send-btn",onClick:Q,disabled:!g.value},"å‘é€",8,["disabled"])])]),Z.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"emoji-picker-container"},[e.createElementVNode("view",{class:"emoji-picker-header"},[e.createElementVNode("text",{class:"emoji-picker-title"},"é€‰æ‹©è¡¨æƒ…"),e.createElementVNode("view",{class:"emoji-picker-close",onClick:W},"Ã—")]),e.createElementVNode("scroll-view",{class:"emoji-picker-content","scroll-y":""},[e.createElementVNode("view",{class:"emoji-grid"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(ee,((t,a)=>e.createElementVNode("view",{key:a,class:"emoji-item",onClick:e=>function(e){l.value+=e,W()}(t)},[e.createElementVNode("text",{class:"emoji-text"},e.toDisplayString(t),1)],8,["onClick"]))),64))])])])):e.createCommentVNode("",!0),te.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"tag-picker-container"},[e.createElementVNode("view",{class:"tag-picker-header"},[e.createElementVNode("text",{class:"tag-picker-title"},"å¿«æ·æ¶ˆæ¯"),e.createElementVNode("view",{class:"tag-picker-close",onClick:K},"Ã—")]),e.createElementVNode("scroll-view",{class:"tag-picker-content","scroll-y":""},[e.createElementVNode("view",{class:"tag-list"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(oe,((a,o)=>e.createElementVNode("view",{key:o,class:"tag-item",onClick:e=>async function(e){if(K(),g.value)try{const a={id:Date.now().toString(),content:e,type:"text",isMe:!0,timestamp:Date.now()};m.value.push(a),m.value.sort(((e,t)=>(e.timestamp||0)-(t.timestamp||0))),U();const o=I();if(!o)throw new Error("æ‚£è€…IDæœªè®¾ç½®");if(!h.value)throw new Error("åŒ»ç”ŸIDæœªè®¾ç½®");const n=ae(),s=(null==n?void 0:n.id)||(null==n?void 0:n._id)||(null==n?void 0:n.userId)||(null==n?void 0:n.username)||(null==n?void 0:n.phone)||null;t("log","at pages/online-consult/chat.vue:1993","ğŸ“¤ æ‚£è€…ç«¯å‘é€æ ‡ç­¾æ¶ˆæ¯:",{fromUserId:o,toUserId:h.value,createdBy:s,content:e}),await bi(h.value,0,"text",{},s),await P(),t("log","at pages/online-consult/chat.vue:2005","âœ… æ ‡ç­¾æ¶ˆæ¯å‘é€æˆåŠŸï¼ˆæ‚£è€… -> åŒ»ç”Ÿï¼‰ï¼Œå·²ä¿å­˜åˆ°å’¨è¯¢è®°å½•")}catch(a){t("error","at pages/online-consult/chat.vue:2007","å‘é€æ ‡ç­¾æ¶ˆæ¯å¤±è´¥:",a),uni.showToast({title:a.message||"å‘é€å¤±è´¥",icon:"none"});const o=m.value.length-1;o>=0&&m.value[o].isMe&&m.value[o].content===e&&m.value.splice(o,1)}else uni.showToast({title:"æœªè¿æ¥ï¼Œè¯·ç¨å€™",icon:"none"})}(a)},[e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(a),1)],8,["onClick"]))),64))])])])):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"video-preview-modal",onClick:q},[e.createElementVNode("view",{class:"video-preview-content",onClick:v[1]||(v[1]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"video-preview-header"},[e.createElementVNode("text",{class:"video-preview-title"},"è§†é¢‘é¢„è§ˆ"),e.createElementVNode("view",{class:"video-close-btn",onClick:q},"Ã—")]),e.createElementVNode("video",{src:d.value,class:"video-player",controls:"",autoplay:!1,"show-center-play-btn":!0,"show-play-btn":!0,"enable-play-gesture":!0,onError:z,poster:u.value,"enable-progress-gesture":!0,"object-fit":"contain"},[e.createElementVNode("source",{src:d.value,type:"video/mp4"},null,8,["src"])],40,["src","poster"])])])):e.createCommentVNode("",!0),k.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"call-modal"},[e.createElementVNode("view",{class:"call-content"},[e.createElementVNode("video",{ref_key:"remoteVideoRef",ref:S,class:"remote-video",autoplay:"",playsinline:""},null,512),e.createElementVNode("video",{ref_key:"localVideoRef",ref:b,class:"local-video",autoplay:"",playsinline:"",muted:""},null,512),e.createElementVNode("view",{class:"call-controls"},[e.createElementVNode("view",{class:"call-control-btn",onClick:R},[e.createElementVNode("text",null,e.toDisplayString(V.value?"ğŸ”‡":"ğŸ¤"),1)]),"video"===N.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"call-control-btn",onClick:O},[e.createElementVNode("text",null,e.toDisplayString(C.value?"ğŸ“¹":"ğŸ“·"),1)])):e.createCommentVNode("",!0),"video"===N.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"call-control-btn",onClick:j},[e.createElementVNode("text",null,"ğŸ”„")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"call-control-btn end-call",onClick:F},[e.createElementVNode("text",null,"ğŸ“´")])]),e.createElementVNode("view",{class:"call-status"},[e.createElementVNode("text",null,e.toDisplayString(x.value),1)])])])):e.createCommentVNode("",!0)])}}}),Ti=s({__name:"index",setup(t){const o=e.ref(""),n=e.ref("ç½‘é¡µå¯¼èˆª");function s(){uni.navigateBack()}return onLoad((e=>{e.url&&(o.value=decodeURIComponent(e.url))})),(t,r)=>{const l=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"web-view-container"},[e.createElementVNode("view",{class:"web-view-header"},[e.createElementVNode("view",{class:"header-left",onClick:s},[e.createVNode(l,{type:"left",size:"24",color:"#333"})]),e.createElementVNode("view",{class:"header-title"},e.toDisplayString(n.value),1),e.createElementVNode("view",{class:"header-right"})]),e.createElementVNode("web-view",{src:o.value},null,8,["src"])])}}},[["__scopeId","data-v-302599bc"]]),Di=s(e.defineComponent({__name:"index",setup(t){const o=e.ref(!1),n=e.ref(null),s=e.ref(""),r=e.ref([]),l=e.ref(""),c=e.ref(""),d=e.ref(""),u=e.computed((()=>l.value&&c.value&&d.value)),m=e=>{const t=(new Date).toLocaleTimeString();r.value.unshift({time:t,content:e}),r.value.length>10&&r.value.pop()},p=async()=>{o.value=!0,s.value="";try{m("å¼€å§‹è·å–å½“å‰ä½ç½®...");const e=await Ve();n.value=e,m("è·å–ä½ç½®æˆåŠŸ")}catch(e){s.value=e instanceof Error?e.message:"è·å–ä½ç½®å¤±è´¥",m(`è·å–ä½ç½®å¤±è´¥ï¼š${s.value}`)}finally{o.value=!1}},h=()=>{l.value="åŒ—äº¬å¤©å®‰é—¨",c.value="39.908718",d.value="116.397491",m("å·²è®¾ç½®é»˜è®¤ç›®çš„åœ°ï¼šåŒ—äº¬å¤©å®‰é—¨")},g=()=>{u.value&&(m("æ˜¾ç¤ºåœ°å›¾é€‰æ‹©èœå•"),uni.showActionSheet({itemList:["é«˜å¾·åœ°å›¾","ç™¾åº¦åœ°å›¾","è…¾è®¯åœ°å›¾","ç½‘é¡µç‰ˆè·¯çº¿"],itemColor:"#333333",success:e=>{m(`ç”¨æˆ·é€‰æ‹©äº†åœ°å›¾é€‰é¡¹ï¼š${e.tapIndex}`);let t="";switch(e.tapIndex){case 0:t="gaode";break;case 1:t="baidu";break;case 2:t="qqmap";break;case 3:t="web"}v(t)},fail:e=>{m(`åœ°å›¾é€‰æ‹©å¤±è´¥ï¼š${e.errMsg}`)}}))},v=e=>{if(!u.value)return;const t={latitude:parseFloat(c.value),longitude:parseFloat(d.value),address:l.value};m(`å¼€å§‹ä½¿ç”¨${"gaode"===e?"é«˜å¾·åœ°å›¾":"baidu"===e?"ç™¾åº¦åœ°å›¾":"qqmap"===e?"è…¾è®¯åœ°å›¾":"ç½‘é¡µç‰ˆ"}å¯¼èˆªåˆ°ï¼š${l.value}`),Ce(t,"web"===e?{mapType:"auto",mode:"drive",destinationName:l.value}:{mapType:e,mode:"drive",destinationName:l.value})};return(t,m)=>{const v=a(e.resolveDynamicComponent("uni-icons"),i);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"ä½ç½®ä¸å¯¼èˆªæ¼”ç¤º")]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"1. è·å–å½“å‰ä½ç½®"),e.createElementVNode("button",{class:"primary-btn",onClick:p,loading:o.value},e.toDisplayString(o.value?"è·å–ä¸­...":"è·å–å½“å‰ä½ç½®"),9,["loading"]),n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"location-info"},[e.createElementVNode("text",{class:"info-label"},"å½“å‰ä½ç½®åæ ‡ï¼š"),e.createElementVNode("text",{class:"info-value"},e.toDisplayString(n.value.latitude.toFixed(6))+", "+e.toDisplayString(n.value.longitude.toFixed(6)),1)])):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-info"},[e.createElementVNode("text",{class:"error-text"},e.toDisplayString(s.value),1)])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"2. è®¾ç½®ç›®çš„åœ°"),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"ç›®çš„åœ°åç§°ï¼š"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":m[0]||(m[0]=e=>l.value=e),type:"text",placeholder:"è¾“å…¥ç›®çš„åœ°åç§°",class:"input"},null,512),[[e.vModelText,l.value]])]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"çº¬åº¦ï¼š"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":m[1]||(m[1]=e=>c.value=e),type:"number",placeholder:"è¾“å…¥çº¬åº¦",class:"input"},null,512),[[e.vModelText,c.value]])]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"ç»åº¦ï¼š"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":m[2]||(m[2]=e=>d.value=e),type:"number",placeholder:"è¾“å…¥ç»åº¦",class:"input"},null,512),[[e.vModelText,d.value]])])]),e.createElementVNode("button",{class:"secondary-btn",onClick:h}," ä½¿ç”¨é»˜è®¤ç›®çš„åœ°ï¼ˆåŒ—äº¬å¤©å®‰é—¨ï¼‰ ")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"3. å¼€å§‹å¯¼èˆª"),e.createElementVNode("view",{class:"nav-buttons"},[e.createElementVNode("button",{class:"circular-nav-btn",onClick:g,disabled:!u.value},[e.createVNode(v,{type:"navigate",size:"40",color:"#fff"}),e.createElementVNode("text",{class:"nav-text"},"å¯¼èˆª")],8,["disabled"])])]),r.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"section"},[e.createElementVNode("text",{class:"section-title"},"æ“ä½œæ—¥å¿—"),e.createElementVNode("view",{class:"logs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:"log-item"},[e.createElementVNode("text",{class:"log-time"},e.toDisplayString(t.time),1),e.createElementVNode("text",{class:"log-content"},e.toDisplayString(t.content),1)])))),128))])])):e.createCommentVNode("",!0)])])}}}),[["__scopeId","data-v-9bf35d3b"]]);__definePage("pages/index/index",p),__definePage("pages/specialty-hospital/index",N),__definePage("pages/doctor/doctor",C),__definePage("pages/buy-medicine/index",O),__definePage("pages/yishuo/yishuo",J),__definePage("pages/yishuo/article-list",de),__definePage("pages/yishuo/article-detail",me),__definePage("pages/mine/mine",ve),__definePage("pages/city/index",we),__definePage("pages/doctor/appointment-register",Ee),__definePage("pages/hospital-detail/index",De),__definePage("pages/doctor/dept-doctors",Be),__definePage("pages/doctor/schedule",_e),__definePage("pages/login/login",Kn),__definePage("pages/login/callback",Gn),__definePage("pages/doctor/department",Yn),__definePage("pages/appointment/index",Qn),__definePage("pages/doctor/disease",Xn),__definePage("pages/doctor/detail",es),__definePage("pages/doctor/appointment",ls),__definePage("pages/doctor/reviews",ds),__definePage("pages/doctor/consultation-history",ms),__definePage("pages/doctor/consultation-detail",hs),__definePage("pages/doctor/live",Es),__definePage("pages/viewer/live",Cs),__definePage("pages/live/list",xs),__definePage("pages/live/entrance",bs),__definePage("pages/doctor/articles",Is),__definePage("pages/doctor/article-detail",Ds),__definePage("pages/doctor/smart-recommend",Us),__definePage("pages/mine/appointments",$s),__definePage("pages/mine/patients",Fs),__definePage("pages/mine/patient-edit",Os),__definePage("pages/mine/consultations",zs),__definePage("pages/mine/favorites",Hs),__definePage("pages/mine/help",Js),__definePage("pages/mine/messages",Ks),__definePage("pages/settings/settings",Ys),__definePage("pages/settings/account/account",Xs),__definePage("pages/settings/notification/notification",Zs),__definePage("pages/settings/address/address",ai),__definePage("pages/settings/address/address-edit",di),__definePage("pages/settings/address/map-selector",mi),__definePage("pages/settings/about/about",pi),__definePage("pages/settings/legal",hi),__definePage("pages/settings/terms",gi),__definePage("pages/settings/privacy",vi),__definePage("pages/settings/realname/realname",yi),__definePage("pages/online-consult/index",Ei),__definePage("pages/online-consult/patient",Si),__definePage("pages/online-consult/chat",Ii),__definePage("pages/web-view/index",Ti),__definePage("pages/location-demo/index",Di);let Bi=[],_i=!1;function Pi(){const e=uni.getSystemInfoSync();return{platform:e.platform,system:e.system,version:e.version,screenWidth:e.screenWidth,screenHeight:e.screenHeight,windowWidth:e.windowWidth,windowHeight:e.windowHeight,pixelRatio:e.pixelRatio,language:e.language}}function Ai(){try{return{userId:ee()?"logged_in":"anonymous",timestamp:(new Date).toISOString()}}catch(Kt){return{userId:"anonymous",timestamp:(new Date).toISOString()}}}async function Ui(e){if(!_i&&0!==e.length){_i=!0;try{await re("/tracking/events",{events:e,deviceInfo:Pi()},{showLoading:!1,showError:!1}),Bi=[]}catch(a){t("warn","at utils/tracker.js:86","åŸ‹ç‚¹æ•°æ®å‘é€å¤±è´¥:",a)}finally{_i=!1}}}function Mi(e,t={}){const a={type:"page_view",pageName:e,...Ai(),...t};Bi.push(a),Bi.length>=10&&Ui([...Bi])}setInterval((()=>{Bi.length>0&&!_i&&Ui([...Bi])}),5e3),uni.onAppHide((()=>{Bi.length>0&&!_i&&Ui([...Bi])}));const $i={globalData:{consultData:null,userProfile:null,userInfo:null},onLaunch:function(){t("log","at App.vue:15","App Launch");try{const e=uni.getStorageSync("API_BASE_URL");e&&(e.includes("natapp")||e.includes("127.0.0.1:80")||!e.includes("http"))&&(t("warn","at App.vue:39","âš ï¸ æ¸…é™¤æ— æ•ˆçš„APIåœ°å€:",e),uni.removeStorageSync("API_BASE_URL"))}catch(Kt){t("warn","at App.vue:44","æ£€æŸ¥APIåœ°å€å¤±è´¥:",Kt)}Mi("app_launch"),this.loadUserData();try{!function(){const e=getApp();e.globalData||(e.globalData={});const t=l();if(e.globalData.currentTheme=t.name,e.globalData.theme=t,"undefined"!=typeof document&&document.documentElement){document.documentElement.setAttribute("data-theme",t.name);const e=document.documentElement;e.style.setProperty("--bg-color",t.bgColor),e.style.setProperty("--card-bg",t.cardBg),e.style.setProperty("--text-color",t.textColor),e.style.setProperty("--text-color-secondary",t.textColorSecondary),e.style.setProperty("--text-color-tertiary",t.textColorTertiary),e.style.setProperty("--border-color",t.borderColor),e.style.setProperty("--primary-color",t.primaryColor),e.style.setProperty("--shadow-color",t.shadowColor)}if("undefined"!=typeof uni&&uni.setTabBarStyle)try{const e=getCurrentPages();if(e&&e.length>0){const a=e[e.length-1],o=["pages/index/index","pages/doctor/doctor","pages/yishuo/yishuo","pages/mine/mine"],n=a.route;if(n&&o.includes(n)){const e=uni.setTabBarStyle({color:"#999999",selectedColor:t.primaryColor,backgroundColor:t.cardBg,borderStyle:"dark"===t.name?"white":"black"});e&&"function"==typeof e.catch&&e.catch((()=>{}))}}}catch(Kt){}}()}catch(Kt){t("error","at App.vue:120","åˆå§‹åŒ–ä¸»é¢˜å¤±è´¥:",Kt)}},onShow:function(){Mi("app_show"),this.loadUserData()},onHide:function(){Mi("app_hide"),this.saveUserData()},methods:{loadUserData(){try{const e=uni.getStorageSync("userInfo");e&&(this.globalData.userInfo=e);const a=uni.getStorageSync("currentUserId"),o=e&&(e.id||e._id||e.userId||e.username)||a||null,n=uni.getStorageSync("userProfilesById")||{};let s=null;if(o&&n[o])s=n[o],this.globalData.userProfile=s,uni.setStorageSync("currentUserId",o);else{const e=uni.getStorageSync("userProfile");e&&(s=e,this.globalData.userProfile=s)}s||(this.globalData.userProfile={avatarUrl:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",nickname:e&&e.username||"ç”¨æˆ·æ˜µç§°",gender:"ä¿å¯†",phone:"",authStatus:"æœªè®¤è¯",realname:"",idCard:""},t("log","at App.vue:179","â„¹ï¸ æœªæ‰¾åˆ°å†å²èµ„æ–™ï¼Œå·²åˆå§‹åŒ–é»˜è®¤userProfile"))}catch(Kt){t("error","at App.vue:182","âŒ åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",Kt),this.globalData.userProfile={avatarUrl:"https://dummyimage.com/200x200/4a90e2/ffffff&text=Avatar",nickname:"ç”¨æˆ·æ˜µç§°",gender:"ä¿å¯†",phone:"",authStatus:"æœªè®¤è¯",realname:"",idCard:""}}},saveUserData(){try{this.globalData.userProfile&&uni.setStorageSync("userProfile",this.globalData.userProfile),this.globalData.userInfo&&uni.setStorageSync("userInfo",this.globalData.userInfo)}catch(Kt){t("error","at App.vue:204","âŒ ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥:",Kt)}}}};const{app:Li,Vuex:Fi,Pinia:Ri}={app:e.createVueApp($i)};uni.Vuex=Fi,uni.Pinia=Ri,Li.provide("__globalStyles",__uniConfig.styles),Li._component.mpType="app",Li._component.render=()=>{},Li.mount("#app")}(Vue);
