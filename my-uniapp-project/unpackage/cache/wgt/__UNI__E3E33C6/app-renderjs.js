var __renderjsModules={};
__renderjsModules["888897b0"]=(()=>{var s=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var u=(o,t)=>{for(var n in t)s(o,n,{get:t[n],enumerable:!0})},i=(o,t,n,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of d(t))!m.call(o,r)&&r!==n&&s(o,r,{get:()=>t[r],enumerable:!(l=a(t,r))||l.enumerable});return o};var p=o=>i(s({},"__esModule",{value:!0}),o);var y={};u(y,{default:()=>g});var e=null,g={mounted(){console.log("renderjs mounted (viewer)")},methods:{updateRemoteStream(o,t,n,l){console.log("updateRemoteStream called:",o);let r=o.stream,c=o.muted;r?(console.log("\u6536\u5230\u8FDC\u7A0B\u6D41\uFF0C\u51C6\u5907\u663E\u793A"),this.displayRemoteStream(r,c)):console.log("stream \u4E3A\u7A7A")},displayRemoteStream(o,t=!1){console.log("displayRemoteStream \u5F00\u59CB");let n=document.getElementById("remoteVideoWrapper");if(!n){console.error("\u627E\u4E0D\u5230 remoteVideoWrapper \u5143\u7D20");return}if(console.log("\u627E\u5230 wrapper\uFF0C\u51C6\u5907\u663E\u793A\u89C6\u9891"),e&&e.parentNode===n){console.log("\u66F4\u65B0\u73B0\u6709\u89C6\u9891\u5143\u7D20"),e.pause(),e.srcObject=o,e.muted=t||!1,setTimeout(()=>{e.play().then(()=>{console.log("\u2705 \u89C6\u9891\u66F4\u65B0\u5E76\u64AD\u653E\u6210\u529F")}).catch(l=>{console.error("\u274C \u64AD\u653E\u5931\u8D25:",l),e.muted=!0,e.play().catch(r=>{console.error("\u274C \u9759\u97F3\u64AD\u653E\u4E5F\u5931\u8D25:",r)})})},100);return}if(e){console.log("\u6E05\u7406\u65E7\u7684\u89C6\u9891\u5143\u7D20");try{e.pause(),e.srcObject=null}catch(l){console.warn("\u6E05\u7406\u65E7\u5143\u7D20\u65F6\u51FA\u9519:",l)}e=null}n.innerHTML="",console.log("\u521B\u5EFA\u65B0\u7684\u89C6\u9891\u5143\u7D20"),e=document.createElement("video"),e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.muted=t||!1,e.style.width="100%",e.style.height="100%",e.style.objectFit="cover",e.style.background="#000",e.onerror=l=>{console.error("\u89C6\u9891\u5143\u7D20\u9519\u8BEF:",l)},n.appendChild(e),e.srcObject=o,setTimeout(()=>{e&&e.parentNode&&e.play().then(()=>{console.log("\u2705 \u8FDC\u7A0B\u89C6\u9891\u64AD\u653E\u6210\u529F")}).catch(l=>{console.error("\u274C \u64AD\u653E\u8FDC\u7A0B\u89C6\u9891\u5931\u8D25:",l),e&&(e.muted=!0,e.play().catch(r=>{console.error("\u274C \u9759\u97F3\u64AD\u653E\u4E5F\u5931\u8D25:",r)}))})},100),console.log("\u2705 \u8FDC\u7A0B\u89C6\u9891\u5143\u7D20\u5DF2\u6DFB\u52A0\u5230 DOM")}}};return p(y);})();

__renderjsModules["7246740a"]=(()=>{var u=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var f=(e,l)=>{for(var t in l)u(e,t,{get:l[t],enumerable:!0})},w=(e,l,t,o)=>{if(l&&typeof l=="object"||typeof l=="function")for(let s of p(l))!y.call(e,s)&&s!==t&&u(e,s,{get:()=>l[s],enumerable:!(o=h(l,s))||o.enumerable});return e};var b=e=>w(u({},"__esModule",{value:!0}),e);var n=(e,l,t)=>new Promise((o,s)=>{var r=c=>{try{m(t.next(c))}catch(g){s(g)}},d=c=>{try{m(t.throw(c))}catch(g){s(g)}},m=c=>c.done?o(c.value):Promise.resolve(c.value).then(r,d);m((t=t.apply(e,l)).next())});var T={};f(T,{default:()=>C});var i=null,a=null;var C={mounted(){console.log("renderjs mounted")},methods:{updateStream(e,l,t,o){return n(this,null,function*(){let s=e.action,r=e.position,d=e.roomId;console.log("updateStream:",s,r),s==="start"?yield this.startCamera(r,d,t):s==="switch"?yield this.switchCamera(r,t):s==="stop"&&this.stopCamera()})},startCamera(e,l,t){return n(this,null,function*(){try{console.log("\u{1F3AC} renderjs: \u5F00\u59CB\u542F\u52A8\u6444\u50CF\u5934..."),console.log("position:",e),console.log("ownerInstance:",t),console.log("ownerInstance \u7C7B\u578B:",typeof t),console.log("\u{1F4F8} \u8BF7\u6C42\u6444\u50CF\u5934\u6743\u9650...");let o=yield navigator.mediaDevices.getUserMedia({video:{facingMode:e,width:{ideal:1280},height:{ideal:720}},audio:!0});if(i=o,console.log("\u2705 \u6444\u50CF\u5934\u6D41\u5DF2\u83B7\u53D6"),console.log("- \u89C6\u9891\u8F68\u9053\u6570:",o.getVideoTracks().length),console.log("- \u97F3\u9891\u8F68\u9053\u6570:",o.getAudioTracks().length),console.log("- \u6D41ID:",o.id),console.log("- \u6D41\u662F\u5426\u6D3B\u8DC3:",o.active),console.log("\u{1F504} \u51C6\u5907\u8C03\u7528 Vue \u65B9\u6CD5..."),typeof window.__setWebRTCStream=="function")try{console.log("\u{1F504} \u5C1D\u8BD5\u5168\u5C40\u65B9\u6CD5 window.__setWebRTCStream...");let r=window.__setWebRTCStream(o);console.log("\u2705 \u5168\u5C40\u65B9\u6CD5\u8C03\u7528\u5B8C\u6210\uFF0C\u8FD4\u56DE\u503C:",r)}catch(r){console.error("\u274C \u5168\u5C40\u65B9\u6CD5\u8C03\u7528\u5931\u8D25:",r),console.error("\u9519\u8BEF\u5806\u6808:",r.stack)}else if(t&&typeof t.callMethod=="function")try{console.log("\u{1F504} \u5C1D\u8BD5 callMethod...");let r=t.callMethod("setWebRTCStream",o);console.log("\u2705 callMethod \u8C03\u7528\u5B8C\u6210\uFF0C\u8FD4\u56DE\u503C:",r)}catch(r){console.error("\u274C callMethod \u5931\u8D25:",r),console.error("\u9519\u8BEF\u5806\u6808:",r.stack)}console.log("\u{1F504} \u540C\u65F6\u53D1\u9001\u4E8B\u4EF6..."),uni.$emit("webrtc-stream-ready",o),console.log("\u2705 \u4E8B\u4EF6\u5DF2\u53D1\u9001");let s=document.getElementById("videoWrapper");s?(console.log("\u{1F4FA} \u521B\u5EFA\u672C\u5730\u9884\u89C8\u89C6\u9891\u5143\u7D20"),s.innerHTML="",a=document.createElement("video"),a.setAttribute("autoplay","true"),a.setAttribute("playsinline","true"),a.setAttribute("muted","true"),a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.style.transform="scaleX(-1)",a.style.background="#000",s.appendChild(a),a.srcObject=o,setTimeout(()=>n(this,null,function*(){try{yield a.play(),console.log("\u2705 \u672C\u5730\u9884\u89C8\u5DF2\u663E\u793A")}catch(r){console.error("\u274C \u64AD\u653E\u5931\u8D25:",r)}}),100)):console.error("\u274C \u627E\u4E0D\u5230 videoWrapper \u5143\u7D20")}catch(o){console.error("\u274C \u542F\u52A8\u6444\u50CF\u5934\u5931\u8D25:",o),console.error("\u9519\u8BEF\u8BE6\u60C5:",o.message,o.name),uni.showToast({title:"\u65E0\u6CD5\u8BBF\u95EE\u6444\u50CF\u5934: "+o.message,icon:"none"})}})},switchCamera(e,l){return n(this,null,function*(){this.stopCamera(),yield this.startCamera(e,null,l)})},stopCamera(){i&&(i.getTracks().forEach(l=>{l.stop()}),i=null),a&&(a.srcObject=null,a=null);let e=document.getElementById("videoWrapper");e&&(e.innerHTML=""),console.log("\u6444\u50CF\u5934\u5DF2\u505C\u6B62")}}};return b(T);})();
