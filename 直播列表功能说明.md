# 📺 直播列表功能使用指南

## ✅ 已完成的功能

### 1. 创建了直播列表页面
- ✅ 文件位置：`pages/live/list.vue`
- ✅ 显示所有正在进行的直播间
- ✅ 实时显示观众数量
- ✅ 显示直播时长
- ✅ 点击直播间卡片可进入观看

### 2. 修改了首页跳转
- ✅ 首页"医生直播"卡片现在跳转到直播列表页面
- ✅ 用户可以看到所有正在直播的医生

---

## 🎯 使用流程

### 用户端流程

```
首页
  ↓ 点击"医生直播"卡片
直播列表页面
  ↓ 点击某个直播间
观看直播页面
```

### 医生端流程

```
医生直播页面
  ↓ 开始直播
直播间创建成功
  ↓ 自动出现在列表中
观众可以看到并加入
```

---

## 📱 页面功能说明

### 直播列表页面 (`/pages/live/list`)

**功能特性：**
- ✅ 显示所有正在进行的直播间
- ✅ 实时显示观众数量（👥 图标）
- ✅ 显示直播时长（如：直播中 5分钟）
- ✅ 显示"直播中"红点动画
- ✅ 下拉刷新列表
- ✅ 自动刷新（每10秒）
- ✅ 空状态提示（暂无直播时）
- ✅ 加载状态动画

**界面元素：**
```
┌─────────────────────────────┐
│  直播间列表          🔄     │
├─────────────────────────────┤
│  ┌───────────────────────┐  │
│  │ [封面图]              │  │
│  │ 🔴 直播中    👥 12    │  │
│  ├───────────────────────┤  │
│  │ 👨‍⚕️ 王医生            │  │
│  │ 直播中 5分钟          │  │
│  │ 心血管健康科普        │  │
│  └───────────────────────┘  │
│                             │
│  ┌───────────────────────┐  │
│  │ [封面图]              │  │
│  │ 🔴 直播中    👥 8     │  │
│  └───────────────────────┘  │
├─────────────────────────────┤
│  共 2 个直播间              │
└─────────────────────────────┘
```

---

## 🔧 技术实现

### 1. 后端 API

**获取直播间列表：**
```
GET http://localhost:3000/api/webrtc/rooms
```

**响应格式：**
```json
{
  "success": true,
  "data": [
    {
      "roomId": "room_1234567890",
      "doctorId": "doctor_1234567890",
      "doctorName": "王医生",
      "title": "心血管健康科普",
      "startTime": 1234567890000,
      "viewerCount": 12
    }
  ]
}
```

### 2. 自动刷新机制

- ✅ 页面加载时立即获取列表
- ✅ 每10秒自动刷新一次
- ✅ 下拉刷新手动更新
- ✅ 页面卸载时停止定时器

### 3. 时长计算

```typescript
const formatLiveTime = (startTime: number) => {
  const now = Date.now()
  const elapsed = Math.floor((now - startTime) / 1000)
  
  const hours = Math.floor(elapsed / 3600)
  const minutes = Math.floor((elapsed % 3600) / 60)
  
  if (hours > 0) {
    return `直播中 ${hours}小时${minutes}分钟`
  } else if (minutes > 0) {
    return `直播中 ${minutes}分钟`
  } else {
    return '刚刚开始'
  }
}
```

---

## 🧪 测试步骤

### 步骤 1: 启动后端服务器

```bash
cd c:\Users\Lenovo\Desktop\2502B\2502-b-main\houduan
node app.js
```

### 步骤 2: 启动前端项目

```bash
cd c:\Users\Lenovo\Desktop\2502B\2502-b-main\Group-project\my-uniapp-project
npm run dev:h5
```

### 步骤 3: 医生开启直播

1. 访问医生直播页面：`/pages/doctor/live`
2. 输入直播主题
3. 点击"开始直播"
4. 直播间创建成功

### 步骤 4: 查看直播列表

1. 回到首页
2. 点击"医生直播"卡片
3. 应该看到刚才创建的直播间
4. 显示观众数量、直播时长等信息

### 步骤 5: 加入直播

1. 点击直播间卡片
2. 自动跳转到观看页面
3. 可以看到医生的视频画面
4. 可以发送聊天消息

---

## 📊 预期效果

### 有直播时

```
┌─────────────────────────────┐
│  直播间列表          🔄     │
├─────────────────────────────┤
│  ┌───────────────────────┐  │
│  │ [医生头像]            │  │
│  │ 🔴 直播中    👥 12    │  │
│  ├───────────────────────┤  │
│  │ 👨‍⚕️ 王医生            │  │
│  │ 直播中 5分钟          │  │
│  │ 心血管健康科普        │  │
│  └───────────────────────┘  │
├─────────────────────────────┤
│  共 1 个直播间              │
└─────────────────────────────┘
```

### 无直播时

```
┌─────────────────────────────┐
│  直播间列表          🔄     │
├─────────────────────────────┤
│                             │
│         📺                  │
│      暂无直播               │
│  当前没有医生在线直播       │
│                             │
│    [刷新列表]               │
│                             │
├─────────────────────────────┤
│  共 0 个直播间              │
└─────────────────────────────┘
```

---

## 🎨 界面特性

### 1. 渐变背景
- 紫色渐变背景（#667eea → #764ba2）
- 现代化设计风格

### 2. 直播状态指示
- 🔴 红色脉动圆点
- "直播中"文字标识
- 动画效果吸引注意

### 3. 卡片设计
- 白色卡片背景
- 圆角设计
- 阴影效果
- 点击反馈动画

### 4. 信息展示
- 医生头像
- 医生姓名
- 直播标题
- 观众数量
- 直播时长

---

## 🔄 数据流程

```
医生开启直播
    ↓
后端创建直播间记录
    ↓
直播间信息存储在 liveRooms Map
    ↓
前端调用 /api/webrtc/rooms
    ↓
获取所有直播间列表
    ↓
显示在列表页面
    ↓
观众点击进入观看
```

---

## 💡 优化建议（可选）

### 1. 添加分类筛选

```vue
<view class="category-tabs">
  <view class="tab" :class="{ active: category === 'all' }">全部</view>
  <view class="tab" :class="{ active: category === 'cardiology' }">心内科</view>
  <view class="tab" :class="{ active: category === 'pediatrics' }">儿科</view>
</view>
```

### 2. 添加搜索功能

```vue
<view class="search-box">
  <input placeholder="搜索医生或主题" v-model="searchKeyword" />
</view>
```

### 3. 添加排序功能

```typescript
// 按观众数量排序
liveRooms.value.sort((a, b) => b.viewerCount - a.viewerCount)

// 按开始时间排序
liveRooms.value.sort((a, b) => b.startTime - a.startTime)
```

### 4. 添加收藏功能

```vue
<view class="favorite-btn" @click.stop="toggleFavorite(room)">
  <text>{{ room.isFavorite ? '❤️' : '🤍' }}</text>
</view>
```

---

## ❓ 常见问题

### Q1: 列表显示为空？

**检查：**
1. 后端服务器是否启动？
2. 是否有医生正在直播？
3. API 地址是否正确？
4. 浏览器控制台有什么错误？

**解决：**
```bash
# 检查后端
curl http://localhost:3000/api/webrtc/rooms

# 应该返回
{"success":true,"data":[...]}
```

### Q2: 点击直播间无反应？

**检查：**
1. roomId 是否正确传递？
2. 观看页面路由是否正确？
3. 控制台是否有错误？

**解决：**
```typescript
// 检查 joinRoom 函数
const joinRoom = (room: any) => {
  console.log('加入直播间:', room.roomId)
  uni.navigateTo({
    url: `/pages/viewer/live?roomId=${room.roomId}`
  })
}
```

### Q3: 观众数量不更新？

**原因：**
- 列表页面使用定时刷新（每10秒）
- 不是实时更新

**解决：**
- 可以手动下拉刷新
- 或者点击右上角刷新按钮

---

## 🎉 完成！

现在你的应用已经有完整的直播功能：

1. ✅ 首页 → 点击"医生直播" → 直播列表
2. ✅ 直播列表 → 显示所有直播间
3. ✅ 点击直播间 → 进入观看页面
4. ✅ 实时聊天功能
5. ✅ 观众数量统计

**立即测试吧！** 🚀

